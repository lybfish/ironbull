(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-19a8ffb7"],{"923a":function(e,t,i){},b01f:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ele-body"},[i("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{shadow:"never"}},[i("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[i("span",[e._v("系统监控")]),i("div",[i("el-tag",{staticStyle:{"margin-right":"12px"},attrs:{type:e.overallType,size:"small"}},[e._v(e._s(e.overallLabel))]),i("el-switch",{attrs:{"active-text":"自动刷新","inactive-text":"手动刷新"},on:{change:e.handleAutoRefreshChange},model:{value:e.autoRefresh,callback:function(t){e.autoRefresh=t},expression:"autoRefresh"}}),i("el-button",{staticStyle:{"margin-left":"12px"},attrs:{type:"primary",size:"mini",icon:"el-icon-refresh"},on:{click:e.fetchData}},[e._v("刷新")])],1)]),i("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:15}},[e._l(e.services,(function(t){return i("el-col",{key:t.name,attrs:{span:6}},[i("stat-card",{attrs:{title:t.name,value:t.healthy?"在线":"离线",icon:"el-icon-connection",color:t.healthy?"success":"danger","help-text":t.latency_ms?"响应 "+t.latency_ms+"ms":t.error||"未知",loading:e.loading}})],1)})),i("el-col",{attrs:{span:6}},[i("stat-card",{attrs:{title:"数据库",value:e.dbStatus.mysql_ok?"正常":"异常",icon:"el-icon-coin",color:e.dbStatus.mysql_ok?"success":"danger","help-text":"MySQL 连接状态",loading:e.loading}})],1),i("el-col",{attrs:{span:6}},[i("stat-card",{attrs:{title:"Redis",value:e.dbStatus.redis_ok?"正常":"异常",icon:"el-icon-box",color:e.dbStatus.redis_ok?"success":"danger","help-text":"Redis 连接状态",loading:e.loading}})],1)],2),e.metrics.summary?i("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[i("el-col",{attrs:{lg:6,md:12}},[i("el-card",{staticClass:"metric-card",attrs:{shadow:"never"}},[i("div",{staticClass:"metric-label"},[e._v("API 调用量 ("+e._s(e.metricDays)+"天)")]),i("div",{staticClass:"metric-val"},[e._v(e._s(e.metrics.summary.total_calls))])])],1),i("el-col",{attrs:{lg:6,md:12}},[i("el-card",{staticClass:"metric-card",attrs:{shadow:"never"}},[i("div",{staticClass:"metric-label"},[e._v("错误数")]),i("div",{staticClass:"metric-val text-danger"},[e._v(e._s(e.metrics.summary.total_errors))])])],1),i("el-col",{attrs:{lg:6,md:12}},[i("el-card",{staticClass:"metric-card",attrs:{shadow:"never"}},[i("div",{staticClass:"metric-label"},[e._v("错误率")]),i("div",{staticClass:"metric-val",class:e.metrics.summary.error_rate>5?"text-danger":"text-success"},[e._v(" "+e._s(e.metrics.summary.error_rate)+"% ")])])],1),i("el-col",{attrs:{lg:6,md:12}},[i("el-card",{staticClass:"metric-card",attrs:{shadow:"never"}},[i("div",{staticClass:"metric-label"},[e._v("平均延迟")]),i("div",{staticClass:"metric-val",class:e.metrics.summary.avg_latency_ms>500?"text-warning":""},[e._v(" "+e._s(e.metrics.summary.avg_latency_ms)+"ms ")])])],1)],1):e._e(),i("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[i("el-col",{attrs:{lg:12,md:24}},[i("el-card",{attrs:{shadow:"never"}},[i("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[i("span",[e._v("API 调用量 & 错误数")]),i("el-radio-group",{attrs:{size:"mini"},on:{change:e.fetchMetrics},model:{value:e.metricDays,callback:function(t){e.metricDays=t},expression:"metricDays"}},[i("el-radio-button",{attrs:{label:7}},[e._v("7天")]),i("el-radio-button",{attrs:{label:14}},[e._v("14天")]),i("el-radio-button",{attrs:{label:30}},[e._v("30天")])],1)],1),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.metricsLoading,expression:"metricsLoading"}],ref:"chartCalls",staticStyle:{height:"240px"}})])],1),i("el-col",{attrs:{lg:12,md:24}},[i("el-card",{attrs:{shadow:"never"}},[i("div",{attrs:{slot:"header"},slot:"header"},[i("span",[e._v("API 延迟 (ms)")])]),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.metricsLoading,expression:"metricsLoading"}],ref:"chartLatency",staticStyle:{height:"240px"}})])],1)],1),e.metrics.error_by_service&&e.metrics.error_by_service.length?i("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[i("el-col",{attrs:{span:24}},[i("el-card",{attrs:{shadow:"never"}},[i("div",{attrs:{slot:"header"},slot:"header"},[e._v("错误按服务分布")]),i("el-table",{attrs:{data:e.metrics.error_by_service,size:"mini",stripe:"",border:""}},[i("el-table-column",{attrs:{prop:"service",label:"服务"}}),i("el-table-column",{attrs:{prop:"count",label:"错误数",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[i("el-tag",{attrs:{type:"danger",size:"mini"}},[e._v(e._s(r.count))])]}}],null,!1,3695536802)})],1)],1)],1)],1):e._e(),i("el-card",{staticStyle:{"margin-bottom":"16px"},attrs:{shadow:"never"}},[i("div",{attrs:{slot:"header"},slot:"header"},[e._v("服务健康详情")]),i("el-table",{attrs:{data:e.services,stripe:"",border:"",size:"small"}},[i("el-table-column",{attrs:{prop:"name",label:"服务名",width:"180"}}),i("el-table-column",{attrs:{prop:"url",label:"健康检查地址","min-width":"250","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{label:"状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[i("el-tag",{attrs:{type:r.healthy?"success":"danger",size:"mini"}},[e._v(e._s(r.healthy?"健康":"异常"))])]}}])}),i("el-table-column",{attrs:{label:"延迟",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.latency_ms?i("span",[e._v(e._s(r.latency_ms)+"ms")]):i("span",{staticStyle:{color:"#909399"}},[e._v("-")])]}}])}),i("el-table-column",{attrs:{label:"错误","min-width":"200","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.error?i("span",{staticStyle:{color:"#F56C6C"}},[e._v(e._s(r.error))]):i("span",{staticStyle:{color:"#67C23A"}},[e._v("无")])]}}])})],1)],1),i("el-card",{staticStyle:{"margin-bottom":"16px"},attrs:{shadow:"never"}},[i("div",{attrs:{slot:"header"},slot:"header"},[e._v("基础设施")]),i("el-descriptions",{attrs:{column:4,border:"",size:"small"}},[i("el-descriptions-item",{attrs:{label:"MySQL"}},[i("el-tag",{attrs:{type:e.dbStatus.mysql_ok?"success":"danger",size:"mini"}},[e._v(e._s(e.dbStatus.mysql_ok?"正常":"异常"))])],1),i("el-descriptions-item",{attrs:{label:"Redis"}},[i("el-tag",{attrs:{type:e.dbStatus.redis_ok?"success":"danger",size:"mini"}},[e._v(e._s(e.dbStatus.redis_ok?"正常":"异常"))])],1),e.dbStatus.mysql_latency_ms?i("el-descriptions-item",{attrs:{label:"MySQL 延迟"}},[e._v(e._s(e.dbStatus.mysql_latency_ms)+"ms")]):e._e(),e.dbStatus.redis_latency_ms?i("el-descriptions-item",{attrs:{label:"Redis 延迟"}},[e._v(e._s(e.dbStatus.redis_latency_ms)+"ms")]):e._e()],1)],1)],1),e.nodes.length>0?i("el-card",{staticStyle:{"margin-top":"16px"},attrs:{shadow:"never"}},[i("div",{attrs:{slot:"header"},slot:"header"},[i("span",[e._v("执行节点心跳")]),i("el-tag",{staticStyle:{"margin-left":"8px"},attrs:{size:"mini"}},[e._v(e._s(e.nodes.length)+" 个节点")])],1),i("el-table",{attrs:{data:e.nodes,stripe:"",border:"",size:"small"}},[i("el-table-column",{attrs:{prop:"code",label:"节点编码",width:"150"}}),i("el-table-column",{attrs:{prop:"name",label:"节点名称",width:"150"}}),i("el-table-column",{attrs:{label:"状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[i("el-tag",{attrs:{type:r.online?"success":"danger",size:"mini"}},[e._v(e._s(r.online?"在线":"离线"))])]}}],null,!1,370005269)}),i("el-table-column",{attrs:{label:"最后心跳",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[e._v(e._s(e.formatTime(i.last_heartbeat)))]}}],null,!1,2949088037)}),i("el-table-column",{attrs:{label:"延迟/超时",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[null!=r.seconds_since_heartbeat?i("span",[e._v(e._s(r.seconds_since_heartbeat)+"s")]):i("span",[e._v("-")])]}}],null,!1,241280005)})],1)],1):e._e()],1)},a=[],n=(i("0643"),i("4e3e"),i("a573"),i("7cf8")),o=i("22b4"),l=i("1be7"),s=i("3620"),c=i("4cb5"),d=i("4b2a"),h=i("2da7"),u=i("ff32"),g=i("f95e");o["a"]([s["a"],c["a"],d["a"],h["a"],u["a"],g["a"]]);var p={name:"SystemMonitor",data(){return{loading:!1,metricsLoading:!1,overall:"",services:[],nodes:[],dbStatus:{mysql_ok:!1,redis_ok:!1},autoRefresh:!1,refreshTimer:null,metricDays:7,metrics:{},chartInst:{}}},computed:{overallType(){return"healthy"===this.overall?"success":"degraded"===this.overall?"warning":"info"},overallLabel(){return"healthy"===this.overall?"系统正常":"degraded"===this.overall?"系统降级":"加载中..."}},mounted(){this.fetchData(),this.fetchMetrics(),this.resizeFn=()=>{Object.values(this.chartInst).forEach(e=>e&&e.resize())},window.addEventListener("resize",this.resizeFn)},beforeDestroy(){this.clearRefreshTimer(),window.removeEventListener("resize",this.resizeFn),Object.values(this.chartInst).forEach(e=>e&&e.dispose())},methods:{formatTime(e){return e?e.replace("T"," ").substring(0,19):"-"},getChart(e){if(this.chartInst[e])return this.chartInst[e];const t=this.$refs[e];if(!t)return null;const i=l["b"](t);return this.chartInst[e]=i,i},async fetchData(){this.loading=!0;try{const e=await Object(n["g"])(),t=e.data.data||e.data||{};this.overall=t.overall||"",this.services=t.services||[],this.nodes=t.nodes||[],this.dbStatus=t.db||{mysql_ok:!1,redis_ok:!1}}catch(e){this.$message.error("获取监控状态失败")}finally{this.loading=!1}},async fetchMetrics(){this.metricsLoading=!0;try{const e=await Object(n["f"])(this.metricDays);this.metrics=e.data&&e.data.data||{},this.$nextTick(()=>{this.renderCallsChart(),this.renderLatencyChart()})}catch(e){console.error("metrics error",e)}finally{this.metricsLoading=!1}},renderCallsChart(){const e=this.getChart("chartCalls");if(!e||!this.metrics.daily)return;const t=this.metrics.daily;e.setOption({tooltip:{trigger:"axis"},legend:{data:["调用量","错误数"],bottom:0},grid:{left:50,right:20,top:10,bottom:35},xAxis:{type:"category",data:(t.dates||[]).map(e=>e.slice(5)),axisLabel:{fontSize:11}},yAxis:{type:"value",splitLine:{lineStyle:{color:"#F2F6FC"}}},series:[{name:"调用量",type:"bar",data:t.api_calls||[],itemStyle:{color:"#409EFF",borderRadius:[3,3,0,0]},barMaxWidth:20},{name:"错误数",type:"bar",data:t.errors||[],itemStyle:{color:"#F56C6C",borderRadius:[3,3,0,0]},barMaxWidth:20}]},!0)},renderLatencyChart(){const e=this.getChart("chartLatency");if(!e||!this.metrics.daily)return;const t=this.metrics.daily;e.setOption({tooltip:{trigger:"axis"},legend:{data:["平均延迟","最大延迟"],bottom:0},grid:{left:50,right:20,top:10,bottom:35},xAxis:{type:"category",data:(t.dates||[]).map(e=>e.slice(5)),axisLabel:{fontSize:11}},yAxis:{type:"value",name:"ms",splitLine:{lineStyle:{color:"#F2F6FC"}}},series:[{name:"平均延迟",type:"line",data:t.avg_latency||[],smooth:!0,lineStyle:{color:"#E6A23C"},itemStyle:{color:"#E6A23C"},symbol:"circle",symbolSize:4},{name:"最大延迟",type:"line",data:t.max_latency||[],smooth:!0,lineStyle:{color:"#F56C6C",type:"dashed"},itemStyle:{color:"#F56C6C"},symbol:"none"}]},!0)},handleAutoRefreshChange(e){e?this.startAutoRefresh():this.clearRefreshTimer()},startAutoRefresh(){this.clearRefreshTimer(),this.refreshTimer=setInterval(()=>{this.fetchData()},3e4)},clearRefreshTimer(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)}}},m=p,y=(i("f341"),i("2877")),f=Object(y["a"])(m,r,a,!1,null,"3a4927af",null);t["default"]=f.exports},f341:function(e,t,i){"use strict";i("923a")},ff32:function(e,t,i){"use strict";i.d(t,"a",(function(){return Z}));var r=i("22b4"),a=i("9ab4"),n=i("6d8b"),o=i("4319"),l=i("e0d3"),s=i("6cb7"),c=function(e,t){return"all"===t?{type:"all",title:e.getLocale(["legend","selector","all"])}:"inverse"===t?{type:"inverse",title:e.getLocale(["legend","selector","inverse"])}:void 0},d=function(e){function t(){var i=null!==e&&e.apply(this,arguments)||this;return i.type=t.type,i.layoutMode={type:"box",ignoreSize:!0},i}return Object(a["b"])(t,e),t.prototype.init=function(e,t,i){this.mergeDefaultAndTheme(e,i),e.selected=e.selected||{},this._updateSelector(e)},t.prototype.mergeOption=function(t,i){e.prototype.mergeOption.call(this,t,i),this._updateSelector(t)},t.prototype._updateSelector=function(e){var t=e.selector,i=this.ecModel;!0===t&&(t=e.selector=["all","inverse"]),n["r"](t)&&n["j"](t,(function(e,r){n["z"](e)&&(e={type:e}),t[r]=n["F"](e,c(i,e.type))}))},t.prototype.optionUpdated=function(){this._updateData(this.ecModel);var e=this._data;if(e[0]&&"single"===this.get("selectedMode")){for(var t=!1,i=0;i<e.length;i++){var r=e[i].get("name");if(this.isSelected(r)){this.select(r),t=!0;break}}!t&&this.select(e[0].get("name"))}},t.prototype._updateData=function(e){var t=[],i=[];e.eachRawSeries((function(r){var a,n=r.name;if(i.push(n),r.legendVisualProvider){var o=r.legendVisualProvider,s=o.getAllNames();e.isSeriesFiltered(r)||(i=i.concat(s)),s.length?t=t.concat(s):a=!0}else a=!0;a&&Object(l["l"])(r)&&t.push(r.name)})),this._availableNames=i;var r=this.get("data")||t,a=n["E"](r,(function(e){return"string"!==typeof e&&"number"!==typeof e||(e={name:e}),new o["a"](e,this,this.ecModel)}),this);this._data=a},t.prototype.getData=function(){return this._data},t.prototype.select=function(e){var t=this.option.selected,i=this.get("selectedMode");if("single"===i){var r=this._data;n["j"](r,(function(e){t[e.get("name")]=!1}))}t[e]=!0},t.prototype.unSelect=function(e){"single"!==this.get("selectedMode")&&(this.option.selected[e]=!1)},t.prototype.toggleSelected=function(e){var t=this.option.selected;t.hasOwnProperty(e)||(t[e]=!0),this[t[e]?"unSelect":"select"](e)},t.prototype.allSelect=function(){var e=this._data,t=this.option.selected;n["j"](e,(function(e){t[e.get("name",!0)]=!0}))},t.prototype.inverseSelect=function(){var e=this._data,t=this.option.selected;n["j"](e,(function(e){var i=e.get("name",!0);t.hasOwnProperty(i)||(t[i]=!0),t[i]=!t[i]}))},t.prototype.isSelected=function(e){var t=this.option.selected;return!(t.hasOwnProperty(e)&&!t[e])&&n["p"](this._availableNames,e)>=0},t.prototype.getOrient=function(){return"vertical"===this.get("orient")?{index:1,name:"vertical"}:{index:0,name:"horizontal"}},t.type="legend.plain",t.dependencies=["series"],t.defaultOption={zlevel:0,z:4,show:!0,orient:"horizontal",left:"center",top:0,align:"auto",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemGap:10,itemWidth:25,itemHeight:14,symbolRotate:"inherit",inactiveColor:"#ccc",inactiveBorderColor:"#ccc",inactiveBorderWidth:"auto",itemStyle:{color:"inherit",opacity:"inherit",decal:"inherit",shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,borderColor:"inherit",borderWidth:"auto",borderCap:"inherit",borderJoin:"inherit",borderDashOffset:"inherit",borderMiterLimit:"inherit"},lineStyle:{width:"auto",color:"inherit",inactiveColor:"#ccc",inactiveWidth:2,opacity:"inherit",type:"inherit",cap:"inherit",join:"inherit",dashOffset:"inherit",miterLimit:"inherit",shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0},textStyle:{color:"#333"},selectedMode:!0,selector:!1,selectorLabel:{show:!0,borderRadius:10,padding:[3,5,3,5],fontSize:12,fontFamily:" sans-serif",color:"#666",borderWidth:1,borderColor:"#666"},emphasis:{selectorLabel:{show:!0,color:"#eee",backgroundColor:"#666"}},selectorPosition:"auto",selectorItemGap:7,selectorButtonGap:10,tooltip:{show:!1}},t}(s["a"]),h=d,u=i("41ef"),g=i("2dc5"),p=i("76a5"),m=i("c7a2"),y=i("2306"),f=i("7d6c"),v=i("7837"),b=i("f934"),_=i("eda2");function S(e,t){var i=_["g"](t.get("padding")),r=t.getItemStyle(["color","opacity"]);return r.fill=t.get("backgroundColor"),e=new m["a"]({shape:{x:e.x-i[3],y:e.y-i[0],width:e.width+i[1]+i[3],height:e.height+i[0]+i[2],r:t.get("borderRadius")},style:r,silent:!0,z2:-1}),e}var x=i("b12f"),w=i("3901"),C=i("551f"),I=i("a15a"),O=n["h"],k=n["j"],R=g["a"],z=function(e){function t(){var i=null!==e&&e.apply(this,arguments)||this;return i.type=t.type,i.newlineDisabled=!1,i}return Object(a["b"])(t,e),t.prototype.init=function(){this.group.add(this._contentGroup=new R),this.group.add(this._selectorGroup=new R),this._isFirstRender=!0},t.prototype.getContentGroup=function(){return this._contentGroup},t.prototype.getSelectorGroup=function(){return this._selectorGroup},t.prototype.render=function(e,t,i){var r=this._isFirstRender;if(this._isFirstRender=!1,this.resetInner(),e.get("show",!0)){var a=e.get("align"),o=e.get("orient");a&&"auto"!==a||(a="right"===e.get("left")&&"vertical"===o?"right":"left");var l=e.get("selector",!0),s=e.get("selectorPosition",!0);!l||s&&"auto"!==s||(s="horizontal"===o?"end":"start"),this.renderInner(a,e,t,i,l,o,s);var c=e.getBoxLayoutParams(),d={width:i.getWidth(),height:i.getHeight()},h=e.get("padding"),u=b["d"](c,d,h),g=this.layoutInner(e,a,u,r,l,s),p=b["d"](n["i"]({width:g.width,height:g.height},c),d,h);this.group.x=p.x-g.x,this.group.y=p.y-g.y,this.group.markRedraw(),this.group.add(this._backgroundEl=S(g,e))}},t.prototype.resetInner=function(){this.getContentGroup().removeAll(),this._backgroundEl&&this.group.remove(this._backgroundEl),this.getSelectorGroup().removeAll()},t.prototype.renderInner=function(e,t,i,r,a,o,l){var s=this.getContentGroup(),c=n["f"](),d=t.get("selectedMode"),h=[];i.eachRawSeries((function(e){!e.get("legendHoverLink")&&h.push(e.id)})),k(t.getData(),(function(a,n){var o=a.get("name");if(!this.newlineDisabled&&(""===o||"\n"===o)){var l=new R;return l.newline=!0,void s.add(l)}var g=i.getSeriesByName(o)[0];if(!c.get(o)){if(g){var p=g.getData(),m=p.getVisual("legendLineStyle")||{},y=p.getVisual("legendIcon"),f=p.getVisual("style"),v=this._createItem(g,o,n,a,t,e,m,f,y,d);v.on("click",O(G,o,null,r,h)).on("mouseover",O(P,g.name,null,r,h)).on("mouseout",O(A,g.name,null,r,h)),c.set(o,!0)}else i.eachRawSeries((function(i){if(!c.get(o)&&i.legendVisualProvider){var l=i.legendVisualProvider;if(!l.containName(o))return;var s=l.indexOfName(o),g=l.getItemVisual(s,"style"),p=l.getItemVisual(s,"legendIcon"),m=Object(u["c"])(g.fill);m&&0===m[3]&&(m[3]=.2,g.fill=Object(u["d"])(m,"rgba"));var y=this._createItem(i,o,n,a,t,e,{},g,p,d);y.on("click",O(G,null,o,r,h)).on("mouseover",O(P,null,o,r,h)).on("mouseout",O(A,null,o,r,h)),c.set(o,!0)}}),this);0}}),this),a&&this._createSelector(a,t,r,o,l)},t.prototype._createSelector=function(e,t,i,r,a){var n=this.getSelectorGroup();k(e,(function(e){var r=e.type,a=new p["a"]({style:{x:0,y:0,align:"center",verticalAlign:"middle"},onclick:function(){i.dispatchAction({type:"all"===r?"legendAllSelect":"legendInverseSelect"})}});n.add(a);var o=t.getModel("selectorLabel"),l=t.getModel(["emphasis","selectorLabel"]);Object(v["f"])(a,{normal:o,emphasis:l},{defaultText:e.title}),Object(f["m"])(a)}))},t.prototype._createItem=function(e,t,i,r,a,n,o,l,s,c){var d=e.visualDrawType,h=a.get("itemWidth"),u=a.get("itemHeight"),g=a.isSelected(t),b=r.get("symbolRotate"),_=r.get("icon");s=_||s||"roundRect";var S=a.getModel("lineStyle"),x=L(s,r,S,o,l,d,g),w=new R,C=r.getModel("textStyle");if("function"!==typeof e.getLegendIcon||_&&"inherit"!==_){var I="inherit"===_&&e.getData().getVisual("symbol")?"inherit"===b?e.getData().getVisual("symbolRotate"):b:0;w.add(D({itemWidth:h,itemHeight:u,icon:s,iconRotate:I,itemStyle:x.itemStyle,lineStyle:x.lineStyle}))}else w.add(e.getLegendIcon({itemWidth:h,itemHeight:u,icon:s,iconRotate:b,itemStyle:x.itemStyle,lineStyle:x.lineStyle}));var O="left"===n?h+5:-5,k=n,z=a.get("formatter"),G=t;"string"===typeof z&&z?G=z.replace("{name}",null!=t?t:""):"function"===typeof z&&(G=z(t));var M=r.get("inactiveColor");w.add(new p["a"]({style:Object(v["b"])(C,{text:G,x:O,y:u/2,fill:g?C.getTextColor():M,align:k,verticalAlign:"middle"})}));var P=new m["a"]({shape:w.getBoundingRect(),invisible:!0}),A=r.getModel("tooltip");return A.get("show")&&y["setTooltipConfig"]({el:P,componentModel:a,itemName:t,itemTooltipOption:A.option}),w.add(P),w.eachChild((function(e){e.silent=!0})),P.silent=!c,this.getContentGroup().add(w),Object(f["m"])(w),w.__legendDataIndex=i,w},t.prototype.layoutInner=function(e,t,i,r,a,n){var o=this.getContentGroup(),l=this.getSelectorGroup();b["a"](e.get("orient"),o,e.get("itemGap"),i.width,i.height);var s=o.getBoundingRect(),c=[-s.x,-s.y];if(l.markRedraw(),o.markRedraw(),a){b["a"]("horizontal",l,e.get("selectorItemGap",!0));var d=l.getBoundingRect(),h=[-d.x,-d.y],u=e.get("selectorButtonGap",!0),g=e.getOrient().index,p=0===g?"width":"height",m=0===g?"height":"width",y=0===g?"y":"x";"end"===n?h[g]+=s[p]+u:c[g]+=d[p]+u,h[1-g]+=s[m]/2-d[m]/2,l.x=h[0],l.y=h[1],o.x=c[0],o.y=c[1];var f={x:0,y:0};return f[p]=s[p]+u+d[p],f[m]=Math.max(s[m],d[m]),f[y]=Math.min(0,d[y]+h[1-g]),f}return o.x=c[0],o.y=c[1],this.group.getBoundingRect()},t.prototype.remove=function(){this.getContentGroup().removeAll(),this._isFirstRender=!0},t.type="legend.plain",t}(x["a"]);function L(e,t,i,r,a,n,o){for(var l=t.getModel("itemStyle"),s=C["a"].concat([["decal"]]),c={},d=0;d<s.length;++d){var h=s[d][s[d].length-1],u=s[d][0],g=l.getShallow(h);if("inherit"===g)switch(u){case"fill":c.fill=a[n];break;case"stroke":c.stroke=a[0===e.lastIndexOf("empty",0)?"fill":"stroke"];break;case"opacity":c.opacity=("fill"===n?a:r).opacity;break;default:c[u]=a[u]}else"auto"===g&&"lineWidth"===u?c.lineWidth=a.lineWidth>0?2:0:c[u]=g}var p=t.getModel("lineStyle"),m=w["a"].concat([["inactiveColor"],["inactiveWidth"]]),y={};for(d=0;d<m.length;++d){h=m[d][1],u=m[d][0],g=p.getShallow(h);"inherit"===g?y[u]=r[u]:"auto"===g&&"lineWidth"===u?y.lineWidth=r.lineWidth>0?2:0:y[u]=g}if("auto"===c.fill&&(c.fill=a.fill),"auto"===c.stroke&&(c.stroke=a.fill),"auto"===y.stroke&&(y.stroke=a.fill),!o){var f=t.get("inactiveBorderWidth"),v=c[e.indexOf("empty")>-1?"fill":"stroke"];c.lineWidth="auto"===f?a.lineWidth>0&&v?2:0:c.lineWidth,c.fill=t.get("inactiveColor"),c.stroke=t.get("inactiveBorderColor"),y.stroke=i.get("inactiveColor"),y.lineWidth=i.get("inactiveWidth")}return{itemStyle:c,lineStyle:y}}function D(e){var t=e.icon||"roundRect",i=Object(I["a"])(t,0,0,e.itemWidth,e.itemHeight,e.itemStyle.fill);return i.setStyle(e.itemStyle),i.rotation=(e.iconRotate||0)*Math.PI/180,i.setOrigin([e.itemWidth/2,e.itemHeight/2]),t.indexOf("empty")>-1&&(i.style.stroke=i.style.fill,i.style.fill="#fff",i.style.lineWidth=2),i}function G(e,t,i,r){A(e,t,i,r),i.dispatchAction({type:"legendToggleSelect",name:null!=e?e:t}),P(e,t,i,r)}function M(e){var t,i=e.getZr().storage.getDisplayList(),r=0,a=i.length;while(r<a&&!(t=i[r].states.emphasis))r++;return t&&t.hoverLayer}function P(e,t,i,r){M(i)||i.dispatchAction({type:"highlight",seriesName:e,name:t,excludeSeriesId:r})}function A(e,t,i,r){M(i)||i.dispatchAction({type:"downplay",seriesName:e,name:t,excludeSeriesId:r})}var j=z;function T(e){var t=e.findComponents({mainType:"legend"});t&&t.length&&e.filterSeries((function(e){for(var i=0;i<t.length;i++)if(!t[i].isSelected(e.name))return!1;return!0}))}function W(e,t,i){var r,a={},o="toggleSelected"===e;return i.eachComponent("legend",(function(i){o&&null!=r?i[r?"select":"unSelect"](t.name):"allSelect"===e||"inverseSelect"===e?i[e]():(i[e](t.name),r=i.isSelected(t.name));var l=i.getData();Object(n["j"])(l,(function(e){var t=e.get("name");if("\n"!==t&&""!==t){var r=i.isSelected(t);a.hasOwnProperty(t)?a[t]=a[t]&&r:a[t]=r}}))})),"allSelect"===e||"inverseSelect"===e?{selected:a}:{name:t.name,selected:a}}function F(e){e.registerAction("legendToggleSelect","legendselectchanged",Object(n["h"])(W,"toggleSelected")),e.registerAction("legendAllSelect","legendselectall",Object(n["h"])(W,"allSelect")),e.registerAction("legendInverseSelect","legendinverseselect",Object(n["h"])(W,"inverseSelect")),e.registerAction("legendSelect","legendselected",Object(n["h"])(W,"select")),e.registerAction("legendUnSelect","legendunselected",Object(n["h"])(W,"unSelect"))}function B(e){e.registerComponentModel(h),e.registerComponentView(j),e.registerProcessor(e.PRIORITY.PROCESSOR.SERIES_FILTER,T),e.registerSubTypeDefaulter("legend",(function(){return"plain"})),F(e)}var N=i("8918"),E=function(e){function t(){var i=null!==e&&e.apply(this,arguments)||this;return i.type=t.type,i}return Object(a["b"])(t,e),t.prototype.setScrollDataIndex=function(e){this.option.scrollDataIndex=e},t.prototype.init=function(t,i,r){var a=Object(b["c"])(t);e.prototype.init.call(this,t,i,r),V(this,t,a)},t.prototype.mergeOption=function(t,i){e.prototype.mergeOption.call(this,t,i),V(this,this.option,t)},t.type="legend.scroll",t.defaultOption=Object(N["d"])(h.defaultOption,{scrollDataIndex:0,pageButtonItemGap:5,pageButtonGap:null,pageButtonPosition:"end",pageFormatter:"{current}/{total}",pageIcons:{horizontal:["M0,0L12,-10L12,10z","M0,0L-12,-10L-12,10z"],vertical:["M0,0L20,0L10,-20z","M0,0L20,0L10,20z"]},pageIconColor:"#2f4554",pageIconInactiveColor:"#aaa",pageIconSize:15,pageTextStyle:{color:"#333"},animationDurationUpdate:800}),t}(h);function V(e,t,i){var r=e.getOrient(),a=[1,1];a[r.index]=0,Object(b["e"])(t,i,{type:"box",ignoreSize:!!a})}var q=E,H=g["a"],$=["width","height"],J=["x","y"],Q=function(e){function t(){var i=null!==e&&e.apply(this,arguments)||this;return i.type=t.type,i.newlineDisabled=!0,i._currentIndex=0,i}return Object(a["b"])(t,e),t.prototype.init=function(){e.prototype.init.call(this),this.group.add(this._containerGroup=new H),this._containerGroup.add(this.getContentGroup()),this.group.add(this._controllerGroup=new H)},t.prototype.resetInner=function(){e.prototype.resetInner.call(this),this._controllerGroup.removeAll(),this._containerGroup.removeClipPath(),this._containerGroup.__rectSize=null},t.prototype.renderInner=function(t,i,r,a,o,l,s){var c=this;e.prototype.renderInner.call(this,t,i,r,a,o,l,s);var d=this._controllerGroup,h=i.get("pageIconSize",!0),u=n["r"](h)?h:[h,h];m("pagePrev",0);var g=i.getModel("pageTextStyle");function m(e,t){var r=e+"DataIndex",o=y["createIcon"](i.get("pageIcons",!0)[i.getOrient().name][t],{onclick:n["c"](c._pageGo,c,r,i,a)},{x:-u[0]/2,y:-u[1]/2,width:u[0],height:u[1]});o.name=e,d.add(o)}d.add(new p["a"]({name:"pageText",style:{text:"xx/xx",fill:g.getTextColor(),font:g.getFont(),verticalAlign:"middle",align:"center"},silent:!0})),m("pageNext",1)},t.prototype.layoutInner=function(e,t,i,r,a,o){var l=this.getSelectorGroup(),s=e.getOrient().index,c=$[s],d=J[s],h=$[1-s],u=J[1-s];a&&b["a"]("horizontal",l,e.get("selectorItemGap",!0));var g=e.get("selectorButtonGap",!0),p=l.getBoundingRect(),m=[-p.x,-p.y],y=n["d"](i);a&&(y[c]=i[c]-p[c]-g);var f=this._layoutContentAndController(e,r,y,s,c,h,u,d);if(a){if("end"===o)m[s]+=f[c]+g;else{var v=p[c]+g;m[s]-=v,f[d]-=v}f[c]+=p[c]+g,m[1-s]+=f[u]+f[h]/2-p[h]/2,f[h]=Math.max(f[h],p[h]),f[u]=Math.min(f[u],p[u]+m[1-s]),l.x=m[0],l.y=m[1],l.markRedraw()}return f},t.prototype._layoutContentAndController=function(e,t,i,r,a,o,l,s){var c=this.getContentGroup(),d=this._containerGroup,h=this._controllerGroup;b["a"](e.get("orient"),c,e.get("itemGap"),r?i.width:null,r?null:i.height),b["a"]("horizontal",h,e.get("pageButtonItemGap",!0));var u=c.getBoundingRect(),g=h.getBoundingRect(),p=this._showController=u[a]>i[a],f=[-u.x,-u.y];t||(f[r]=c[s]);var v=[0,0],_=[-g.x,-g.y],S=n["L"](e.get("pageButtonGap",!0),e.get("itemGap",!0));if(p){var x=e.get("pageButtonPosition",!0);"end"===x?_[r]+=i[a]-g[a]:v[r]+=g[a]+S}_[1-r]+=u[o]/2-g[o]/2,c.setPosition(f),d.setPosition(v),h.setPosition(_);var w={x:0,y:0};if(w[a]=p?i[a]:u[a],w[o]=Math.max(u[o],g[o]),w[l]=Math.min(0,g[l]+_[1-r]),d.__rectSize=i[a],p){var C={x:0,y:0};C[a]=Math.max(i[a]-g[a]-S,0),C[o]=w[o],d.setClipPath(new m["a"]({shape:C})),d.__rectSize=C[a]}else h.eachChild((function(e){e.attr({invisible:!0,silent:!0})}));var I=this._getPageInfo(e);return null!=I.pageIndex&&y["updateProps"](c,{x:I.contentPosition[0],y:I.contentPosition[1]},p?e:null),this._updatePageInfoView(e,I),w},t.prototype._pageGo=function(e,t,i){var r=this._getPageInfo(t)[e];null!=r&&i.dispatchAction({type:"legendScroll",scrollDataIndex:r,legendId:t.id})},t.prototype._updatePageInfoView=function(e,t){var i=this._controllerGroup;n["j"](["pagePrev","pageNext"],(function(r){var a=r+"DataIndex",n=null!=t[a],o=i.childOfName(r);o&&(o.setStyle("fill",n?e.get("pageIconColor",!0):e.get("pageIconInactiveColor",!0)),o.cursor=n?"pointer":"default")}));var r=i.childOfName("pageText"),a=e.get("pageFormatter"),o=t.pageIndex,l=null!=o?o+1:0,s=t.pageCount;r&&a&&r.setStyle("text",n["z"](a)?a.replace("{current}",null==l?"":l+"").replace("{total}",null==s?"":s+""):a({current:l,total:s}))},t.prototype._getPageInfo=function(e){var t=e.get("scrollDataIndex",!0),i=this.getContentGroup(),r=this._containerGroup.__rectSize,a=e.getOrient().index,n=$[a],o=J[a],l=this._findTargetItemIndex(t),s=i.children(),c=s[l],d=s.length,h=d?1:0,u={contentPosition:[i.x,i.y],pageCount:h,pageIndex:h-1,pagePrevDataIndex:null,pageNextDataIndex:null};if(!c)return u;var g=v(c);u.contentPosition[a]=-g.s;for(var p=l+1,m=g,y=g,f=null;p<=d;++p)f=v(s[p]),(!f&&y.e>m.s+r||f&&!b(f,m.s))&&(m=y.i>m.i?y:f,m&&(null==u.pageNextDataIndex&&(u.pageNextDataIndex=m.i),++u.pageCount)),y=f;for(p=l-1,m=g,y=g,f=null;p>=-1;--p)f=v(s[p]),f&&b(y,f.s)||!(m.i<y.i)||(y=m,null==u.pagePrevDataIndex&&(u.pagePrevDataIndex=m.i),++u.pageCount,++u.pageIndex),m=f;return u;function v(e){if(e){var t=e.getBoundingRect(),i=t[o]+e[o];return{s:i,e:i+t[n],i:e.__legendDataIndex}}}function b(e,t){return e.e>=t&&e.s<=t+r}},t.prototype._findTargetItemIndex=function(e){if(!this._showController)return 0;var t,i,r=this.getContentGroup();return r.eachChild((function(r,a){var n=r.__legendDataIndex;null==i&&null!=n&&(i=a),n===e&&(t=a)})),null!=t?t:i},t.type="legend.scroll",t}(j),U=Q;function Y(e){e.registerAction("legendScroll","legendscroll",(function(e,t){var i=e.scrollDataIndex;null!=i&&t.eachComponent({mainType:"legend",subType:"scroll",query:e},(function(e){e.setScrollDataIndex(i)}))}))}function X(e){Object(r["a"])(B),e.registerComponentModel(q),e.registerComponentView(U),Y(e)}function Z(e){Object(r["a"])(B),Object(r["a"])(X)}}}]);