(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1f2bd485"],{"488b":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ele-body"},[a("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[a("el-col",{attrs:{lg:6,md:12,sm:12}},[a("stat-card",{attrs:{title:"总用户数",value:t.stats.totalCount,icon:"el-icon-user",color:"primary","help-text":"系统中的用户总数",loading:t.statsLoading}})],1),a("el-col",{attrs:{lg:6,md:12,sm:12}},[a("stat-card",{attrs:{title:"今日新增",value:t.stats.todayCount,icon:"el-icon-user-solid",color:"success","help-text":"今日注册的用户数量",loading:t.statsLoading}})],1),a("el-col",{attrs:{lg:6,md:12,sm:12}},[a("stat-card",{attrs:{title:"活跃用户",value:t.stats.activeCount,icon:"el-icon-star-on",color:"warning","help-text":"状态为正常的用户数量",loading:t.statsLoading}})],1),a("el-col",{attrs:{lg:6,md:12,sm:12}},[a("stat-card",{attrs:{title:"总点卡余额",value:t.stats.totalPointCard,icon:"el-icon-bank-card",color:"danger",format:"money",precision:2,"help-text":"所有用户的点卡总余额（自充+赠送）",loading:t.statsLoading}})],1)],1),a("el-card",{attrs:{shadow:"never"}},[a("el-form",{staticClass:"search-form",attrs:{inline:!0,model:t.where,size:"small"}},[a("el-form-item",{attrs:{label:"邮箱"}},[a("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入邮箱",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.reload.apply(null,arguments)}},model:{value:t.where.email,callback:function(e){t.$set(t.where,"email",e)},expression:"where.email"}})],1),a("el-form-item",{attrs:{label:"邀请码"}},[a("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:"请输入邀请码",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.reload.apply(null,arguments)}},model:{value:t.where.invite_code,callback:function(e){t.$set(t.where,"invite_code",e)},expression:"where.invite_code"}})],1),a("el-form-item",{attrs:{label:"邀请人ID"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"请输入邀请人ID",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.reload.apply(null,arguments)}},model:{value:t.where.inviter_id,callback:function(e){t.$set(t.where,"inviter_id",e)},expression:"where.inviter_id"}})],1),a("el-form-item",{attrs:{label:"自充点卡≥"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"最小值",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.reload.apply(null,arguments)}},model:{value:t.where.point_card_self_min,callback:function(e){t.$set(t.where,"point_card_self_min",e)},expression:"where.point_card_self_min"}})],1),a("el-form-item",{attrs:{label:"赠送点卡≥"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"最小值",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.reload.apply(null,arguments)}},model:{value:t.where.point_card_gift_min,callback:function(e){t.$set(t.where,"point_card_gift_min",e)},expression:"where.point_card_gift_min"}})],1),a("el-form-item",{attrs:{label:"租户"}},[a("el-select",{staticStyle:{width:"140px"},attrs:{placeholder:"全部租户",clearable:"",filterable:""},model:{value:t.where.tenant_id,callback:function(e){t.$set(t.where,"tenant_id",e)},expression:"where.tenant_id"}},t._l(t.tenantList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.reload}},[t._v("查询")]),a("el-button",{on:{click:t.resetSearch}},[t._v("重置")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.list,stripe:"",border:"",size:"small","max-height":t.tableMaxHeight,"row-key":"id"}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"70",align:"center",fixed:"left"}}),a("el-table-column",{attrs:{prop:"email",label:"邮箱","min-width":"180","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"invite_code",label:"邀请码",width:"110",align:"center","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"inviter_invite_code",label:"邀请人码",width:"110",align:"center","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.inviter_invite_code?a("span",[t._v(t._s(i.inviter_invite_code))]):a("span",{staticStyle:{color:"#c0c4cc"}},[t._v("-")])]}}])}),a("el-table-column",{attrs:{prop:"inviter_id",label:"邀请人ID",width:"90",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.inviter_id?a("span",[t._v(t._s(i.inviter_id))]):a("span",{staticStyle:{color:"#c0c4cc"}},[t._v("-")])]}}])}),a("el-table-column",{attrs:{label:"直推人数",width:"90",align:"center",prop:"team_direct_count"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(null!=a.team_direct_count?a.team_direct_count:"-"))]}}])}),a("el-table-column",{attrs:{label:"团队业绩",width:"110",align:"right",prop:"team_performance"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",{staticClass:"money-cell"},[t._v(t._s(t.formatMoney(i.team_performance)))])]}}])}),a("el-table-column",{attrs:{label:"自充点卡",width:"110",align:"right",sortable:"",prop:"point_card_self"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",{staticClass:"money-cell"},[t._v(t._s(t.formatMoney(i.point_card_self)))])]}}])}),a("el-table-column",{attrs:{label:"赠送点卡",width:"110",align:"right",sortable:"",prop:"point_card_gift"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",{staticClass:"money-cell"},[t._v(t._s(t.formatMoney(i.point_card_gift)))])]}}])}),a("el-table-column",{attrs:{label:"累计奖励",width:"110",align:"right",prop:"total_reward"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",{staticClass:"money-cell"},[t._v(t._s(t.formatMoney(i.total_reward)))])]}}])}),a("el-table-column",{attrs:{label:"根用户",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.is_root?a("el-tag",{attrs:{type:"danger",size:"mini"}},[t._v("ROOT")]):a("span",{staticStyle:{color:"#c0c4cc"}},[t._v("-")])]}}])}),a("el-table-column",{attrs:{label:"等级",width:"80",align:"center",prop:"member_level"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("el-tag",{attrs:{type:t.levelTagType(i.member_level),size:"mini"}},[t._v(" "+t._s(t.levelName(i.member_level))+" ")])]}}])}),a("el-table-column",{attrs:{label:"状态",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(e){return t.handleStatusChange(i)}},model:{value:i.status,callback:function(e){t.$set(i,"status",e)},expression:"row.status"}})]}}])}),a("el-table-column",{attrs:{label:"注册时间",width:"160",align:"center",prop:"created_at",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatDate(a.created_at))+" ")]}}])}),a("el-table-column",{attrs:{label:"操作",width:"260",align:"center",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-view"},on:{click:function(e){return t.openDetail(i)}}},[t._v("详情")]),a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-coin"},on:{click:function(e){return t.openRecharge(i)}}},[t._v("充值")]),a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-present"},on:{click:function(e){return t.openGift(i)}}},[t._v("赠送")]),a("el-button",{attrs:{type:"text",size:"small",icon:i.is_market_node?"el-icon-circle-close":"el-icon-place"},on:{click:function(e){return t.toggleMarketNode(i)}}},[t._v(" "+t._s(i.is_market_node?"取消节点":"设节点")+" ")])]}}])})],1),a("div",{staticClass:"pagination-wrap"},[a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":t.page,"page-size":t.pageSize,"page-sizes":[15,30,50,100],total:t.total},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"update:pageSize":function(e){t.pageSize=e},"update:page-size":function(e){t.pageSize=e},"size-change":t.reload,"current-change":t.fetchData}})],1)],1),a("el-dialog",{attrs:{title:"用户详情",visible:t.detailVisible,width:"900px","close-on-click-modal":!1,top:"5vh","destroy-on-close":""},on:{"update:visible":function(e){t.detailVisible=e}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.detailLoading,expression:"detailLoading"}]},[t.detailData?[a("div",{staticClass:"section-title"},[t._v("基本信息")]),a("el-descriptions",{attrs:{column:3,border:"",size:"small"}},[a("el-descriptions-item",{attrs:{label:"用户ID"}},[t._v(t._s(t.detailData.id))]),a("el-descriptions-item",{attrs:{label:"租户ID"}},[t._v(t._s(t.detailData.tenant_id))]),a("el-descriptions-item",{attrs:{label:"邮箱"}},[t._v(t._s(t.detailData.email))]),a("el-descriptions-item",{attrs:{label:"邀请码"}},[t._v(t._s(t.detailData.invite_code||"-"))]),a("el-descriptions-item",{attrs:{label:"邀请人ID"}},[t._v(t._s(t.detailData.inviter_id||"-"))]),a("el-descriptions-item",{attrs:{label:"邀请人码"}},[t._v(t._s(t.detailData.inviter_invite_code||"-"))]),a("el-descriptions-item",{attrs:{label:"邀请人邮箱"}},[t._v(t._s(t.detailData.inviter_email||"-"))]),a("el-descriptions-item",{attrs:{label:"是否ROOT"}},[t.detailData.is_root?a("el-tag",{attrs:{type:"danger",size:"mini"}},[t._v("是")]):a("span",[t._v("否")])],1),a("el-descriptions-item",{attrs:{label:"会员等级"}},[a("el-tag",{attrs:{type:t.levelTagType(t.detailData.member_level),size:"mini"}},[t._v(" "+t._s(t.detailData.level_name||t.levelName(t.detailData.member_level))+" ")])],1),a("el-descriptions-item",{attrs:{label:"市场节点"}},[t.detailData.is_market_node?a("el-tag",{attrs:{type:"success",size:"mini"}},[t._v("是")]):a("span",[t._v("否")])],1),a("el-descriptions-item",{attrs:{label:"状态"}},[a("el-tag",{attrs:{type:1===t.detailData.status?"success":"info",size:"mini"}},[t._v(" "+t._s(1===t.detailData.status?"正常":"禁用")+" ")])],1),a("el-descriptions-item",{attrs:{label:"活跃策略"}},[t._v(t._s(t.detailData.active_strategies||0))]),a("el-descriptions-item",{attrs:{label:"注册时间"}},[t._v(t._s(t.formatDate(t.detailData.created_at)))])],1),a("div",{staticClass:"section-title",staticStyle:{"margin-top":"20px"}},[t._v("点卡与奖励")]),a("el-descriptions",{attrs:{column:3,border:"",size:"small"}},[a("el-descriptions-item",{attrs:{label:"自充点卡"}},[a("span",{staticClass:"money-value"},[t._v(t._s(t.formatMoney(t.detailData.point_card_self)))])]),a("el-descriptions-item",{attrs:{label:"赠送点卡"}},[a("span",{staticClass:"money-value"},[t._v(t._s(t.formatMoney(t.detailData.point_card_gift)))])]),a("el-descriptions-item",{attrs:{label:"点卡总计"}},[a("span",{staticClass:"money-value money-total"},[t._v(t._s(t.formatMoney(t.detailData.point_card_total)))])]),a("el-descriptions-item",{attrs:{label:"奖励余额(USDT)"}},[a("span",{staticClass:"money-value"},[t._v(t._s(t.formatMoney(t.detailData.reward_usdt)))])]),a("el-descriptions-item",{attrs:{label:"累计奖励"}},[a("span",{staticClass:"money-value"},[t._v(t._s(t.formatMoney(t.detailData.total_reward)))])]),a("el-descriptions-item",{attrs:{label:"已提现"}},[a("span",{staticClass:"money-value"},[t._v(t._s(t.formatMoney(t.detailData.withdrawn_reward)))])])],1),a("div",{staticClass:"section-title",staticStyle:{"margin-top":"20px"}},[t._v("团队信息")]),a("el-descriptions",{attrs:{column:3,border:"",size:"small"}},[a("el-descriptions-item",{attrs:{label:"直推人数"}},[t._v(t._s(t.detailData.team_direct_count||0))]),a("el-descriptions-item",{attrs:{label:"团队总人数"}},[t._v(t._s(t.detailData.team_total_count||0))]),a("el-descriptions-item",{attrs:{label:"团队业绩"}},[t._v(t._s(t.formatMoney(t.detailData.team_performance)))])],1),t.detailData.team_direct_count>0?a("div",{staticStyle:{"margin-top":"10px"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-s-unfold"},on:{click:t.loadTeam}},[t._v(" "+t._s(t.teamList.length?"刷新直推列表":"查看直推列表")+" ")]),t.teamList.length?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.teamLoading,expression:"teamLoading"}],staticStyle:{"margin-top":"8px"},attrs:{data:t.teamList,size:"mini",border:"","max-height":"250"}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"70",align:"center"}}),a("el-table-column",{attrs:{prop:"email",label:"邮箱","min-width":"160","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"等级",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("el-tag",{attrs:{type:t.levelTagType(i.member_level),size:"mini"}},[t._v(" "+t._s(i.level_name||t.levelName(i.member_level))+" ")])]}}],null,!1,3789848761)}),a("el-table-column",{attrs:{label:"市场节点",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.is_market_node?a("el-tag",{attrs:{type:"success",size:"mini"}},[t._v("是")]):a("span",[t._v("-")])]}}],null,!1,4144126815)}),a("el-table-column",{attrs:{label:"自充点卡",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatMoney(a.point_card_self)))]}}],null,!1,2731998345)}),a("el-table-column",{attrs:{label:"赠送点卡",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatMoney(a.point_card_gift)))]}}],null,!1,3745737929)}),a("el-table-column",{attrs:{label:"下级人数",width:"80",align:"center",prop:"sub_count"}}),a("el-table-column",{attrs:{label:"注册时间",width:"150",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatDate(a.created_at)))]}}],null,!1,4243643267)})],1):t._e(),t.teamTotal>t.teamPageSize?a("el-pagination",{staticStyle:{"margin-top":"8px","text-align":"right"},attrs:{small:"",layout:"prev, pager, next","current-page":t.teamPage,"page-size":t.teamPageSize,total:t.teamTotal},on:{"update:currentPage":function(e){t.teamPage=e},"update:current-page":function(e){t.teamPage=e},"current-change":t.loadTeam}}):t._e()],1):t._e(),a("div",{staticClass:"section-title",staticStyle:{"margin-top":"20px"}},[t._v("交易所账户")]),t.detailData.accounts&&t.detailData.accounts.length?a("el-table",{attrs:{data:t.detailData.accounts,size:"mini",border:"","max-height":"200"}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"60",align:"center"}}),a("el-table-column",{attrs:{label:"交易所",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("el-tag",{attrs:{size:"mini"}},[t._v(t._s(i.exchange))])]}}],null,!1,4193481423)}),a("el-table-column",{attrs:{label:"账户类型",width:"90",align:"center",prop:"account_type"}}),a("el-table-column",{attrs:{label:"余额",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatMoney(a.balance)))]}}],null,!1,2689833067)}),a("el-table-column",{attrs:{label:"合约余额",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatMoney(a.futures_balance)))]}}],null,!1,2798479234)}),a("el-table-column",{attrs:{label:"状态",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("el-tag",{attrs:{type:1===i.status?"success":"info",size:"mini"}},[t._v(" "+t._s(1===i.status?"正常":"禁用")+" ")])]}}],null,!1,995696833)})],1):a("el-empty",{attrs:{description:"暂无交易所账户","image-size":60}}),a("div",{staticClass:"section-title",staticStyle:{"margin-top":"20px"}},[t._v("奖励记录")]),a("el-button",{attrs:{type:"text",icon:"el-icon-list"},on:{click:t.loadRewards}},[t._v(" "+t._s(t.rewardList.length?"刷新奖励记录":"查看奖励记录")+" ")]),t.rewardList.length?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.rewardLoading,expression:"rewardLoading"}],staticStyle:{"margin-top":"8px"},attrs:{data:t.rewardList,size:"mini",border:"","max-height":"220"}},[a("el-table-column",{attrs:{prop:"reward_type_name",label:"类型",width:"90",align:"center"}}),a("el-table-column",{attrs:{prop:"amount",label:"金额(USDT)",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatMoney(a.amount)))]}}],null,!1,837137985)}),a("el-table-column",{attrs:{prop:"rate",label:"比例",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(null!=a.rate?(100*a.rate).toFixed(2)+"%":"-"))]}}],null,!1,571127408)}),a("el-table-column",{attrs:{prop:"source_email",label:"来源用户","min-width":"140","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"remark",label:"备注","min-width":"100","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"created_at",label:"时间",width:"160",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatDate(a.created_at)))]}}],null,!1,4243643267)})],1):t._e(),t.rewardTotal>t.rewardPageSize?a("el-pagination",{staticStyle:{"margin-top":"8px","text-align":"right"},attrs:{small:"",layout:"prev, pager, next, total","current-page":t.rewardPage,"page-size":t.rewardPageSize,total:t.rewardTotal},on:{"update:currentPage":function(e){t.rewardPage=e},"update:current-page":function(e){t.rewardPage=e},"current-change":t.loadRewards}}):t._e(),t.rewardListLoaded&&0===t.rewardList.length?a("el-empty",{staticStyle:{"margin-top":"8px"},attrs:{description:"暂无奖励记录","image-size":50}}):t._e()]:t._e()],2),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.detailVisible=!1}}},[t._v("关闭")]),a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-coin"},on:{click:t.openRechargeFromDetail}},[t._v("充值")]),a("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-present"},on:{click:t.openGiftFromDetail}},[t._v("赠送")])],1)]),a("el-dialog",{attrs:{title:"用户充值",visible:t.rechargeVisible,width:"440px","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(e){t.rechargeVisible=e}}},[a("el-form",{attrs:{model:t.rechargeForm,"label-width":"100px",size:"small"}},[a("el-form-item",{attrs:{label:"用户ID"}},[a("el-input",{attrs:{value:t.rechargeForm.userId,disabled:""}})],1),a("el-form-item",{attrs:{label:"用户邮箱"}},[a("el-input",{attrs:{value:t.rechargeForm.email,disabled:""}})],1),a("el-form-item",{attrs:{label:"当前自充点卡"}},[a("el-input",{attrs:{value:t.formatMoney(t.rechargeForm.currentSelf),disabled:""}})],1),a("el-form-item",{attrs:{label:"充值金额",required:""}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:.01,precision:2,step:10,placeholder:"请输入金额"},model:{value:t.rechargeForm.amount,callback:function(e){t.$set(t.rechargeForm,"amount",e)},expression:"rechargeForm.amount"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.rechargeVisible=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary",size:"small",loading:t.rechargeLoading},on:{click:t.submitRecharge}},[t._v("确认充值")])],1)],1),a("el-dialog",{attrs:{title:"赠送点卡",visible:t.giftVisible,width:"440px","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(e){t.giftVisible=e}}},[a("el-form",{attrs:{model:t.giftForm,"label-width":"100px",size:"small"}},[a("el-form-item",{attrs:{label:"用户ID"}},[a("el-input",{attrs:{value:t.giftForm.userId,disabled:""}})],1),a("el-form-item",{attrs:{label:"用户邮箱"}},[a("el-input",{attrs:{value:t.giftForm.email,disabled:""}})],1),a("el-form-item",{attrs:{label:"当前赠送点卡"}},[a("el-input",{attrs:{value:t.formatMoney(t.giftForm.currentGift),disabled:""}})],1),a("el-form-item",{attrs:{label:"赠送数量",required:""}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:.01,precision:2,step:10,placeholder:"请输入数量"},model:{value:t.giftForm.amount,callback:function(e){t.$set(t.giftForm,"amount",e)},expression:"giftForm.amount"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.giftVisible=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"success",size:"small",loading:t.giftLoading},on:{click:t.submitGift}},[t._v("确认赠送")])],1)],1)],1)},n=[],r=(a("13d5"),a("e9c4"),a("0643"),a("2382"),a("9d4a"),a("50fc")),s=a("cd05");const l={0:"普通",1:"V1",2:"V2",3:"V3",4:"V4",5:"V5"};var o={name:"UserManage",data(){return{loading:!1,list:[],total:0,page:1,pageSize:15,where:{email:"",invite_code:"",inviter_id:"",point_card_self_min:"",point_card_gift_min:"",tenant_id:""},stats:{totalCount:0,todayCount:0,activeCount:0,totalPointCard:0},statsLoading:!1,tenantList:[],detailVisible:!1,detailLoading:!1,detailData:null,teamList:[],teamLoading:!1,teamPage:1,teamPageSize:10,teamTotal:0,rewardList:[],rewardLoading:!1,rewardListLoaded:!1,rewardPage:1,rewardPageSize:10,rewardTotal:0,rechargeVisible:!1,rechargeLoading:!1,rechargeForm:{userId:"",email:"",currentSelf:0,amount:0},giftVisible:!1,giftLoading:!1,giftForm:{userId:"",email:"",currentGift:0,amount:0},tableMaxHeight:520}},created(){this.loadTenants(),this.fetchData(),this.loadStats()},mounted(){this.calcTableHeight(),window.addEventListener("resize",this.calcTableHeight)},beforeDestroy(){window.removeEventListener("resize",this.calcTableHeight)},methods:{async fetchData(){this.loading=!0;try{const t={page:this.page,page_size:this.pageSize};this.where.email&&(t.email=this.where.email),this.where.invite_code&&(t.invite_code=this.where.invite_code),this.where.inviter_id&&(t.inviter_id=this.where.inviter_id),this.where.point_card_self_min&&(t.point_card_self_min=this.where.point_card_self_min),this.where.point_card_gift_min&&(t.point_card_gift_min=this.where.point_card_gift_min),this.where.tenant_id&&(t.tenant_id=this.where.tenant_id);const e=await Object(r["s"])(t),a=e.data;a.success?(this.list=a.data||[],this.total=a.total||0):this.$message.error(a.message||"获取用户列表失败")}catch(t){this.$message.error("获取用户列表失败")}finally{this.loading=!1}},reload(){this.page=1,this.fetchData(),this.loadStats()},resetSearch(){this.where={email:"",invite_code:"",inviter_id:"",point_card_self_min:"",point_card_gift_min:"",tenant_id:""},this.reload()},async loadStats(){this.statsLoading=!0;try{const t=await Object(r["s"])({page:1,page_size:9999}),e=t.data;if(e.success){const t=e.data||[],a=(new Date).toISOString().slice(0,10);this.stats={totalCount:e.total||t.length,todayCount:t.filter(t=>(t.created_at||"").slice(0,10)===a).length,activeCount:t.filter(t=>1===t.status).length,totalPointCard:t.reduce((t,e)=>t+(parseFloat(e.point_card_self)||0)+(parseFloat(e.point_card_gift)||0),0)}}}catch(t){console.warn("加载统计失败",t)}finally{this.statsLoading=!1}},async loadTenants(){try{const t=await Object(r["p"])({page_size:200}),e=t.data;e.success&&(this.tenantList=e.data||[])}catch(t){console.warn("加载租户列表失败",t)}},async openDetail(t){this.detailVisible=!0,this.detailLoading=!0,this.detailData=null,this.teamList=[],this.teamPage=1,this.teamTotal=0,this.rewardList=[],this.rewardListLoaded=!1,this.rewardPage=1,this.rewardTotal=0;try{const e=await Object(r["q"])(t.id),a=e.data;a.success?this.detailData=a.data:this.$message.error(a.message||a.detail||"获取详情失败")}catch(e){const t=e.response&&e.response.data,a=t&&(t.detail||t.message)||e.message||"获取详情失败";this.$message.error("string"===typeof a?a:JSON.stringify(a))}finally{this.detailLoading=!1}},async loadTeam(){if(this.detailData){this.teamLoading=!0;try{const t=await Object(r["r"])(this.detailData.id,{page:this.teamPage,page_size:this.teamPageSize}),e=t.data;e.success&&(this.teamList=e.data||[],this.teamTotal=e.total||0)}catch(t){this.$message.error("加载团队数据失败")}finally{this.teamLoading=!1}}},async loadRewards(){if(this.detailData){this.rewardLoading=!0,this.rewardListLoaded=!0;try{const t=await Object(s["f"])({user_id:this.detailData.id,page:this.rewardPage,page_size:this.rewardPageSize}),e=t.data;e.success&&(this.rewardList=e.data||[],this.rewardTotal=e.total||0)}catch(t){this.$message.error("加载奖励记录失败")}finally{this.rewardLoading=!1}}},async handleStatusChange(t){try{await Object(r["A"])(t.id,t.status),this.$message.success(`用户 ${t.id} 已${1===t.status?"启用":"禁用"}`)}catch(e){this.$message.error("状态切换失败"),t.status=1===t.status?0:1}},async toggleMarketNode(t){const e=t.is_market_node?0:1,a=e?"设置为市场节点":"取消市场节点";try{await this.$confirm(`确定要将用户 ${t.email} ${a}吗？`,"提示",{type:"warning"})}catch(n){return}const i=this.$loading({lock:!0,text:"处理中..."});try{const n=await Object(r["w"])(t.id,{is_node:e}),s=n.data;s.success?(this.$message.success(s.message||a+"成功"),t.is_market_node=e):this.$message.error(s.message||a+"失败")}catch(n){this.$message.error(a+"失败")}finally{i.close()}},openRecharge(t){this.rechargeForm={userId:t.id,email:t.email,currentSelf:t.point_card_self||0,amount:0},this.rechargeVisible=!0},openRechargeFromDetail(){this.detailData&&(this.rechargeForm={userId:this.detailData.id,email:this.detailData.email,currentSelf:this.detailData.point_card_self||0,amount:0},this.rechargeVisible=!0)},async submitRecharge(){if(!this.rechargeForm.amount||this.rechargeForm.amount<=0)this.$message.warning("请输入有效金额");else{this.rechargeLoading=!0;try{const t=await Object(r["u"])(this.rechargeForm.userId,{amount:this.rechargeForm.amount,card_type:"self"}),e=t.data;e.success?(this.$message.success(e.message||"充值成功"),this.rechargeVisible=!1,this.fetchData(),this.loadStats(),this.detailVisible&&this.detailData&&this.detailData.id===this.rechargeForm.userId&&this.openDetail({id:this.rechargeForm.userId})):this.$message.error(e.message||e.detail||"充值失败")}catch(t){const e=t.response&&t.response.data&&(t.response.data.detail||t.response.data.message)||"充值失败";this.$message.error(e)}finally{this.rechargeLoading=!1}}},openGift(t){this.giftForm={userId:t.id,email:t.email,currentGift:t.point_card_gift||0,amount:0},this.giftVisible=!0},openGiftFromDetail(){this.detailData&&(this.giftForm={userId:this.detailData.id,email:this.detailData.email,currentGift:this.detailData.point_card_gift||0,amount:0},this.giftVisible=!0)},async submitGift(){if(!this.giftForm.amount||this.giftForm.amount<=0)this.$message.warning("请输入有效数量");else{this.giftLoading=!0;try{const t=await Object(r["u"])(this.giftForm.userId,{amount:this.giftForm.amount,card_type:"gift"}),e=t.data;e.success?(this.$message.success(e.message||"赠送成功"),this.giftVisible=!1,this.fetchData(),this.loadStats(),this.detailVisible&&this.detailData&&this.detailData.id===this.giftForm.userId&&this.openDetail({id:this.giftForm.userId})):this.$message.error(e.message||e.detail||"赠送失败")}catch(t){const e=t.response&&t.response.data&&(t.response.data.detail||t.response.data.message)||"赠送失败";this.$message.error(e)}finally{this.giftLoading=!1}}},formatMoney(t){const e=parseFloat(t);return isNaN(e)?"0.00":e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},formatDate(t){return t?"string"===typeof t?t.replace("T"," ").slice(0,19):t:"-"},levelName(t){return l[t]||"V"+t},levelTagType(t){return t&&0!==t?t>=4?"danger":t>=2?"warning":"":"info"},calcTableHeight(){this.$nextTick(()=>{this.tableMaxHeight=Math.max(300,window.innerHeight-380)})}}},c=o,d=(a("65f9"),a("2877")),u=Object(d["a"])(c,i,n,!1,null,"010d8afe",null);e["default"]=u.exports},"50d3":function(t,e,a){},"50fc":function(t,e,a){"use strict";a.d(e,"p",(function(){return r})),a.d(e,"f",(function(){return s})),a.d(e,"E",(function(){return l})),a.d(e,"z",(function(){return o})),a.d(e,"t",(function(){return c})),a.d(e,"b",(function(){return d})),a.d(e,"o",(function(){return u})),a.d(e,"g",(function(){return m})),a.d(e,"F",(function(){return p})),a.d(e,"d",(function(){return g})),a.d(e,"h",(function(){return f})),a.d(e,"s",(function(){return h})),a.d(e,"q",(function(){return _})),a.d(e,"u",(function(){return b})),a.d(e,"r",(function(){return v})),a.d(e,"w",(function(){return w})),a.d(e,"A",(function(){return y})),a.d(e,"i",(function(){return k})),a.d(e,"e",(function(){return D})),a.d(e,"B",(function(){return S})),a.d(e,"x",(function(){return x})),a.d(e,"v",(function(){return z})),a.d(e,"m",(function(){return $})),a.d(e,"n",(function(){return L})),a.d(e,"D",(function(){return F})),a.d(e,"y",(function(){return C})),a.d(e,"j",(function(){return T})),a.d(e,"C",(function(){return O})),a.d(e,"k",(function(){return V})),a.d(e,"a",(function(){return I})),a.d(e,"c",(function(){return M})),a.d(e,"l",(function(){return P}));var i=a("bc3a"),n=a.n(i);function r(t={}){return n.a.get("/tenants",{params:t})}function s(t){return n.a.post("/tenants",t)}function l(t,e){return n.a.put("/tenants/"+t,e)}function o(t){return n.a.patch(`/tenants/${t}/toggle`)}function c(t,e){return n.a.post(`/tenants/${t}/recharge`,e)}function d(t,e){return n.a.post(`/tenants/${t}/assign-plan`,{plan_id:e})}function u(t,e={}){return n.a.get(`/tenants/${t}/tenant-strategies`,{params:e})}function m(t,e){return n.a.post(`/tenants/${t}/tenant-strategies`,e)}function p(t,e,a){return n.a.put(`/tenants/${t}/tenant-strategies/${e}`,a)}function g(t,e){return n.a.post(`/tenants/${t}/tenant-strategies/${e}/copy-from-master`)}function f(t,e){return n.a.delete(`/tenants/${t}/tenant-strategies/${e}`)}function h(t={}){return n.a.get("/users",{params:t})}function _(t){return n.a.get("/users/"+t)}function b(t,e){return n.a.post(`/users/${t}/recharge`,e)}function v(t,e={}){return n.a.get(`/users/${t}/team`,{params:e})}function w(t,e){return n.a.post(`/users/${t}/set-market-node`,e)}function y(t,e){return n.a.post(`/users/${t}/toggle-status`,{status:e})}function k(t={}){return n.a.get("/admins",{params:t})}function D(t){return n.a.post("/admins",t)}function S(t,e){return n.a.put("/admins/"+t,e)}function x(t){return n.a.patch(`/admins/${t}/toggle`)}function z(t,e){return n.a.post(`/admins/${t}/reset-password`,e)}function $(t={}){return n.a.get("/strategies",{params:t})}function L(t){return n.a.get("/strategies/"+t)}function F(t,e){return n.a.post("/strategies/"+t,e)}function C(t){return n.a.patch(`/strategies/${t}/toggle`)}function T(t={}){return n.a.get("/strategy-bindings-admin",{params:t})}function O(t,e){return n.a.put("/strategy-bindings-admin/"+t,e)}function V(t={}){return n.a.get("/exchange-accounts",{params:t})}function I(t,e){return n.a.put(`/exchange-accounts/${t}/assign-node`,e)}function M(t){return n.a.post("/exchange-accounts/batch-assign-node",t)}function P(t={}){return n.a.get("/signal-events",{params:t})}},"65f9":function(t,e,a){"use strict";a("50d3")},cd05:function(t,e,a){"use strict";a.d(e,"e",(function(){return r})),a.d(e,"c",(function(){return s})),a.d(e,"j",(function(){return l})),a.d(e,"i",(function(){return o})),a.d(e,"g",(function(){return c})),a.d(e,"a",(function(){return d})),a.d(e,"h",(function(){return u})),a.d(e,"b",(function(){return m})),a.d(e,"d",(function(){return p})),a.d(e,"f",(function(){return g}));var i=a("bc3a"),n=a.n(i);function r(t={}){return n.a.get("/quota-plans",{params:t})}function s(t){return n.a.post("/quota-plans",t)}function l(t,e){return n.a.put("/quota-plans/"+t,e)}function o(t){return n.a.patch(`/quota-plans/${t}/toggle`)}function c(t={}){return n.a.get("/withdrawals",{params:t})}function d(t){return n.a.post(`/withdrawals/${t}/approve`)}function u(t,e=""){return n.a.post(`/withdrawals/${t}/reject`,{reason:e})}function m(t,e=""){return n.a.post(`/withdrawals/${t}/complete`,{tx_hash:e})}function p(t={}){return n.a.get("/pointcard-logs",{params:t})}function g(t={}){return n.a.get("/rewards",{params:t})}}}]);