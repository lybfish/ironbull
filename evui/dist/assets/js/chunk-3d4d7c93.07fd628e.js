(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3d4d7c93"],{"4f0c":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ele-body"},[n("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[n("el-col",{attrs:{span:6}},[n("stat-card",{attrs:{title:"流水条数",value:t.total,icon:"el-icon-s-order",color:"primary",loading:t.loading,"help-text":"当前筛选结果"}})],1),n("el-col",{attrs:{span:6}},[n("stat-card",{attrs:{title:"收入合计",icon:"el-icon-top",color:"success",loading:t.loading}},[n("template",{slot:"value"},[t._v(t._s(t.formatCurrency(t.stats.income)))])],2)],1),n("el-col",{attrs:{span:6}},[n("stat-card",{attrs:{title:"支出合计",icon:"el-icon-bottom",color:"danger",loading:t.loading}},[n("template",{slot:"value"},[t._v(t._s(t.formatCurrency(t.stats.expense)))])],2)],1),n("el-col",{attrs:{span:6}},[n("stat-card",{attrs:{title:"净额",icon:"el-icon-data-analysis",color:t.stats.net>=0?"success":"danger",loading:t.loading}},[n("template",{slot:"value"},[n("span",{style:{color:t.stats.net>=0?"#67C23A":"#F56C6C"}},[t._v(t._s(t.formatCurrency(t.stats.net)))])])],2)],1)],1),n("el-card",{attrs:{shadow:"never"}},[n("div",{staticClass:"toolbar"},[n("span",{staticClass:"toolbar-title"},[t._v("资金流水")]),n("el-button",{attrs:{size:"small",icon:"el-icon-refresh",loading:t.loading},on:{click:t.fetchData}},[t._v("刷新")])],1),n("div",{staticClass:"search-bar"},[n("el-form",{attrs:{inline:!0,size:"small"}},[n("el-form-item",{attrs:{label:"类型"}},[n("el-select",{staticStyle:{width:"140px"},attrs:{placeholder:"全部",clearable:""},model:{value:t.filters.tx_type,callback:function(e){t.$set(t.filters,"tx_type",e)},expression:"filters.tx_type"}},[n("el-option",{attrs:{label:"充值",value:"DEPOSIT"}}),n("el-option",{attrs:{label:"提现",value:"WITHDRAW"}}),n("el-option",{attrs:{label:"手续费",value:"FEE"}}),n("el-option",{attrs:{label:"盈亏",value:"PNL"}}),n("el-option",{attrs:{label:"转账",value:"TRANSFER"}}),n("el-option",{attrs:{label:"资金费",value:"FUNDING"}})],1)],1),n("el-form-item",{attrs:{label:"账户"}},[n("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:"全部账户",clearable:""},model:{value:t.filters.account_id,callback:function(e){t.$set(t.filters,"account_id",e)},expression:"filters.account_id"}},t._l(t.accountOptions,(function(t){return n("el-option",{key:t.id,attrs:{label:"["+(t.exchange||"").toUpperCase()+"] #"+t.id,value:t.id}})})),1)],1),n("el-form-item",{attrs:{label:"币种"}},[n("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"币种",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch.apply(null,arguments)}},model:{value:t.filters.currency,callback:function(e){t.$set(t.filters,"currency",e)},expression:"filters.currency"}})],1),n("el-form-item",{attrs:{label:"日期范围"}},[n("el-date-picker",{staticStyle:{width:"240px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始","end-placeholder":"结束","value-format":"yyyy-MM-dd"},model:{value:t.filters.dateRange,callback:function(e){t.$set(t.filters,"dateRange",e)},expression:"filters.dateRange"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.onSearch}},[t._v("查询")]),n("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:t.handleReset}},[t._v("重置")])],1)],1)],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"12px"},attrs:{data:t.list,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa"}}},[n("el-table-column",{attrs:{prop:"tx_id",label:"流水ID",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("span",{staticClass:"id-text"},[t._v(t._s(a.tx_id))])]}}])}),n("el-table-column",{attrs:{prop:"account_id",label:"账户",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("span",[t._v("#"+t._s(a.account_id))])]}}])}),n("el-table-column",{attrs:{prop:"tx_type",label:"类型",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("el-tag",{attrs:{type:t.getTxTypeTagType(a.tx_type),size:"small"}},[t._v(t._s(t.getTxTypeLabel(a.tx_type)))])]}}])}),n("el-table-column",{attrs:{prop:"currency",label:"币种",width:"80"}}),n("el-table-column",{attrs:{prop:"amount",label:"金额",width:"130",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("span",{style:{color:parseFloat(a.amount)>=0?"#67C23A":"#F56C6C",fontWeight:600}},[t._v(" "+t._s(parseFloat(a.amount)>=0?"+":"")+t._s(t.formatCurrency(a.amount))+" ")])]}}])}),n("el-table-column",{attrs:{prop:"balance_after",label:"变动后余额",width:"130",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v(t._s(t.formatCurrency(n.balance_after)))]}}])}),n("el-table-column",{attrs:{prop:"description",label:"备注","min-width":"150","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v(t._s(n.description||"-"))]}}])}),n("el-table-column",{attrs:{prop:"reference_id",label:"参考ID",width:"140","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.reference_id?n("span",{staticClass:"id-text"},[t._v(t._s(a.reference_id))]):n("span",{staticClass:"text-muted"},[t._v("-")])]}}])}),n("el-table-column",{attrs:{prop:"created_at",label:"创建时间",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v(t._s(t.formatTime(n.created_at)))]}}])})],1),t.loading||0!==t.list.length?t._e():n("el-empty",{attrs:{description:"暂无流水记录"}}),t.total>0?n("div",{staticClass:"pagination-wrap"},[n("span",{staticClass:"total-tip"},[t._v("共 "+t._s(t.total)+" 条")]),n("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes",total:t.total,"page-sizes":[20,50,100,200],"page-size":t.pagination.limit,"current-page":t.pagination.page},on:{"update:pageSize":function(e){return t.$set(t.pagination,"limit",e)},"update:page-size":function(e){return t.$set(t.pagination,"limit",e)},"update:currentPage":function(e){return t.$set(t.pagination,"page",e)},"update:current-page":function(e){return t.$set(t.pagination,"page",e)},"size-change":t.handleSizeChange,"current-change":t.handlePageChange}})],1):t._e()],1)],1)},r=[],i=(n("0643"),n("4e3e"),n("8012")),s=n("50fc"),o={name:"TransactionList",data(){return{loading:!1,list:[],total:0,filters:{tx_type:"",currency:"",account_id:"",dateRange:null},pagination:{page:1,limit:50},accountOptions:[]}},computed:{stats(){let t=0,e=0;return this.list.forEach(n=>{const a=parseFloat(n.amount)||0;a>=0?t+=a:e+=Math.abs(a)}),{income:t,expense:e,net:t-e}}},mounted(){this.fetchData(),this.fetchAccounts()},methods:{formatTime(t){if(!t)return"-";const e=new Date(t);if(isNaN(e.getTime()))return String(t).replace("T"," ").substring(0,19);const n=t=>String(t).padStart(2,"0");return`${e.getFullYear()}-${n(e.getMonth()+1)}-${n(e.getDate())} ${n(e.getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}`},formatCurrency(t){if(null==t||""===t)return"0.00";const e=parseFloat(t);return isNaN(e)?"0.00":e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},onSearch(){this.pagination.page=1,this.fetchData()},handleReset(){this.filters={tx_type:"",currency:"",account_id:"",dateRange:null},this.pagination.page=1,this.fetchData()},handleSizeChange(t){this.pagination.limit=t,this.pagination.page=1,this.fetchData()},handlePageChange(t){this.pagination.page=t,this.fetchData()},getTxTypeLabel(t){const e={DEPOSIT:"充值",WITHDRAW:"提现",FEE:"手续费",PNL:"盈亏",TRANSFER:"转账",FUNDING:"资金费"};return e[t]||t},getTxTypeTagType(t){const e={DEPOSIT:"success",WITHDRAW:"warning",FEE:"info",PNL:"success",TRANSFER:"",FUNDING:"info"};return e[t]||""},async fetchAccounts(){try{const t=await Object(s["k"])({status:1});this.accountOptions=t.data.data||t.data||[]}catch(t){}},async fetchData(){this.loading=!0;try{const t={offset:(this.pagination.page-1)*this.pagination.limit,limit:this.pagination.limit};this.filters.tx_type&&(t.transaction_type=this.filters.tx_type),this.filters.currency&&(t.currency=this.filters.currency),this.filters.account_id&&(t.account_id=this.filters.account_id),this.filters.dateRange&&2===this.filters.dateRange.length&&(t.start_time=this.filters.dateRange[0]+"T00:00:00",t.end_time=this.filters.dateRange[1]+"T23:59:59");const e=await Object(i["e"])(t),n=e.data;this.list=n.data||[],this.total=null!=n.total?n.total:this.list.length}catch(e){var t;this.$message.error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"获取流水失败")}finally{this.loading=!1}}}},l=o,c=(n("8de5"),n("2877")),u=Object(c["a"])(l,a,r,!1,null,"4676586d",null);e["default"]=u.exports},"50fc":function(t,e,n){"use strict";n.d(e,"o",(function(){return i})),n.d(e,"f",(function(){return s})),n.d(e,"B",(function(){return o})),n.d(e,"y",(function(){return l})),n.d(e,"s",(function(){return c})),n.d(e,"b",(function(){return u})),n.d(e,"n",(function(){return d})),n.d(e,"g",(function(){return p})),n.d(e,"C",(function(){return f})),n.d(e,"d",(function(){return g})),n.d(e,"h",(function(){return m})),n.d(e,"r",(function(){return h})),n.d(e,"p",(function(){return _})),n.d(e,"t",(function(){return y})),n.d(e,"q",(function(){return b})),n.d(e,"v",(function(){return v})),n.d(e,"i",(function(){return w})),n.d(e,"e",(function(){return x})),n.d(e,"z",(function(){return $})),n.d(e,"w",(function(){return S})),n.d(e,"u",(function(){return k})),n.d(e,"l",(function(){return C})),n.d(e,"m",(function(){return T})),n.d(e,"A",(function(){return D})),n.d(e,"x",(function(){return R})),n.d(e,"j",(function(){return F})),n.d(e,"k",(function(){return N})),n.d(e,"a",(function(){return E})),n.d(e,"c",(function(){return z}));var a=n("bc3a"),r=n.n(a);function i(t={}){return r.a.get("/tenants",{params:t})}function s(t){return r.a.post("/tenants",t)}function o(t,e){return r.a.put("/tenants/"+t,e)}function l(t){return r.a.patch(`/tenants/${t}/toggle`)}function c(t,e){return r.a.post(`/tenants/${t}/recharge`,e)}function u(t,e){return r.a.post(`/tenants/${t}/assign-plan`,{plan_id:e})}function d(t,e={}){return r.a.get(`/tenants/${t}/tenant-strategies`,{params:e})}function p(t,e){return r.a.post(`/tenants/${t}/tenant-strategies`,e)}function f(t,e,n){return r.a.put(`/tenants/${t}/tenant-strategies/${e}`,n)}function g(t,e){return r.a.post(`/tenants/${t}/tenant-strategies/${e}/copy-from-master`)}function m(t,e){return r.a.delete(`/tenants/${t}/tenant-strategies/${e}`)}function h(t={}){return r.a.get("/users",{params:t})}function _(t){return r.a.get("/users/"+t)}function y(t,e){return r.a.post(`/users/${t}/recharge`,e)}function b(t,e={}){return r.a.get(`/users/${t}/team`,{params:e})}function v(t,e){return r.a.post(`/users/${t}/set-market-node`,e)}function w(t={}){return r.a.get("/admins",{params:t})}function x(t){return r.a.post("/admins",t)}function $(t,e){return r.a.put("/admins/"+t,e)}function S(t){return r.a.patch(`/admins/${t}/toggle`)}function k(t,e){return r.a.post(`/admins/${t}/reset-password`,e)}function C(t={}){return r.a.get("/strategies",{params:t})}function T(t){return r.a.get("/strategies/"+t)}function D(t,e){return r.a.post("/strategies/"+t,e)}function R(t){return r.a.patch(`/strategies/${t}/toggle`)}function F(t={}){return r.a.get("/strategy-bindings-admin",{params:t})}function N(t={}){return r.a.get("/exchange-accounts",{params:t})}function E(t,e){return r.a.put(`/exchange-accounts/${t}/assign-node`,e)}function z(t){return r.a.post("/exchange-accounts/batch-assign-node",t)}},8012:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return l})),n.d(e,"d",(function(){return c})),n.d(e,"a",(function(){return u})),n.d(e,"e",(function(){return d}));var a=n("bc3a"),r=n.n(a);let i={tenant_id:1};function s(t){return{...i,...t}}function o(t={}){return r.a.get("/orders",{params:s({limit:50,...t})})}function l(t={}){return r.a.get("/fills",{params:s({limit:50,...t})})}function c(t={}){return r.a.get("/positions",{params:s({limit:100,...t})})}function u(t={}){return r.a.get("/accounts",{params:s({limit:50,...t})})}function d(t={}){return r.a.get("/transactions",{params:s({limit:50,...t})})}},"8de5":function(t,e,n){"use strict";n("d396")},d396:function(t,e,n){}}]);