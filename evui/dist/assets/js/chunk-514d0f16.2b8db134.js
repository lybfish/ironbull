(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-514d0f16"],{"0f0b":function(t,e,a){},"9d21":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ele-body"},[a("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[a("el-col",{attrs:{lg:8,md:8,sm:12}},[a("stat-card",{attrs:{title:"总记录数",value:t.summary.totalRecords,icon:"el-icon-document",color:"primary","help-text":"当前筛选条件下的奖励记录总数",loading:t.loading}})],1),a("el-col",{attrs:{lg:8,md:8,sm:12}},[a("stat-card",{attrs:{title:"总金额",icon:"el-icon-money",color:"success","help-text":"当前筛选条件下的奖励总金额",loading:t.loading}},[a("template",{slot:"value"},[a("span",{staticStyle:{"font-weight":"600"}},[t._v(t._s(t.formatMoney(t.summary.totalAmount)))])])],2)],1),a("el-col",{attrs:{lg:8,md:8,sm:12}},[a("stat-card",{attrs:{title:"平均比例",icon:"el-icon-data-analysis",color:"warning","help-text":"当前筛选条件下的平均奖励比例",loading:t.loading}},[a("template",{slot:"value"},[a("span",[t._v(t._s(t.formatRate(t.summary.averageRate)))])])],2)],1)],1),a("el-card",{attrs:{shadow:"never"}},[a("el-form",{staticClass:"ele-form-search",attrs:{model:t.query,"label-width":"90px"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch.apply(null,arguments)},submit:function(t){t.preventDefault()}}},[a("el-row",{attrs:{gutter:15}},[a("el-col",{attrs:{lg:6,md:12}},[a("el-form-item",{attrs:{label:"用户ID:"}},[a("el-input",{attrs:{placeholder:"请输入用户ID",clearable:"",size:"small"},model:{value:t.query.user_id,callback:function(e){t.$set(t.query,"user_id",e)},expression:"query.user_id"}})],1)],1),a("el-col",{attrs:{lg:6,md:12}},[a("el-form-item",{attrs:{label:"奖励类型:"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择奖励类型",clearable:"",size:"small"},model:{value:t.query.reward_type,callback:function(e){t.$set(t.query,"reward_type",e)},expression:"query.reward_type"}},[a("el-option",{attrs:{label:"直推奖",value:"direct"}}),a("el-option",{attrs:{label:"级差奖",value:"level_diff"}}),a("el-option",{attrs:{label:"平级奖",value:"peer"}})],1)],1)],1),a("el-col",{attrs:{lg:6,md:12}},[a("el-form-item",{attrs:{label:"租户ID:"}},[a("el-input",{attrs:{placeholder:"请输入租户ID",clearable:"",size:"small"},model:{value:t.query.tenant_id,callback:function(e){t.$set(t.query,"tenant_id",e)},expression:"query.tenant_id"}})],1)],1),a("el-col",{attrs:{lg:12,md:12}},[a("el-form-item",{attrs:{label:"日期范围:"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd",size:"small"},on:{change:t.handleSearch},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1)],1),a("el-col",{attrs:{lg:6,md:12}},[a("div",{staticClass:"ele-form-actions"},[a("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:t.handleSearch}},[t._v(" 查询 ")]),a("el-button",{attrs:{icon:"el-icon-refresh",size:"small"},on:{click:t.handleReset}},[t._v(" 重置 ")]),a("el-button",{attrs:{icon:"el-icon-download",size:"small",type:"success",plain:"",disabled:0===t.list.length},on:{click:t.exportCSV}},[t._v(" 导出CSV ")])],1)])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"12px"},attrs:{data:t.list,stripe:"",border:"",size:"small","row-key":"id"}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",align:"center"}}),a("el-table-column",{attrs:{prop:"user_email",label:"获奖用户",minWidth:"150","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("span",[t._v(t._s(r.user_email||"用户ID: "+r.user_id))])]}}])}),a("el-table-column",{attrs:{prop:"source_email",label:"来源用户",minWidth:"150","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[r.source_email?a("span",[t._v(t._s(r.source_email))]):r.source_user_id?a("span",[t._v("用户ID: "+t._s(r.source_user_id))]):a("span",{staticStyle:{color:"#C0C4CC"}},[t._v("-")])]}}])}),a("el-table-column",{attrs:{prop:"reward_type",label:"奖励类型",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("el-tag",{attrs:{type:t.getRewardTypeTag(r.reward_type),size:"small"}},[t._v(" "+t._s(t.getRewardTypeName(r.reward_type))+" ")])]}}])}),a("el-table-column",{attrs:{prop:"amount",label:"金额",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("span",{staticStyle:{"font-weight":"600"}},[t._v(t._s(t.formatMoney(r.amount)))])]}}])}),a("el-table-column",{attrs:{prop:"rate",label:"比例",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("span",[t._v(t._s(t.formatRate(r.rate)))])]}}])}),a("el-table-column",{attrs:{prop:"settle_batch",label:"结算批次",minWidth:"150","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("span",[t._v(t._s(r.settle_batch||"-"))])]}}])}),a("el-table-column",{attrs:{prop:"remark",label:"备注",minWidth:"150"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[r.remark?a("el-tooltip",{attrs:{content:r.remark,placement:"top",disabled:!r.remark}},[a("span",[t._v(t._s(r.remark))])]):a("span",{staticStyle:{color:"#C0C4CC"}},[t._v("-")])]}}])}),a("el-table-column",{attrs:{prop:"created_at",label:"创建时间",width:"170",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("span",[t._v(t._s(t.formatDateTime(r.created_at)))])]}}])})],1),a("div",{staticClass:"pagination-wrap"},[a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",total:t.total,"page-size":t.query.page_size,"current-page":t.query.page,"page-sizes":[10,20,50,100]},on:{"update:pageSize":function(e){return t.$set(t.query,"page_size",e)},"update:page-size":function(e){return t.$set(t.query,"page_size",e)},"update:currentPage":function(e){return t.$set(t.query,"page",e)},"update:current-page":function(e){return t.$set(t.query,"page",e)},"size-change":t.fetchData,"current-change":t.fetchData}})],1),t.loading||0!==t.list.length?t._e():a("el-empty",{staticStyle:{padding:"40px 0"},attrs:{description:"暂无奖励记录"}})],1)],1)},n=[],l=(a("0643"),a("a573"),a("cd05")),s={name:"RewardList",data(){return{loading:!1,list:[],total:0,query:{user_id:"",reward_type:"",tenant_id:"",page:1,page_size:20},dateRange:null,summary:{totalRecords:0,totalAmount:0,averageRate:0}}},computed:{},mounted(){this.fetchData()},methods:{getRewardTypeName(t){const e={direct:"直推奖",level_diff:"级差奖",peer:"平级奖"};return e[t]||t||"-"},getRewardTypeTag(t){const e={direct:"success",level_diff:"warning",peer:"primary"};return e[t]||"info"},formatMoney(t){const e=Number(t)||0;return e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},formatRate(t){const e=Number(t)||0;return 0===e?"-":(100*e).toFixed(2)+"%"},formatDateTime(t){if(!t)return"-";if("string"===typeof t)try{const e=new Date(t);if(isNaN(e.getTime()))return t;const a=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),l=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0"),o=String(e.getSeconds()).padStart(2,"0");return`${a}-${r}-${n} ${l}:${s}:${o}`}catch(e){return t}return t},exportCSV(){const t=["ID","获奖用户","来源用户","奖励类型","金额","比例","结算批次","备注","创建时间"],e=this.list.map(t=>[t.id,t.user_email||t.user_id,t.source_email||t.source_user_id||"",this.getRewardTypeName(t.reward_type),t.amount,t.rate,t.settle_batch||"",t.remark||"",t.created_at||""]),a=[t,...e].map(t=>t.map(t=>`"${t}"`).join(",")).join("\n"),r=new Blob(["\ufeff"+a],{type:"text/csv;charset=utf-8"}),n=URL.createObjectURL(r),l=document.createElement("a");l.href=n,l.download=`奖励记录_${(new Date).toISOString().slice(0,10)}.csv`,l.click(),URL.revokeObjectURL(n)},handleSearch(){this.query.page=1,this.fetchData()},handleReset(){this.query={user_id:"",reward_type:"",tenant_id:"",page:1,page_size:20},this.dateRange=null,this.fetchData()},async fetchData(){this.loading=!0;try{const t={page:this.query.page,page_size:this.query.page_size};this.query.user_id&&(t.user_id=this.query.user_id),this.query.reward_type&&(t.reward_type=this.query.reward_type),this.query.tenant_id&&(t.tenant_id=this.query.tenant_id);const e=await Object(l["h"])(t),a=e.data;a&&a.success&&Array.isArray(a.data)?(this.list=a.data,this.total=a.total||a.data.length,a.stats&&(this.summary={totalRecords:a.stats.total_records||this.total,totalAmount:a.stats.total_amount||0,averageRate:a.stats.avg_rate||0})):Array.isArray(a)?(this.list=a,this.total=a.length):(this.list=[],this.total=0)}catch(t){this.$message.error("获取奖励记录失败："+(t.response&&t.response.data&&t.response.data.message||"未知错误")),this.list=[],this.total=0}finally{this.loading=!1}}}},o=s,i=(a("b131"),a("2877")),u=Object(i["a"])(o,r,n,!1,null,"4cc0c2b8",null);e["default"]=u.exports},b131:function(t,e,a){"use strict";a("0f0b")},cd05:function(t,e,a){"use strict";a.d(e,"g",(function(){return l})),a.d(e,"c",(function(){return s})),a.d(e,"m",(function(){return o})),a.d(e,"l",(function(){return i})),a.d(e,"i",(function(){return u})),a.d(e,"a",(function(){return c})),a.d(e,"j",(function(){return d})),a.d(e,"b",(function(){return p})),a.d(e,"d",(function(){return m})),a.d(e,"h",(function(){return f})),a.d(e,"f",(function(){return g})),a.d(e,"e",(function(){return h})),a.d(e,"k",(function(){return y}));var r=a("bc3a"),n=a.n(r);function l(t={}){return n.a.get("/quota-plans",{params:t})}function s(t){return n.a.post("/quota-plans",t)}function o(t,e){return n.a.put("/quota-plans/"+t,e)}function i(t){return n.a.patch(`/quota-plans/${t}/toggle`)}function u(t={}){return n.a.get("/withdrawals",{params:t})}function c(t){return n.a.post(`/withdrawals/${t}/approve`)}function d(t,e=""){return n.a.post(`/withdrawals/${t}/reject`,{reason:e})}function p(t,e=""){return n.a.post(`/withdrawals/${t}/complete`,{tx_hash:e})}function m(t={}){return n.a.get("/pointcard-logs",{params:t})}function f(t={}){return n.a.get("/rewards",{params:t})}function g(t={}){return n.a.get("/profit-pools",{params:t})}function h(){return n.a.get("/profit-pools/stats")}function y(t){return n.a.post(`/profit-pools/${t}/retry`)}}}]);