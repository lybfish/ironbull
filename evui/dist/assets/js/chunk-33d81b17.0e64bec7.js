(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-33d81b17"],{"0f66":function(e,t,s){"use strict";s.d(t,"d",(function(){return r})),s.d(t,"a",(function(){return i})),s.d(t,"i",(function(){return l})),s.d(t,"b",(function(){return o})),s.d(t,"c",(function(){return c})),s.d(t,"e",(function(){return d})),s.d(t,"g",(function(){return u})),s.d(t,"h",(function(){return h})),s.d(t,"f",(function(){return y}));var a=s("bc3a"),n=s.n(a);function r(e={}){return n.a.get("/nodes",{params:e})}function i(e){return n.a.post("/nodes",e)}function l(e,t){return n.a.put("/nodes/"+e,t)}function o(e){return n.a.delete("/nodes/"+e)}function c(e){return n.a.get(`/nodes/${e}/accounts`)}function d(e={}){return n.a.post("/sync/balance",e)}function u(e={}){return n.a.post("/sync/positions",e)}function h(e={}){return n.a.post("/sync/trades",e)}function y(e={}){return n.a.post("/sync/markets",e)}},4738:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ele-body"},[s("el-row",{attrs:{gutter:16}},[s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[e._v("余额同步")])]),s("el-form",{attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点",clearable:""},model:{value:e.balanceNodeId,callback:function(t){e.balanceNodeId=t},expression:"balanceNodeId"}},e._l(e.nodes,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name+" ("+e.node_code+")",value:e.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",loading:e.syncingBalance},on:{click:e.handleSyncBalance}},[e._v("同步余额")])],1)],1),e.balanceResult?s("div",{staticClass:"result"},[s("el-alert",{attrs:{title:e.balanceResult.message,type:e.balanceResult.success?"success":"error",closable:!1,"show-icon":""}})],1):e._e()],1)],1),s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[e._v("持仓同步")])]),s("el-form",{attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点",clearable:""},model:{value:e.positionNodeId,callback:function(t){e.positionNodeId=t},expression:"positionNodeId"}},e._l(e.nodes,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name+" ("+e.node_code+")",value:e.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",loading:e.syncingPositions},on:{click:e.handleSyncPositions}},[e._v("同步持仓")])],1)],1),e.positionResult?s("div",{staticClass:"result"},[s("el-alert",{attrs:{title:e.positionResult.message,type:e.positionResult.success?"success":"error",closable:!1,"show-icon":""}})],1):e._e()],1)],1)],1),s("el-row",{staticStyle:{"margin-top":"16px"},attrs:{gutter:16}},[s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[e._v("成交同步")])]),s("el-form",{attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点（不选=全部）",clearable:""},model:{value:e.tradesNodeId,callback:function(t){e.tradesNodeId=t},expression:"tradesNodeId"}},e._l(e.nodes,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name+" ("+e.node_code+")",value:e.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"warning",loading:e.syncingTrades},on:{click:e.handleSyncTrades}},[e._v("同步成交")])],1)],1),e.tradesResult?s("div",{staticClass:"result"},[s("el-alert",{attrs:{title:e.tradesResult.message,type:e.tradesResult.success?"success":"error",closable:!1,"show-icon":""}})],1):e._e()],1)],1),s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[e._v("市场信息同步")])]),s("el-form",{attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"交易所"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"全部交易所",clearable:""},model:{value:e.marketExchange,callback:function(t){e.marketExchange=t},expression:"marketExchange"}},[s("el-option",{attrs:{label:"Binance",value:"binance"}}),s("el-option",{attrs:{label:"Gate",value:"gate"}}),s("el-option",{attrs:{label:"OKX",value:"okx"}})],1)],1),s("el-form-item",{attrs:{label:"市场类型"}},[s("el-radio-group",{model:{value:e.marketType,callback:function(t){e.marketType=t},expression:"marketType"}},[s("el-radio",{attrs:{label:"swap"}},[e._v("永续合约")]),s("el-radio",{attrs:{label:"spot"}},[e._v("现货")])],1)],1),s("el-form-item",[s("el-button",{attrs:{type:"success",loading:e.syncingMarkets},on:{click:e.handleSyncMarkets}},[e._v("同步市场信息")])],1)],1),e.marketsResult?s("div",{staticClass:"result"},[s("el-alert",{attrs:{title:e.marketsResult.message,type:e.marketsResult.success?"success":"error",closable:!1,"show-icon":""}})],1):e._e()],1)],1)],1),s("el-card",{staticStyle:{"margin-top":"16px"},attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[e._v("同步历史")]),s("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.clearHistory}},[e._v("清空历史")])],1),s("el-table",{attrs:{data:e.syncHistory,stripe:"",border:"",size:"small","max-height":"400"}},[s("el-table-column",{attrs:{prop:"type",label:"类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("el-tag",{attrs:{type:e.syncTypeTag(a.type),size:"mini"}},[e._v(" "+e._s(e.syncTypeLabel(a.type))+" ")])]}}])}),s("el-table-column",{attrs:{prop:"node_name",label:"目标节点",width:"200"}}),s("el-table-column",{attrs:{prop:"message",label:"结果"}}),s("el-table-column",{attrs:{prop:"time",label:"时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[e._v(" "+e._s(e.formatDateTime(s.time))+" ")]}}])}),s("el-table-column",{attrs:{label:"状态",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("el-tag",{attrs:{type:a.success?"success":"danger",size:"mini"}},[e._v(" "+e._s(a.success?"成功":"失败")+" ")])]}}])})],1),0===e.syncHistory.length?s("el-empty",{attrs:{description:"暂无同步记录"}}):e._e()],1)],1)},n=[],r=(s("e9c4"),s("0643"),s("fffc"),s("0f66")),i={name:"SyncManage",data(){return{nodes:[],balanceNodeId:null,positionNodeId:null,syncingBalance:!1,syncingPositions:!1,syncingTrades:!1,syncingMarkets:!1,balanceResult:null,positionResult:null,tradesResult:null,marketsResult:null,tradesNodeId:null,marketExchange:null,marketType:"swap",syncHistory:[]}},mounted(){this.fetchNodes(),this.loadHistory()},methods:{syncTypeLabel(e){const t={balance:"余额同步",position:"持仓同步",trades:"成交同步",markets:"市场同步"};return t[e]||e},syncTypeTag(e){const t={balance:"primary",position:"success",trades:"warning",markets:""};return t[e]||"info"},async fetchNodes(){try{const e=await Object(r["d"])();this.nodes=e.data.data||[]}catch(e){this.$message.error("获取节点列表失败")}},async handleSyncBalance(){if(!this.balanceNodeId)return void this.$message.warning("请选择目标节点");this.syncingBalance=!0,this.balanceResult=null;const e=this.nodes.find(e=>e.id===this.balanceNodeId),t=e?`${e.name} (${e.node_code})`:"未知节点",s=new Date;try{await Object(r["e"])({node_id:this.balanceNodeId});const e={success:!0,message:"余额同步完成"};this.balanceResult=e,this.addHistory("balance",t,e.message,!0,s),this.$message.success("余额同步完成")}catch(n){var a;const e=(null===(a=n.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||n.message||"同步失败",r={success:!1,message:"同步失败: "+e};this.balanceResult=r,this.addHistory("balance",t,r.message,!1,s),this.$message.error("余额同步失败")}finally{this.syncingBalance=!1}},async handleSyncPositions(){if(!this.positionNodeId)return void this.$message.warning("请选择目标节点");this.syncingPositions=!0,this.positionResult=null;const e=this.nodes.find(e=>e.id===this.positionNodeId),t=e?`${e.name} (${e.node_code})`:"未知节点",s=new Date;try{await Object(r["g"])({node_id:this.positionNodeId});const e={success:!0,message:"持仓同步完成"};this.positionResult=e,this.addHistory("position",t,e.message,!0,s),this.$message.success("持仓同步完成")}catch(n){var a;const e=(null===(a=n.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||n.message||"同步失败",r={success:!1,message:"同步失败: "+e};this.positionResult=r,this.addHistory("position",t,r.message,!1,s),this.$message.error("持仓同步失败")}finally{this.syncingPositions=!1}},async handleSyncTrades(){this.syncingTrades=!0,this.tradesResult=null;const e=this.tradesNodeId?this.nodes.find(e=>e.id===this.tradesNodeId):null,t=e?`${e.name} (${e.node_code})`:"全部节点",s=new Date;try{const e={};this.tradesNodeId&&(e.node_id=this.tradesNodeId),await Object(r["h"])(e);const a={success:!0,message:"成交同步完成"};this.tradesResult=a,this.addHistory("trades",t,a.message,!0,s),this.$message.success("成交同步完成")}catch(n){var a;const e=(null===(a=n.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||n.message||"同步失败",r={success:!1,message:"同步失败: "+e};this.tradesResult=r,this.addHistory("trades",t,r.message,!1,s),this.$message.error("成交同步失败")}finally{this.syncingTrades=!1}},async handleSyncMarkets(){this.syncingMarkets=!0,this.marketsResult=null;const e=new Date,t=this.marketExchange?this.marketExchange.toUpperCase():"全部";try{const s={market_type:this.marketType};this.marketExchange&&(s.exchange=this.marketExchange),await Object(r["f"])(s);const a={success:!0,message:`市场信息同步完成 (${t} - ${this.marketType})`};this.marketsResult=a,this.addHistory("markets",t,a.message,!0,e),this.$message.success("市场信息同步完成")}catch(a){var s;const n=(null===(s=a.response)||void 0===s||null===(s=s.data)||void 0===s?void 0:s.detail)||a.message||"同步失败",r={success:!1,message:"同步失败: "+n};this.marketsResult=r,this.addHistory("markets",t,r.message,!1,e),this.$message.error("市场信息同步失败")}finally{this.syncingMarkets=!1}},addHistory(e,t,s,a,n){this.syncHistory.unshift({type:e,node_name:t,message:s,success:a,time:n.toISOString()}),this.syncHistory.length>50&&(this.syncHistory=this.syncHistory.slice(0,50)),this.saveHistory()},formatDateTime(e){return e?new Date(e).toLocaleString("zh-CN"):"-"},saveHistory(){try{localStorage.setItem("sync_history",JSON.stringify(this.syncHistory))}catch(e){console.error("保存同步历史失败",e)}},loadHistory(){try{const e=localStorage.getItem("sync_history");e&&(this.syncHistory=JSON.parse(e))}catch(e){console.error("加载同步历史失败",e)}},clearHistory(){this.$confirm("确定清空所有同步历史记录吗？","提示",{type:"warning"}).then(()=>{this.syncHistory=[],this.saveHistory(),this.$message.success("已清空历史记录")}).catch(()=>{})}}},l=i,o=(s("961c"),s("2877")),c=Object(o["a"])(l,a,n,!1,null,"78e6014d",null);t["default"]=c.exports},"961c":function(e,t,s){"use strict";s("c37e")},c37e:function(e,t,s){}}]);