(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5b64efbe"],{"342c":function(t,a,e){},"50bf":function(t,a,e){"use strict";e("342c")},"50fc":function(t,a,e){"use strict";e.d(a,"p",(function(){return n})),e.d(a,"f",(function(){return r})),e.d(a,"D",(function(){return l})),e.d(a,"z",(function(){return o})),e.d(a,"t",(function(){return c})),e.d(a,"b",(function(){return d})),e.d(a,"o",(function(){return u})),e.d(a,"g",(function(){return p})),e.d(a,"E",(function(){return g})),e.d(a,"d",(function(){return f})),e.d(a,"h",(function(){return h})),e.d(a,"s",(function(){return m})),e.d(a,"q",(function(){return _})),e.d(a,"u",(function(){return v})),e.d(a,"r",(function(){return b})),e.d(a,"w",(function(){return y})),e.d(a,"i",(function(){return w})),e.d(a,"e",(function(){return D})),e.d(a,"A",(function(){return k})),e.d(a,"x",(function(){return C})),e.d(a,"v",(function(){return x})),e.d(a,"m",(function(){return S})),e.d(a,"n",(function(){return $})),e.d(a,"C",(function(){return z})),e.d(a,"y",(function(){return P})),e.d(a,"j",(function(){return T})),e.d(a,"B",(function(){return F})),e.d(a,"k",(function(){return N})),e.d(a,"a",(function(){return I})),e.d(a,"c",(function(){return L})),e.d(a,"l",(function(){return V}));var s=e("bc3a"),i=e.n(s);function n(t={}){return i.a.get("/tenants",{params:t})}function r(t){return i.a.post("/tenants",t)}function l(t,a){return i.a.put("/tenants/"+t,a)}function o(t){return i.a.patch(`/tenants/${t}/toggle`)}function c(t,a){return i.a.post(`/tenants/${t}/recharge`,a)}function d(t,a){return i.a.post(`/tenants/${t}/assign-plan`,{plan_id:a})}function u(t,a={}){return i.a.get(`/tenants/${t}/tenant-strategies`,{params:a})}function p(t,a){return i.a.post(`/tenants/${t}/tenant-strategies`,a)}function g(t,a,e){return i.a.put(`/tenants/${t}/tenant-strategies/${a}`,e)}function f(t,a){return i.a.post(`/tenants/${t}/tenant-strategies/${a}/copy-from-master`)}function h(t,a){return i.a.delete(`/tenants/${t}/tenant-strategies/${a}`)}function m(t={}){return i.a.get("/users",{params:t})}function _(t){return i.a.get("/users/"+t)}function v(t,a){return i.a.post(`/users/${t}/recharge`,a)}function b(t,a={}){return i.a.get(`/users/${t}/team`,{params:a})}function y(t,a){return i.a.post(`/users/${t}/set-market-node`,a)}function w(t={}){return i.a.get("/admins",{params:t})}function D(t){return i.a.post("/admins",t)}function k(t,a){return i.a.put("/admins/"+t,a)}function C(t){return i.a.patch(`/admins/${t}/toggle`)}function x(t,a){return i.a.post(`/admins/${t}/reset-password`,a)}function S(t={}){return i.a.get("/strategies",{params:t})}function $(t){return i.a.get("/strategies/"+t)}function z(t,a){return i.a.post("/strategies/"+t,a)}function P(t){return i.a.patch(`/strategies/${t}/toggle`)}function T(t={}){return i.a.get("/strategy-bindings-admin",{params:t})}function F(t,a){return i.a.put("/strategy-bindings-admin/"+t,a)}function N(t={}){return i.a.get("/exchange-accounts",{params:t})}function I(t,a){return i.a.put(`/exchange-accounts/${t}/assign-node`,a)}function L(t){return i.a.post("/exchange-accounts/batch-assign-node",t)}function V(t={}){return i.a.get("/signal-events",{params:t})}},7926:function(t,a,e){"use strict";e("aadc")},aadc:function(t,a,e){},cd05:function(t,a,e){"use strict";e.d(a,"e",(function(){return n})),e.d(a,"c",(function(){return r})),e.d(a,"j",(function(){return l})),e.d(a,"i",(function(){return o})),e.d(a,"g",(function(){return c})),e.d(a,"a",(function(){return d})),e.d(a,"h",(function(){return u})),e.d(a,"b",(function(){return p})),e.d(a,"d",(function(){return g})),e.d(a,"f",(function(){return f}));var s=e("bc3a"),i=e.n(s);function n(t={}){return i.a.get("/quota-plans",{params:t})}function r(t){return i.a.post("/quota-plans",t)}function l(t,a){return i.a.put("/quota-plans/"+t,a)}function o(t){return i.a.patch(`/quota-plans/${t}/toggle`)}function c(t={}){return i.a.get("/withdrawals",{params:t})}function d(t){return i.a.post(`/withdrawals/${t}/approve`)}function u(t,a=""){return i.a.post(`/withdrawals/${t}/reject`,{reason:a})}function p(t,a=""){return i.a.post(`/withdrawals/${t}/complete`,{tx_hash:a})}function g(t={}){return i.a.get("/pointcard-logs",{params:t})}function f(t={}){return i.a.get("/rewards",{params:t})}},f143:function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"ele-body"},[e("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[e("el-col",{attrs:{lg:8,md:8,sm:12}},[e("stat-card",{attrs:{title:"租户总数",value:t.stats.totalTenants,icon:"el-icon-office-building",color:"primary","help-text":"系统中的租户总数",loading:t.statsLoading}})],1),e("el-col",{attrs:{lg:8,md:8,sm:12}},[e("stat-card",{attrs:{title:"已启用租户",value:t.stats.activeTenants,icon:"el-icon-circle-check",color:"success","help-text":"状态为启用的租户数",loading:t.statsLoading}})],1),e("el-col",{attrs:{lg:8,md:8,sm:12}},[e("stat-card",{attrs:{title:"点卡余额总计",value:t.stats.totalPointBalance,icon:"el-icon-coin",color:"warning","help-text":"所有租户点卡余额之和（自购+赠送）",loading:t.statsLoading}})],1)],1),e("el-card",{attrs:{shadow:"never"}},[e("div",{staticClass:"toolbar"},[e("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:function(a){return t.openEditDialog()}}},[t._v("新建租户")]),e("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:t.fetchData}},[t._v("刷新")]),e("div",{staticStyle:{flex:"1"}}),e("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"搜索租户名称",clearable:"",size:"small"},on:{clear:t.fetchData},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.fetchData.apply(null,arguments)}},model:{value:t.keyword,callback:function(a){t.keyword=a},expression:"keyword"}})],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"12px"},attrs:{data:t.list,stripe:"",border:"",size:"small"}},[e("el-table-column",{attrs:{prop:"id",label:"ID",width:"60",align:"center"}}),e("el-table-column",{attrs:{prop:"name",label:"租户名称","min-width":"130"}}),e("el-table-column",{attrs:{label:"AppKey",width:"180"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("span",{staticClass:"masked-key",on:{click:function(a){return t.copyText(s.app_key,"AppKey")}}},[t._v(" "+t._s(t.maskKey(s.app_key))+" "),e("i",{staticClass:"el-icon-document-copy copy-icon"})])]}}])}),e("el-table-column",{attrs:{prop:"point_card_self",label:"自购点卡",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("span",[t._v(t._s(t.formatNum(s.point_card_self)))])]}}])}),e("el-table-column",{attrs:{prop:"point_card_gift",label:"赠送点卡",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("span",[t._v(t._s(t.formatNum(s.point_card_gift)))])]}}])}),e("el-table-column",{attrs:{prop:"total_users",label:"用户数",width:"80",align:"center"}}),e("el-table-column",{attrs:{prop:"tech_reward_total",label:"技术累计",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("span",[t._v(t._s(t.formatNum(s.tech_reward_total)))])]}}])}),e("el-table-column",{attrs:{prop:"undist_reward_total",label:"未分配累计",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("span",[t._v(t._s(t.formatNum(s.undist_reward_total)))])]}}])}),e("el-table-column",{attrs:{prop:"quota_plan_name",label:"配额套餐",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("span",[t._v(t._s(s.quota_plan_name||"-"))])]}}])}),e("el-table-column",{attrs:{prop:"status",label:"状态",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("el-tag",{attrs:{type:1===s.status?"success":"info",size:"mini"}},[t._v(" "+t._s(1===s.status?"启用":"禁用")+" ")])]}}])}),e("el-table-column",{attrs:{prop:"created_at",label:"创建时间",width:"170"}}),e("el-table-column",{attrs:{label:"操作",width:"280",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.openEditDialog(s)}}},[t._v("编辑")]),e("el-button",{attrs:{size:"mini",type:1===s.status?"warning":"success"},on:{click:function(a){return t.handleToggle(s)}}},[t._v(" "+t._s(1===s.status?"禁用":"启用")+" ")]),e("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.openRechargeDialog(s)}}},[t._v("充值")]),e("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.openDetail(s)}}},[t._v("详情")])]}}])})],1),t.total>0?e("div",{staticClass:"pagination-wrap"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",total:t.total,"page-sizes":[10,20,50,100],"page-size":t.pageSize,"current-page":t.page},on:{"update:pageSize":function(a){t.pageSize=a},"update:page-size":function(a){t.pageSize=a},"update:currentPage":function(a){t.page=a},"update:current-page":function(a){t.page=a},"size-change":t.fetchData,"current-change":t.fetchData}})],1):t._e()],1),e("el-dialog",{attrs:{title:t.editId?"编辑租户":"新建租户",visible:t.editDialogVisible,width:"480px","close-on-click-modal":!1},on:{"update:visible":function(a){t.editDialogVisible=a}}},[e("el-form",{ref:"editForm",attrs:{model:t.editForm,rules:t.editRules,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"名称",prop:"name"}},[e("el-input",{attrs:{placeholder:"请输入租户名称",maxlength:"50","show-word-limit":""},model:{value:t.editForm.name,callback:function(a){t.$set(t.editForm,"name",a)},expression:"editForm.name"}})],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.editDialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary",loading:t.saving},on:{click:t.handleSave}},[t._v("确定")])],1)],1),e("el-dialog",{attrs:{title:"点卡充值",visible:t.rechargeDialogVisible,width:"440px","close-on-click-modal":!1},on:{"update:visible":function(a){t.rechargeDialogVisible=a}}},[e("el-form",{ref:"rechargeForm",attrs:{model:t.rechargeForm,rules:t.rechargeRules,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"租户"}},[e("span",{staticStyle:{"font-weight":"600"}},[t._v(t._s(t.rechargeTenantName))])]),e("el-form-item",{attrs:{label:"类型",prop:"card_type"}},[e("el-radio-group",{model:{value:t.rechargeForm.card_type,callback:function(a){t.$set(t.rechargeForm,"card_type",a)},expression:"rechargeForm.card_type"}},[e("el-radio-button",{attrs:{label:"self"}},[t._v("自购充值")]),e("el-radio-button",{attrs:{label:"gift"}},[t._v("赠送充值")])],1)],1),e("el-form-item",{attrs:{label:"金额",prop:"amount"}},[e("el-input-number",{staticStyle:{width:"100%"},attrs:{min:1,max:999999,precision:2},model:{value:t.rechargeForm.amount,callback:function(a){t.$set(t.rechargeForm,"amount",a)},expression:"rechargeForm.amount"}})],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.rechargeDialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary",loading:t.recharging},on:{click:t.handleRecharge}},[t._v("确认充值")])],1)],1),e("el-dialog",{attrs:{title:t.detailData?"租户详情 - "+t.detailData.name:"租户详情",visible:t.detailVisible,width:"960px",top:"5vh","close-on-click-modal":!1,"custom-class":"tenant-detail-dialog"},on:{"update:visible":function(a){t.detailVisible=a}}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.detailLoading,expression:"detailLoading"}],staticClass:"detail-content"},[e("div",{staticClass:"detail-section"},[e("div",{staticClass:"section-title"},[t._v("基本信息")]),t.detailData?e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:6}},[e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("租户ID")]),e("span",{staticClass:"info-value"},[t._v(t._s(t.detailData.id))])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("名称")]),e("span",{staticClass:"info-value"},[t._v(t._s(t.detailData.name))])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("状态")]),e("el-tag",{attrs:{type:1===t.detailData.status?"success":"info",size:"small"}},[t._v(" "+t._s(1===t.detailData.status?"启用":"禁用")+" ")])],1)]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("创建时间")]),e("span",{staticClass:"info-value",staticStyle:{"font-size":"12px"}},[t._v(t._s(t.detailData.created_at))])])])],1):t._e(),t.detailData?e("el-row",{staticStyle:{"margin-top":"8px"},attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("AppKey")]),e("span",{staticClass:"info-value",staticStyle:{"font-family":"monospace"}},[t._v(t._s(t.detailData.app_key))]),e("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-document-copy"},on:{click:function(a){return t.copyText(t.detailData.app_key,"AppKey")}}},[t._v("复制")])],1)]),e("el-col",{attrs:{span:12}},[e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("AppSecret")]),e("span",{staticClass:"info-value",staticStyle:{"font-family":"monospace"}},[t._v(" "+t._s(t.showSecret?t.detailData.app_secret:"********************************")+" ")]),e("el-button",{attrs:{size:"mini",type:"text",icon:t.showSecret?"el-icon-view":"el-icon-hide"},on:{click:function(a){t.showSecret=!t.showSecret}}},[t._v(" "+t._s(t.showSecret?"隐藏":"显示")+" ")]),e("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-document-copy"},on:{click:function(a){return t.copyText(t.detailData.app_secret,"AppSecret")}}},[t._v("复制")])],1)])],1):t._e()],1),e("div",{staticClass:"detail-section"},[e("div",{staticClass:"section-title"},[t._v(" 点卡余额 "),e("el-button",{staticStyle:{float:"right"},attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:function(a){return t.openRechargeDialog(t.detailData)}}},[t._v("充值")])],1),t.detailData?e("el-row",{staticStyle:{"margin-top":"15px"},attrs:{gutter:15}},[e("el-col",{attrs:{span:8}},[e("div",{staticClass:"stat-box"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.formatNum(t.detailData.point_card_self)))]),e("div",{staticClass:"stat-label"},[t._v("自购余额")])])]),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"stat-box"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.formatNum(t.detailData.point_card_gift)))]),e("div",{staticClass:"stat-label"},[t._v("赠送余额")])])]),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"stat-box primary"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.formatNum(Number(t.detailData.point_card_self||0)+Number(t.detailData.point_card_gift||0))))]),e("div",{staticClass:"stat-label"},[t._v("总余额")])])])],1):t._e()],1),t.detailData?e("div",{staticClass:"detail-section"},[e("div",{staticClass:"section-title"},[t._v("奖励分配")]),e("el-row",{staticStyle:{"margin-top":"15px"},attrs:{gutter:15}},[e("el-col",{attrs:{span:8}},[e("div",{staticClass:"stat-box"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.formatNum(t.detailData.tech_reward_total)))]),e("div",{staticClass:"stat-label"},[t._v("技术团队累计 (10%)")])])]),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"stat-box"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.formatNum(t.detailData.undist_reward_total)))]),e("div",{staticClass:"stat-label"},[t._v("网体未分配累计")])])]),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"stat-box primary"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.formatNum(Number(t.detailData.tech_reward_total||0)+Number(t.detailData.undist_reward_total||0))))]),e("div",{staticClass:"stat-label"},[t._v("根账户累计收入")])])])],1)],1):t._e(),t.detailData?e("div",{staticClass:"detail-section"},[e("div",{staticClass:"section-title"},[t._v("根用户信息")]),t.detailData.root_user_id?[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:8}},[e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("Root用户ID")]),e("span",{staticClass:"info-value"},[t._v(t._s(t.detailData.root_user_id))])])]),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("用户数")]),e("span",{staticClass:"info-value"},[t._v(t._s(t.detailData.total_users||0))])])]),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("配额套餐")]),e("span",{staticClass:"info-value"},[t._v(t._s(t.detailData.quota_plan_name||"-"))])])])],1)]:e("el-empty",{attrs:{description:"暂无根用户","image-size":50}})],2):t._e(),t.detailData?e("div",{staticClass:"detail-section"},[e("div",{staticClass:"section-title"},[t._v("配额套餐分配")]),e("el-row",{staticStyle:{"margin-top":"10px"},attrs:{gutter:15}},[e("el-col",{attrs:{span:16}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择配额套餐",clearable:"",size:"small"},model:{value:t.assignPlanId,callback:function(a){t.assignPlanId=a},expression:"assignPlanId"}},t._l(t.quotaPlans,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),e("el-col",{attrs:{span:8}},[e("el-button",{attrs:{type:"primary",size:"small",loading:t.assigning,disabled:!t.assignPlanId},on:{click:t.handleAssignPlan}},[t._v(" 分配套餐 ")])],1)],1)],1):t._e(),e("div",{staticClass:"detail-section"},[e("div",{staticClass:"section-title"},[t._v("点卡流水")]),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.logsLoading,expression:"logsLoading"}],attrs:{data:t.pointcardLogs,size:"mini",border:"","max-height":"260"}},[e("el-table-column",{attrs:{prop:"id",label:"ID",width:"60"}}),e("el-table-column",{attrs:{prop:"change_type",label:"类型",width:"90"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("el-tag",{attrs:{type:t.logTagType(s.change_type),size:"mini"}},[t._v(" "+t._s(s.change_type_name||s.change_type||"-")+" ")])]}}])}),e("el-table-column",{attrs:{prop:"amount",label:"金额",width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("span",{style:{color:parseFloat(s.amount)>=0?"#67c23a":"#f56c6c",fontWeight:600}},[t._v(" "+t._s(parseFloat(s.amount)>=0?"+":"")+t._s(s.amount)+" ")])]}}])}),e("el-table-column",{attrs:{prop:"card_type",label:"卡类型",width:"80"},scopedSlots:t._u([{key:"default",fn:function(a){var e=a.row;return[t._v(" "+t._s("self"===e.card_type?"自购":"gift"===e.card_type?"赠送":e.card_type||"-")+" ")]}}])}),e("el-table-column",{attrs:{prop:"after_balance",label:"变动后余额",width:"100"}}),e("el-table-column",{attrs:{prop:"remark",label:"备注","min-width":"120","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"created_at",label:"时间",width:"160"}})],1),t.logsTotal>t.logsPageSize?e("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{background:"",small:"",layout:"total, prev, pager, next",total:t.logsTotal,"page-size":t.logsPageSize,"current-page":t.logsPage},on:{"update:currentPage":function(a){t.logsPage=a},"update:current-page":function(a){t.logsPage=a},"current-change":t.loadPointcardLogs}}):t._e()],1)])])],1)},i=[],n=(e("13d5"),e("0643"),e("2382"),e("fffc"),e("9d4a"),e("50fc")),r=e("cd05"),l={name:"TenantManage",data(){return{loading:!1,list:[],total:0,page:1,pageSize:20,keyword:"",stats:{totalTenants:0,activeTenants:0,totalPointBalance:0},statsLoading:!1,editDialogVisible:!1,editId:null,editForm:{name:""},editRules:{name:[{required:!0,message:"请输入租户名称",trigger:"blur"}]},saving:!1,rechargeDialogVisible:!1,rechargeTenantId:null,rechargeTenantName:"",rechargeForm:{amount:100,card_type:"self"},rechargeRules:{amount:[{required:!0,message:"请输入充值金额",trigger:"blur"}],card_type:[{required:!0,message:"请选择充值类型",trigger:"change"}]},recharging:!1,detailVisible:!1,detailLoading:!1,detailData:null,showSecret:!1,quotaPlans:[],assignPlanId:null,assigning:!1,pointcardLogs:[],logsLoading:!1,logsPage:1,logsPageSize:10,logsTotal:0}},mounted(){this.fetchData(),this.loadQuotaPlans()},methods:{async fetchData(){this.loading=!0;try{const t={page:this.page,page_size:this.pageSize};this.keyword&&(t.keyword=this.keyword);const a=await Object(n["p"])(t),e=a.data.data;this.list=Array.isArray(e)?e:[],this.total=a.data.total||0,this.computeStats()}catch(t){this.$message.error("获取租户列表失败")}finally{this.loading=!1}},computeStats(){const t=this.list;this.stats.totalTenants=this.total,this.stats.activeTenants=t.filter(t=>1===t.status).length,this.stats.totalPointBalance=t.reduce((t,a)=>t+Number(a.point_card_self||0)+Number(a.point_card_gift||0),0).toFixed(2)},openEditDialog(t){t?(this.editId=t.id,this.editForm={name:t.name}):(this.editId=null,this.editForm={name:""}),this.editDialogVisible=!0,this.$nextTick(()=>{this.$refs.editForm&&this.$refs.editForm.clearValidate()})},async handleSave(){try{await this.$refs.editForm.validate()}catch(t){return}this.saving=!0;try{const t={name:this.editForm.name,status:1};this.editId?await Object(n["D"])(this.editId,t):await Object(n["f"])(t),this.$message.success("保存成功"),this.editDialogVisible=!1,this.fetchData()}catch(t){const a=t.response&&t.response.data&&t.response.data.detail?t.response.data.detail:"保存失败";this.$message.error(a)}finally{this.saving=!1}},async handleToggle(t){const a=1===t.status?"禁用":"启用";try{await this.$confirm(`确定要${a}租户「${t.name}」吗？`,"提示",{type:"warning"})}catch(e){return}try{await Object(n["z"])(t.id),this.$message.success(a+"成功"),this.fetchData()}catch(e){this.$message.error(a+"失败")}},openRechargeDialog(t){t&&(this.rechargeTenantId=t.id,this.rechargeTenantName=t.name,this.rechargeForm={amount:100,card_type:"self"},this.rechargeDialogVisible=!0,this.$nextTick(()=>{this.$refs.rechargeForm&&this.$refs.rechargeForm.clearValidate()}))},async handleRecharge(){try{await this.$refs.rechargeForm.validate()}catch(t){return}this.recharging=!0;try{await Object(n["t"])(this.rechargeTenantId,{amount:this.rechargeForm.amount,card_type:this.rechargeForm.card_type}),this.$message.success("充值成功"),this.rechargeDialogVisible=!1,this.fetchData(),this.detailVisible&&this.detailData&&this.detailData.id===this.rechargeTenantId&&this.refreshDetail()}catch(t){const a=t.response&&t.response.data&&t.response.data.detail?t.response.data.detail:"充值失败";this.$message.error(a)}finally{this.recharging=!1}},openDetail(t){this.detailData={...t},this.detailVisible=!0,this.showSecret=!1,this.assignPlanId=t.quota_plan_id||null,this.logsPage=1,this.loadPointcardLogs()},async refreshDetail(){try{const t={page:this.page,page_size:this.pageSize};this.keyword&&(t.keyword=this.keyword);const a=await Object(n["p"])(t),e=a.data.data;if(this.list=Array.isArray(e)?e:[],this.total=a.data.total||0,this.computeStats(),this.detailData){const t=this.list.find(t=>t.id===this.detailData.id);t&&(this.detailData={...t})}}catch(t){}this.loadPointcardLogs()},async loadPointcardLogs(){if(this.detailData){this.logsLoading=!0;try{const t=await Object(r["d"])({tenant_id:this.detailData.id,page:this.logsPage,page_size:this.logsPageSize});this.pointcardLogs=t.data.data||[],this.logsTotal=t.data.total||0}catch(t){this.pointcardLogs=[],this.logsTotal=0}finally{this.logsLoading=!1}}},async loadQuotaPlans(){try{const t=await Object(r["e"])();this.quotaPlans=t.data.data||[]}catch(t){this.quotaPlans=[]}},async handleAssignPlan(){if(this.assignPlanId&&this.detailData){this.assigning=!0;try{await Object(n["b"])(this.detailData.id,this.assignPlanId),this.$message.success("套餐分配成功"),this.refreshDetail()}catch(t){const a=t.response&&t.response.data&&t.response.data.detail?t.response.data.detail:"分配失败";this.$message.error(a)}finally{this.assigning=!1}}},maskKey(t){return t?t.length<=8?t:t.substring(0,4)+"****"+t.substring(t.length-4):"-"},formatNum(t){const a=Number(t);return isNaN(a)?"0.00":a.toFixed(2)},logTagType(t){const a={recharge:"primary",gift:"success",deduct:"danger",refund:"warning"};return a[t]||"info"},copyText(t,a){t&&(navigator.clipboard?navigator.clipboard.writeText(t).then(()=>{this.$message.success("已复制"+a)}).catch(()=>{this.fallbackCopy(t,a)}):this.fallbackCopy(t,a))},fallbackCopy(t,a){const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.select();try{document.execCommand("copy"),this.$message.success("已复制"+a)}catch(s){this.$message.error("复制失败，请手动复制")}document.body.removeChild(e)}}},o=l,c=(e("50bf"),e("7926"),e("2877")),d=Object(c["a"])(o,s,i,!1,null,"687258b5",null);a["default"]=d.exports}}]);