(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-531631be"],{"157c":function(t,e,a){"use strict";a("c35f")},"50fc":function(t,e,a){"use strict";a.d(e,"p",(function(){return n})),a.d(e,"f",(function(){return i})),a.d(e,"E",(function(){return o})),a.d(e,"z",(function(){return l})),a.d(e,"t",(function(){return d})),a.d(e,"b",(function(){return c})),a.d(e,"o",(function(){return u})),a.d(e,"g",(function(){return m})),a.d(e,"F",(function(){return p})),a.d(e,"d",(function(){return f})),a.d(e,"h",(function(){return g})),a.d(e,"s",(function(){return h})),a.d(e,"q",(function(){return _})),a.d(e,"u",(function(){return y})),a.d(e,"r",(function(){return b})),a.d(e,"w",(function(){return F})),a.d(e,"A",(function(){return v})),a.d(e,"i",(function(){return w})),a.d(e,"e",(function(){return $})),a.d(e,"B",(function(){return S})),a.d(e,"x",(function(){return k})),a.d(e,"v",(function(){return x})),a.d(e,"m",(function(){return z})),a.d(e,"n",(function(){return I})),a.d(e,"D",(function(){return C})),a.d(e,"y",(function(){return L})),a.d(e,"j",(function(){return N})),a.d(e,"C",(function(){return A})),a.d(e,"k",(function(){return O})),a.d(e,"a",(function(){return V})),a.d(e,"c",(function(){return j})),a.d(e,"l",(function(){return D}));var s=a("bc3a"),r=a.n(s);function n(t={}){return r.a.get("/tenants",{params:t})}function i(t){return r.a.post("/tenants",t)}function o(t,e){return r.a.put("/tenants/"+t,e)}function l(t){return r.a.patch(`/tenants/${t}/toggle`)}function d(t,e){return r.a.post(`/tenants/${t}/recharge`,e)}function c(t,e){return r.a.post(`/tenants/${t}/assign-plan`,{plan_id:e})}function u(t,e={}){return r.a.get(`/tenants/${t}/tenant-strategies`,{params:e})}function m(t,e){return r.a.post(`/tenants/${t}/tenant-strategies`,e)}function p(t,e,a){return r.a.put(`/tenants/${t}/tenant-strategies/${e}`,a)}function f(t,e){return r.a.post(`/tenants/${t}/tenant-strategies/${e}/copy-from-master`)}function g(t,e){return r.a.delete(`/tenants/${t}/tenant-strategies/${e}`)}function h(t={}){return r.a.get("/users",{params:t})}function _(t){return r.a.get("/users/"+t)}function y(t,e){return r.a.post(`/users/${t}/recharge`,e)}function b(t,e={}){return r.a.get(`/users/${t}/team`,{params:e})}function F(t,e){return r.a.post(`/users/${t}/set-market-node`,e)}function v(t,e){return r.a.post(`/users/${t}/toggle-status`,{status:e})}function w(t={}){return r.a.get("/admins",{params:t})}function $(t){return r.a.post("/admins",t)}function S(t,e){return r.a.put("/admins/"+t,e)}function k(t){return r.a.patch(`/admins/${t}/toggle`)}function x(t,e){return r.a.post(`/admins/${t}/reset-password`,e)}function z(t={}){return r.a.get("/strategies",{params:t})}function I(t){return r.a.get("/strategies/"+t)}function C(t,e){return r.a.post("/strategies/"+t,e)}function L(t){return r.a.patch(`/strategies/${t}/toggle`)}function N(t={}){return r.a.get("/strategy-bindings-admin",{params:t})}function A(t,e){return r.a.put("/strategy-bindings-admin/"+t,e)}function O(t={}){return r.a.get("/exchange-accounts",{params:t})}function V(t,e){return r.a.put(`/exchange-accounts/${t}/assign-node`,e)}function j(t){return r.a.post("/exchange-accounts/batch-assign-node",t)}function D(t={}){return r.a.get("/signal-events",{params:t})}},aee0:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ele-body"},[a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"toolbar"},[a("span",{staticClass:"toolbar-label"},[t._v("选择租户：")]),a("el-select",{staticStyle:{width:"280px"},attrs:{placeholder:"请选择租户",clearable:"",filterable:"",size:"small"},on:{change:t.onTenantChange},model:{value:t.tenantId,callback:function(e){t.tenantId=e},expression:"tenantId"}},t._l(t.tenantList,(function(t){return a("el-option",{key:t.id,attrs:{label:(t.name||"租户#"+t.id)+" (ID: "+t.id+")",value:t.id}})})),1),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh",loading:t.tenantLoading},on:{click:t.fetchTenants}},[t._v("刷新租户")]),t.tenantId?[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus",loading:t.loading},on:{click:t.openAdd}},[t._v("新增实例")]),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh",loading:t.loading},on:{click:t.fetchList}},[t._v("刷新列表")])]:t._e(),a("div",{staticStyle:{flex:"1"}})],2),t.tenantId?[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"12px"},attrs:{data:t.list,stripe:"",border:"",size:"small"}},[a("el-table-column",{attrs:{prop:"id",label:"实例ID",width:"80",align:"center"}}),a("el-table-column",{attrs:{prop:"strategy_code",label:"主策略编码",width:"100","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"strategy_name",label:"主策略名称",width:"120","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"display_name",label:"展示名称",width:"120","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"display_description",label:"展示描述","min-width":"140","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"leverage",label:"杠杆",width:"75",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[null!=s.leverage?a("el-tag",{attrs:{size:"mini",type:"warning"}},[t._v(t._s(s.leverage)+"x")]):a("span",{staticClass:"text-placeholder"},[t._v("继承")])]}}],null,!1,1370675450)}),a("el-table-column",{attrs:{prop:"amount_usdt",label:"单笔(U)",width:"90",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(null!=a.amount_usdt?a.amount_usdt:"继承"))]}}],null,!1,2145268289)}),a("el-table-column",{attrs:{prop:"min_capital",label:"最低资金",width:"90",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(null!=a.min_capital?a.min_capital:"继承"))]}}],null,!1,1634876801)}),a("el-table-column",{attrs:{prop:"status",label:"状态",width:"75",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-tag",{attrs:{type:1===s.status?"success":"info",size:"mini"}},[t._v(t._s(1===s.status?"启用":"禁用"))])]}}],null,!1,462494141)}),a("el-table-column",{attrs:{prop:"sort_order",label:"排序",width:"70",align:"center"}}),a("el-table-column",{attrs:{label:"操作",width:"240",align:"center",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(e){return t.openEdit(s)}}},[t._v("编辑")]),a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-document-copy"},on:{click:function(e){return t.copyFromMaster(s)}}},[t._v("复制主策略")]),a("el-button",{staticClass:"ele-text-danger",attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(e){return t.remove(s)}}},[t._v("删除")])]}}],null,!1,1317942053)})],1),t.loading||0!==t.list.length?t._e():a("el-empty",{attrs:{description:"该租户下暂无策略实例"}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.openAdd}},[t._v("新增实例")])],1)]:a("el-empty",{attrs:{description:"请先选择租户"}})],2),a("el-dialog",{attrs:{title:"新增策略实例",visible:t.addVisible,width:"560px","close-on-click-modal":!1},on:{"update:visible":function(e){t.addVisible=e},close:function(e){t.addForm={}}}},[a("el-form",{ref:"addFormRef",staticClass:"tenant-strategy-form",attrs:{model:t.addForm,rules:t.addRules,"label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"主策略",prop:"strategy_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择主策略",filterable:""},on:{change:t.onAddFormStrategyChange},model:{value:t.addForm.strategy_id,callback:function(e){t.$set(t.addForm,"strategy_id",e)},expression:"addForm.strategy_id"}},t._l(t.masterStrategies,(function(t){return a("el-option",{key:t.id,attrs:{label:t.code+" - "+t.name,value:t.id}})})),1)],1),a("el-form-item",{staticClass:"copy-option-item",attrs:{label:" "}},[a("el-checkbox",{on:{change:t.onCopyFromMasterChange},model:{value:t.addForm.copy_from_master,callback:function(e){t.$set(t.addForm,"copy_from_master",e)},expression:"addForm.copy_from_master"}},[t._v("一键复制主策略参数")]),a("div",{staticClass:"form-item-hint"},[t._v("勾选后将自动带入：杠杆、单笔金额、最低资金、展示名与描述")])],1),a("el-form-item",{attrs:{label:"展示名称"}},[a("el-input",{attrs:{placeholder:"留空则用主策略名称"},model:{value:t.addForm.display_name,callback:function(e){t.$set(t.addForm,"display_name",e)},expression:"addForm.display_name"}})],1),a("el-form-item",{attrs:{label:"展示描述"}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"留空则用主策略描述"},model:{value:t.addForm.display_description,callback:function(e){t.$set(t.addForm,"display_description",e)},expression:"addForm.display_description"}})],1),a("el-form-item",{attrs:{label:"杠杆"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,max:125,placeholder:"留空继承主策略"},model:{value:t.addForm.leverage,callback:function(e){t.$set(t.addForm,"leverage",e)},expression:"addForm.leverage"}})],1),a("el-form-item",{attrs:{label:"单笔金额(USDT)"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,precision:2,placeholder:"留空继承"},model:{value:t.addForm.amount_usdt,callback:function(e){t.$set(t.addForm,"amount_usdt",e)},expression:"addForm.amount_usdt"}})],1),a("el-form-item",{attrs:{label:"最低资金(USDT)"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,precision:2,placeholder:"留空继承"},model:{value:t.addForm.min_capital,callback:function(e){t.$set(t.addForm,"min_capital",e)},expression:"addForm.min_capital"}})],1),a("el-form-item",{attrs:{label:"状态"}},[a("el-radio-group",{model:{value:t.addForm.status,callback:function(e){t.$set(t.addForm,"status",e)},expression:"addForm.status"}},[a("el-radio",{attrs:{label:1}},[t._v("启用")]),a("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1),a("el-form-item",{attrs:{label:"排序"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:t.addForm.sort_order,callback:function(e){t.$set(t.addForm,"sort_order",e)},expression:"addForm.sort_order"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.addVisible=!1}}},[t._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary",loading:t.addSaving},on:{click:t.submitAdd}},[t._v("确定")])],1)],1),a("el-dialog",{attrs:{title:"编辑策略实例",visible:t.editVisible,width:"520px","close-on-click-modal":!1},on:{"update:visible":function(e){t.editVisible=e},close:function(e){t.editForm={}}}},[a("el-form",{ref:"editFormRef",attrs:{model:t.editForm,"label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"主策略"}},[a("span",[t._v(t._s(t.editForm.strategy_code)+" - "+t._s(t.editForm.strategy_name))])]),a("el-form-item",{attrs:{label:"展示名称"}},[a("el-input",{attrs:{placeholder:"留空则用主策略名称"},model:{value:t.editForm.display_name,callback:function(e){t.$set(t.editForm,"display_name",e)},expression:"editForm.display_name"}})],1),a("el-form-item",{attrs:{label:"展示描述"}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"留空则用主策略描述"},model:{value:t.editForm.display_description,callback:function(e){t.$set(t.editForm,"display_description",e)},expression:"editForm.display_description"}})],1),a("el-form-item",{attrs:{label:"杠杆"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,max:125},model:{value:t.editForm.leverage,callback:function(e){t.$set(t.editForm,"leverage",e)},expression:"editForm.leverage"}})],1),a("el-form-item",{attrs:{label:"单笔金额(USDT)"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,precision:2},model:{value:t.editForm.amount_usdt,callback:function(e){t.$set(t.editForm,"amount_usdt",e)},expression:"editForm.amount_usdt"}})],1),a("el-form-item",{attrs:{label:"最低资金(USDT)"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,precision:2},model:{value:t.editForm.min_capital,callback:function(e){t.$set(t.editForm,"min_capital",e)},expression:"editForm.min_capital"}})],1),a("el-form-item",{attrs:{label:"状态"}},[a("el-radio-group",{model:{value:t.editForm.status,callback:function(e){t.$set(t.editForm,"status",e)},expression:"editForm.status"}},[a("el-radio",{attrs:{label:1}},[t._v("启用")]),a("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1),a("el-form-item",{attrs:{label:"排序"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:t.editForm.sort_order,callback:function(e){t.$set(t.editForm,"sort_order",e)},expression:"editForm.sort_order"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.editVisible=!1}}},[t._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary",loading:t.editSaving},on:{click:t.submitEdit}},[t._v("保存")])],1)],1)],1)},r=[],n=(a("e9c4"),a("50fc")),i={name:"TenantStrategies",data(){return{tenantId:null,tenantList:[],tenantLoading:!1,list:[],loading:!1,masterStrategies:[],addVisible:!1,addForm:{strategy_id:null,copy_from_master:!0,display_name:"",display_description:"",leverage:null,amount_usdt:null,min_capital:null,status:1,sort_order:0},addRules:{strategy_id:[{required:!0,message:"请选择主策略",trigger:"change"}]},addSaving:!1,editVisible:!1,editForm:{},editSaving:!1}},mounted(){this.fetchTenants()},methods:{async fetchTenants(){this.tenantLoading=!0;try{const t=await Object(n["p"])({page_size:500}),e=t.data||{};this.tenantList=e.data||[],Array.isArray(this.tenantList)||(this.tenantList=[])}catch(t){this.$message.error(t.response&&t.response.data&&(t.response.data.detail||t.response.data.message)||t.message||"获取租户列表失败")}finally{this.tenantLoading=!1}},onTenantChange(){this.list=[],this.tenantId&&this.fetchList()},async fetchList(){if(this.tenantId){this.loading=!0;try{const t=await Object(n["o"])(this.tenantId,{}),e=t.data||{};this.list=e.data||[],Array.isArray(this.list)||(this.list=[])}catch(t){this.$message.error(t.response&&t.response.data&&(t.response.data.detail||t.response.data.message)||t.message||"获取列表失败")}finally{this.loading=!1}}},async loadMasterStrategies(){try{const t=await Object(n["m"])({}),e=t.data||{};this.masterStrategies=e.data||[],Array.isArray(this.masterStrategies)||(this.masterStrategies=[])}catch{this.masterStrategies=[]}},openAdd(){this.loadMasterStrategies(),this.addForm={strategy_id:null,copy_from_master:!0,display_name:"",display_description:"",leverage:null,amount_usdt:null,min_capital:null,status:1,sort_order:0},this.addVisible=!0},async fillFormFromMasterStrategy(){if(this.addForm.strategy_id&&this.addForm.copy_from_master)try{const t=await Object(n["n"])(this.addForm.strategy_id),e=t.data||{},a=e.data||e;if(!a)return;this.addForm.display_name=(a.user_display_name||a.name||"").toString().trim()||"",this.addForm.display_description=(a.user_description||a.description||"").toString().trim()||"",this.addForm.leverage=null!=a.leverage?Number(a.leverage):null,this.addForm.amount_usdt=null!=a.amount_usdt?Number(a.amount_usdt):null,this.addForm.min_capital=null!=a.min_capital?Number(a.min_capital):null}catch(t){this.$message.warning("获取主策略参数失败，可手动填写或提交时由后端复制")}},onAddFormStrategyChange(){this.addForm.copy_from_master&&this.addForm.strategy_id&&this.fillFormFromMasterStrategy()},onCopyFromMasterChange(t){t&&this.addForm.strategy_id&&this.fillFormFromMasterStrategy()},async submitAdd(){await this.$refs.addFormRef.validate().catch(()=>{throw new Error("请填写必填项")});const t={strategy_id:this.addForm.strategy_id,copy_from_master:!!this.addForm.copy_from_master,status:this.addForm.status,sort_order:this.addForm.sort_order};void 0!==this.addForm.display_name&&""!==this.addForm.display_name&&(t.display_name=this.addForm.display_name),void 0!==this.addForm.display_description&&""!==this.addForm.display_description&&(t.display_description=this.addForm.display_description),null!=this.addForm.leverage&&""!==this.addForm.leverage&&(t.leverage=Number(this.addForm.leverage)),null!=this.addForm.amount_usdt&&""!==this.addForm.amount_usdt&&(t.amount_usdt=Number(this.addForm.amount_usdt)),null!=this.addForm.min_capital&&""!==this.addForm.min_capital&&(t.min_capital=Number(this.addForm.min_capital)),this.addSaving=!0;try{await Object(n["g"])(this.tenantId,t),this.$message.success("新增成功"),this.addVisible=!1,this.fetchList()}catch(e){const t=e.response&&e.response.data&&(e.response.data.detail||e.response.data.message)||e.message||"新增失败";this.$message.error("string"===typeof t?t:JSON.stringify(t))}finally{this.addSaving=!1}},openEdit(t){this.editForm={id:t.id,strategy_code:t.strategy_code,strategy_name:t.strategy_name,display_name:t.display_name||"",display_description:t.display_description||"",leverage:null!=t.leverage?Number(t.leverage):null,amount_usdt:null!=t.amount_usdt?Number(t.amount_usdt):null,min_capital:null!=t.min_capital?Number(t.min_capital):null,status:null!=t.status?Number(t.status):1,sort_order:null!=t.sort_order?Number(t.sort_order):0},this.editVisible=!0},async submitEdit(){if(!this.editForm.id)return void this.$message.error("策略实例ID无效，请重新打开编辑");const t={display_name:this.editForm.display_name||null,display_description:this.editForm.display_description||null,leverage:this.editForm.leverage,amount_usdt:this.editForm.amount_usdt,min_capital:this.editForm.min_capital,status:this.editForm.status,sort_order:this.editForm.sort_order};this.editSaving=!0;try{await Object(n["F"])(this.tenantId,this.editForm.id,t),this.$message.success("保存成功"),this.editVisible=!1,this.fetchList()}catch(e){const t=e.response&&e.response.data&&(e.response.data.detail||e.response.data.message)||e.message||"保存失败";this.$message.error("string"===typeof t?t:JSON.stringify(t))}finally{this.editSaving=!1}},async copyFromMaster(t){if(t.id){try{await this.$confirm("确定用主策略参数覆盖当前实例的杠杆、单笔金额、最低资金及展示名/描述？","一键复制主策略",{type:"warning"})}catch{return}try{await Object(n["d"])(this.tenantId,t.id),this.$message.success("已从主策略复制参数"),this.fetchList()}catch(e){const t=e.response&&e.response.data&&(e.response.data.detail||e.response.data.message)||e.message||"复制失败";this.$message.error("string"===typeof t?t:JSON.stringify(t))}}else this.$message.error("策略实例ID无效")},async remove(t){if(t.id){try{await this.$confirm(`确定删除该租户下的策略实例「${t.display_name||t.strategy_name}」？`,"删除",{type:"warning"})}catch{return}try{await Object(n["h"])(this.tenantId,t.id),this.$message.success("已删除"),this.fetchList()}catch(e){const t=e.response&&e.response.data&&(e.response.data.detail||e.response.data.message)||e.message||"删除失败";this.$message.error("string"===typeof t?t:JSON.stringify(t))}}else this.$message.error("策略实例ID无效")}}},o=i,l=(a("157c"),a("2877")),d=Object(l["a"])(o,s,r,!1,null,"1b99005e",null);e["default"]=d.exports},c35f:function(t,e,a){}}]);