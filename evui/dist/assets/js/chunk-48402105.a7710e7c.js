(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-48402105"],{"311b":function(t,e,a){"use strict";a("94f9")},"50fc":function(t,e,a){"use strict";a.d(e,"p",(function(){return i})),a.d(e,"f",(function(){return l})),a.d(e,"E",(function(){return r})),a.d(e,"z",(function(){return o})),a.d(e,"t",(function(){return c})),a.d(e,"b",(function(){return u})),a.d(e,"o",(function(){return d})),a.d(e,"g",(function(){return f})),a.d(e,"F",(function(){return p})),a.d(e,"d",(function(){return m})),a.d(e,"h",(function(){return _})),a.d(e,"s",(function(){return g})),a.d(e,"q",(function(){return h})),a.d(e,"u",(function(){return b})),a.d(e,"r",(function(){return v})),a.d(e,"w",(function(){return w})),a.d(e,"A",(function(){return y})),a.d(e,"i",(function(){return x})),a.d(e,"e",(function(){return S})),a.d(e,"B",(function(){return C})),a.d(e,"x",(function(){return k})),a.d(e,"v",(function(){return N})),a.d(e,"m",(function(){return D})),a.d(e,"n",(function(){return L})),a.d(e,"D",(function(){return T})),a.d(e,"y",(function(){return z})),a.d(e,"j",(function(){return O})),a.d(e,"C",(function(){return R})),a.d(e,"k",(function(){return P})),a.d(e,"a",(function(){return U})),a.d(e,"c",(function(){return $})),a.d(e,"l",(function(){return F}));var n=a("bc3a"),s=a.n(n);function i(t={}){return s.a.get("/tenants",{params:t})}function l(t){return s.a.post("/tenants",t)}function r(t,e){return s.a.put("/tenants/"+t,e)}function o(t){return s.a.patch(`/tenants/${t}/toggle`)}function c(t,e){return s.a.post(`/tenants/${t}/recharge`,e)}function u(t,e){return s.a.post(`/tenants/${t}/assign-plan`,{plan_id:e})}function d(t,e={}){return s.a.get(`/tenants/${t}/tenant-strategies`,{params:e})}function f(t,e){return s.a.post(`/tenants/${t}/tenant-strategies`,e)}function p(t,e,a){return s.a.put(`/tenants/${t}/tenant-strategies/${e}`,a)}function m(t,e){return s.a.post(`/tenants/${t}/tenant-strategies/${e}/copy-from-master`)}function _(t,e){return s.a.delete(`/tenants/${t}/tenant-strategies/${e}`)}function g(t={}){return s.a.get("/users",{params:t})}function h(t){return s.a.get("/users/"+t)}function b(t,e){return s.a.post(`/users/${t}/recharge`,e)}function v(t,e={}){return s.a.get(`/users/${t}/team`,{params:e})}function w(t,e){return s.a.post(`/users/${t}/set-market-node`,e)}function y(t,e){return s.a.post(`/users/${t}/toggle-status`,{status:e})}function x(t={}){return s.a.get("/admins",{params:t})}function S(t){return s.a.post("/admins",t)}function C(t,e){return s.a.put("/admins/"+t,e)}function k(t){return s.a.patch(`/admins/${t}/toggle`)}function N(t,e){return s.a.post(`/admins/${t}/reset-password`,e)}function D(t={}){return s.a.get("/strategies",{params:t})}function L(t){return s.a.get("/strategies/"+t)}function T(t,e){return s.a.post("/strategies/"+t,e)}function z(t){return s.a.patch(`/strategies/${t}/toggle`)}function O(t={}){return s.a.get("/strategy-bindings-admin",{params:t})}function R(t,e){return s.a.put("/strategy-bindings-admin/"+t,e)}function P(t={}){return s.a.get("/exchange-accounts",{params:t})}function U(t,e){return s.a.put(`/exchange-accounts/${t}/assign-node`,e)}function $(t){return s.a.post("/exchange-accounts/batch-assign-node",t)}function F(t={}){return s.a.get("/signal-events",{params:t})}},8012:function(t,e,a){"use strict";a.d(e,"c",(function(){return r})),a.d(e,"b",(function(){return o})),a.d(e,"d",(function(){return c})),a.d(e,"a",(function(){return u})),a.d(e,"e",(function(){return d}));var n=a("bc3a"),s=a.n(n);let i={tenant_id:1};function l(t){return{...i,...t}}function r(t={}){return s.a.get("/orders",{params:l({limit:50,...t})})}function o(t={}){return s.a.get("/fills",{params:l({limit:50,...t})})}function c(t={}){return s.a.get("/positions",{params:l({limit:100,...t})})}function u(t={}){return s.a.get("/accounts",{params:l({limit:50,...t})})}function d(t={}){return s.a.get("/transactions",{params:l({limit:50,...t})})}},"94f9":function(t,e,a){},9704:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ele-body"},[a("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[a("el-col",{attrs:{lg:4,md:8,sm:12}},[a("stat-card",{attrs:{title:"总持仓数",value:t.stats.totalCount,icon:"el-icon-s-data",color:"primary",loading:t.loading},scopedSlots:t._u([{key:"footer",fn:function(){return[a("span",{staticClass:"ele-text-secondary"},[t._v("活跃仓位")])]},proxy:!0}])})],1),a("el-col",{attrs:{lg:4,md:8,sm:12}},[a("stat-card",{attrs:{title:"总名义价值",icon:"el-icon-coin",color:"warning",loading:t.loading},scopedSlots:t._u([{key:"value",fn:function(){return[a("span",[t._v(t._s(t.formatMoney(t.stats.totalNotional)))])]},proxy:!0},{key:"footer",fn:function(){return[a("span",{staticClass:"ele-text-secondary"},[t._v("USDT")])]},proxy:!0}])})],1),a("el-col",{attrs:{lg:4,md:8,sm:12}},[a("stat-card",{attrs:{title:"未实现盈亏",icon:"el-icon-data-analysis",color:t.stats.totalPnl>=0?"success":"danger",loading:t.loading},scopedSlots:t._u([{key:"value",fn:function(){return[a("span",{class:t.stats.totalPnl>=0?"text-success":"text-danger"},[t._v(" "+t._s(t.stats.totalPnl>=0?"+":"")+t._s(t.formatMoney(t.stats.totalPnl))+" ")])]},proxy:!0}])})],1),a("el-col",{attrs:{lg:4,md:8,sm:12}},[a("stat-card",{attrs:{title:"多头仓位",value:t.stats.longCount,icon:"el-icon-top",color:"success",loading:t.loading},scopedSlots:t._u([{key:"footer",fn:function(){return[a("span",{staticClass:"ele-text-secondary"},[t._v("做多")])]},proxy:!0}])})],1),a("el-col",{attrs:{lg:4,md:8,sm:12}},[a("stat-card",{attrs:{title:"空头仓位",value:t.stats.shortCount,icon:"el-icon-bottom",color:"danger",loading:t.loading},scopedSlots:t._u([{key:"footer",fn:function(){return[a("span",{staticClass:"ele-text-secondary"},[t._v("做空")])]},proxy:!0}])})],1),a("el-col",{attrs:{lg:4,md:8,sm:12}},[a("stat-card",{attrs:{title:"盈亏比",icon:"el-icon-pie-chart",color:"info",loading:t.loading},scopedSlots:t._u([{key:"value",fn:function(){return[a("span",[a("span",{staticClass:"text-success"},[t._v(t._s(t.stats.profitCount))]),a("span",{staticStyle:{color:"#C0C4CC",margin:"0 4px"}},[t._v("/")]),a("span",{staticClass:"text-danger"},[t._v(t._s(t.stats.lossCount))])])]},proxy:!0},{key:"footer",fn:function(){return[a("span",{staticClass:"ele-text-secondary"},[t._v("盈利 / 亏损")])]},proxy:!0}])})],1)],1),a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"toolbar"},[a("span",{staticClass:"toolbar-title"},[t._v("持仓管理")]),a("el-radio-group",{attrs:{size:"small"},on:{change:t.onViewModeChange},model:{value:t.viewMode,callback:function(e){t.viewMode=e},expression:"viewMode"}},[a("el-radio-button",{attrs:{label:"open"}},[t._v("当前持仓")]),a("el-radio-button",{attrs:{label:"closed"}},[t._v("已平仓")]),a("el-radio-button",{attrs:{label:"all"}},[t._v("全部")])],1)],1),a("div",{staticClass:"search-bar"},[a("el-form",{staticClass:"search-form",attrs:{inline:!0,model:t.where,size:"small"}},[a("el-form-item",{attrs:{label:"标的"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"如 BTC/USDT",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.fetchData.apply(null,arguments)}},model:{value:t.where.symbol,callback:function(e){t.$set(t.where,"symbol",e)},expression:"where.symbol"}})],1),a("el-form-item",{attrs:{label:"方向"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"全部",clearable:""},model:{value:t.where.position_side,callback:function(e){t.$set(t.where,"position_side",e)},expression:"where.position_side"}},[a("el-option",{attrs:{label:"多头",value:"long"}}),a("el-option",{attrs:{label:"空头",value:"short"}})],1)],1),a("el-form-item",{attrs:{label:"交易所"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"全部",clearable:""},model:{value:t.where.exchange,callback:function(e){t.$set(t.where,"exchange",e)},expression:"where.exchange"}},t._l(t.exchangeOptions,(function(t){return a("el-option",{key:t,attrs:{label:t.toUpperCase(),value:t}})})),1)],1),a("el-form-item",{attrs:{label:"账户"}},[a("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:"全部",clearable:""},model:{value:t.where.account_id,callback:function(e){t.$set(t.where,"account_id",e)},expression:"where.account_id"}},t._l(t.accountOptions,(function(t){return a("el-option",{key:t.id,attrs:{label:"["+(t.exchange||"").toUpperCase()+"] #"+t.id,value:t.id}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.fetchData}},[t._v("查询")]),a("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:t.resetQuery}},[t._v("重置")])],1)],1)],1),a("div",{staticClass:"operation-bar"},[a("el-button",{attrs:{size:"small",icon:"el-icon-refresh",loading:t.loading},on:{click:t.fetchData}},[t._v("刷新")]),a("el-divider",{attrs:{direction:"vertical"}}),a("el-switch",{staticStyle:{"margin-right":"8px"},attrs:{"active-text":"自动刷新","inactive-text":""},on:{change:t.handleAutoRefreshChange},model:{value:t.autoRefresh,callback:function(e){t.autoRefresh=e},expression:"autoRefresh"}}),t.lastUpdateTime?a("span",{staticClass:"last-update"},[a("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.lastUpdateTime)+" ")]):t._e(),t.total>0?a("span",{staticClass:"total-tip",staticStyle:{"margin-left":"auto"}},[t._v("共 "),a("b",[t._v(t._s(t.total))]),t._v(" 条持仓")]):t._e()],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.filteredList,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa",color:"#606266"},"row-class-name":t.rowClassName}},[a("el-table-column",{attrs:{prop:"symbol",label:"标的",width:"120",fixed:""},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",{staticClass:"symbol-text"},[t._v(t._s(n.symbol))])]}}])}),a("el-table-column",{attrs:{prop:"exchange",label:"交易所",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-tag",{attrs:{size:"mini",effect:"plain"}},[t._v(t._s((n.exchange||"").toUpperCase()))])]}}])}),a("el-table-column",{attrs:{prop:"account_id",label:"账户",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",{staticClass:"text-muted"},[t._v("#"+t._s(n.account_id))])]}}])}),a("el-table-column",{attrs:{label:"方向",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-tag",{attrs:{type:t.isLong(n)?"success":"danger",size:"mini",effect:"dark"}},[t._v(" "+t._s(t.isLong(n)?"多":"空")+" ")])]}}])}),a("el-table-column",{attrs:{prop:"quantity",label:"数量",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatNum(a.quantity))+" ")]}}])}),a("el-table-column",{attrs:{label:"开仓均价",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatPrice(a.avg_cost))+" ")]}}])}),a("el-table-column",{attrs:{label:"名义价值",width:"130",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatMoney(t.calcNotional(a)))+" ")]}}])}),a("el-table-column",{attrs:{prop:"leverage",label:"杠杆",width:"75",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-tag",{attrs:{size:"mini",type:"warning",effect:"plain"}},[t._v(t._s(n.leverage||"-")+"x")])]}}])}),a("el-table-column",{attrs:{label:"未实现盈亏",width:"140",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("div",{staticClass:"pnl-cell"},[a("span",{staticClass:"pnl-value",class:t.pnlClass(n.unrealized_pnl)},[t._v(" "+t._s(t.formatPnl(n.unrealized_pnl))+" ")]),null!==t.pnlPercent(n)?a("span",{staticClass:"pnl-percent",class:t.pnlClass(n.unrealized_pnl)},[t._v(" ("+t._s(t.pnlPercent(n))+") ")]):t._e()])]}}])}),a("el-table-column",{attrs:{prop:"liquidation_price",label:"强平价",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[n.liquidation_price?a("span",{staticClass:"liq-price"},[t._v(t._s(t.formatPrice(n.liquidation_price)))]):a("span",{staticClass:"text-muted"},[t._v("-")])]}}])}),a("el-table-column",{attrs:{label:"已实现盈亏",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[null!=n.realized_pnl&&0!=n.realized_pnl?a("span",{class:Number(n.realized_pnl)>=0?"text-success":"text-danger"},[t._v(" "+t._s(t.formatPnl(n.realized_pnl))+" ")]):a("span",{staticClass:"text-muted"},[t._v("-")])]}}])}),a("el-table-column",{attrs:{label:"状态",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-tag",{attrs:{type:"OPEN"===n.status?"success":"info",size:"mini",effect:"dark"}},[t._v(" "+t._s("OPEN"===n.status?"持仓":"CLOSED"===n.status?"已平":n.status||"-")+" ")])]}}])}),"open"!==t.viewMode?a("el-table-column",{attrs:{label:"平仓原因",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[n.close_reason?[a("el-tag",{attrs:{type:t.closeReasonType(n.close_reason),size:"mini"}},[t._v(" "+t._s(t.closeReasonLabel(n.close_reason))+" ")])]:a("span",{staticClass:"text-muted"},[t._v("-")])]}}],null,!1,4240901358)}):t._e(),a("el-table-column",{attrs:{label:"开仓时间",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatTime(a.opened_at))+" ")]}}])}),"open"!==t.viewMode?a("el-table-column",{attrs:{label:"平仓时间",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatTime(a.closed_at))+" ")]}}],null,!1,3762530608)}):t._e(),a("el-table-column",{attrs:{prop:"updated_at",label:"更新时间",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatTime(a.updated_at))+" ")]}}])}),a("el-table-column",{attrs:{label:"操作",width:"80",align:"center",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return t.showDetail(n)}}},[t._v("详情")])]}}])})],1),t.loading||0!==t.filteredList.length?t._e():a("el-empty",{attrs:{description:"暂无持仓数据"}})],1),a("el-dialog",{attrs:{title:"持仓详情 - "+(t.detailRow.symbol||""),visible:t.detailVisible,width:"900px",top:"5vh","append-to-body":""},on:{"update:visible":function(e){t.detailVisible=e}}},[t.detailRow.symbol?a("div",{staticClass:"detail-content"},[a("el-descriptions",{staticStyle:{"margin-bottom":"16px"},attrs:{column:3,border:"",size:"small"}},[a("el-descriptions-item",{attrs:{label:"标的"}},[t._v(t._s(t.detailRow.symbol))]),a("el-descriptions-item",{attrs:{label:"交易所"}},[t._v(t._s((t.detailRow.exchange||"").toUpperCase()))]),a("el-descriptions-item",{attrs:{label:"方向"}},[a("el-tag",{attrs:{type:t.isLong(t.detailRow)?"success":"danger",size:"mini",effect:"dark"}},[t._v(t._s(t.isLong(t.detailRow)?"多头":"空头"))])],1),a("el-descriptions-item",{attrs:{label:"数量"}},[t._v(t._s(t.formatNum(t.detailRow.quantity)))]),a("el-descriptions-item",{attrs:{label:"开仓均价"}},[t._v(t._s(t.formatPrice(t.detailRow.avg_cost)))]),a("el-descriptions-item",{attrs:{label:"杠杆"}},[t._v(t._s(t.detailRow.leverage||"-")+"x")]),a("el-descriptions-item",{attrs:{label:"名义价值"}},[t._v(t._s(t.formatMoney(t.calcNotional(t.detailRow)))+" USDT")]),a("el-descriptions-item",{attrs:{label:"保证金"}},[t._v(t._s(t.detailRow.margin?t.formatMoney(t.detailRow.margin):"-"))]),a("el-descriptions-item",{attrs:{label:"强平价"}},[t.detailRow.liquidation_price?a("span",{staticClass:"liq-price"},[t._v(t._s(t.formatPrice(t.detailRow.liquidation_price)))]):a("span",{staticClass:"text-muted"},[t._v("-")])]),a("el-descriptions-item",{attrs:{label:"未实现盈亏"}},[a("span",{class:t.pnlClass(t.detailRow.unrealized_pnl)},[t._v(t._s(t.formatPnl(t.detailRow.unrealized_pnl)))])]),a("el-descriptions-item",{attrs:{label:"已实现盈亏"}},[a("span",{class:t.pnlClass(t.detailRow.realized_pnl)},[t._v(t._s(t.formatPnl(t.detailRow.realized_pnl)))])]),a("el-descriptions-item",{attrs:{label:"状态"}},[a("el-tag",{attrs:{type:"OPEN"===t.detailRow.status?"success":"info",size:"mini"}},[t._v(t._s("OPEN"===t.detailRow.status?"持仓中":"已平仓"))])],1),t.detailRow.close_reason?a("el-descriptions-item",{attrs:{label:"平仓原因"}},[a("el-tag",{attrs:{type:t.closeReasonType(t.detailRow.close_reason),size:"mini"}},[t._v(" "+t._s(t.closeReasonLabel(t.detailRow.close_reason))+" ")])],1):t._e()],1),t.detailSlTp.stop_loss||t.detailSlTp.take_profit?a("div",{staticClass:"sltp-bar"},[t.detailSlTp.stop_loss?a("el-tag",{attrs:{type:"danger",size:"small",effect:"plain"}},[a("i",{staticClass:"el-icon-bottom"}),t._v(" 止损 "+t._s(t.formatPrice(t.detailSlTp.stop_loss))+" ")]):t._e(),t.detailSlTp.take_profit?a("el-tag",{attrs:{type:"success",size:"small",effect:"plain"}},[a("i",{staticClass:"el-icon-top"}),t._v(" 止盈 "+t._s(t.formatPrice(t.detailSlTp.take_profit))+" ")]):t._e(),a("span",{staticClass:"text-muted",staticStyle:{"font-size":"12px","margin-left":"8px"}},[t._v("（来自关联订单）")])],1):t._e(),t.detailTotalFee>0?a("div",{staticClass:"fee-summary"},[a("el-tag",{attrs:{size:"small",type:"warning",effect:"plain"}},[t._v(" 累计手续费："+t._s(t.formatMoney(t.detailTotalFee))+" USDT ")])],1):t._e(),a("h4",{staticStyle:{margin:"16px 0 8px"}},[a("i",{staticClass:"el-icon-s-order"}),t._v(" 关联订单 "),t.detailOrders.length?a("span",{staticClass:"text-muted",staticStyle:{"font-size":"12px"}},[t._v("("+t._s(t.detailOrders.length)+"笔)")]):t._e()]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.detailLoading,expression:"detailLoading"}],attrs:{data:t.detailOrders,stripe:"",border:"",size:"mini","header-cell-style":{background:"#fafafa"},"max-height":"260"}},[a("el-table-column",{attrs:{prop:"order_id",label:"订单ID",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-tooltip",{attrs:{content:n.order_id,placement:"top"}},[a("span",{staticClass:"id-text"},[t._v(t._s((n.order_id||"").slice(0,10))+"...")])])]}}],null,!1,1879197418)}),a("el-table-column",{attrs:{prop:"side",label:"方向",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-tag",{attrs:{type:"BUY"===(n.side||"").toUpperCase()?"success":"danger",size:"mini",effect:"dark"}},[t._v(t._s("BUY"===(n.side||"").toUpperCase()?"买入":"卖出"))])]}}],null,!1,1699511138)}),a("el-table-column",{attrs:{prop:"order_type",label:"类型",width:"70",align:"center"}}),a("el-table-column",{attrs:{label:"开/平仓",width:"90",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-tag",{attrs:{type:"CLOSE"===(n.trade_type||"OPEN")?"warning":"",size:"mini",effect:"plain"}},[t._v(" "+t._s({OPEN:"开仓",CLOSE:"平仓",ADD:"加仓",REDUCE:"减仓"}[(n.trade_type||"OPEN").toUpperCase()]||"开仓")+" ")]),n.close_reason?a("div",{staticStyle:{"font-size":"10px","margin-top":"1px"}},[a("el-tag",{attrs:{type:"TP"===n.close_reason?"success":"danger",size:"mini",effect:"plain"}},[t._v(" "+t._s({SL:"止损",TP:"止盈",SIGNAL:"信号",MANUAL:"手动",LIQUIDATION:"强平"}[(n.close_reason||"").toUpperCase()]||n.close_reason)+" ")])],1):t._e()]}}],null,!1,2996805348)}),a("el-table-column",{attrs:{label:"数量",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatNum(a.filled_quantity))+" / "+t._s(t.formatNum(a.quantity)))]}}],null,!1,1520794440)}),a("el-table-column",{attrs:{label:"成交均价",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatPrice(a.avg_price)))]}}],null,!1,165611858)}),a("el-table-column",{attrs:{label:"止损",width:"90",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[n.stop_loss?a("span",{staticStyle:{color:"#F56C6C"}},[t._v(t._s(t.formatPrice(n.stop_loss)))]):a("span",{staticClass:"text-muted"},[t._v("-")])]}}],null,!1,957256416)}),a("el-table-column",{attrs:{label:"止盈",width:"90",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[n.take_profit?a("span",{staticStyle:{color:"#67C23A"}},[t._v(t._s(t.formatPrice(n.take_profit)))]):a("span",{staticClass:"text-muted"},[t._v("-")])]}}],null,!1,2257475313)}),a("el-table-column",{attrs:{label:"手续费",width:"80",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[n.total_fee?a("span",[t._v(t._s(t.formatNum(n.total_fee)))]):a("span",{staticClass:"text-muted"},[t._v("-")])]}}],null,!1,1149643701)}),a("el-table-column",{attrs:{prop:"status",label:"状态",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-tag",{attrs:{type:"FILLED"===n.status?"success":"CANCELLED"===n.status?"info":"warning",size:"mini"}},[t._v(t._s(n.status))])]}}],null,!1,988390284)}),a("el-table-column",{attrs:{label:"时间","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatTime(a.created_at)))]}}],null,!1,3307665282)})],1),a("h4",{staticStyle:{margin:"16px 0 8px"}},[a("i",{staticClass:"el-icon-tickets"}),t._v(" 成交记录 "),t.detailFills.length?a("span",{staticClass:"text-muted",staticStyle:{"font-size":"12px"}},[t._v("("+t._s(t.detailFills.length)+"笔)")]):t._e()]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.detailLoading,expression:"detailLoading"}],attrs:{data:t.detailFills,stripe:"",border:"",size:"mini","header-cell-style":{background:"#fafafa"},"max-height":"220"}},[a("el-table-column",{attrs:{prop:"fill_id",label:"成交ID",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",{staticClass:"id-text"},[t._v(t._s((n.fill_id||"").slice(0,10))+"...")])]}}],null,!1,1225718116)}),a("el-table-column",{attrs:{prop:"side",label:"方向",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-tag",{attrs:{type:"BUY"===(n.side||"").toUpperCase()?"success":"danger",size:"mini"}},[t._v(t._s("BUY"===(n.side||"").toUpperCase()?"买入":"卖出"))])]}}],null,!1,3696549279)}),a("el-table-column",{attrs:{label:"数量",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatNum(a.quantity)))]}}],null,!1,1869857680)}),a("el-table-column",{attrs:{label:"成交价",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatPrice(a.price)))]}}],null,!1,3253945309)}),a("el-table-column",{attrs:{label:"成交额",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatMoney(a.value||a.quantity*a.price)))]}}],null,!1,2997206010)}),a("el-table-column",{attrs:{label:"手续费",width:"90",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[n.fee?a("span",{staticStyle:{color:"#E6A23C"}},[t._v(t._s(t.formatNum(n.fee)))]):a("span",{staticClass:"text-muted"},[t._v("0")])]}}],null,!1,2066547205)}),a("el-table-column",{attrs:{label:"时间","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatTime(a.filled_at)))]}}],null,!1,989805868)})],1)],1):t._e()])],1)},s=[],i=(a("13d5"),a("0643"),a("2382"),a("4e3e"),a("9d4a"),a("9a9a"),a("8012")),l=a("50fc"),r={name:"PositionList",data(){return{loading:!1,list:[],total:0,viewMode:"open",where:{symbol:"",position_side:"",exchange:"",account_id:""},autoRefresh:!1,refreshTimer:null,lastUpdateTime:"",accountOptions:[],detailVisible:!1,detailLoading:!1,detailRow:{},detailOrders:[],detailFills:[]}},computed:{exchangeOptions(){const t=new Set;return this.list.forEach(e=>{e.exchange&&t.add(e.exchange)}),this.accountOptions.forEach(e=>{e.exchange&&t.add(e.exchange)}),Array.from(t).sort()},filteredList(){return this.list.filter(t=>{if(this.where.position_side){const e=(t.position_side||t.side||"").toLowerCase();if(e!==this.where.position_side)return!1}return(!this.where.exchange||(t.exchange||"").toLowerCase()===this.where.exchange.toLowerCase())&&(!this.where.account_id||t.account_id===this.where.account_id)})},detailSlTp(){let t=null,e=null;for(const a of this.detailOrders)a.stop_loss&&!t&&(t=a.stop_loss),a.take_profit&&!e&&(e=a.take_profit);return{stop_loss:t,take_profit:e}},detailTotalFee(){return this.detailOrders.reduce((t,e)=>t+(Number(e.total_fee)||0),0)+this.detailFills.reduce((t,e)=>{const a=this.detailOrders.some(t=>t.order_id===e.order_id&&Number(t.total_fee)>0);return t+(a?0:Number(e.fee)||0)},0)},stats(){const t=this.filteredList;let e=0,a=0,n=0,s=0,i=0,l=0;return t.forEach(t=>{e+=this.calcNotional(t);const r=Number(t.unrealized_pnl)||0;a+=r,this.isLong(t)?n++:s++,r>=0?i++:l++}),{totalCount:t.length,totalNotional:e,totalPnl:a,longCount:n,shortCount:s,profitCount:i,lossCount:l}}},mounted(){this.fetchData(),this.fetchAccounts()},beforeDestroy(){this.clearTimer()},methods:{onViewModeChange(){this.fetchData()},async fetchData(){this.loading=!0;try{const t={};"open"===this.viewMode?t.has_position=!0:"closed"===this.viewMode&&(t.status="CLOSED"),this.where.symbol&&(t.symbol=this.where.symbol);const e=await Object(i["d"])(t);this.list=e.data.data||[],this.total=e.data.total||this.list.length,this.lastUpdateTime=this.nowStr()}catch(t){this.$message.error("获取持仓失败")}finally{this.loading=!1}},async fetchAccounts(){try{const t=await Object(l["k"])({status:1});this.accountOptions=t.data.data||t.data||[]}catch(t){}},resetQuery(){this.where={symbol:"",position_side:"",exchange:"",account_id:""},this.fetchData()},async showDetail(t){this.detailRow=t,this.detailOrders=[],this.detailFills=[],this.detailVisible=!0,this.detailLoading=!0;try{const e={symbol:t.symbol,account_id:t.account_id,limit:100},a={symbol:t.symbol,account_id:t.account_id,limit:200};if(t.opened_at){const n=new Date(new Date(t.opened_at).getTime()-6e4).toISOString();e.start_time=n,a.start_time=n}if(t.closed_at){const n=new Date(new Date(t.closed_at).getTime()+6e4).toISOString();e.end_time=n,a.end_time=n}const[n,s]=await Promise.all([Object(i["c"])(e),Object(i["b"])(a)]);this.detailOrders=(n.data.data||[]).sort((t,e)=>new Date(e.created_at)-new Date(t.created_at)),this.detailFills=(s.data.data||[]).sort((t,e)=>new Date(e.filled_at)-new Date(t.filled_at))}catch(e){this.$message.error("获取关联数据失败")}finally{this.detailLoading=!1}},calcNotional(t){const e=Number(t.quantity)||0,a=Number(t.avg_cost)||0;return e*a},handleAutoRefreshChange(t){t?(this.startTimer(),this.$message.success("已开启自动刷新（30秒）")):(this.clearTimer(),this.$message.info("已关闭自动刷新"))},startTimer(){this.clearTimer(),this.refreshTimer=setInterval(()=>{this.fetchData()},3e4)},clearTimer(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)},isLong(t){const e=(t.position_side||t.side||"").toLowerCase();return"long"===e},closeReasonLabel(t){const e={SL:"止损",TP:"止盈",SIGNAL:"信号平仓",MANUAL:"手动平仓",LIQUIDATION:"强平"};return e[(t||"").toUpperCase()]||t||"-"},closeReasonType(t){const e={SL:"danger",TP:"success",SIGNAL:"warning",MANUAL:"info",LIQUIDATION:"danger"};return e[(t||"").toUpperCase()]||"info"},formatPrice(t){if(null===t||void 0===t||""===t||0===t)return"-";const e=Number(t);return isNaN(e)?t:e>=1e3?e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):e>=1?e.toLocaleString("en-US",{minimumFractionDigits:4,maximumFractionDigits:4}):e.toLocaleString("en-US",{minimumFractionDigits:6,maximumFractionDigits:8})},formatNum(t){if(null===t||void 0===t||""===t)return"-";const e=Number(t);return isNaN(e)?t:e.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:6})},formatMoney(t){if(null===t||void 0===t||""===t)return"-";const e=Number(t);return isNaN(e)?t:e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},formatPnl(t){if(null===t||void 0===t)return"-";const e=Number(t);if(isNaN(e))return t;const a=e>=0?"+":"";return a+e.toLocaleString("en-US",{minimumFractionDigits:4,maximumFractionDigits:4})},pnlPercent(t){const e=Number(t.unrealized_pnl),a=this.calcNotional(t);if(!a||isNaN(e)||isNaN(a))return null;const n=e/a*100,s=n>=0?"+":"";return s+n.toFixed(2)+"%"},pnlClass(t){const e=Number(t);return isNaN(e)||0===e?"text-muted":e>0?"text-success":"text-danger"},formatTime(t){if(!t)return"-";const e=new Date(t);if(isNaN(e.getTime()))return t;const a=t=>String(t).padStart(2,"0");return`${e.getFullYear()}-${a(e.getMonth()+1)}-${a(e.getDate())} ${a(e.getHours())}:${a(e.getMinutes())}:${a(e.getSeconds())}`},nowStr(){return this.formatTime(new Date)},rowClassName({row:t}){const e=Number(t.unrealized_pnl);return isNaN(e)?"":e>0?"row-profit":e<0?"row-loss":""}}},o=r,c=(a("311b"),a("2877")),u=Object(c["a"])(o,n,s,!1,null,"6907efc3",null);e["default"]=u.exports}}]);