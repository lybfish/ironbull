(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-78cac204"],{"2d26":function(t,e,a){},"48b2":function(t,e,a){"use strict";a("2d26")},"4f0c":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ele-body"},[a("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[a("el-col",{attrs:{span:6}},[a("stat-card",{attrs:{title:"流水条数",value:t.total,icon:"el-icon-s-order",color:"primary",loading:t.loading,"help-text":"当前筛选结果"}})],1),a("el-col",{attrs:{span:6}},[a("stat-card",{attrs:{title:"收入合计",value:t.stats.income,icon:"el-icon-top",color:"success",loading:t.loading}},[a("template",{slot:"value"},[t._v(t._s(t.formatCurrency(t.stats.income)))])],2)],1),a("el-col",{attrs:{span:6}},[a("stat-card",{attrs:{title:"支出合计",value:t.stats.expense,icon:"el-icon-bottom",color:"danger",loading:t.loading}},[a("template",{slot:"value"},[t._v(t._s(t.formatCurrency(t.stats.expense)))])],2)],1),a("el-col",{attrs:{span:6}},[a("stat-card",{attrs:{title:"净额",value:t.stats.net,icon:"el-icon-data-analysis",color:t.stats.net>=0?"success":"danger",loading:t.loading}},[a("template",{slot:"value"},[a("span",{style:{color:t.stats.net>=0?"#67C23A":"#F56C6C"}},[t._v(t._s(t.formatCurrency(t.stats.net)))])])],2)],1)],1),a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"toolbar"},[a("span",{staticClass:"toolbar-title"},[t._v("资金流水")]),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh",loading:t.loading},on:{click:t.fetchData}},[t._v("刷新")])],1),a("div",{staticClass:"search-bar"},[a("el-form",{attrs:{inline:!0,size:"small"}},[a("el-form-item",{attrs:{label:"类型"}},[a("el-select",{staticStyle:{width:"140px"},attrs:{placeholder:"全部",clearable:""},model:{value:t.filters.tx_type,callback:function(e){t.$set(t.filters,"tx_type",e)},expression:"filters.tx_type"}},[a("el-option",{attrs:{label:"充值",value:"DEPOSIT"}}),a("el-option",{attrs:{label:"提现",value:"WITHDRAW"}}),a("el-option",{attrs:{label:"手续费",value:"FEE"}}),a("el-option",{attrs:{label:"盈亏",value:"PNL"}}),a("el-option",{attrs:{label:"转账",value:"TRANSFER"}}),a("el-option",{attrs:{label:"资金费",value:"FUNDING"}})],1)],1),a("el-form-item",{attrs:{label:"币种"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"币种",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch.apply(null,arguments)}},model:{value:t.filters.currency,callback:function(e){t.$set(t.filters,"currency",e)},expression:"filters.currency"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.onSearch}},[t._v("查询")]),a("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:t.handleReset}},[t._v("重置")])],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"12px"},attrs:{data:t.list,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa"}}},[a("el-table-column",{attrs:{prop:"tx_id",label:"流水ID",width:"120"}}),a("el-table-column",{attrs:{prop:"account_id",label:"账户ID",width:"100"}}),a("el-table-column",{attrs:{prop:"tx_type",label:"类型",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-tag",{attrs:{type:t.getTxTypeTagType(n.tx_type),size:"small"}},[t._v(t._s(t.getTxTypeLabel(n.tx_type)))])]}}])}),a("el-table-column",{attrs:{prop:"currency",label:"币种",width:"80"}}),a("el-table-column",{attrs:{prop:"amount",label:"金额",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",{style:{color:parseFloat(n.amount)>=0?"#67C23A":"#F56C6C"}},[t._v(t._s(t.formatCurrency(n.amount)))])]}}])}),a("el-table-column",{attrs:{prop:"balance_after",label:"变动后余额",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatCurrency(a.balance_after)))]}}])}),a("el-table-column",{attrs:{prop:"description",label:"备注","min-width":"150","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(a.description||"-"))]}}])}),a("el-table-column",{attrs:{prop:"reference_id",label:"参考ID",width:"120","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"created_at",label:"创建时间",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t.formatTime(a.created_at)))]}}])})],1),t.loading||0!==t.list.length?t._e():a("el-empty",{attrs:{description:"暂无流水记录"}}),t.total>0?a("div",{staticClass:"pagination-wrap"},[a("span",{staticClass:"total-tip"},[t._v("共 "+t._s(t.total)+" 条")]),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes",total:t.total,"page-sizes":[20,50,100,200],"page-size":t.pagination.limit,"current-page":t.pagination.page},on:{"update:pageSize":function(e){return t.$set(t.pagination,"limit",e)},"update:page-size":function(e){return t.$set(t.pagination,"limit",e)},"update:currentPage":function(e){return t.$set(t.pagination,"page",e)},"update:current-page":function(e){return t.$set(t.pagination,"page",e)},"size-change":t.handleSizeChange,"current-change":t.handlePageChange}})],1):t._e()],1)],1)},l=[],i=(a("0643"),a("4e3e"),a("8012")),r={name:"TransactionList",data(){return{loading:!1,list:[],total:0,filters:{tx_type:"",currency:""},pagination:{page:1,limit:50}}},computed:{stats(){let t=0,e=0;return this.list.forEach(a=>{const n=parseFloat(a.amount)||0;n>=0?t+=n:e+=Math.abs(n)}),{income:t,expense:e,net:t-e}}},mounted(){this.fetchData()},methods:{formatTime(t){return t?String(t).replace("T"," ").substring(0,19):"-"},formatCurrency(t){if(null==t||""===t)return"0.00";const e=parseFloat(t);return isNaN(e)?"0.00":e.toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2})},onSearch(){this.pagination.page=1,this.fetchData()},handleReset(){this.filters={tx_type:"",currency:""},this.pagination.page=1,this.fetchData()},handleSizeChange(t){this.pagination.limit=t,this.pagination.page=1,this.fetchData()},handlePageChange(t){this.pagination.page=t,this.fetchData()},getTxTypeLabel(t){const e={DEPOSIT:"充值",WITHDRAW:"提现",FEE:"手续费",PNL:"盈亏",TRANSFER:"转账",FUNDING:"资金费"};return e[t]||t},getTxTypeTagType(t){const e={DEPOSIT:"success",WITHDRAW:"warning",FEE:"info",PNL:"success",TRANSFER:"",FUNDING:"info"};return e[t]||""},async fetchData(){this.loading=!0;try{const t={offset:(this.pagination.page-1)*this.pagination.limit,limit:this.pagination.limit};this.filters.tx_type&&(t.transaction_type=this.filters.tx_type),this.filters.currency&&(t.currency=this.filters.currency);const e=await Object(i["e"])(t),a=e.data;this.list=a.data||[],this.total=null!=a.total?a.total:this.list.length}catch(e){var t;this.$message.error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||"获取流水失败")}finally{this.loading=!1}}}},s=r,o=(a("48b2"),a("2877")),c=Object(o["a"])(s,n,l,!1,null,"2d13daea",null);e["default"]=c.exports},8012:function(t,e,a){"use strict";a.d(e,"c",(function(){return s})),a.d(e,"b",(function(){return o})),a.d(e,"d",(function(){return c})),a.d(e,"a",(function(){return u})),a.d(e,"e",(function(){return p}));var n=a("bc3a"),l=a.n(n);let i={tenant_id:1};function r(t){return{...i,...t}}function s(t={}){return l.a.get("/orders",{params:r({limit:50,...t})})}function o(t={}){return l.a.get("/fills",{params:r({limit:50,...t})})}function c(t={}){return l.a.get("/positions",{params:r({limit:100,...t})})}function u(t={}){return l.a.get("/accounts",{params:r({limit:50,...t})})}function p(t={}){return l.a.get("/transactions",{params:r({limit:50,...t})})}}}]);