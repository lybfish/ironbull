(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-50828382"],{1364:function(t,e,a){},8012:function(t,e,a){"use strict";a.d(e,"c",(function(){return l})),a.d(e,"b",(function(){return o})),a.d(e,"d",(function(){return c})),a.d(e,"a",(function(){return u})),a.d(e,"e",(function(){return d}));var s=a("bc3a"),n=a.n(s);let r={tenant_id:1};function i(t){return{...r,...t}}function l(t={}){return n.a.get("/orders",{params:i({limit:50,...t})})}function o(t={}){return n.a.get("/fills",{params:i({limit:50,...t})})}function c(t={}){return n.a.get("/positions",{params:i({limit:100,...t})})}function u(t={}){return n.a.get("/accounts",{params:i({limit:50,...t})})}function d(t={}){return n.a.get("/transactions",{params:i({limit:50,...t})})}},9704:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ele-body"},[a("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[a("el-col",{attrs:{lg:4,md:8,sm:12}},[a("stat-card",{attrs:{title:"总持仓数",value:t.stats.totalCount,icon:"el-icon-s-data",color:"primary",loading:t.loading},scopedSlots:t._u([{key:"footer",fn:function(){return[a("span",{staticClass:"ele-text-secondary"},[t._v("活跃仓位")])]},proxy:!0}])})],1),a("el-col",{attrs:{lg:4,md:8,sm:12}},[a("stat-card",{attrs:{title:"总名义价值",icon:"el-icon-coin",color:"warning",loading:t.loading},scopedSlots:t._u([{key:"value",fn:function(){return[a("span",[t._v(t._s(t.formatMoney(t.stats.totalNotional)))])]},proxy:!0},{key:"footer",fn:function(){return[a("span",{staticClass:"ele-text-secondary"},[t._v("USDT")])]},proxy:!0}])})],1),a("el-col",{attrs:{lg:4,md:8,sm:12}},[a("stat-card",{attrs:{title:"未实现盈亏",icon:"el-icon-data-analysis",color:t.stats.totalPnl>=0?"success":"danger",loading:t.loading},scopedSlots:t._u([{key:"value",fn:function(){return[a("span",{class:t.stats.totalPnl>=0?"text-success":"text-danger"},[t._v(" "+t._s(t.stats.totalPnl>=0?"+":"")+t._s(t.formatMoney(t.stats.totalPnl))+" ")])]},proxy:!0}])})],1),a("el-col",{attrs:{lg:4,md:8,sm:12}},[a("stat-card",{attrs:{title:"多头仓位",value:t.stats.longCount,icon:"el-icon-top",color:"success",loading:t.loading},scopedSlots:t._u([{key:"footer",fn:function(){return[a("span",{staticClass:"ele-text-secondary"},[t._v("做多")])]},proxy:!0}])})],1),a("el-col",{attrs:{lg:4,md:8,sm:12}},[a("stat-card",{attrs:{title:"空头仓位",value:t.stats.shortCount,icon:"el-icon-bottom",color:"danger",loading:t.loading},scopedSlots:t._u([{key:"footer",fn:function(){return[a("span",{staticClass:"ele-text-secondary"},[t._v("做空")])]},proxy:!0}])})],1),a("el-col",{attrs:{lg:4,md:8,sm:12}},[a("stat-card",{attrs:{title:"盈亏比",icon:"el-icon-pie-chart",color:"info",loading:t.loading},scopedSlots:t._u([{key:"value",fn:function(){return[a("span",[a("span",{staticClass:"text-success"},[t._v(t._s(t.stats.profitCount))]),a("span",{staticStyle:{color:"#C0C4CC",margin:"0 4px"}},[t._v("/")]),a("span",{staticClass:"text-danger"},[t._v(t._s(t.stats.lossCount))])])]},proxy:!0},{key:"footer",fn:function(){return[a("span",{staticClass:"ele-text-secondary"},[t._v("盈利 / 亏损")])]},proxy:!0}])})],1)],1),a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"toolbar"},[a("span",{staticClass:"toolbar-title"},[t._v("当前持仓")])]),a("div",{staticClass:"search-bar"},[a("el-form",{staticClass:"search-form",attrs:{inline:!0,model:t.where,size:"small"}},[a("el-form-item",{attrs:{label:"标的"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"如 BTC/USDT",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.fetchData.apply(null,arguments)}},model:{value:t.where.symbol,callback:function(e){t.$set(t.where,"symbol",e)},expression:"where.symbol"}})],1),a("el-form-item",{attrs:{label:"方向"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"全部",clearable:""},model:{value:t.where.position_side,callback:function(e){t.$set(t.where,"position_side",e)},expression:"where.position_side"}},[a("el-option",{attrs:{label:"多头",value:"long"}}),a("el-option",{attrs:{label:"空头",value:"short"}})],1)],1),a("el-form-item",{attrs:{label:"交易所"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"全部",clearable:""},model:{value:t.where.exchange,callback:function(e){t.$set(t.where,"exchange",e)},expression:"where.exchange"}},t._l(t.exchangeOptions,(function(t){return a("el-option",{key:t,attrs:{label:t.toUpperCase(),value:t}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.fetchData}},[t._v("查询")]),a("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:t.resetQuery}},[t._v("重置")])],1)],1)],1),a("div",{staticClass:"operation-bar"},[a("el-button",{attrs:{size:"small",icon:"el-icon-refresh",loading:t.loading},on:{click:t.fetchData}},[t._v("刷新")]),a("el-divider",{attrs:{direction:"vertical"}}),a("el-switch",{staticStyle:{"margin-right":"8px"},attrs:{"active-text":"自动刷新","inactive-text":""},on:{change:t.handleAutoRefreshChange},model:{value:t.autoRefresh,callback:function(e){t.autoRefresh=e},expression:"autoRefresh"}}),t.lastUpdateTime?a("span",{staticClass:"last-update"},[a("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.lastUpdateTime)+" ")]):t._e(),t.total>0?a("span",{staticClass:"total-tip",staticStyle:{"margin-left":"auto"}},[t._v("共 "),a("b",[t._v(t._s(t.total))]),t._v(" 条持仓")]):t._e()],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.filteredList,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa",color:"#606266"},"row-class-name":t.rowClassName}},[a("el-table-column",{attrs:{prop:"symbol",label:"标的",width:"120",fixed:""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("span",{staticClass:"symbol-text"},[t._v(t._s(s.symbol))])]}}])}),a("el-table-column",{attrs:{prop:"exchange",label:"交易所",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-tag",{attrs:{size:"mini",effect:"plain"}},[t._v(t._s((s.exchange||"").toUpperCase()))])]}}])}),a("el-table-column",{attrs:{label:"方向",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-tag",{attrs:{type:t.isLong(s)?"success":"danger",size:"mini",effect:"dark"}},[t._v(" "+t._s(t.isLong(s)?"多":"空")+" ")])]}}])}),a("el-table-column",{attrs:{prop:"quantity",label:"数量",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatNum(a.quantity))+" ")]}}])}),a("el-table-column",{attrs:{prop:"entry_price",label:"开仓价",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatPrice(a.entry_price))+" ")]}}])}),a("el-table-column",{attrs:{prop:"mark_price",label:"标记价",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatPrice(a.mark_price))+" ")]}}])}),a("el-table-column",{attrs:{prop:"leverage",label:"杠杆",width:"75",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-tag",{attrs:{size:"mini",type:"warning",effect:"plain"}},[t._v(t._s(s.leverage||"-")+"x")])]}}])}),a("el-table-column",{attrs:{prop:"margin_mode",label:"保证金",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("span",[t._v(t._s(t.marginLabel(s.margin_mode)))])]}}])}),a("el-table-column",{attrs:{label:"未实现盈亏",width:"150",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("div",{staticClass:"pnl-cell"},[a("span",{staticClass:"pnl-value",class:t.pnlClass(s.unrealized_pnl)},[t._v(" "+t._s(t.formatPnl(s.unrealized_pnl))+" ")]),null!==t.pnlPercent(s)?a("span",{staticClass:"pnl-percent",class:t.pnlClass(s.unrealized_pnl)},[t._v(" ("+t._s(t.pnlPercent(s))+") ")]):t._e()])]}}])}),a("el-table-column",{attrs:{prop:"notional_value",label:"名义价值",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatMoney(a.notional_value))+" ")]}}])}),a("el-table-column",{attrs:{prop:"liquidation_price",label:"强平价",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[s.liquidation_price?a("span",{staticClass:"liq-price"},[t._v(t._s(t.formatPrice(s.liquidation_price)))]):a("span",{staticClass:"text-muted"},[t._v("-")])]}}])}),a("el-table-column",{attrs:{prop:"updated_at",label:"更新时间","min-width":"170"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatTime(a.updated_at))+" ")]}}])})],1),t.loading||0!==t.filteredList.length?t._e():a("el-empty",{attrs:{description:"暂无持仓数据"}})],1)],1)},n=[],r=(a("0643"),a("2382"),a("4e3e"),a("8012")),i={name:"PositionList",data(){return{loading:!1,list:[],total:0,where:{symbol:"",position_side:"",exchange:""},autoRefresh:!1,refreshTimer:null,lastUpdateTime:""}},computed:{exchangeOptions(){const t=new Set;return this.list.forEach(e=>{e.exchange&&t.add(e.exchange)}),Array.from(t).sort()},filteredList(){return this.list.filter(t=>{if(this.where.position_side){const e=(t.position_side||t.side||"").toLowerCase();if(e!==this.where.position_side)return!1}return!this.where.exchange||(t.exchange||"").toLowerCase()===this.where.exchange.toLowerCase()})},stats(){const t=this.filteredList;let e=0,a=0,s=0,n=0,r=0,i=0;return t.forEach(t=>{e+=Number(t.notional_value)||0;const l=Number(t.unrealized_pnl)||0;a+=l,this.isLong(t)?s++:n++,l>=0?r++:i++}),{totalCount:t.length,totalNotional:e,totalPnl:a,longCount:s,shortCount:n,profitCount:r,lossCount:i}}},mounted(){this.fetchData()},beforeDestroy(){this.clearTimer()},methods:{async fetchData(){this.loading=!0;try{const t={};this.where.symbol&&(t.symbol=this.where.symbol);const e=await Object(r["d"])(t);this.list=e.data.data||[],this.total=e.data.total||this.list.length,this.lastUpdateTime=this.nowStr()}catch(t){this.$message.error("获取持仓失败")}finally{this.loading=!1}},resetQuery(){this.where={symbol:"",position_side:"",exchange:""},this.fetchData()},handleAutoRefreshChange(t){t?(this.startTimer(),this.$message.success("已开启自动刷新（30秒）")):(this.clearTimer(),this.$message.info("已关闭自动刷新"))},startTimer(){this.clearTimer(),this.refreshTimer=setInterval(()=>{this.fetchData()},3e4)},clearTimer(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)},isLong(t){const e=(t.position_side||t.side||"").toLowerCase();return"long"===e},formatPrice(t){if(null===t||void 0===t||""===t)return"-";const e=Number(t);return isNaN(e)?t:e>=1e3?e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):e>=1?e.toLocaleString("en-US",{minimumFractionDigits:4,maximumFractionDigits:4}):e.toLocaleString("en-US",{minimumFractionDigits:6,maximumFractionDigits:8})},formatNum(t){if(null===t||void 0===t||""===t)return"-";const e=Number(t);return isNaN(e)?t:e.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:6})},formatMoney(t){if(null===t||void 0===t||""===t)return"-";const e=Number(t);return isNaN(e)?t:e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},formatPnl(t){if(null===t||void 0===t)return"-";const e=Number(t);if(isNaN(e))return t;const a=e>=0?"+":"";return a+e.toLocaleString("en-US",{minimumFractionDigits:4,maximumFractionDigits:4})},pnlPercent(t){const e=Number(t.unrealized_pnl),a=Number(t.notional_value);if(!a||isNaN(e)||isNaN(a))return null;const s=e/a*100,n=s>=0?"+":"";return n+s.toFixed(2)+"%"},pnlClass(t){const e=Number(t);return isNaN(e)||0===e?"text-muted":e>0?"text-success":"text-danger"},marginLabel(t){if(!t)return"-";const e=t.toLowerCase();return"cross"===e||"crossed"===e?"全仓":"isolated"===e?"逐仓":t},formatTime(t){if(!t)return"-";const e=new Date(t);if(isNaN(e.getTime()))return t;const a=t=>String(t).padStart(2,"0");return`${e.getFullYear()}-${a(e.getMonth()+1)}-${a(e.getDate())} ${a(e.getHours())}:${a(e.getMinutes())}:${a(e.getSeconds())}`},nowStr(){return this.formatTime(new Date)},rowClassName({row:t}){const e=Number(t.unrealized_pnl);return isNaN(e)?"":e>0?"row-profit":e<0?"row-loss":""}}},l=i,o=(a("e4e3"),a("2877")),c=Object(o["a"])(l,s,n,!1,null,"50041a18",null);e["default"]=c.exports},e4e3:function(t,e,a){"use strict";a("1364")}}]);