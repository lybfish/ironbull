(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0083fb4b"],{"0f66":function(t,e,s){"use strict";s.d(e,"f",(function(){return n})),s.d(e,"a",(function(){return l})),s.d(e,"n",(function(){return o})),s.d(e,"b",(function(){return r})),s.d(e,"e",(function(){return c})),s.d(e,"c",(function(){return d})),s.d(e,"i",(function(){return u})),s.d(e,"k",(function(){return p})),s.d(e,"l",(function(){return m})),s.d(e,"j",(function(){return h})),s.d(e,"g",(function(){return y})),s.d(e,"d",(function(){return f})),s.d(e,"m",(function(){return g})),s.d(e,"h",(function(){return v}));var a=s("bc3a"),i=s.n(a);function n(t={}){return i.a.get("/nodes",{params:t})}function l(t){return i.a.post("/nodes",t)}function o(t,e){return i.a.put("/nodes/"+t,e)}function r(t){return i.a.delete("/nodes/"+t)}function c(t){return i.a.get(`/nodes/${t}/accounts`)}function d(t={}){return i.a.get("/exchange-accounts",{params:t})}function u(t={}){return i.a.post("/sync/balance",t)}function p(t={}){return i.a.post("/sync/positions",t)}function m(t={}){return i.a.post("/sync/trades",t)}function h(t={}){return i.a.post("/sync/markets",t)}function y(){return i.a.get("/signal-monitor/status")}function f(){return i.a.get("/sync/monitored-positions")}function g(){return i.a.post("/signal-monitor/trigger-scan")}function v(t){return i.a.get("/signal-monitor/realtime-prices",{params:{symbols:t}})}},"1a37":function(t,e,s){},"20e8":function(t,e,s){"use strict";s("1a37")},4738:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ele-body"},[s("el-tabs",{attrs:{type:"border-card"},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[s("el-tab-pane",{attrs:{label:"数据同步",name:"sync"}},[s("el-row",{attrs:{gutter:16}},[s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("余额同步")])]),s("el-form",{attrs:{"label-width":"100px",size:"small"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点",clearable:""},model:{value:t.balanceNodeId,callback:function(e){t.balanceNodeId=e},expression:"balanceNodeId"}},t._l(t.nodes,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name+" ("+t.node_code+")",value:t.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",loading:t.syncingBalance},on:{click:t.handleSyncBalance}},[t._v("同步余额")])],1)],1),t.balanceResult?s("el-alert",{staticStyle:{"margin-top":"8px"},attrs:{title:t.balanceResult.message,type:t.balanceResult.success?"success":"error",closable:!1,"show-icon":""}}):t._e()],1)],1),s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("持仓同步")])]),s("el-form",{attrs:{"label-width":"100px",size:"small"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点",clearable:""},model:{value:t.positionNodeId,callback:function(e){t.positionNodeId=e},expression:"positionNodeId"}},t._l(t.nodes,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name+" ("+t.node_code+")",value:t.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",loading:t.syncingPositions},on:{click:t.handleSyncPositions}},[t._v("同步持仓")])],1)],1),t.positionResult?s("el-alert",{staticStyle:{"margin-top":"8px"},attrs:{title:t.positionResult.message,type:t.positionResult.success?"success":"error",closable:!1,"show-icon":""}}):t._e()],1)],1)],1),s("el-row",{staticStyle:{"margin-top":"16px"},attrs:{gutter:16}},[s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("成交同步")])]),s("el-form",{attrs:{"label-width":"100px",size:"small"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点（不选=全部）",clearable:""},model:{value:t.tradesNodeId,callback:function(e){t.tradesNodeId=e},expression:"tradesNodeId"}},t._l(t.nodes,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name+" ("+t.node_code+")",value:t.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"warning",loading:t.syncingTrades},on:{click:t.handleSyncTrades}},[t._v("同步成交")])],1)],1),t.tradesResult?s("el-alert",{staticStyle:{"margin-top":"8px"},attrs:{title:t.tradesResult.message,type:t.tradesResult.success?"success":"error",closable:!1,"show-icon":""}}):t._e()],1)],1),s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("市场信息同步")])]),s("el-form",{attrs:{"label-width":"100px",size:"small"}},[s("el-form-item",{attrs:{label:"交易所"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"全部交易所",clearable:""},model:{value:t.marketExchange,callback:function(e){t.marketExchange=e},expression:"marketExchange"}},[s("el-option",{attrs:{label:"Binance",value:"binance"}}),s("el-option",{attrs:{label:"Gate",value:"gate"}}),s("el-option",{attrs:{label:"OKX",value:"okx"}})],1)],1),s("el-form-item",{attrs:{label:"市场类型"}},[s("el-radio-group",{model:{value:t.marketType,callback:function(e){t.marketType=e},expression:"marketType"}},[s("el-radio",{attrs:{label:"swap"}},[t._v("永续合约")]),s("el-radio",{attrs:{label:"spot"}},[t._v("现货")])],1)],1),s("el-form-item",[s("el-button",{attrs:{type:"success",loading:t.syncingMarkets},on:{click:t.handleSyncMarkets}},[t._v("同步市场信息")])],1)],1),t.marketsResult?s("el-alert",{staticStyle:{"margin-top":"8px"},attrs:{title:t.marketsResult.message,type:t.marketsResult.success?"success":"error",closable:!1,"show-icon":""}}):t._e()],1)],1)],1),s("el-card",{staticStyle:{"margin-top":"16px"},attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("同步历史")]),s("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:t.clearHistory}},[t._v("清空")])],1),s("el-table",{attrs:{data:t.syncHistory,stripe:"",border:"",size:"mini","max-height":"300"}},[s("el-table-column",{attrs:{prop:"type",label:"类型",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{type:t.syncTypeTag(a.type),size:"mini"}},[t._v(t._s(t.syncTypeLabel(a.type)))])]}}])}),s("el-table-column",{attrs:{prop:"node_name",label:"目标",width:"160"}}),s("el-table-column",{attrs:{prop:"message",label:"结果","show-overflow-tooltip":""}}),s("el-table-column",{attrs:{prop:"time",label:"时间",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(t.fmtDT(s.time)))]}}])}),s("el-table-column",{attrs:{label:"状态",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{type:a.success?"success":"danger",size:"mini"}},[t._v(t._s(a.success?"成功":"失败"))])]}}])})],1),0===t.syncHistory.length?s("el-empty",{attrs:{description:"暂无同步记录","image-size":60}}):t._e()],1)],1),s("el-tab-pane",{attrs:{label:"持仓监控 (SL/TP)",name:"monitor"}},[t.pmError?s("div",{staticStyle:{"margin-bottom":"12px"}},[s("el-alert",{attrs:{title:t.pmError,type:"error",closable:!1,"show-icon":""}})],1):t._e(),s("el-row",{attrs:{gutter:16}},[s("el-col",{attrs:{span:5}},[s("div",{staticClass:"pm-card"},[s("div",{staticClass:"pm-label"},[t._v("监控状态")]),s("div",{staticClass:"pm-value"},[s("el-tag",{attrs:{type:t.pmStatus.enabled?"success":"info",size:"medium",effect:"dark"}},[t._v(" "+t._s(t.pmStatus.enabled?"运行中":"未启用")+" ")])],1),s("div",{staticClass:"pm-desc"},[t._v(t._s(t.pmStatus.enabled?"自管SL/TP模式":"交易所SL/TP模式"))])])]),s("el-col",{attrs:{span:4}},[s("div",{staticClass:"pm-card"},[s("div",{staticClass:"pm-label"},[t._v("监控持仓")]),s("div",{staticClass:"pm-value pm-num"},[t._v(t._s(t.pmStats.positions_monitored||0))]),s("div",{staticClass:"pm-desc"},[t._v("带SL/TP的OPEN持仓")])])]),s("el-col",{attrs:{span:4}},[s("div",{staticClass:"pm-card"},[s("div",{staticClass:"pm-label"},[t._v("触发次数")]),s("div",{staticClass:"pm-value pm-num"},[t._v(t._s(t.pmStats.triggers_total||0))]),s("div",{staticClass:"pm-desc"},[s("span",{staticStyle:{color:"#67C23A"}},[t._v("成功 "+t._s(t.pmStats.closes_success||0))]),s("span",{staticStyle:{"margin-left":"4px",color:"#F56C6C"}},[t._v("失败 "+t._s(t.pmStats.closes_failed||0))])])])]),s("el-col",{attrs:{span:5}},[s("div",{staticClass:"pm-card"},[s("div",{staticClass:"pm-label"},[t._v("扫描频率")]),s("div",{staticClass:"pm-value",staticStyle:{"font-size":"20px",color:"#409EFF"}},[t._v(t._s(t.pmConfig.interval||"?")+"s / 次")]),s("div",{staticClass:"pm-desc"},[t._v("上次: "+t._s(t.pmStats.last_scan_at?t.fmtDT(t.pmStats.last_scan_at):"-"))])])]),s("el-col",{attrs:{span:6}},[s("div",{staticClass:"pm-card",staticStyle:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center"}},[s("el-button",{staticStyle:{"margin-bottom":"8px",width:"100%"},attrs:{type:"primary",icon:"el-icon-refresh",loading:t.loadingPM},on:{click:t.refreshPM}},[t._v(" 刷新状态 ")]),s("el-button",{staticStyle:{width:"100%"},attrs:{type:"warning",icon:"el-icon-aim",loading:t.scanning,disabled:!t.pmStatus.enabled},on:{click:t.handleTriggerScan}},[t._v(" 手动扫描一次 ")])],1)])],1),s("el-card",{staticStyle:{"margin-top":"16px"},attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",{staticStyle:{"font-weight":"600"}},[t._v("监控持仓明细")]),s("el-button",{staticStyle:{"margin-left":"12px"},attrs:{type:"text",size:"small",loading:t.loadingPositions},on:{click:t.fetchMonitoredPositions}},[t._v("刷新")]),s("el-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"text",size:"small",loading:t.loadingPrices},on:{click:t.fetchPrices}},[s("i",{staticClass:"el-icon-data-line"}),t._v(" 刷新价格 ")]),s("el-switch",{staticStyle:{float:"right","margin-top":"2px"},attrs:{"active-text":"自动刷新价格","inactive-text":""},on:{change:t.toggleAutoRefresh},model:{value:t.autoRefreshPrices,callback:function(e){t.autoRefreshPrices=e},expression:"autoRefreshPrices"}})],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingPositions,expression:"loadingPositions"}],attrs:{data:t.monitoredPositions,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa"},"max-height":"500"}},[s("el-table-column",{attrs:{label:"交易对",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("span",{staticStyle:{"font-weight":"600"}},[t._v(t._s(a.symbol))])]}}])}),s("el-table-column",{attrs:{label:"交易所",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{size:"mini",effect:"plain"}},[t._v(t._s((a.exchange||"").toUpperCase()))])]}}])}),s("el-table-column",{attrs:{label:"方向",width:"60",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{type:"LONG"===a.position_side?"success":"danger",size:"mini",effect:"dark"}},[t._v(" "+t._s("LONG"===a.position_side?"多":"空")+" ")])]}}])}),s("el-table-column",{attrs:{label:"数量",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(s.quantity))]}}])}),s("el-table-column",{attrs:{label:"入场价",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.entry_price?s("span",[t._v(t._s(t.fmtPrice(a.entry_price)))]):s("span",{staticClass:"muted"},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"实时价格",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t.priceMap[a.symbol]?s("span",{style:t.pnlColor(a)},[s("b",[t._v(t._s(t.fmtPrice(t.priceMap[a.symbol])))])]):s("span",{staticClass:"muted"},[t._v(t._s(t.loadingPrices?"加载中...":"未获取"))])]}}])}),s("el-table-column",{attrs:{label:"浮动盈亏",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t.priceMap[a.symbol]&&a.entry_price?s("span",{style:t.pnlColor(a)},[t._v(" "+t._s(t.calcPnlPct(a))+" ")]):s("span",{staticClass:"muted"},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"止损",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.stop_loss?s("span",{staticStyle:{color:"#F56C6C","font-weight":"600"}},[t._v(t._s(t.fmtPrice(a.stop_loss)))]):s("span",{staticClass:"muted"},[t._v("未设置")])]}}])}),s("el-table-column",{attrs:{label:"止盈",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.take_profit?s("span",{staticStyle:{color:"#67C23A","font-weight":"600"}},[t._v(t._s(t.fmtPrice(a.take_profit)))]):s("span",{staticClass:"muted"},[t._v("未设置")])]}}])}),s("el-table-column",{attrs:{label:"杠杆",width:"55",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(s.leverage||"-")+"x")]}}])}),s("el-table-column",{attrs:{label:"策略",width:"130","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.strategy_code?s("span",[t._v(t._s(a.strategy_code))]):s("span",{staticClass:"muted"},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"用户",width:"150","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.user_email?s("span",[t._v(t._s(a.user_email))]):s("span",{staticClass:"muted"},[t._v("账户#"+t._s(a.account_id))])]}}])})],1),t.loadingPositions||0!==t.monitoredPositions.length?t._e():s("el-empty",{attrs:{description:"当前没有被监控的持仓","image-size":60}})],1)],1),s("el-tab-pane",{attrs:{label:"信号冷却",name:"cooldown"}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("当前冷却中的策略-币对")]),s("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:t.loadingPM},on:{click:t.fetchPMStatus}},[t._v("刷新")])],1),s("el-table",{attrs:{data:t.pmCooldowns,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa"}}},[s("el-table-column",{attrs:{prop:"strategy",label:"策略",width:"220"}}),s("el-table-column",{attrs:{prop:"symbol",label:"交易对",width:"140"}}),s("el-table-column",{attrs:{label:"剩余冷却",width:"120",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{type:"warning",size:"small",effect:"dark"}},[t._v(t._s(a.remaining_minutes)+" 分钟")])]}}])}),s("el-table-column",{attrs:{prop:"cooldown_until",label:"冷却截止"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(t.fmtDT(s.cooldown_until)))]}}])})],1),0===t.pmCooldowns.length?s("el-empty",{attrs:{description:"当前没有冷却中的策略","image-size":60}}):t._e()],1)],1)],1)],1)},i=[],n=(s("e9c4"),s("0643"),s("fffc"),s("4e3e"),s("a573"),s("0f66")),l={name:"SyncManage",data(){return{activeTab:"monitor",nodes:[],balanceNodeId:null,positionNodeId:null,syncingBalance:!1,syncingPositions:!1,syncingTrades:!1,syncingMarkets:!1,balanceResult:null,positionResult:null,tradesResult:null,marketsResult:null,tradesNodeId:null,marketExchange:null,marketType:"swap",syncHistory:[],loadingPM:!1,pmError:null,pmStatus:{enabled:!1},pmStats:{},pmConfig:{},pmCooldowns:[],monitoredPositions:[],loadingPositions:!1,scanning:!1,priceMap:{},loadingPrices:!1,autoRefreshPrices:!1,priceTimer:null}},mounted(){this.fetchNodes(),this.loadHistory(),this.fetchPMStatus(),this.fetchMonitoredPositions()},beforeDestroy(){this.stopAutoRefresh()},methods:{fmtDT(t){if(!t)return"-";try{return new Date(t).toLocaleString("zh-CN")}catch{return t}},fmtPrice(t){if(null==t)return"-";const e=Number(t);return isNaN(e)?t:e>=100?e.toFixed(2):e>=1?e.toFixed(4):e.toFixed(6)},pnlColor(t){const e=this.priceMap[t.symbol],s=Number(t.entry_price);if(!e||!s)return"";const a="LONG"===t.position_side,i=a?e>s:e<s;return i?"color:#67C23A;font-weight:600":"color:#F56C6C;font-weight:600"},calcPnlPct(t){const e=this.priceMap[t.symbol],s=Number(t.entry_price);if(!e||!s||0===s)return"-";const a="LONG"===t.position_side,i=a?(e-s)/s*100:(s-e)/s*100,n=i>=0?"+":"";return n+i.toFixed(2)+"%"},syncTypeLabel(t){return{balance:"余额",position:"持仓",trades:"成交",markets:"市场"}[t]||t},syncTypeTag(t){return{balance:"primary",position:"success",trades:"warning",markets:""}[t]||"info"},async fetchNodes(){try{const t=await Object(n["f"])();this.nodes=t.data.data||[]}catch(t){this.$message.error("获取节点列表失败")}},async handleSyncBalance(){if(!this.balanceNodeId)return void this.$message.warning("请选择目标节点");this.syncingBalance=!0,this.balanceResult=null;const t=this.nodes.find(t=>t.id===this.balanceNodeId),e=t?`${t.name} (${t.node_code})`:"未知",s=new Date;try{await Object(n["i"])({node_id:this.balanceNodeId}),this.balanceResult={success:!0,message:"余额同步完成"},this.addHistory("balance",e,"余额同步完成",!0,s),this.$message.success("余额同步完成")}catch(i){var a;const t="同步失败: "+((null===(a=i.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||i.message);this.balanceResult={success:!1,message:t},this.addHistory("balance",e,t,!1,s)}finally{this.syncingBalance=!1}},async handleSyncPositions(){if(!this.positionNodeId)return void this.$message.warning("请选择目标节点");this.syncingPositions=!0,this.positionResult=null;const t=this.nodes.find(t=>t.id===this.positionNodeId),e=t?`${t.name} (${t.node_code})`:"未知",s=new Date;try{await Object(n["k"])({node_id:this.positionNodeId}),this.positionResult={success:!0,message:"持仓同步完成"},this.addHistory("position",e,"持仓同步完成",!0,s),this.$message.success("持仓同步完成")}catch(i){var a;const t="同步失败: "+((null===(a=i.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||i.message);this.positionResult={success:!1,message:t},this.addHistory("position",e,t,!1,s)}finally{this.syncingPositions=!1}},async handleSyncTrades(){this.syncingTrades=!0,this.tradesResult=null;const t=this.tradesNodeId?this.nodes.find(t=>t.id===this.tradesNodeId):null,e=t?`${t.name} (${t.node_code})`:"全部节点",s=new Date;try{const t={};this.tradesNodeId&&(t.node_id=this.tradesNodeId),await Object(n["l"])(t),this.tradesResult={success:!0,message:"成交同步完成"},this.addHistory("trades",e,"成交同步完成",!0,s),this.$message.success("成交同步完成")}catch(i){var a;const t="同步失败: "+((null===(a=i.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||i.message);this.tradesResult={success:!1,message:t},this.addHistory("trades",e,t,!1,s)}finally{this.syncingTrades=!1}},async handleSyncMarkets(){this.syncingMarkets=!0,this.marketsResult=null;const t=new Date,e=this.marketExchange?this.marketExchange.toUpperCase():"全部";try{const s={market_type:this.marketType};this.marketExchange&&(s.exchange=this.marketExchange),await Object(n["j"])(s),this.marketsResult={success:!0,message:`市场信息同步完成 (${e})`},this.addHistory("markets",e,"市场信息同步完成",!0,t),this.$message.success("市场信息同步完成")}catch(a){var s;const i="同步失败: "+((null===(s=a.response)||void 0===s||null===(s=s.data)||void 0===s?void 0:s.detail)||a.message);this.marketsResult={success:!1,message:i},this.addHistory("markets",e,i,!1,t)}finally{this.syncingMarkets=!1}},addHistory(t,e,s,a,i){this.syncHistory.unshift({type:t,node_name:e,message:s,success:a,time:i.toISOString()}),this.syncHistory.length>50&&(this.syncHistory=this.syncHistory.slice(0,50)),this.saveHistory()},saveHistory(){try{localStorage.setItem("sync_history",JSON.stringify(this.syncHistory))}catch{}},loadHistory(){try{const t=localStorage.getItem("sync_history");t&&(this.syncHistory=JSON.parse(t))}catch{}},clearHistory(){this.$confirm("确定清空所有同步历史记录吗？","提示",{type:"warning"}).then(()=>{this.syncHistory=[],this.saveHistory(),this.$message.success("已清空")}).catch(()=>{})},refreshPM(){this.fetchPMStatus(),this.fetchMonitoredPositions()},async fetchPMStatus(){this.loadingPM=!0,this.pmError=null;try{const t=await Object(n["g"])(),e=t.data||{},s=e.config||{};this.pmStatus={enabled:!0===s.position_monitor},this.pmStats=e.position_monitor_stats||{},this.pmConfig={interval:s.position_monitor_interval||s.interval_seconds||"-",syncInterval:s.sync_interval_seconds||"-",strategiesCount:s.strategies_count||0,exchangeSlTp:s.exchange_sl_tp||!1},this.pmCooldowns=e.cooldowns||[]}catch(e){var t;this.pmError="无法获取持仓监控状态："+((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||e.message||"服务不可达"),this.pmStatus={enabled:!1},this.pmStats={},this.pmConfig={},this.pmCooldowns=[]}finally{this.loadingPM=!1}},async fetchMonitoredPositions(){this.loadingPositions=!0;try{const t=await Object(n["d"])();this.monitoredPositions=t.data.data||[],this.monitoredPositions.length>0&&this.fetchPrices()}catch(t){this.monitoredPositions=[]}finally{this.loadingPositions=!1}},async handleTriggerScan(){this.scanning=!0;try{const e=await Object(n["m"])(),s=e.data||{};var t;if(s.success)this.$message.success("扫描完成，监控持仓: "+((null===(t=s.data)||void 0===t?void 0:t.positions_monitored)||0)),this.fetchPMStatus(),this.fetchMonitoredPositions();else this.$message.warning(s.message||s.error||"扫描未成功")}catch(s){var e;this.$message.error("手动扫描失败: "+((null===(e=s.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||s.message))}finally{this.scanning=!1}},async fetchPrices(){if(0!==this.monitoredPositions.length){this.loadingPrices=!0;try{const t=[...new Set(this.monitoredPositions.map(t=>t.symbol))].join(","),e=await Object(n["h"])(t),s=(e.data||{}).prices||{},a={};Object.keys(s).forEach(t=>{s[t]&&s[t].last&&(a[t]=s[t].last)}),this.priceMap=a}catch(t){}finally{this.loadingPrices=!1}}},toggleAutoRefresh(t){t?(this.fetchPrices(),this.priceTimer=setInterval(()=>{this.fetchPrices()},1e4)):this.stopAutoRefresh()},stopAutoRefresh(){this.priceTimer&&(clearInterval(this.priceTimer),this.priceTimer=null),this.autoRefreshPrices=!1}}},o=l,r=(s("20e8"),s("2877")),c=Object(r["a"])(o,a,i,!1,null,"4b82d862",null);e["default"]=c.exports}}]);