(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-91c27650"],{"0f66":function(e,t,s){"use strict";s.d(t,"d",(function(){return o})),s.d(t,"a",(function(){return i})),s.d(t,"g",(function(){return l})),s.d(t,"b",(function(){return c})),s.d(t,"c",(function(){return r})),s.d(t,"e",(function(){return d})),s.d(t,"f",(function(){return u}));var n=s("bc3a"),a=s.n(n);function o(e={}){return a.a.get("/nodes",{params:e})}function i(e){return a.a.post("/nodes",e)}function l(e,t){return a.a.put("/nodes/"+e,t)}function c(e){return a.a.delete("/nodes/"+e)}function r(e){return a.a.get(`/nodes/${e}/accounts`)}function d(e={}){return a.a.post("/sync/balance",e)}function u(e={}){return a.a.post("/sync/positions",e)}},4738:function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ele-body"},[s("el-row",{attrs:{gutter:16}},[s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[e._v("余额同步")])]),s("el-form",{attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点",clearable:""},model:{value:e.balanceNodeId,callback:function(t){e.balanceNodeId=t},expression:"balanceNodeId"}},e._l(e.nodes,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name+" ("+e.node_code+")",value:e.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",loading:e.syncingBalance},on:{click:e.handleSyncBalance}},[e._v("同步余额")])],1)],1),e.balanceResult?s("div",{staticClass:"result"},[s("el-alert",{attrs:{title:e.balanceResult.message,type:e.balanceResult.success?"success":"error",closable:!1,"show-icon":""}})],1):e._e()],1)],1),s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[e._v("持仓同步")])]),s("el-form",{attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点",clearable:""},model:{value:e.positionNodeId,callback:function(t){e.positionNodeId=t},expression:"positionNodeId"}},e._l(e.nodes,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name+" ("+e.node_code+")",value:e.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",loading:e.syncingPositions},on:{click:e.handleSyncPositions}},[e._v("同步持仓")])],1)],1),e.positionResult?s("div",{staticClass:"result"},[s("el-alert",{attrs:{title:e.positionResult.message,type:e.positionResult.success?"success":"error",closable:!1,"show-icon":""}})],1):e._e()],1)],1)],1),s("el-card",{staticStyle:{"margin-top":"16px"},attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[e._v("同步历史")]),s("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.clearHistory}},[e._v("清空历史")])],1),s("el-table",{attrs:{data:e.syncHistory,stripe:"",border:"",size:"small","max-height":"400"}},[s("el-table-column",{attrs:{prop:"type",label:"类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[s("el-tag",{attrs:{type:"balance"===n.type?"primary":"success",size:"mini"}},[e._v(" "+e._s("balance"===n.type?"余额同步":"持仓同步")+" ")])]}}])}),s("el-table-column",{attrs:{prop:"node_name",label:"目标节点",width:"200"}}),s("el-table-column",{attrs:{prop:"message",label:"结果"}}),s("el-table-column",{attrs:{prop:"time",label:"时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[e._v(" "+e._s(e.formatDateTime(s.time))+" ")]}}])}),s("el-table-column",{attrs:{label:"状态",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[s("el-tag",{attrs:{type:n.success?"success":"danger",size:"mini"}},[e._v(" "+e._s(n.success?"成功":"失败")+" ")])]}}])})],1),0===e.syncHistory.length?s("el-empty",{attrs:{description:"暂无同步记录"}}):e._e()],1)],1)},a=[],o=(s("e9c4"),s("0643"),s("fffc"),s("0f66")),i={name:"SyncManage",data(){return{nodes:[],balanceNodeId:null,positionNodeId:null,syncingBalance:!1,syncingPositions:!1,balanceResult:null,positionResult:null,syncHistory:[]}},mounted(){this.fetchNodes(),this.loadHistory()},methods:{async fetchNodes(){try{const e=await Object(o["d"])();this.nodes=e.data.data||[]}catch(e){this.$message.error("获取节点列表失败")}},async handleSyncBalance(){if(!this.balanceNodeId)return void this.$message.warning("请选择目标节点");this.syncingBalance=!0,this.balanceResult=null;const e=this.nodes.find(e=>e.id===this.balanceNodeId),t=e?`${e.name} (${e.node_code})`:"未知节点",s=new Date;try{await Object(o["e"])({node_id:this.balanceNodeId});const e={success:!0,message:"余额同步完成"};this.balanceResult=e,this.addHistory("balance",t,e.message,!0,s),this.$message.success("余额同步完成")}catch(a){var n;const e=(null===(n=a.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.detail)||a.message||"同步失败",o={success:!1,message:"同步失败: "+e};this.balanceResult=o,this.addHistory("balance",t,o.message,!1,s),this.$message.error("余额同步失败")}finally{this.syncingBalance=!1}},async handleSyncPositions(){if(!this.positionNodeId)return void this.$message.warning("请选择目标节点");this.syncingPositions=!0,this.positionResult=null;const e=this.nodes.find(e=>e.id===this.positionNodeId),t=e?`${e.name} (${e.node_code})`:"未知节点",s=new Date;try{await Object(o["f"])({node_id:this.positionNodeId});const e={success:!0,message:"持仓同步完成"};this.positionResult=e,this.addHistory("position",t,e.message,!0,s),this.$message.success("持仓同步完成")}catch(a){var n;const e=(null===(n=a.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.detail)||a.message||"同步失败",o={success:!1,message:"同步失败: "+e};this.positionResult=o,this.addHistory("position",t,o.message,!1,s),this.$message.error("持仓同步失败")}finally{this.syncingPositions=!1}},addHistory(e,t,s,n,a){this.syncHistory.unshift({type:e,node_name:t,message:s,success:n,time:a.toISOString()}),this.syncHistory.length>50&&(this.syncHistory=this.syncHistory.slice(0,50)),this.saveHistory()},formatDateTime(e){return e?new Date(e).toLocaleString("zh-CN"):"-"},saveHistory(){try{localStorage.setItem("sync_history",JSON.stringify(this.syncHistory))}catch(e){console.error("保存同步历史失败",e)}},loadHistory(){try{const e=localStorage.getItem("sync_history");e&&(this.syncHistory=JSON.parse(e))}catch(e){console.error("加载同步历史失败",e)}},clearHistory(){this.$confirm("确定清空所有同步历史记录吗？","提示",{type:"warning"}).then(()=>{this.syncHistory=[],this.saveHistory(),this.$message.success("已清空历史记录")}).catch(()=>{})}}},l=i,c=(s("b825"),s("2877")),r=Object(c["a"])(l,n,a,!1,null,"5ecba906",null);t["default"]=r.exports},b825:function(e,t,s){"use strict";s("fcd4f")},fcd4f:function(e,t,s){}}]);