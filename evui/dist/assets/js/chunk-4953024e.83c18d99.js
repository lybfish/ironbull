(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4953024e"],{"50fc":function(t,e,n){"use strict";n.d(e,"o",(function(){return s})),n.d(e,"f",(function(){return i})),n.d(e,"B",(function(){return o})),n.d(e,"y",(function(){return l})),n.d(e,"s",(function(){return c})),n.d(e,"b",(function(){return u})),n.d(e,"n",(function(){return d})),n.d(e,"g",(function(){return f})),n.d(e,"C",(function(){return m})),n.d(e,"d",(function(){return p})),n.d(e,"h",(function(){return h})),n.d(e,"r",(function(){return g})),n.d(e,"p",(function(){return _})),n.d(e,"t",(function(){return v})),n.d(e,"q",(function(){return y})),n.d(e,"v",(function(){return b})),n.d(e,"i",(function(){return w})),n.d(e,"e",(function(){return x})),n.d(e,"z",(function(){return C})),n.d(e,"w",(function(){return S})),n.d(e,"u",(function(){return k})),n.d(e,"l",(function(){return N})),n.d(e,"m",(function(){return $})),n.d(e,"A",(function(){return D})),n.d(e,"x",(function(){return T})),n.d(e,"j",(function(){return L})),n.d(e,"k",(function(){return U})),n.d(e,"a",(function(){return F})),n.d(e,"c",(function(){return P}));var a=n("bc3a"),r=n.n(a);function s(t={}){return r.a.get("/tenants",{params:t})}function i(t){return r.a.post("/tenants",t)}function o(t,e){return r.a.put("/tenants/"+t,e)}function l(t){return r.a.patch(`/tenants/${t}/toggle`)}function c(t,e){return r.a.post(`/tenants/${t}/recharge`,e)}function u(t,e){return r.a.post(`/tenants/${t}/assign-plan`,{plan_id:e})}function d(t,e={}){return r.a.get(`/tenants/${t}/tenant-strategies`,{params:e})}function f(t,e){return r.a.post(`/tenants/${t}/tenant-strategies`,e)}function m(t,e,n){return r.a.put(`/tenants/${t}/tenant-strategies/${e}`,n)}function p(t,e){return r.a.post(`/tenants/${t}/tenant-strategies/${e}/copy-from-master`)}function h(t,e){return r.a.delete(`/tenants/${t}/tenant-strategies/${e}`)}function g(t={}){return r.a.get("/users",{params:t})}function _(t){return r.a.get("/users/"+t)}function v(t,e){return r.a.post(`/users/${t}/recharge`,e)}function y(t,e={}){return r.a.get(`/users/${t}/team`,{params:e})}function b(t,e){return r.a.post(`/users/${t}/set-market-node`,e)}function w(t={}){return r.a.get("/admins",{params:t})}function x(t){return r.a.post("/admins",t)}function C(t,e){return r.a.put("/admins/"+t,e)}function S(t){return r.a.patch(`/admins/${t}/toggle`)}function k(t,e){return r.a.post(`/admins/${t}/reset-password`,e)}function N(t={}){return r.a.get("/strategies",{params:t})}function $(t){return r.a.get("/strategies/"+t)}function D(t,e){return r.a.post("/strategies/"+t,e)}function T(t){return r.a.patch(`/strategies/${t}/toggle`)}function L(t={}){return r.a.get("/strategy-bindings-admin",{params:t})}function U(t={}){return r.a.get("/exchange-accounts",{params:t})}function F(t,e){return r.a.put(`/exchange-accounts/${t}/assign-node`,e)}function P(t){return r.a.post("/exchange-accounts/batch-assign-node",t)}},"534c":function(t,e,n){},8012:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return l})),n.d(e,"d",(function(){return c})),n.d(e,"a",(function(){return u})),n.d(e,"e",(function(){return d}));var a=n("bc3a"),r=n.n(a);let s={tenant_id:1};function i(t){return{...s,...t}}function o(t={}){return r.a.get("/orders",{params:i({limit:50,...t})})}function l(t={}){return r.a.get("/fills",{params:i({limit:50,...t})})}function c(t={}){return r.a.get("/positions",{params:i({limit:100,...t})})}function u(t={}){return r.a.get("/accounts",{params:i({limit:50,...t})})}function d(t={}){return r.a.get("/transactions",{params:i({limit:50,...t})})}},9704:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ele-body"},[n("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[n("el-col",{attrs:{lg:4,md:8,sm:12}},[n("stat-card",{attrs:{title:"总持仓数",value:t.stats.totalCount,icon:"el-icon-s-data",color:"primary",loading:t.loading},scopedSlots:t._u([{key:"footer",fn:function(){return[n("span",{staticClass:"ele-text-secondary"},[t._v("活跃仓位")])]},proxy:!0}])})],1),n("el-col",{attrs:{lg:4,md:8,sm:12}},[n("stat-card",{attrs:{title:"总名义价值",icon:"el-icon-coin",color:"warning",loading:t.loading},scopedSlots:t._u([{key:"value",fn:function(){return[n("span",[t._v(t._s(t.formatMoney(t.stats.totalNotional)))])]},proxy:!0},{key:"footer",fn:function(){return[n("span",{staticClass:"ele-text-secondary"},[t._v("USDT")])]},proxy:!0}])})],1),n("el-col",{attrs:{lg:4,md:8,sm:12}},[n("stat-card",{attrs:{title:"未实现盈亏",icon:"el-icon-data-analysis",color:t.stats.totalPnl>=0?"success":"danger",loading:t.loading},scopedSlots:t._u([{key:"value",fn:function(){return[n("span",{class:t.stats.totalPnl>=0?"text-success":"text-danger"},[t._v(" "+t._s(t.stats.totalPnl>=0?"+":"")+t._s(t.formatMoney(t.stats.totalPnl))+" ")])]},proxy:!0}])})],1),n("el-col",{attrs:{lg:4,md:8,sm:12}},[n("stat-card",{attrs:{title:"多头仓位",value:t.stats.longCount,icon:"el-icon-top",color:"success",loading:t.loading},scopedSlots:t._u([{key:"footer",fn:function(){return[n("span",{staticClass:"ele-text-secondary"},[t._v("做多")])]},proxy:!0}])})],1),n("el-col",{attrs:{lg:4,md:8,sm:12}},[n("stat-card",{attrs:{title:"空头仓位",value:t.stats.shortCount,icon:"el-icon-bottom",color:"danger",loading:t.loading},scopedSlots:t._u([{key:"footer",fn:function(){return[n("span",{staticClass:"ele-text-secondary"},[t._v("做空")])]},proxy:!0}])})],1),n("el-col",{attrs:{lg:4,md:8,sm:12}},[n("stat-card",{attrs:{title:"盈亏比",icon:"el-icon-pie-chart",color:"info",loading:t.loading},scopedSlots:t._u([{key:"value",fn:function(){return[n("span",[n("span",{staticClass:"text-success"},[t._v(t._s(t.stats.profitCount))]),n("span",{staticStyle:{color:"#C0C4CC",margin:"0 4px"}},[t._v("/")]),n("span",{staticClass:"text-danger"},[t._v(t._s(t.stats.lossCount))])])]},proxy:!0},{key:"footer",fn:function(){return[n("span",{staticClass:"ele-text-secondary"},[t._v("盈利 / 亏损")])]},proxy:!0}])})],1)],1),n("el-card",{attrs:{shadow:"never"}},[n("div",{staticClass:"toolbar"},[n("span",{staticClass:"toolbar-title"},[t._v("当前持仓")])]),n("div",{staticClass:"search-bar"},[n("el-form",{staticClass:"search-form",attrs:{inline:!0,model:t.where,size:"small"}},[n("el-form-item",{attrs:{label:"标的"}},[n("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"如 BTC/USDT",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.fetchData.apply(null,arguments)}},model:{value:t.where.symbol,callback:function(e){t.$set(t.where,"symbol",e)},expression:"where.symbol"}})],1),n("el-form-item",{attrs:{label:"方向"}},[n("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"全部",clearable:""},model:{value:t.where.position_side,callback:function(e){t.$set(t.where,"position_side",e)},expression:"where.position_side"}},[n("el-option",{attrs:{label:"多头",value:"long"}}),n("el-option",{attrs:{label:"空头",value:"short"}})],1)],1),n("el-form-item",{attrs:{label:"交易所"}},[n("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"全部",clearable:""},model:{value:t.where.exchange,callback:function(e){t.$set(t.where,"exchange",e)},expression:"where.exchange"}},t._l(t.exchangeOptions,(function(t){return n("el-option",{key:t,attrs:{label:t.toUpperCase(),value:t}})})),1)],1),n("el-form-item",{attrs:{label:"账户"}},[n("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:"全部",clearable:""},model:{value:t.where.account_id,callback:function(e){t.$set(t.where,"account_id",e)},expression:"where.account_id"}},t._l(t.accountOptions,(function(t){return n("el-option",{key:t.id,attrs:{label:"["+(t.exchange||"").toUpperCase()+"] #"+t.id,value:t.id}})})),1)],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.fetchData}},[t._v("查询")]),n("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:t.resetQuery}},[t._v("重置")])],1)],1)],1),n("div",{staticClass:"operation-bar"},[n("el-button",{attrs:{size:"small",icon:"el-icon-refresh",loading:t.loading},on:{click:t.fetchData}},[t._v("刷新")]),n("el-divider",{attrs:{direction:"vertical"}}),n("el-switch",{staticStyle:{"margin-right":"8px"},attrs:{"active-text":"自动刷新","inactive-text":""},on:{change:t.handleAutoRefreshChange},model:{value:t.autoRefresh,callback:function(e){t.autoRefresh=e},expression:"autoRefresh"}}),t.lastUpdateTime?n("span",{staticClass:"last-update"},[n("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.lastUpdateTime)+" ")]):t._e(),t.total>0?n("span",{staticClass:"total-tip",staticStyle:{"margin-left":"auto"}},[t._v("共 "),n("b",[t._v(t._s(t.total))]),t._v(" 条持仓")]):t._e()],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.filteredList,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa",color:"#606266"},"row-class-name":t.rowClassName}},[n("el-table-column",{attrs:{prop:"symbol",label:"标的",width:"120",fixed:""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("span",{staticClass:"symbol-text"},[t._v(t._s(a.symbol))])]}}])}),n("el-table-column",{attrs:{prop:"exchange",label:"交易所",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("el-tag",{attrs:{size:"mini",effect:"plain"}},[t._v(t._s((a.exchange||"").toUpperCase()))])]}}])}),n("el-table-column",{attrs:{prop:"account_id",label:"账户",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("span",{staticClass:"text-muted"},[t._v("#"+t._s(a.account_id))])]}}])}),n("el-table-column",{attrs:{label:"方向",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("el-tag",{attrs:{type:t.isLong(a)?"success":"danger",size:"mini",effect:"dark"}},[t._v(" "+t._s(t.isLong(a)?"多":"空")+" ")])]}}])}),n("el-table-column",{attrs:{prop:"quantity",label:"数量",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v(" "+t._s(t.formatNum(n.quantity))+" ")]}}])}),n("el-table-column",{attrs:{label:"开仓均价",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v(" "+t._s(t.formatPrice(n.avg_cost))+" ")]}}])}),n("el-table-column",{attrs:{label:"名义价值",width:"130",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v(" "+t._s(t.formatMoney(t.calcNotional(n)))+" ")]}}])}),n("el-table-column",{attrs:{prop:"leverage",label:"杠杆",width:"75",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("el-tag",{attrs:{size:"mini",type:"warning",effect:"plain"}},[t._v(t._s(a.leverage||"-")+"x")])]}}])}),n("el-table-column",{attrs:{label:"未实现盈亏",width:"140",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("div",{staticClass:"pnl-cell"},[n("span",{staticClass:"pnl-value",class:t.pnlClass(a.unrealized_pnl)},[t._v(" "+t._s(t.formatPnl(a.unrealized_pnl))+" ")]),null!==t.pnlPercent(a)?n("span",{staticClass:"pnl-percent",class:t.pnlClass(a.unrealized_pnl)},[t._v(" ("+t._s(t.pnlPercent(a))+") ")]):t._e()])]}}])}),n("el-table-column",{attrs:{prop:"liquidation_price",label:"强平价",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.liquidation_price?n("span",{staticClass:"liq-price"},[t._v(t._s(t.formatPrice(a.liquidation_price)))]):n("span",{staticClass:"text-muted"},[t._v("-")])]}}])}),n("el-table-column",{attrs:{label:"开仓时间",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v(" "+t._s(t.formatTime(n.opened_at))+" ")]}}])}),n("el-table-column",{attrs:{prop:"updated_at",label:"更新时间","min-width":"170"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v(" "+t._s(t.formatTime(n.updated_at))+" ")]}}])})],1),t.loading||0!==t.filteredList.length?t._e():n("el-empty",{attrs:{description:"暂无持仓数据"}})],1)],1)},r=[],s=(n("0643"),n("2382"),n("4e3e"),n("8012")),i=n("50fc"),o={name:"PositionList",data(){return{loading:!1,list:[],total:0,where:{symbol:"",position_side:"",exchange:"",account_id:""},autoRefresh:!1,refreshTimer:null,lastUpdateTime:"",accountOptions:[]}},computed:{exchangeOptions(){const t=new Set;return this.list.forEach(e=>{e.exchange&&t.add(e.exchange)}),this.accountOptions.forEach(e=>{e.exchange&&t.add(e.exchange)}),Array.from(t).sort()},filteredList(){return this.list.filter(t=>{if(this.where.position_side){const e=(t.position_side||t.side||"").toLowerCase();if(e!==this.where.position_side)return!1}return(!this.where.exchange||(t.exchange||"").toLowerCase()===this.where.exchange.toLowerCase())&&(!this.where.account_id||t.account_id===this.where.account_id)})},stats(){const t=this.filteredList;let e=0,n=0,a=0,r=0,s=0,i=0;return t.forEach(t=>{e+=this.calcNotional(t);const o=Number(t.unrealized_pnl)||0;n+=o,this.isLong(t)?a++:r++,o>=0?s++:i++}),{totalCount:t.length,totalNotional:e,totalPnl:n,longCount:a,shortCount:r,profitCount:s,lossCount:i}}},mounted(){this.fetchData(),this.fetchAccounts()},beforeDestroy(){this.clearTimer()},methods:{async fetchData(){this.loading=!0;try{const t={has_position:!0};this.where.symbol&&(t.symbol=this.where.symbol);const e=await Object(s["d"])(t);this.list=e.data.data||[],this.total=e.data.total||this.list.length,this.lastUpdateTime=this.nowStr()}catch(t){this.$message.error("获取持仓失败")}finally{this.loading=!1}},async fetchAccounts(){try{const t=await Object(i["k"])({status:1});this.accountOptions=t.data.data||t.data||[]}catch(t){}},resetQuery(){this.where={symbol:"",position_side:"",exchange:"",account_id:""},this.fetchData()},calcNotional(t){const e=Number(t.quantity)||0,n=Number(t.avg_cost)||0;return e*n},handleAutoRefreshChange(t){t?(this.startTimer(),this.$message.success("已开启自动刷新（30秒）")):(this.clearTimer(),this.$message.info("已关闭自动刷新"))},startTimer(){this.clearTimer(),this.refreshTimer=setInterval(()=>{this.fetchData()},3e4)},clearTimer(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)},isLong(t){const e=(t.position_side||t.side||"").toLowerCase();return"long"===e},formatPrice(t){if(null===t||void 0===t||""===t||0===t)return"-";const e=Number(t);return isNaN(e)?t:e>=1e3?e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):e>=1?e.toLocaleString("en-US",{minimumFractionDigits:4,maximumFractionDigits:4}):e.toLocaleString("en-US",{minimumFractionDigits:6,maximumFractionDigits:8})},formatNum(t){if(null===t||void 0===t||""===t)return"-";const e=Number(t);return isNaN(e)?t:e.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:6})},formatMoney(t){if(null===t||void 0===t||""===t)return"-";const e=Number(t);return isNaN(e)?t:e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},formatPnl(t){if(null===t||void 0===t)return"-";const e=Number(t);if(isNaN(e))return t;const n=e>=0?"+":"";return n+e.toLocaleString("en-US",{minimumFractionDigits:4,maximumFractionDigits:4})},pnlPercent(t){const e=Number(t.unrealized_pnl),n=this.calcNotional(t);if(!n||isNaN(e)||isNaN(n))return null;const a=e/n*100,r=a>=0?"+":"";return r+a.toFixed(2)+"%"},pnlClass(t){const e=Number(t);return isNaN(e)||0===e?"text-muted":e>0?"text-success":"text-danger"},formatTime(t){if(!t)return"-";const e=new Date(t);if(isNaN(e.getTime()))return t;const n=t=>String(t).padStart(2,"0");return`${e.getFullYear()}-${n(e.getMonth()+1)}-${n(e.getDate())} ${n(e.getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}`},nowStr(){return this.formatTime(new Date)},rowClassName({row:t}){const e=Number(t.unrealized_pnl);return isNaN(e)?"":e>0?"row-profit":e<0?"row-loss":""}}},l=o,c=(n("d081"),n("2877")),u=Object(c["a"])(l,a,r,!1,null,"3d0a547c",null);e["default"]=u.exports},d081:function(t,e,n){"use strict";n("534c")}}]);