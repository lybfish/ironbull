(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-61c8578e"],{"1b3a":function(e,t,a){},"7cf8":function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return n}));var s=a("bc3a"),r=a.n(s);function l(){return r.a.get("/monitor/status")}function n(e={}){return r.a.get("/audit-logs",{params:e})}},9659:function(e,t,a){"use strict";a("1b3a")},b01f:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ele-body"},[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{shadow:"never"}},[a("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("系统监控")]),a("div",[a("el-tag",{staticStyle:{"margin-right":"12px"},attrs:{type:e.overallType,size:"small"}},[e._v(e._s(e.overallLabel))]),a("el-switch",{attrs:{"active-text":"自动刷新","inactive-text":"手动刷新"},on:{change:e.handleAutoRefreshChange},model:{value:e.autoRefresh,callback:function(t){e.autoRefresh=t},expression:"autoRefresh"}}),a("el-button",{staticStyle:{"margin-left":"12px"},attrs:{type:"primary",size:"mini",icon:"el-icon-refresh"},on:{click:e.fetchData}},[e._v("刷新")])],1)]),a("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:15}},[e._l(e.services,(function(t){return a("el-col",{key:t.name,attrs:{span:6}},[a("stat-card",{attrs:{title:t.name,value:t.healthy?"在线":"离线",icon:"el-icon-connection",color:t.healthy?"success":"danger","help-text":t.latency_ms?"响应 "+t.latency_ms+"ms":t.error||"未知",loading:e.loading}})],1)})),a("el-col",{attrs:{span:6}},[a("stat-card",{attrs:{title:"数据库",value:e.dbStatus.mysql_ok?"正常":"异常",icon:"el-icon-coin",color:e.dbStatus.mysql_ok?"success":"danger","help-text":"MySQL 连接状态",loading:e.loading}})],1),a("el-col",{attrs:{span:6}},[a("stat-card",{attrs:{title:"Redis",value:e.dbStatus.redis_ok?"正常":"异常",icon:"el-icon-box",color:e.dbStatus.redis_ok?"success":"danger","help-text":"Redis 连接状态",loading:e.loading}})],1)],2),a("el-card",{staticStyle:{"margin-bottom":"16px"},attrs:{shadow:"never"}},[a("div",{attrs:{slot:"header"},slot:"header"},[e._v("服务健康详情")]),a("el-table",{attrs:{data:e.services,stripe:"",border:"",size:"small"}},[a("el-table-column",{attrs:{prop:"name",label:"服务名",width:"180"}}),a("el-table-column",{attrs:{prop:"url",label:"健康检查地址","min-width":"250","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("el-tag",{attrs:{type:s.healthy?"success":"danger",size:"mini"}},[e._v(e._s(s.healthy?"健康":"异常"))])]}}])}),a("el-table-column",{attrs:{label:"延迟",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[s.latency_ms?a("span",[e._v(e._s(s.latency_ms)+"ms")]):a("span",{staticStyle:{color:"#909399"}},[e._v("-")])]}}])}),a("el-table-column",{attrs:{label:"错误","min-width":"200","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[s.error?a("span",{staticStyle:{color:"#F56C6C"}},[e._v(e._s(s.error))]):a("span",{staticStyle:{color:"#67C23A"}},[e._v("无")])]}}])})],1)],1),a("el-card",{staticStyle:{"margin-bottom":"16px"},attrs:{shadow:"never"}},[a("div",{attrs:{slot:"header"},slot:"header"},[e._v("基础设施")]),a("el-descriptions",{attrs:{column:4,border:"",size:"small"}},[a("el-descriptions-item",{attrs:{label:"MySQL"}},[a("el-tag",{attrs:{type:e.dbStatus.mysql_ok?"success":"danger",size:"mini"}},[e._v(e._s(e.dbStatus.mysql_ok?"正常":"异常"))])],1),a("el-descriptions-item",{attrs:{label:"Redis"}},[a("el-tag",{attrs:{type:e.dbStatus.redis_ok?"success":"danger",size:"mini"}},[e._v(e._s(e.dbStatus.redis_ok?"正常":"异常"))])],1),e.dbStatus.mysql_latency_ms?a("el-descriptions-item",{attrs:{label:"MySQL 延迟"}},[e._v(" "+e._s(e.dbStatus.mysql_latency_ms)+"ms ")]):e._e(),e.dbStatus.redis_latency_ms?a("el-descriptions-item",{attrs:{label:"Redis 延迟"}},[e._v(" "+e._s(e.dbStatus.redis_latency_ms)+"ms ")]):e._e()],1)],1)],1),e.nodes.length>0?a("el-card",{staticStyle:{"margin-top":"16px"},attrs:{shadow:"never"}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v("执行节点心跳")]),a("el-tag",{staticStyle:{"margin-left":"8px"},attrs:{size:"mini"}},[e._v(e._s(e.nodes.length)+" 个节点")])],1),a("el-table",{attrs:{data:e.nodes,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa"}}},[a("el-table-column",{attrs:{prop:"code",label:"节点编码",width:"150"}}),a("el-table-column",{attrs:{prop:"name",label:"节点名称",width:"150"}}),a("el-table-column",{attrs:{label:"状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("el-tag",{attrs:{type:s.online?"success":"danger",size:"mini"}},[e._v(" "+e._s(s.online?"在线":"离线")+" ")])]}}],null,!1,2673502133)}),a("el-table-column",{attrs:{label:"最后心跳",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(e.formatTime(a.last_heartbeat)))]}}],null,!1,2949088037)}),a("el-table-column",{attrs:{label:"延迟/超时",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[null!=s.seconds_since_heartbeat?a("span",[e._v(e._s(s.seconds_since_heartbeat)+"s")]):a("span",[e._v("-")])]}}],null,!1,241280005)})],1)],1):e.loading?e._e():a("el-card",{staticStyle:{"margin-top":"16px"},attrs:{shadow:"never"}},[a("el-empty",{attrs:{description:"暂无节点心跳数据"}})],1)],1)},r=[],l=a("7cf8"),n={name:"SystemMonitor",data(){return{loading:!1,overall:"",services:[],nodes:[],dbStatus:{mysql_ok:!1,redis_ok:!1},autoRefresh:!1,refreshTimer:null}},computed:{overallType(){return"healthy"===this.overall?"success":"degraded"===this.overall?"warning":"info"},overallLabel(){return"healthy"===this.overall?"系统正常":"degraded"===this.overall?"系统降级":"加载中..."}},mounted(){this.fetchData()},beforeDestroy(){this.clearRefreshTimer()},methods:{formatTime(e){return e?e.replace("T"," ").substring(0,19):"-"},async fetchData(){this.loading=!0;try{const e=await Object(l["b"])(),t=e.data.data||e.data||{};this.overall=t.overall||"",this.services=t.services||[],this.nodes=t.nodes||[],this.dbStatus=t.db||{mysql_ok:!1,redis_ok:!1}}catch(e){this.$message.error("获取监控状态失败"),console.error(e)}finally{this.loading=!1}},handleAutoRefreshChange(e){e?this.startAutoRefresh():this.clearRefreshTimer()},startAutoRefresh(){this.clearRefreshTimer(),this.refreshTimer=setInterval(()=>{this.fetchData()},3e4)},clearRefreshTimer(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)}}},o=n,i=(a("9659"),a("2877")),c=Object(i["a"])(o,s,r,!1,null,"1174833c",null);t["default"]=c.exports}}]);