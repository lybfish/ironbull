(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b32119f6"],{"8e8c":function(t,e,a){"use strict";a("916f")},"916f":function(t,e,a){},c93b:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ele-body"},[a("el-card",{attrs:{shadow:"never"}},[a("el-form",{staticClass:"ele-form-search",attrs:{model:t.where,"label-width":"100px"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.reload.apply(null,arguments)},submit:function(t){t.preventDefault()}}},[a("el-row",{attrs:{gutter:15}},[a("el-col",{attrs:{lg:6,md:12}},[a("el-form-item",{attrs:{label:"租户ID:"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入租户ID",type:"number"},model:{value:t.where.tenant_id,callback:function(e){t.$set(t.where,"tenant_id",e)},expression:"where.tenant_id"}})],1)],1),a("el-col",{attrs:{lg:6,md:12}},[a("el-form-item",{attrs:{label:"用户ID:"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入用户ID",type:"number"},model:{value:t.where.user_id,callback:function(e){t.$set(t.where,"user_id",e)},expression:"where.user_id"}})],1)],1),a("el-col",{attrs:{lg:6,md:12}},[a("el-form-item",{attrs:{label:"变动类型:"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择变动类型"},model:{value:t.where.change_type,callback:function(e){t.$set(t.where,"change_type",e)},expression:"where.change_type"}},[a("el-option",{attrs:{label:"充值",value:1}}),a("el-option",{attrs:{label:"赠送",value:2}}),a("el-option",{attrs:{label:"分发/转出",value:3}}),a("el-option",{attrs:{label:"转入",value:4}}),a("el-option",{attrs:{label:"盈利扣费",value:5}})],1)],1)],1),a("el-col",{attrs:{lg:12,md:12}},[a("el-form-item",{attrs:{label:"日期范围:"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},on:{change:t.handleDateRangeChange},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1)],1),a("el-col",{attrs:{lg:6,md:12}},[a("div",{staticClass:"ele-form-actions"},[a("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.reload}},[t._v("查询 ")]),a("el-button",{on:{click:t.reset}},[t._v("重置")])],1)])],1)],1),a("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[a("el-col",{attrs:{lg:8,md:12,sm:12}},[a("stat-card",{attrs:{title:"总记录数",value:t.summary.totalCount,icon:"el-icon-document",color:"primary","help-text":"当前查询条件下的记录总数",loading:t.loading}})],1),a("el-col",{attrs:{lg:8,md:12,sm:12}},[a("stat-card",{attrs:{title:"总正数金额",icon:"el-icon-arrow-up",color:"success","help-text":"所有正数金额的总和",loading:t.loading},scopedSlots:t._u([{key:"value",fn:function(){return[a("span",{staticStyle:{color:"#67C23A","font-weight":"bold"}},[t._v(" "+t._s(t.formatAmount(t.summary.totalPositive))+" ")])]},proxy:!0}])})],1),a("el-col",{attrs:{lg:8,md:12,sm:12}},[a("stat-card",{attrs:{title:"总负数金额",icon:"el-icon-arrow-down",color:"danger","help-text":"所有负数金额的总和",loading:t.loading},scopedSlots:t._u([{key:"value",fn:function(){return[a("span",{staticStyle:{color:"#F56C6C","font-weight":"bold"}},[t._v(" "+t._s(t.formatAmount(t.summary.totalNegative))+" ")])]},proxy:!0}])})],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:t.tableData,border:"",stripe:"",size:"small"}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",align:"center"}}),a("el-table-column",{attrs:{prop:"tenant_id",label:"租户ID",width:"100",align:"center"}}),a("el-table-column",{attrs:{prop:"user_email",label:"用户邮箱","min-width":"180",align:"left","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"change_type",label:"变动类型",width:"120",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-tag",{attrs:{type:t.getChangeTypeTagType(n.change_type),size:"mini"}},[t._v(" "+t._s(n.change_type_name||t.getChangeTypeName(n.change_type))+" ")])]}}])}),a("el-table-column",{attrs:{prop:"amount",label:"变动金额",width:"130",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",{style:{color:parseFloat(n.amount)>=0?"#67C23A":"#F56C6C",fontWeight:"bold"}},[t._v(" "+t._s(parseFloat(n.amount)>=0?"+":"")+t._s(n.amount)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"card_type",label:"卡类型",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.getCardTypeName(a.card_type))+" ")]}}])}),a("el-table-column",{attrs:{label:"自充余额",width:"150",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",{staticClass:"ele-text-secondary"},[t._v(t._s(n.before_self))]),a("span",{staticStyle:{margin:"0 5px"}},[t._v("→")]),a("span",[t._v(t._s(n.after_self))])]}}])}),a("el-table-column",{attrs:{label:"赠送余额",width:"150",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",{staticClass:"ele-text-secondary"},[t._v(t._s(n.before_gift))]),a("span",{staticStyle:{margin:"0 5px"}},[t._v("→")]),a("span",[t._v(t._s(n.after_gift))])]}}])}),a("el-table-column",{attrs:{prop:"remark",label:"备注","min-width":"200","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[n.remark?a("el-tooltip",{attrs:{content:n.remark,placement:"top",effect:"dark"}},[a("span",[t._v(t._s(n.remark))])]):a("span",{staticClass:"ele-text-secondary"},[t._v("-")])]}}])}),a("el-table-column",{attrs:{prop:"created_at",label:"创建时间",width:"180",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatDateTime(a.created_at))+" ")]}}])})],1),a("el-pagination",{staticStyle:{"margin-top":"15px","text-align":"right"},attrs:{"current-page":t.pagination.page,"page-sizes":[10,20,50,100],"page-size":t.pagination.page_size,layout:"total, sizes, prev, pager, next, jumper",total:t.pagination.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},r=[],l=(a("0643"),a("4e3e"),a("cd05")),o={name:"PointcardLogs",data(){return{where:{tenant_id:"",user_id:"",change_type:null,start_date:"",end_date:""},dateRange:null,tableData:[],loading:!1,pagination:{page:1,page_size:20,total:0},summary:{totalCount:0,totalPositive:0,totalNegative:0}}},created(){this.loadData()},methods:{async loadData(){this.loading=!0;try{const t={page:this.pagination.page,page_size:this.pagination.page_size};this.where.tenant_id&&(t.tenant_id=parseInt(this.where.tenant_id)),this.where.user_id&&(t.user_id=parseInt(this.where.user_id)),null!==this.where.change_type&&""!==this.where.change_type&&(t.change_type=this.where.change_type),this.where.start_date&&(t.start_date=this.where.start_date),this.where.end_date&&(t.end_date=this.where.end_date);const e=await Object(l["d"])(t);e.data.success?(this.tableData=Array.isArray(e.data.data)?e.data.data:[],this.pagination.total=e.data.total||0,this.calculateSummary()):(this.$message.error("获取点卡流水失败"),this.tableData=[],this.pagination.total=0)}catch(t){this.$message.error("获取点卡流水失败: "+(t.message||"未知错误")),this.tableData=[],this.pagination.total=0}finally{this.loading=!1}},calculateSummary(){this.summary.totalCount=this.pagination.total;let t=0,e=0;Array.isArray(this.tableData)&&this.tableData.forEach(a=>{const n=parseFloat(a.amount)||0;n>0?t+=n:n<0&&(e+=Math.abs(n))}),this.summary.totalPositive=t,this.summary.totalNegative=e},reload(){this.pagination.page=1,this.loadData()},reset(){this.where={tenant_id:"",user_id:"",change_type:null,start_date:"",end_date:""},this.dateRange=null,this.reload()},handleDateRangeChange(t){t&&2===t.length?(this.where.start_date=t[0],this.where.end_date=t[1]):(this.where.start_date="",this.where.end_date="")},handleSizeChange(t){this.pagination.page_size=t,this.loadData()},handleCurrentChange(t){this.pagination.page=t,this.loadData()},getChangeTypeName(t){const e={1:"充值",2:"赠送",3:"分发/转出",4:"转入",5:"盈利扣费"};return e[t]||String(t)},getChangeTypeTagType(t){const e={1:"success",2:"warning",3:"info",4:"primary",5:"danger"};return e[t]||""},getCardTypeName(t){if(!t)return"-";const e={self:"自充",gift:"赠送"};return e[t]||String(t)},formatAmount(t){return 0===t?"0.00":t.toFixed(2)},formatDateTime(t){if(!t)return"-";const e=new Date(t);if(isNaN(e.getTime()))return t;const a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),l=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return`${a}-${n}-${r} ${l}:${o}:${s}`}}},s=o,i=(a("8e8c"),a("2877")),c=Object(i["a"])(s,n,r,!1,null,"268be837",null);e["default"]=c.exports},cd05:function(t,e,a){"use strict";a.d(e,"e",(function(){return l})),a.d(e,"c",(function(){return o})),a.d(e,"j",(function(){return s})),a.d(e,"i",(function(){return i})),a.d(e,"g",(function(){return c})),a.d(e,"a",(function(){return u})),a.d(e,"h",(function(){return d})),a.d(e,"b",(function(){return p})),a.d(e,"d",(function(){return h})),a.d(e,"f",(function(){return g}));var n=a("bc3a"),r=a.n(n);function l(t={}){return r.a.get("/quota-plans",{params:t})}function o(t){return r.a.post("/quota-plans",t)}function s(t,e){return r.a.put("/quota-plans/"+t,e)}function i(t){return r.a.patch(`/quota-plans/${t}/toggle`)}function c(t={}){return r.a.get("/withdrawals",{params:t})}function u(t){return r.a.post(`/withdrawals/${t}/approve`)}function d(t,e=""){return r.a.post(`/withdrawals/${t}/reject`,{reason:e})}function p(t,e=""){return r.a.post(`/withdrawals/${t}/complete`,{tx_hash:e})}function h(t={}){return r.a.get("/pointcard-logs",{params:t})}function g(t={}){return r.a.get("/rewards",{params:t})}}}]);