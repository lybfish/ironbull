(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-12baa8ca"],{"3c73":function(t,e,a){"use strict";a("6692")},6692:function(t,e,a){},"8f6f":function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ele-body"},[a("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[a("el-col",{attrs:{lg:6,md:12,sm:12}},[a("stat-card",{attrs:{title:"待审核",value:t.stats.pendingCount,icon:"el-icon-bell",color:"warning","help-text":"当前待审核的提现申请数",loading:t.loading}})],1),a("el-col",{attrs:{lg:6,md:12,sm:12}},[a("stat-card",{attrs:{title:"待打款",value:t.stats.approvedCount,icon:"el-icon-wallet",color:"primary","help-text":"已审核通过待打款的提现数",loading:t.loading}})],1),a("el-col",{attrs:{lg:6,md:12,sm:12}},[a("stat-card",{attrs:{title:"累计提现",value:t.stats.totalAmount,icon:"el-icon-money",color:"success",format:"money",precision:2,"help-text":"所有提现申请的累计金额",loading:t.loading}},[a("template",{slot:"value"},[t._v(" $"+t._s(t.formatMoney(t.stats.totalAmount))+" ")])],2)],1),a("el-col",{attrs:{lg:6,md:12,sm:12}},[a("stat-card",{attrs:{title:"累计服务费",value:t.stats.totalFee,icon:"el-icon-coin",color:"danger",format:"money",precision:2,"help-text":"所有提现扣除的服务费总计",loading:t.loading}},[a("template",{slot:"value"},[t._v(" $"+t._s(t.formatMoney(t.stats.totalFee))+" ")])],2)],1)],1),a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"toolbar"},[a("el-select",{staticStyle:{width:"140px"},attrs:{placeholder:"提现状态",clearable:"",size:"small"},on:{change:t.handleSearch},model:{value:t.query.status,callback:function(e){t.$set(t.query,"status",e)},expression:"query.status"}},[a("el-option",{attrs:{label:"全部",value:""}}),a("el-option",{attrs:{label:"待审核",value:0}}),a("el-option",{attrs:{label:"已通过",value:1}}),a("el-option",{attrs:{label:"已拒绝",value:2}}),a("el-option",{attrs:{label:"已完成",value:3}})],1),a("el-input",{staticStyle:{width:"100px","margin-left":"8px"},attrs:{placeholder:"用户ID",clearable:"",size:"small"},on:{clear:t.handleSearch},model:{value:t.query.user_id,callback:function(e){t.$set(t.query,"user_id",e)},expression:"query.user_id"}}),a("el-date-picker",{staticStyle:{width:"280px","margin-left":"8px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd",size:"small"},on:{change:t.handleSearch},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}}),a("el-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary",size:"small",icon:"el-icon-search"},on:{click:t.handleSearch}},[t._v(" 查询 ")]),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:t.handleReset}},[t._v(" 重置 ")]),a("el-button",{attrs:{size:"small",icon:"el-icon-download",type:"success",plain:"",disabled:0===t.list.length},on:{click:t.exportCSV}},[t._v(" 导出CSV ")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"12px"},attrs:{data:t.list,stripe:"",border:"",size:"small","row-key":"id"}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"70",align:"center"}}),a("el-table-column",{attrs:{prop:"user_id",label:"用户ID",width:"80",align:"center"}}),a("el-table-column",{attrs:{label:"用户邮箱",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){var l=e.row;return[l.user_email?a("span",{staticStyle:{"font-size":"12px"}},[t._v(t._s(l.user_email))]):a("span",{staticStyle:{color:"#C0C4CC"}},[t._v("-")])]}}])}),a("el-table-column",{attrs:{label:"提现金额",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var l=e.row;return[a("span",{staticStyle:{"font-weight":"600"}},[t._v("$"+t._s(t.formatMoney(l.amount)))])]}}])}),a("el-table-column",{attrs:{label:"服务费",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var l=e.row;return[a("span",{staticStyle:{color:"#F56C6C"}},[t._v("$"+t._s(t.formatMoney(l.fee)))])]}}])}),a("el-table-column",{attrs:{label:"实际到账",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var l=e.row;return[a("span",{staticStyle:{color:"#67C23A","font-weight":"600"}},[t._v("$"+t._s(t.formatMoney(l.actual_amount)))])]}}])}),a("el-table-column",{attrs:{label:"钱包地址",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){var l=e.row;return[a("el-tooltip",{attrs:{content:l.wallet_address,placement:"top",disabled:!l.wallet_address}},[a("span",{staticClass:"address-text"},[t._v(t._s(t.truncateAddress(l.wallet_address)))])])]}}])}),a("el-table-column",{attrs:{prop:"wallet_network",label:"网络",width:"90",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var l=e.row;return[l.wallet_network?a("el-tag",{attrs:{size:"mini",type:"info"}},[t._v(t._s(l.wallet_network))]):a("span",[t._v("-")])]}}])}),a("el-table-column",{attrs:{label:"状态",width:"90",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var l=e.row;return[a("el-tag",{attrs:{type:t.statusTagType(l.status),size:"mini"}},[t._v(" "+t._s(t.statusLabel(l.status))+" ")])]}}])}),a("el-table-column",{attrs:{prop:"created_at",label:"申请时间",width:"170"}}),a("el-table-column",{attrs:{label:"操作",width:"220",fixed:"right",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var l=e.row;return[0===l.status?a("el-button",{attrs:{size:"mini",type:"success",plain:""},on:{click:function(e){return t.openApproveDialog(l)}}},[t._v(" 通过 ")]):t._e(),0===l.status?a("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.openRejectDialog(l)}}},[t._v(" 拒绝 ")]):t._e(),1===l.status?a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.openCompleteDialog(l)}}},[t._v(" 打款完成 ")]):t._e(),a("el-button",{attrs:{size:"mini",type:"info",plain:""},on:{click:function(e){return t.openDetailDialog(l)}}},[t._v(" 详情 ")])]}}])})],1),a("div",{staticClass:"pagination-wrap"},[a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",total:t.total,"page-size":t.query.page_size,"current-page":t.query.page,"page-sizes":[10,20,50,100]},on:{"update:pageSize":function(e){return t.$set(t.query,"page_size",e)},"update:page-size":function(e){return t.$set(t.query,"page_size",e)},"update:currentPage":function(e){return t.$set(t.query,"page",e)},"update:current-page":function(e){return t.$set(t.query,"page",e)},"size-change":t.fetchData,"current-change":t.fetchData}})],1)],1),a("el-dialog",{attrs:{title:"审核通过确认",visible:t.approveDialog.visible,width:"480px","close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.approveDialog,"visible",e)}}},[t.approveDialog.row?a("div",{staticClass:"confirm-info"},[a("el-descriptions",{attrs:{column:1,border:"",size:"small"}},[a("el-descriptions-item",{attrs:{label:"提现ID"}},[t._v(t._s(t.approveDialog.row.id))]),a("el-descriptions-item",{attrs:{label:"用户ID"}},[t._v(t._s(t.approveDialog.row.user_id))]),a("el-descriptions-item",{attrs:{label:"提现金额"}},[t._v("$"+t._s(t.formatMoney(t.approveDialog.row.amount)))]),a("el-descriptions-item",{attrs:{label:"服务费"}},[t._v("$"+t._s(t.formatMoney(t.approveDialog.row.fee)))]),a("el-descriptions-item",{attrs:{label:"实际到账"}},[t._v("$"+t._s(t.formatMoney(t.approveDialog.row.actual_amount)))]),a("el-descriptions-item",{attrs:{label:"钱包地址"}},[t._v(t._s(t.approveDialog.row.wallet_address))]),a("el-descriptions-item",{attrs:{label:"网络"}},[t._v(t._s(t.approveDialog.row.wallet_network||"-"))])],1),a("el-alert",{staticStyle:{"margin-top":"16px"},attrs:{title:"确认通过此提现申请？通过后将进入待打款状态。",type:"warning",closable:!1,"show-icon":""}})],1):t._e(),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.approveDialog.visible=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"success",size:"small",loading:t.approveDialog.loading},on:{click:t.handleApprove}},[t._v(" 确认通过 ")])],1)]),a("el-dialog",{attrs:{title:"拒绝提现",visible:t.rejectDialog.visible,width:"480px","close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.rejectDialog,"visible",e)}}},[t.rejectDialog.row?a("div",{staticStyle:{"margin-bottom":"12px"}},[a("span",{staticStyle:{color:"#909399","font-size":"13px"}},[t._v(" 提现ID: "+t._s(t.rejectDialog.row.id)+" | 金额: $"+t._s(t.formatMoney(t.rejectDialog.row.amount))+" ")])]):t._e(),a("el-form",{attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"拒绝原因",required:""}},[a("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入拒绝原因（必填）",maxlength:"500","show-word-limit":""},model:{value:t.rejectDialog.reason,callback:function(e){t.$set(t.rejectDialog,"reason",e)},expression:"rejectDialog.reason"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.rejectDialog.visible=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"danger",size:"small",loading:t.rejectDialog.loading,disabled:!t.rejectDialog.reason.trim()},on:{click:t.handleReject}},[t._v(" 确认拒绝 ")])],1)],1),a("el-dialog",{attrs:{title:"确认打款完成",visible:t.completeDialog.visible,width:"480px","close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.completeDialog,"visible",e)}}},[t.completeDialog.row?a("div",{staticStyle:{"margin-bottom":"12px"}},[a("span",{staticStyle:{color:"#909399","font-size":"13px"}},[t._v(" 提现ID: "+t._s(t.completeDialog.row.id)+" | 实际到账: $"+t._s(t.formatMoney(t.completeDialog.row.actual_amount))+" ")])]):t._e(),a("el-form",{attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"交易哈希"}},[a("el-input",{attrs:{placeholder:"请输入链上交易哈希（可选）",clearable:""},model:{value:t.completeDialog.txHash,callback:function(e){t.$set(t.completeDialog,"txHash",e)},expression:"completeDialog.txHash"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.completeDialog.visible=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary",size:"small",loading:t.completeDialog.loading},on:{click:t.handleComplete}},[t._v(" 确认完成 ")])],1)],1),a("el-dialog",{attrs:{title:"提现详情",visible:t.detailDialog.visible,width:"600px"},on:{"update:visible":function(e){return t.$set(t.detailDialog,"visible",e)}}},[t.detailDialog.row?a("el-descriptions",{attrs:{column:2,border:"",size:"small"}},[a("el-descriptions-item",{attrs:{label:"提现ID"}},[t._v(t._s(t.detailDialog.row.id))]),a("el-descriptions-item",{attrs:{label:"用户ID"}},[t._v(t._s(t.detailDialog.row.user_id))]),a("el-descriptions-item",{attrs:{label:"用户邮箱",span:2}},[t._v(t._s(t.detailDialog.row.user_email||"-"))]),a("el-descriptions-item",{attrs:{label:"提现金额"}},[t._v("$"+t._s(t.formatMoney(t.detailDialog.row.amount)))]),a("el-descriptions-item",{attrs:{label:"服务费"}},[t._v("$"+t._s(t.formatMoney(t.detailDialog.row.fee)))]),a("el-descriptions-item",{attrs:{label:"实际到账"}},[t._v("$"+t._s(t.formatMoney(t.detailDialog.row.actual_amount)))]),a("el-descriptions-item",{attrs:{label:"状态"}},[a("el-tag",{attrs:{type:t.statusTagType(t.detailDialog.row.status),size:"mini"}},[t._v(" "+t._s(t.statusLabel(t.detailDialog.row.status))+" ")])],1),a("el-descriptions-item",{attrs:{label:"钱包地址",span:2}},[t._v(" "+t._s(t.detailDialog.row.wallet_address||"-")+" ")]),a("el-descriptions-item",{attrs:{label:"钱包网络"}},[t._v(t._s(t.detailDialog.row.wallet_network||"-"))]),a("el-descriptions-item",{attrs:{label:"申请时间"}},[t._v(t._s(t.detailDialog.row.created_at||"-"))]),a("el-descriptions-item",{attrs:{label:"交易哈希",span:2}},[t.detailDialog.row.tx_hash?a("span",{staticClass:"tx-hash-text"},[t._v(t._s(t.detailDialog.row.tx_hash))]):a("span",{staticStyle:{color:"#C0C4CC"}},[t._v("-")])]),2===t.detailDialog.row.status?a("el-descriptions-item",{attrs:{label:"拒绝原因",span:2}},[a("span",{staticStyle:{color:"#F56C6C"}},[t._v(t._s(t.detailDialog.row.reject_reason||"-"))])]):t._e(),a("el-descriptions-item",{attrs:{label:"审核人"}},[t._v(t._s(t.detailDialog.row.audit_by||"-"))]),a("el-descriptions-item",{attrs:{label:"审核时间"}},[t._v(t._s(t.detailDialog.row.audit_at||"-"))]),3===t.detailDialog.row.status?a("el-descriptions-item",{attrs:{label:"完成时间",span:2}},[t._v(" "+t._s(t.detailDialog.row.completed_at||"-")+" ")]):t._e()],1):t._e(),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.detailDialog.visible=!1}}},[t._v("关闭")])],1)],1)],1)},i=[],s=(a("0643"),a("a573"),a("cd05")),o={name:"WithdrawalManage",data(){return{loading:!1,list:[],total:0,query:{page:1,page_size:20,status:"",user_id:""},dateRange:null,approveDialog:{visible:!1,loading:!1,row:null},rejectDialog:{visible:!1,loading:!1,row:null,reason:""},completeDialog:{visible:!1,loading:!1,row:null,txHash:""},detailDialog:{visible:!1,row:null},stats:{pendingCount:0,approvedCount:0,totalAmount:0,totalFee:0}}},computed:{},mounted(){this.fetchData()},methods:{statusLabel(t){const e={0:"待审核",1:"已通过",2:"已拒绝",3:"已完成"};return void 0!==e[t]?e[t]:t},statusTagType(t){const e={0:"warning",1:"",2:"danger",3:"success"};return void 0!==e[t]?e[t]:"info"},formatMoney(t){const e=Number(t)||0;return e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},truncateAddress(t){return t?t.length<=16?t:t.slice(0,8)+"..."+t.slice(-6):"-"},handleSearch(){this.query.page=1,this.fetchData()},handleReset(){this.query={page:1,page_size:20,status:"",user_id:""},this.dateRange=null,this.fetchData()},async fetchData(){this.loading=!0;try{const t={page:this.query.page,page_size:this.query.page_size};""!==this.query.status&&null!==this.query.status&&(t.status=this.query.status),this.query.user_id&&(t.user_id=this.query.user_id),this.dateRange&&2===this.dateRange.length&&(t.start_date=this.dateRange[0],t.end_date=this.dateRange[1]);const e=await Object(s["g"])(t),a=e.data.data;Array.isArray(a)?(this.list=a,this.total=e.data.total||a.length):(this.list=[],this.total=0);const l=e.data.stats;l&&(this.stats={pendingCount:l.pending||0,approvedCount:l.approved||0,totalAmount:l.total_amount||0,totalFee:l.total_fee||0})}catch(t){this.$message.error("获取提现记录失败"),this.list=[],this.total=0}finally{this.loading=!1}},openApproveDialog(t){this.approveDialog={visible:!0,loading:!1,row:{...t}}},async handleApprove(){this.approveDialog.loading=!0;try{await Object(s["a"])(this.approveDialog.row.id),this.$message.success("审核已通过"),this.approveDialog.visible=!1,this.fetchData()}catch(t){this.$message.error("操作失败："+(t.response&&t.response.data&&t.response.data.message||"未知错误"))}finally{this.approveDialog.loading=!1}},openRejectDialog(t){this.rejectDialog={visible:!0,loading:!1,row:{...t},reason:""}},async handleReject(){if(this.rejectDialog.reason.trim()){this.rejectDialog.loading=!0;try{await Object(s["h"])(this.rejectDialog.row.id,this.rejectDialog.reason.trim()),this.$message.success("已拒绝提现"),this.rejectDialog.visible=!1,this.fetchData()}catch(t){this.$message.error("操作失败："+(t.response&&t.response.data&&t.response.data.message||"未知错误"))}finally{this.rejectDialog.loading=!1}}else this.$message.warning("请输入拒绝原因")},openCompleteDialog(t){this.completeDialog={visible:!0,loading:!1,row:{...t},txHash:""}},async handleComplete(){this.completeDialog.loading=!0;try{await Object(s["b"])(this.completeDialog.row.id,this.completeDialog.txHash.trim()),this.$message.success("已标记为打款完成"),this.completeDialog.visible=!1,this.fetchData()}catch(t){this.$message.error("操作失败："+(t.response&&t.response.data&&t.response.data.message||"未知错误"))}finally{this.completeDialog.loading=!1}},exportCSV(){const t=["ID","用户ID","用户邮箱","金额","服务费","实际到账","钱包地址","网络","状态","申请时间"],e=this.list.map(t=>[t.id,t.user_id,t.user_email||"",t.amount,t.fee,t.actual_amount,t.wallet_address,t.wallet_network,this.statusLabel(t.status),t.created_at||""]),a=[t,...e].map(t=>t.map(t=>`"${t}"`).join(",")).join("\n"),l=new Blob(["\ufeff"+a],{type:"text/csv;charset=utf-8"}),i=URL.createObjectURL(l),s=document.createElement("a");s.href=i,s.download=`提现记录_${(new Date).toISOString().slice(0,10)}.csv`,s.click(),URL.revokeObjectURL(i)},openDetailDialog(t){this.detailDialog={visible:!0,row:{...t}}}}},r=o,n=(a("3c73"),a("2877")),c=Object(n["a"])(r,l,i,!1,null,"14582984",null);e["default"]=c.exports},cd05:function(t,e,a){"use strict";a.d(e,"e",(function(){return s})),a.d(e,"c",(function(){return o})),a.d(e,"j",(function(){return r})),a.d(e,"i",(function(){return n})),a.d(e,"g",(function(){return c})),a.d(e,"a",(function(){return u})),a.d(e,"h",(function(){return d})),a.d(e,"b",(function(){return p})),a.d(e,"d",(function(){return g})),a.d(e,"f",(function(){return m}));var l=a("bc3a"),i=a.n(l);function s(t={}){return i.a.get("/quota-plans",{params:t})}function o(t){return i.a.post("/quota-plans",t)}function r(t,e){return i.a.put("/quota-plans/"+t,e)}function n(t){return i.a.patch(`/quota-plans/${t}/toggle`)}function c(t={}){return i.a.get("/withdrawals",{params:t})}function u(t){return i.a.post(`/withdrawals/${t}/approve`)}function d(t,e=""){return i.a.post(`/withdrawals/${t}/reject`,{reason:e})}function p(t,e=""){return i.a.post(`/withdrawals/${t}/complete`,{tx_hash:e})}function g(t={}){return i.a.get("/pointcard-logs",{params:t})}function m(t={}){return i.a.get("/rewards",{params:t})}}}]);