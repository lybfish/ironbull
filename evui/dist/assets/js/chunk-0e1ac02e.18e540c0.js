(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e1ac02e"],{"0f66":function(t,e,s){"use strict";s.d(e,"f",(function(){return i})),s.d(e,"a",(function(){return o})),s.d(e,"l",(function(){return l})),s.d(e,"b",(function(){return r})),s.d(e,"e",(function(){return c})),s.d(e,"c",(function(){return d})),s.d(e,"h",(function(){return u})),s.d(e,"j",(function(){return p})),s.d(e,"k",(function(){return m})),s.d(e,"i",(function(){return h})),s.d(e,"g",(function(){return y})),s.d(e,"d",(function(){return g}));var a=s("bc3a"),n=s.n(a);function i(t={}){return n.a.get("/nodes",{params:t})}function o(t){return n.a.post("/nodes",t)}function l(t,e){return n.a.put("/nodes/"+t,e)}function r(t){return n.a.delete("/nodes/"+t)}function c(t){return n.a.get(`/nodes/${t}/accounts`)}function d(t={}){return n.a.get("/exchange-accounts",{params:t})}function u(t={}){return n.a.post("/sync/balance",t)}function p(t={}){return n.a.post("/sync/positions",t)}function m(t={}){return n.a.post("/sync/trades",t)}function h(t={}){return n.a.post("/sync/markets",t)}function y(){return n.a.get("/signal-monitor/status")}function g(){return n.a.get("/sync/monitored-positions")}},"16f9":function(t,e,s){"use strict";s("5179")},4738:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ele-body"},[s("el-row",{attrs:{gutter:16}},[s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("余额同步")])]),s("el-form",{attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点",clearable:""},model:{value:t.balanceNodeId,callback:function(e){t.balanceNodeId=e},expression:"balanceNodeId"}},t._l(t.nodes,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name+" ("+t.node_code+")",value:t.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",loading:t.syncingBalance},on:{click:t.handleSyncBalance}},[t._v("同步余额")])],1)],1),t.balanceResult?s("div",{staticClass:"result"},[s("el-alert",{attrs:{title:t.balanceResult.message,type:t.balanceResult.success?"success":"error",closable:!1,"show-icon":""}})],1):t._e()],1)],1),s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("持仓同步")])]),s("el-form",{attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点",clearable:""},model:{value:t.positionNodeId,callback:function(e){t.positionNodeId=e},expression:"positionNodeId"}},t._l(t.nodes,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name+" ("+t.node_code+")",value:t.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",loading:t.syncingPositions},on:{click:t.handleSyncPositions}},[t._v("同步持仓")])],1)],1),t.positionResult?s("div",{staticClass:"result"},[s("el-alert",{attrs:{title:t.positionResult.message,type:t.positionResult.success?"success":"error",closable:!1,"show-icon":""}})],1):t._e()],1)],1)],1),s("el-row",{staticStyle:{"margin-top":"16px"},attrs:{gutter:16}},[s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("成交同步")])]),s("el-form",{attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点（不选=全部）",clearable:""},model:{value:t.tradesNodeId,callback:function(e){t.tradesNodeId=e},expression:"tradesNodeId"}},t._l(t.nodes,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name+" ("+t.node_code+")",value:t.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"warning",loading:t.syncingTrades},on:{click:t.handleSyncTrades}},[t._v("同步成交")])],1)],1),t.tradesResult?s("div",{staticClass:"result"},[s("el-alert",{attrs:{title:t.tradesResult.message,type:t.tradesResult.success?"success":"error",closable:!1,"show-icon":""}})],1):t._e()],1)],1),s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("市场信息同步")])]),s("el-form",{attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"交易所"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"全部交易所",clearable:""},model:{value:t.marketExchange,callback:function(e){t.marketExchange=e},expression:"marketExchange"}},[s("el-option",{attrs:{label:"Binance",value:"binance"}}),s("el-option",{attrs:{label:"Gate",value:"gate"}}),s("el-option",{attrs:{label:"OKX",value:"okx"}})],1)],1),s("el-form-item",{attrs:{label:"市场类型"}},[s("el-radio-group",{model:{value:t.marketType,callback:function(e){t.marketType=e},expression:"marketType"}},[s("el-radio",{attrs:{label:"swap"}},[t._v("永续合约")]),s("el-radio",{attrs:{label:"spot"}},[t._v("现货")])],1)],1),s("el-form-item",[s("el-button",{attrs:{type:"success",loading:t.syncingMarkets},on:{click:t.handleSyncMarkets}},[t._v("同步市场信息")])],1)],1),t.marketsResult?s("div",{staticClass:"result"},[s("el-alert",{attrs:{title:t.marketsResult.message,type:t.marketsResult.success?"success":"error",closable:!1,"show-icon":""}})],1):t._e()],1)],1)],1),s("el-row",{staticStyle:{"margin-top":"16px"},attrs:{gutter:16}},[s("el-col",{attrs:{span:24}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("持仓监控 (自管 SL/TP)")]),s("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:t.loadingPM||t.loadingPositions},on:{click:t.refreshPM}},[t._v(" 刷新状态 ")])],1),t.pmError?s("div",{staticStyle:{"margin-bottom":"12px"}},[s("el-alert",{attrs:{title:t.pmError,type:"error",closable:!1,"show-icon":""}})],1):t._e(),s("el-row",{attrs:{gutter:24}},[s("el-col",{attrs:{span:6}},[s("div",{staticClass:"pm-stat-card"},[s("div",{staticClass:"pm-stat-label"},[t._v("监控状态")]),s("div",{staticClass:"pm-stat-value"},[t.pmStatus.enabled?s("el-tag",{attrs:{type:"success",size:"medium"}},[t._v("运行中")]):s("el-tag",{attrs:{type:"info",size:"medium"}},[t._v("未启用")])],1),s("div",{staticClass:"pm-stat-desc"},[t._v(" "+t._s(t.pmStatus.enabled?"自管模式：不在交易所挂止损单":"交易所 SL/TP 模式")+" ")])])]),s("el-col",{attrs:{span:6}},[s("div",{staticClass:"pm-stat-card"},[s("div",{staticClass:"pm-stat-label"},[t._v("监控持仓数")]),s("div",{staticClass:"pm-stat-value pm-stat-number"},[t._v(t._s(t.pmStats.positions_monitored||0))]),s("div",{staticClass:"pm-stat-desc"},[t._v("当前带 SL/TP 的 OPEN 持仓")])])]),s("el-col",{attrs:{span:6}},[s("div",{staticClass:"pm-stat-card"},[s("div",{staticClass:"pm-stat-label"},[t._v("触发总次数")]),s("div",{staticClass:"pm-stat-value pm-stat-number"},[t._v(t._s(t.pmStats.triggers_total||0))]),s("div",{staticClass:"pm-stat-desc"},[s("span",{staticStyle:{color:"#67C23A"}},[t._v("成功 "+t._s(t.pmStats.closes_success||0))]),s("span",{staticStyle:{"margin-left":"8px",color:"#F56C6C"}},[t._v("失败 "+t._s(t.pmStats.closes_failed||0))])])])]),s("el-col",{attrs:{span:6}},[s("div",{staticClass:"pm-stat-card"},[s("div",{staticClass:"pm-stat-label"},[t._v("最近扫描")]),s("div",{staticClass:"pm-stat-value pm-stat-time"},[t._v(t._s(t.pmStats.last_scan_at?t.formatPMTime(t.pmStats.last_scan_at):"-"))]),s("div",{staticClass:"pm-stat-desc"},[t._v("每 "+t._s(t.pmConfig.interval||"?")+" 秒扫描一次")])])])],1),t.pmCooldowns.length>0?s("div",{staticStyle:{"margin-top":"16px"}},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("止损冷却中的策略")]),s("el-table",{attrs:{data:t.pmCooldowns,stripe:"",border:"",size:"small"}},[s("el-table-column",{attrs:{prop:"strategy",label:"策略",width:"200"}}),s("el-table-column",{attrs:{prop:"symbol",label:"交易对",width:"150"}}),s("el-table-column",{attrs:{label:"剩余冷却",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{type:"warning",size:"mini"}},[t._v(t._s(a.remaining_minutes)+" 分钟")])]}}],null,!1,1111793692)}),s("el-table-column",{attrs:{prop:"cooldown_until",label:"冷却截止"}})],1)],1):t._e(),s("div",{staticStyle:{"margin-top":"16px"}},[s("el-divider",{attrs:{"content-position":"left"}},[t._v(" 监控持仓明细 "),s("el-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"text",size:"mini",loading:t.loadingPositions},on:{click:t.fetchMonitoredPositions}},[t._v("刷新")])],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingPositions,expression:"loadingPositions"}],attrs:{data:t.monitoredPositions,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa"},"max-height":"500"}},[s("el-table-column",{attrs:{label:"交易对",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("span",{staticStyle:{"font-weight":"600"}},[t._v(t._s(a.symbol))])]}}])}),s("el-table-column",{attrs:{label:"交易所",width:"90",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{size:"mini",effect:"plain"}},[t._v(t._s((a.exchange||"").toUpperCase()))])]}}])}),s("el-table-column",{attrs:{label:"方向",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{type:"LONG"===a.position_side?"success":"danger",size:"mini"}},[t._v(" "+t._s("LONG"===a.position_side?"多":"空")+" ")])]}}])}),s("el-table-column",{attrs:{label:"数量",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(s.quantity))]}}])}),s("el-table-column",{attrs:{label:"入场价",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.entry_price?s("span",[t._v(t._s(a.entry_price))]):s("span",{staticStyle:{color:"#C0C4CC"}},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"止损价",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.stop_loss?s("span",{staticStyle:{color:"#F56C6C","font-weight":"600"}},[t._v(t._s(a.stop_loss))]):s("span",{staticStyle:{color:"#C0C4CC"}},[t._v("未设置")])]}}])}),s("el-table-column",{attrs:{label:"止盈价",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.take_profit?s("span",{staticStyle:{color:"#67C23A","font-weight":"600"}},[t._v(t._s(a.take_profit))]):s("span",{staticStyle:{color:"#C0C4CC"}},[t._v("未设置")])]}}])}),s("el-table-column",{attrs:{label:"杠杆",width:"60",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(s.leverage||"-")+"x")]}}])}),s("el-table-column",{attrs:{label:"策略",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.strategy_code?s("span",[t._v(t._s(a.strategy_code))]):s("span",{staticStyle:{color:"#C0C4CC"}},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"用户",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.user_email?s("span",[t._v(t._s(a.user_email))]):s("span",{staticStyle:{color:"#C0C4CC"}},[t._v("账户#"+t._s(a.account_id))])]}}])}),s("el-table-column",{attrs:{label:"更新时间",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(s.updated_at?t.formatPMTime(s.updated_at):"-"))]}}])})],1),t.loadingPositions||0!==t.monitoredPositions.length?t._e():s("el-empty",{attrs:{description:"当前没有被监控的持仓"}})],1)],1)],1)],1),s("el-card",{staticStyle:{"margin-top":"16px"},attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("同步历史")]),s("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:t.clearHistory}},[t._v("清空历史")])],1),s("el-table",{attrs:{data:t.syncHistory,stripe:"",border:"",size:"small","max-height":"400"}},[s("el-table-column",{attrs:{prop:"type",label:"类型",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{type:t.syncTypeTag(a.type),size:"mini"}},[t._v(" "+t._s(t.syncTypeLabel(a.type))+" ")])]}}])}),s("el-table-column",{attrs:{prop:"node_name",label:"目标节点",width:"200"}}),s("el-table-column",{attrs:{prop:"message",label:"结果"}}),s("el-table-column",{attrs:{prop:"time",label:"时间",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(" "+t._s(t.formatDateTime(s.time))+" ")]}}])}),s("el-table-column",{attrs:{label:"状态",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{type:a.success?"success":"danger",size:"mini"}},[t._v(" "+t._s(a.success?"成功":"失败")+" ")])]}}])})],1),0===t.syncHistory.length?s("el-empty",{attrs:{description:"暂无同步记录"}}):t._e()],1)],1)},n=[],i=(s("e9c4"),s("0643"),s("fffc"),s("0f66")),o={name:"SyncManage",data(){return{nodes:[],balanceNodeId:null,positionNodeId:null,syncingBalance:!1,syncingPositions:!1,syncingTrades:!1,syncingMarkets:!1,balanceResult:null,positionResult:null,tradesResult:null,marketsResult:null,tradesNodeId:null,marketExchange:null,marketType:"swap",syncHistory:[],loadingPM:!1,pmError:null,pmStatus:{enabled:!1},pmStats:{},pmConfig:{},pmCooldowns:[],monitoredPositions:[],loadingPositions:!1}},mounted(){this.fetchNodes(),this.loadHistory(),this.fetchPMStatus(),this.fetchMonitoredPositions()},methods:{syncTypeLabel(t){const e={balance:"余额同步",position:"持仓同步",trades:"成交同步",markets:"市场同步"};return e[t]||t},syncTypeTag(t){const e={balance:"primary",position:"success",trades:"warning",markets:""};return e[t]||"info"},async fetchNodes(){try{const t=await Object(i["f"])();this.nodes=t.data.data||[]}catch(t){this.$message.error("获取节点列表失败")}},async handleSyncBalance(){if(!this.balanceNodeId)return void this.$message.warning("请选择目标节点");this.syncingBalance=!0,this.balanceResult=null;const t=this.nodes.find(t=>t.id===this.balanceNodeId),e=t?`${t.name} (${t.node_code})`:"未知节点",s=new Date;try{await Object(i["h"])({node_id:this.balanceNodeId});const t={success:!0,message:"余额同步完成"};this.balanceResult=t,this.addHistory("balance",e,t.message,!0,s),this.$message.success("余额同步完成")}catch(n){var a;const t=(null===(a=n.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||n.message||"同步失败",i={success:!1,message:"同步失败: "+t};this.balanceResult=i,this.addHistory("balance",e,i.message,!1,s),this.$message.error("余额同步失败")}finally{this.syncingBalance=!1}},async handleSyncPositions(){if(!this.positionNodeId)return void this.$message.warning("请选择目标节点");this.syncingPositions=!0,this.positionResult=null;const t=this.nodes.find(t=>t.id===this.positionNodeId),e=t?`${t.name} (${t.node_code})`:"未知节点",s=new Date;try{await Object(i["j"])({node_id:this.positionNodeId});const t={success:!0,message:"持仓同步完成"};this.positionResult=t,this.addHistory("position",e,t.message,!0,s),this.$message.success("持仓同步完成")}catch(n){var a;const t=(null===(a=n.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||n.message||"同步失败",i={success:!1,message:"同步失败: "+t};this.positionResult=i,this.addHistory("position",e,i.message,!1,s),this.$message.error("持仓同步失败")}finally{this.syncingPositions=!1}},async handleSyncTrades(){this.syncingTrades=!0,this.tradesResult=null;const t=this.tradesNodeId?this.nodes.find(t=>t.id===this.tradesNodeId):null,e=t?`${t.name} (${t.node_code})`:"全部节点",s=new Date;try{const t={};this.tradesNodeId&&(t.node_id=this.tradesNodeId),await Object(i["k"])(t);const a={success:!0,message:"成交同步完成"};this.tradesResult=a,this.addHistory("trades",e,a.message,!0,s),this.$message.success("成交同步完成")}catch(n){var a;const t=(null===(a=n.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||n.message||"同步失败",i={success:!1,message:"同步失败: "+t};this.tradesResult=i,this.addHistory("trades",e,i.message,!1,s),this.$message.error("成交同步失败")}finally{this.syncingTrades=!1}},async handleSyncMarkets(){this.syncingMarkets=!0,this.marketsResult=null;const t=new Date,e=this.marketExchange?this.marketExchange.toUpperCase():"全部";try{const s={market_type:this.marketType};this.marketExchange&&(s.exchange=this.marketExchange),await Object(i["i"])(s);const a={success:!0,message:`市场信息同步完成 (${e} - ${this.marketType})`};this.marketsResult=a,this.addHistory("markets",e,a.message,!0,t),this.$message.success("市场信息同步完成")}catch(a){var s;const n=(null===(s=a.response)||void 0===s||null===(s=s.data)||void 0===s?void 0:s.detail)||a.message||"同步失败",i={success:!1,message:"同步失败: "+n};this.marketsResult=i,this.addHistory("markets",e,i.message,!1,t),this.$message.error("市场信息同步失败")}finally{this.syncingMarkets=!1}},addHistory(t,e,s,a,n){this.syncHistory.unshift({type:t,node_name:e,message:s,success:a,time:n.toISOString()}),this.syncHistory.length>50&&(this.syncHistory=this.syncHistory.slice(0,50)),this.saveHistory()},formatDateTime(t){return t?new Date(t).toLocaleString("zh-CN"):"-"},saveHistory(){try{localStorage.setItem("sync_history",JSON.stringify(this.syncHistory))}catch(t){console.error("保存同步历史失败",t)}},loadHistory(){try{const t=localStorage.getItem("sync_history");t&&(this.syncHistory=JSON.parse(t))}catch(t){console.error("加载同步历史失败",t)}},clearHistory(){this.$confirm("确定清空所有同步历史记录吗？","提示",{type:"warning"}).then(()=>{this.syncHistory=[],this.saveHistory(),this.$message.success("已清空历史记录")}).catch(()=>{})},refreshPM(){this.fetchPMStatus(),this.fetchMonitoredPositions()},async fetchPMStatus(){this.loadingPM=!0,this.pmError=null;try{const t=await Object(i["g"])(),e=t.data||{},s=e.config||{};this.pmStatus={enabled:!0===s.position_monitor},this.pmStats=e.position_monitor_stats||{},this.pmConfig={interval:s.interval_seconds||"-",syncInterval:s.sync_interval_seconds||"-",strategiesCount:s.strategies_count||0,exchangeSlTp:s.exchange_sl_tp||!1},this.pmCooldowns=e.cooldowns||[]}catch(e){var t;this.pmError="无法获取持仓监控状态："+((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||e.message||"服务不可达"),this.pmStatus={enabled:!1},this.pmStats={},this.pmConfig={},this.pmCooldowns=[]}finally{this.loadingPM=!1}},formatPMTime(t){if(!t)return"-";try{return new Date(t).toLocaleString("zh-CN")}catch(e){return t}},async fetchMonitoredPositions(){this.loadingPositions=!0;try{const t=await Object(i["d"])();this.monitoredPositions=t.data.data||[]}catch(t){console.error("获取监控持仓失败:",t),this.monitoredPositions=[]}finally{this.loadingPositions=!1}}}},l=o,r=(s("16f9"),s("2877")),c=Object(r["a"])(l,a,n,!1,null,"431327f2",null);e["default"]=c.exports},5179:function(t,e,s){}}]);