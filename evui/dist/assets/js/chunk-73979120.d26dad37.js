(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-73979120"],{"0668":function(t,e,s){"use strict";s("b288")},"0f66":function(t,e,s){"use strict";s.d(e,"f",(function(){return n})),s.d(e,"a",(function(){return l})),s.d(e,"n",(function(){return o})),s.d(e,"b",(function(){return r})),s.d(e,"e",(function(){return c})),s.d(e,"i",(function(){return d})),s.d(e,"k",(function(){return u})),s.d(e,"l",(function(){return m})),s.d(e,"j",(function(){return p})),s.d(e,"c",(function(){return h})),s.d(e,"g",(function(){return g})),s.d(e,"d",(function(){return f})),s.d(e,"m",(function(){return y})),s.d(e,"h",(function(){return _}));var a=s("bc3a"),i=s.n(a);function n(t={}){return i.a.get("/nodes",{params:t})}function l(t){return i.a.post("/nodes",t)}function o(t,e){return i.a.put("/nodes/"+t,e)}function r(t){return i.a.delete("/nodes/"+t)}function c(t){return i.a.get(`/nodes/${t}/accounts`)}function d(t={}){return i.a.post("/sync/balance",t)}function u(t={}){return i.a.post("/sync/positions",t)}function m(t={}){return i.a.post("/sync/trades",t)}function p(t={}){return i.a.post("/sync/markets",t)}function h(t={}){return i.a.get("/sync/markets",{params:t})}function g(){return i.a.get("/signal-monitor/status")}function f(){return i.a.get("/sync/monitored-positions")}function y(){return i.a.post("/signal-monitor/trigger-scan")}function _(t,e){const s={symbols:t};return e&&(s.exchange_symbols=e),i.a.get("/signal-monitor/realtime-prices",{params:s})}},4738:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ele-body"},[s("el-tabs",{attrs:{type:"border-card"},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[s("el-tab-pane",{attrs:{label:"数据同步",name:"sync"}},[s("el-row",{attrs:{gutter:16}},[s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("余额同步")])]),s("el-form",{attrs:{"label-width":"100px",size:"small"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点",clearable:""},model:{value:t.balanceNodeId,callback:function(e){t.balanceNodeId=e},expression:"balanceNodeId"}},t._l(t.nodes,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name+" ("+t.node_code+")",value:t.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",loading:t.syncingBalance},on:{click:t.handleSyncBalance}},[t._v("同步余额")])],1)],1),t.balanceResult?s("el-alert",{staticStyle:{"margin-top":"8px"},attrs:{title:t.balanceResult.message,type:t.balanceResult.success?"success":"error",closable:!1,"show-icon":""}}):t._e()],1)],1),s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("持仓同步")])]),s("el-form",{attrs:{"label-width":"100px",size:"small"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点",clearable:""},model:{value:t.positionNodeId,callback:function(e){t.positionNodeId=e},expression:"positionNodeId"}},t._l(t.nodes,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name+" ("+t.node_code+")",value:t.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",loading:t.syncingPositions},on:{click:t.handleSyncPositions}},[t._v("同步持仓")])],1)],1),t.positionResult?s("el-alert",{staticStyle:{"margin-top":"8px"},attrs:{title:t.positionResult.message,type:t.positionResult.success?"success":"error",closable:!1,"show-icon":""}}):t._e()],1)],1)],1),s("el-row",{staticStyle:{"margin-top":"16px"},attrs:{gutter:16}},[s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("成交同步")])]),s("el-form",{attrs:{"label-width":"100px",size:"small"}},[s("el-form-item",{attrs:{label:"目标节点"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择节点（不选=全部）",clearable:""},model:{value:t.tradesNodeId,callback:function(e){t.tradesNodeId=e},expression:"tradesNodeId"}},t._l(t.nodes,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name+" ("+t.node_code+")",value:t.id}})})),1)],1),s("el-form-item",[s("el-button",{attrs:{type:"warning",loading:t.syncingTrades},on:{click:t.handleSyncTrades}},[t._v("同步成交")])],1)],1),t.tradesResult?s("el-alert",{staticStyle:{"margin-top":"8px"},attrs:{title:t.tradesResult.message,type:t.tradesResult.success?"success":"error",closable:!1,"show-icon":""}}):t._e()],1)],1),s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("市场信息同步")])]),s("el-form",{attrs:{"label-width":"100px",size:"small"}},[s("el-form-item",{attrs:{label:"交易所"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"全部交易所",clearable:""},model:{value:t.marketExchange,callback:function(e){t.marketExchange=e},expression:"marketExchange"}},[s("el-option",{attrs:{label:"Binance",value:"binance"}}),s("el-option",{attrs:{label:"Gate",value:"gate"}}),s("el-option",{attrs:{label:"OKX",value:"okx"}})],1)],1),s("el-form-item",{attrs:{label:"市场类型"}},[s("el-radio-group",{model:{value:t.marketType,callback:function(e){t.marketType=e},expression:"marketType"}},[s("el-radio",{attrs:{label:"swap"}},[t._v("永续合约")]),s("el-radio",{attrs:{label:"spot"}},[t._v("现货")])],1)],1),s("el-form-item",[s("el-button",{attrs:{type:"success",loading:t.syncingMarkets},on:{click:t.handleSyncMarkets}},[t._v("同步市场信息")])],1)],1),t.marketsResult?s("el-alert",{staticStyle:{"margin-top":"8px"},attrs:{title:t.marketsResult.message,type:t.marketsResult.success?"success":"error",closable:!1,"show-icon":""}}):t._e()],1)],1)],1),s("el-card",{staticStyle:{"margin-top":"16px"},attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("同步历史")]),s("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:t.clearHistory}},[t._v("清空")])],1),s("el-table",{attrs:{data:t.syncHistory,stripe:"",border:"",size:"mini","max-height":"300"}},[s("el-table-column",{attrs:{prop:"type",label:"类型",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{type:t.syncTypeTag(a.type),size:"mini"}},[t._v(t._s(t.syncTypeLabel(a.type)))])]}}])}),s("el-table-column",{attrs:{prop:"node_name",label:"目标",width:"160"}}),s("el-table-column",{attrs:{prop:"message",label:"结果","show-overflow-tooltip":""}}),s("el-table-column",{attrs:{prop:"time",label:"时间",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(t.fmtDT(s.time)))]}}])}),s("el-table-column",{attrs:{label:"状态",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{type:a.success?"success":"danger",size:"mini"}},[t._v(t._s(a.success?"成功":"失败"))])]}}])})],1),0===t.syncHistory.length?s("el-empty",{attrs:{description:"暂无同步记录","image-size":60}}):t._e()],1)],1),s("el-tab-pane",{attrs:{label:"持仓监控 (SL/TP)",name:"monitor"}},[t.pmError?s("div",{staticStyle:{"margin-bottom":"12px"}},[s("el-alert",{attrs:{title:t.pmError,type:"error",closable:!1,"show-icon":""}})],1):t._e(),s("el-row",{attrs:{gutter:16}},[s("el-col",{attrs:{span:5}},[s("div",{staticClass:"pm-card"},[s("div",{staticClass:"pm-label"},[t._v("监控状态")]),s("div",{staticClass:"pm-value"},[s("el-tag",{attrs:{type:t.pmStatus.enabled?"success":"info",size:"medium",effect:"dark"}},[t._v(" "+t._s(t.pmStatus.enabled?"运行中":"未启用")+" ")])],1),s("div",{staticClass:"pm-desc"},[t._v(t._s(t.pmStatus.enabled?"自管SL/TP模式":"交易所SL/TP模式"))])])]),s("el-col",{attrs:{span:4}},[s("div",{staticClass:"pm-card"},[s("div",{staticClass:"pm-label"},[t._v("监控持仓")]),s("div",{staticClass:"pm-value pm-num"},[t._v(t._s(t.pmStats.positions_monitored||0))]),s("div",{staticClass:"pm-desc"},[t._v("带SL/TP的OPEN持仓")])])]),s("el-col",{attrs:{span:4}},[s("div",{staticClass:"pm-card"},[s("div",{staticClass:"pm-label"},[t._v("触发次数")]),s("div",{staticClass:"pm-value pm-num"},[t._v(t._s(t.pmStats.triggers_total||0))]),s("div",{staticClass:"pm-desc"},[s("span",{staticStyle:{color:"#67C23A"}},[t._v("成功 "+t._s(t.pmStats.closes_success||0))]),s("span",{staticStyle:{"margin-left":"4px",color:"#F56C6C"}},[t._v("失败 "+t._s(t.pmStats.closes_failed||0))])])])]),s("el-col",{attrs:{span:5}},[s("div",{staticClass:"pm-card"},[s("div",{staticClass:"pm-label"},[t._v("扫描频率")]),s("div",{staticClass:"pm-value",staticStyle:{"font-size":"20px",color:"#409EFF"}},[t._v(t._s(t.pmConfig.interval||"?")+"s / 次")]),s("div",{staticClass:"pm-desc"},[t._v("上次: "+t._s(t.pmStats.last_scan_at?t.fmtDT(t.pmStats.last_scan_at):"-"))])])]),s("el-col",{attrs:{span:6}},[s("div",{staticClass:"pm-card",staticStyle:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center"}},[s("el-button",{staticStyle:{"margin-bottom":"8px",width:"100%"},attrs:{type:"primary",icon:"el-icon-refresh",loading:t.loadingPM},on:{click:t.refreshPM}},[t._v(" 刷新状态 ")]),s("el-button",{staticStyle:{width:"100%"},attrs:{type:"warning",icon:"el-icon-aim",loading:t.scanning,disabled:!t.pmStatus.enabled},on:{click:t.handleTriggerScan}},[t._v(" 手动扫描一次 ")])],1)])],1),s("el-card",{staticStyle:{"margin-top":"16px"},attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",{staticStyle:{"font-weight":"600"}},[t._v("监控持仓明细")]),s("el-button",{staticStyle:{"margin-left":"12px"},attrs:{type:"text",size:"small",loading:t.loadingPositions},on:{click:t.fetchMonitoredPositions}},[t._v("刷新")]),s("el-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"text",size:"small",loading:t.loadingPrices},on:{click:t.fetchPrices}},[s("i",{staticClass:"el-icon-data-line"}),t._v(" 刷新价格 ")]),s("el-switch",{staticStyle:{float:"right","margin-top":"2px"},attrs:{"active-text":"自动刷新价格","inactive-text":""},on:{change:t.toggleAutoRefresh},model:{value:t.autoRefreshPrices,callback:function(e){t.autoRefreshPrices=e},expression:"autoRefreshPrices"}})],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingPositions,expression:"loadingPositions"}],attrs:{data:t.monitoredPositions,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa"},"max-height":"500"}},[s("el-table-column",{attrs:{label:"交易对",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("span",{staticStyle:{"font-weight":"600"}},[t._v(t._s(a.symbol))])]}}])}),s("el-table-column",{attrs:{label:"交易所",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{size:"mini",effect:"plain"}},[t._v(t._s((a.exchange||"").toUpperCase()))])]}}])}),s("el-table-column",{attrs:{label:"方向",width:"60",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{type:"LONG"===a.position_side?"success":"danger",size:"mini",effect:"dark"}},[t._v(" "+t._s("LONG"===a.position_side?"多":"空")+" ")])]}}])}),s("el-table-column",{attrs:{label:"数量",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(s.quantity))]}}])}),s("el-table-column",{attrs:{label:"入场价",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.entry_price?s("span",[t._v(t._s(t.fmtPrice(a.entry_price)))]):s("span",{staticClass:"muted"},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"实时价格",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t.getPrice(a)?s("span",{style:t.pnlColor(a)},[s("b",[t._v(t._s(t.fmtPrice(t.getPrice(a))))])]):s("span",{staticClass:"muted"},[t._v(t._s(t.loadingPrices?"加载中...":"未获取"))])]}}])}),s("el-table-column",{attrs:{label:"浮动盈亏",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t.getPrice(a)&&a.entry_price?s("span",{style:t.pnlColor(a)},[t._v(" "+t._s(t.calcPnlPct(a))+" ")]):s("span",{staticClass:"muted"},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"止损",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.stop_loss?s("span",{staticStyle:{color:"#F56C6C","font-weight":"600"}},[t._v(t._s(t.fmtPrice(a.stop_loss)))]):s("span",{staticClass:"muted"},[t._v("未设置")])]}}])}),s("el-table-column",{attrs:{label:"止盈",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.take_profit?s("span",{staticStyle:{color:"#67C23A","font-weight":"600"}},[t._v(t._s(t.fmtPrice(a.take_profit)))]):s("span",{staticClass:"muted"},[t._v("未设置")])]}}])}),s("el-table-column",{attrs:{label:"杠杆",width:"55",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(s.leverage||"-")+"x")]}}])}),s("el-table-column",{attrs:{label:"策略",width:"130","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.strategy_code?s("span",[t._v(t._s(a.strategy_code))]):s("span",{staticClass:"muted"},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"用户",width:"150","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.user_email?s("span",[t._v(t._s(a.user_email))]):s("span",{staticClass:"muted"},[t._v("账户#"+t._s(a.account_id))])]}}])})],1),t.loadingPositions||0!==t.monitoredPositions.length?t._e():s("el-empty",{attrs:{description:"当前没有被监控的持仓","image-size":60}})],1)],1),s("el-tab-pane",{attrs:{label:"市场信息",name:"markets"}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"space-between"},attrs:{slot:"header"},slot:"header"},[s("span",{staticStyle:{"font-weight":"600"}},[t._v("已同步的市场信息")]),t.mkTotal>0?s("span",{staticClass:"muted",staticStyle:{"font-size":"12px"}},[t._v("共 "+t._s(t.mkTotal)+" 个交易对")]):t._e()]),s("el-form",{staticStyle:{"margin-bottom":"12px"},attrs:{inline:!0,size:"small"}},[s("el-form-item",{attrs:{label:"交易所"}},[s("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"全部",clearable:""},on:{change:t.fetchMarkets},model:{value:t.mkFilter.exchange,callback:function(e){t.$set(t.mkFilter,"exchange",e)},expression:"mkFilter.exchange"}},[s("el-option",{attrs:{label:"Binance",value:"binance"}}),s("el-option",{attrs:{label:"Gate",value:"gate"}}),s("el-option",{attrs:{label:"OKX",value:"okx"}})],1)],1),s("el-form-item",{attrs:{label:"类型"}},[s("el-select",{staticStyle:{width:"110px"},attrs:{placeholder:"全部",clearable:""},on:{change:t.fetchMarkets},model:{value:t.mkFilter.market_type,callback:function(e){t.$set(t.mkFilter,"market_type",e)},expression:"mkFilter.market_type"}},[s("el-option",{attrs:{label:"永续合约",value:"swap"}}),s("el-option",{attrs:{label:"现货",value:"spot"}})],1)],1),s("el-form-item",{attrs:{label:"搜索"}},[s("el-input",{staticStyle:{width:"160px"},attrs:{placeholder:"输入币种如 BTC",clearable:""},on:{clear:t.fetchMarkets},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.fetchMarkets.apply(null,arguments)}},model:{value:t.mkFilter.symbol,callback:function(e){t.$set(t.mkFilter,"symbol",e)},expression:"mkFilter.symbol"}},[s("i",{staticClass:"el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.fetchMarkets}},[t._v("查询")]),s("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:t.resetMkFilter}},[t._v("重置")])],1)],1),t.mkList.length>0?s("el-row",{staticStyle:{"margin-bottom":"12px"},attrs:{gutter:12}},t._l(t.mkExchangeSummary,(function(e){return s("el-col",{key:e.name,attrs:{span:6}},[s("div",{staticClass:"mk-summary-card"},[s("span",{staticClass:"mk-summary-label"},[t._v(t._s(e.name.toUpperCase()))]),s("span",{staticClass:"mk-summary-value"},[t._v(t._s(e.count))]),s("span",{staticClass:"mk-summary-desc"},[t._v("个交易对")])])])})),1):t._e(),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.mkLoading,expression:"mkLoading"}],attrs:{data:t.mkPagedList,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa"},"max-height":"500"}},[s("el-table-column",{attrs:{label:"交易对",width:"130",fixed:""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("span",{staticStyle:{"font-weight":"600"}},[t._v(t._s(a.canonical_symbol))])]}}])}),s("el-table-column",{attrs:{label:"交易所",width:"90",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{size:"mini",type:t.mkExTagType(a.exchange),effect:"plain"}},[t._v(t._s((a.exchange||"").toUpperCase()))])]}}])}),s("el-table-column",{attrs:{label:"类型",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{size:"mini",type:"swap"===a.market_type?"warning":"",effect:"plain"}},[t._v(" "+t._s("swap"===a.market_type?"合约":"现货")+" ")])]}}])}),s("el-table-column",{attrs:{label:"合约面值",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.contract_size&&1!==a.contract_size?s("span",[t._v(t._s(a.contract_size))]):s("span",{staticClass:"muted"},[t._v("1")])]}}])}),s("el-table-column",{attrs:{label:"价格精度",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[null!=a.price_precision?s("span",[t._v(t._s(a.price_precision))]):s("span",{staticClass:"muted"},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"数量精度",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[null!=a.amount_precision?s("span",[t._v(t._s(a.amount_precision))]):s("span",{staticClass:"muted"},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"最小数量",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.min_quantity?s("span",[t._v(t._s(a.min_quantity))]):s("span",{staticClass:"muted"},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"最小金额",width:"90",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.min_cost?s("span",[t._v(t._s(a.min_cost))]):s("span",{staticClass:"muted"},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"Tick Size",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.tick_size?s("span",[t._v(t._s(a.tick_size))]):s("span",{staticClass:"muted"},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"Step Size",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[a.step_size?s("span",[t._v(t._s(a.step_size))]):s("span",{staticClass:"muted"},[t._v("-")])]}}])}),s("el-table-column",{attrs:{label:"基础/计价",width:"110",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("span",{staticStyle:{"font-weight":"500"}},[t._v(t._s(a.base_currency))]),s("span",{staticClass:"muted"},[t._v(" / "+t._s(a.quote_currency))])]}}])}),s("el-table-column",{attrs:{label:"同步时间",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(t.fmtDT(s.synced_at)))]}}])})],1),t.mkLoading||0!==t.mkList.length?t._e():s("el-empty",{attrs:{description:"暂无市场数据，请先在「数据同步」中同步市场信息","image-size":80}}),t.mkTotal>0?s("div",{staticStyle:{"margin-top":"12px",display:"flex","justify-content":"space-between","align-items":"center"}},[s("span",{staticClass:"muted",staticStyle:{"font-size":"12px"}},[t._v(" 显示 "+t._s((t.mkPage-1)*t.mkPageSize+1)+"–"+t._s(Math.min(t.mkPage*t.mkPageSize,t.mkFilteredList.length))+" / "+t._s(t.mkFilteredList.length)+" 条 ")]),s("el-pagination",{attrs:{background:"",layout:"prev, pager, next, sizes",total:t.mkFilteredList.length,"page-sizes":[20,50,100,200],"page-size":t.mkPageSize,"current-page":t.mkPage},on:{"update:pageSize":function(e){t.mkPageSize=e},"update:page-size":function(e){t.mkPageSize=e},"update:currentPage":function(e){t.mkPage=e},"update:current-page":function(e){t.mkPage=e},"size-change":function(e){t.mkPage=1},"current-change":function(){}}})],1):t._e()],1)],1),s("el-tab-pane",{attrs:{label:"信号冷却",name:"cooldown"}},[s("el-card",{attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("当前冷却中的策略-币对")]),s("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:t.loadingPM},on:{click:t.fetchPMStatus}},[t._v("刷新")])],1),s("el-table",{attrs:{data:t.pmCooldowns,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa"}}},[s("el-table-column",{attrs:{prop:"strategy",label:"策略",width:"220"}}),s("el-table-column",{attrs:{prop:"symbol",label:"交易对",width:"140"}}),s("el-table-column",{attrs:{label:"剩余冷却",width:"120",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-tag",{attrs:{type:"warning",size:"small",effect:"dark"}},[t._v(t._s(a.remaining_minutes)+" 分钟")])]}}])}),s("el-table-column",{attrs:{prop:"cooldown_until",label:"冷却截止"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(t.fmtDT(s.cooldown_until)))]}}])})],1),0===t.pmCooldowns.length?s("el-empty",{attrs:{description:"当前没有冷却中的策略","image-size":60}}):t._e()],1)],1)],1)],1)},i=[],n=(s("e9c4"),s("0643"),s("2382"),s("fffc"),s("4e3e"),s("a573"),s("0f66")),l={name:"SyncManage",data(){return{activeTab:"monitor",nodes:[],balanceNodeId:null,positionNodeId:null,syncingBalance:!1,syncingPositions:!1,syncingTrades:!1,syncingMarkets:!1,balanceResult:null,positionResult:null,tradesResult:null,marketsResult:null,tradesNodeId:null,marketExchange:null,marketType:"swap",syncHistory:[],loadingPM:!1,pmError:null,pmStatus:{enabled:!1},pmStats:{},pmConfig:{},pmCooldowns:[],monitoredPositions:[],loadingPositions:!1,scanning:!1,mkLoading:!1,mkList:[],mkTotal:0,mkPage:1,mkPageSize:50,mkFilter:{exchange:"",market_type:"",symbol:""},priceMap:{},loadingPrices:!1,autoRefreshPrices:!1,priceTimer:null,positionTimer:null}},watch:{activeTab(t,e){"monitor"===e&&"monitor"!==t&&this.stopAutoRefresh(),"monitor"===t&&this.fetchMonitoredPositions(),"markets"===t&&0===this.mkList.length&&this.fetchMarkets()}},mounted(){this.fetchNodes(),this.loadHistory(),this.fetchPMStatus(),this.fetchMonitoredPositions()},beforeDestroy(){this.stopAutoRefresh()},methods:{fmtDT(t){if(!t)return"-";try{return new Date(t).toLocaleString("zh-CN")}catch{return t}},fmtPrice(t){if(null==t)return"-";const e=Number(t);return isNaN(e)?t:e>=100?e.toFixed(2):e>=1?e.toFixed(4):e.toFixed(6)},getPrice(t){const e=(t.exchange||"").toLowerCase();if(e){const s=`${e}:${t.symbol}`;if(this.priceMap[s])return this.priceMap[s]}return this.priceMap[t.symbol]||null},pnlColor(t){const e=this.getPrice(t),s=Number(t.entry_price);if(!e||!s)return"";const a="LONG"===t.position_side,i=a?e>s:e<s;return i?"color:#67C23A;font-weight:600":"color:#F56C6C;font-weight:600"},calcPnlPct(t){const e=this.getPrice(t),s=Number(t.entry_price);if(!e||!s||0===s)return"-";const a="LONG"===t.position_side,i=a?(e-s)/s*100:(s-e)/s*100,n=i>=0?"+":"";return n+i.toFixed(2)+"%"},syncTypeLabel(t){return{balance:"余额",position:"持仓",trades:"成交",markets:"市场"}[t]||t},syncTypeTag(t){return{balance:"primary",position:"success",trades:"warning",markets:""}[t]||"info"},async fetchNodes(){try{const t=await Object(n["f"])();this.nodes=t.data.data||[]}catch(t){this.$message.error("获取节点列表失败")}},async handleSyncBalance(){if(!this.balanceNodeId)return void this.$message.warning("请选择目标节点");this.syncingBalance=!0,this.balanceResult=null;const t=this.nodes.find(t=>t.id===this.balanceNodeId),e=t?`${t.name} (${t.node_code})`:"未知",s=new Date;try{await Object(n["i"])({node_id:this.balanceNodeId}),this.balanceResult={success:!0,message:"余额同步完成"},this.addHistory("balance",e,"余额同步完成",!0,s),this.$message.success("余额同步完成")}catch(i){var a;const t="同步失败: "+((null===(a=i.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||i.message);this.balanceResult={success:!1,message:t},this.addHistory("balance",e,t,!1,s)}finally{this.syncingBalance=!1}},async handleSyncPositions(){if(!this.positionNodeId)return void this.$message.warning("请选择目标节点");this.syncingPositions=!0,this.positionResult=null;const t=this.nodes.find(t=>t.id===this.positionNodeId),e=t?`${t.name} (${t.node_code})`:"未知",s=new Date;try{await Object(n["k"])({node_id:this.positionNodeId}),this.positionResult={success:!0,message:"持仓同步完成"},this.addHistory("position",e,"持仓同步完成",!0,s),this.$message.success("持仓同步完成")}catch(i){var a;const t="同步失败: "+((null===(a=i.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||i.message);this.positionResult={success:!1,message:t},this.addHistory("position",e,t,!1,s)}finally{this.syncingPositions=!1}},async handleSyncTrades(){this.syncingTrades=!0,this.tradesResult=null;const t=this.tradesNodeId?this.nodes.find(t=>t.id===this.tradesNodeId):null,e=t?`${t.name} (${t.node_code})`:"全部节点",s=new Date;try{const t={};this.tradesNodeId&&(t.node_id=this.tradesNodeId),await Object(n["l"])(t),this.tradesResult={success:!0,message:"成交同步完成"},this.addHistory("trades",e,"成交同步完成",!0,s),this.$message.success("成交同步完成")}catch(i){var a;const t="同步失败: "+((null===(a=i.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||i.message);this.tradesResult={success:!1,message:t},this.addHistory("trades",e,t,!1,s)}finally{this.syncingTrades=!1}},async handleSyncMarkets(){this.syncingMarkets=!0,this.marketsResult=null;const t=new Date,e=this.marketExchange?this.marketExchange.toUpperCase():"全部";try{const s={market_type:this.marketType};this.marketExchange&&(s.exchange=this.marketExchange),await Object(n["j"])(s),this.marketsResult={success:!0,message:`市场信息同步完成 (${e})`},this.addHistory("markets",e,"市场信息同步完成",!0,t),this.$message.success("市场信息同步完成")}catch(a){var s;const i="同步失败: "+((null===(s=a.response)||void 0===s||null===(s=s.data)||void 0===s?void 0:s.detail)||a.message);this.marketsResult={success:!1,message:i},this.addHistory("markets",e,i,!1,t)}finally{this.syncingMarkets=!1}},addHistory(t,e,s,a,i){this.syncHistory.unshift({type:t,node_name:e,message:s,success:a,time:i.toISOString()}),this.syncHistory.length>50&&(this.syncHistory=this.syncHistory.slice(0,50)),this.saveHistory()},saveHistory(){try{localStorage.setItem("sync_history",JSON.stringify(this.syncHistory))}catch(t){}},loadHistory(){try{const t=localStorage.getItem("sync_history");t&&(this.syncHistory=JSON.parse(t))}catch(t){}},clearHistory(){this.$confirm("确定清空所有同步历史记录吗？","提示",{type:"warning"}).then(()=>{this.syncHistory=[],this.saveHistory(),this.$message.success("已清空")}).catch(()=>{})},refreshPM(){this.fetchPMStatus(),this.fetchMonitoredPositions()},async fetchPMStatus(){this.loadingPM=!0,this.pmError=null;try{const t=await Object(n["g"])(),e=t.data||{},s=e.config||{};this.pmStatus={enabled:!0===s.position_monitor},this.pmStats=e.position_monitor_stats||{},this.pmConfig={interval:s.position_monitor_interval||s.interval_seconds||"-",syncInterval:s.sync_interval_seconds||"-",strategiesCount:s.strategies_count||0,exchangeSlTp:s.exchange_sl_tp||!1},this.pmCooldowns=e.cooldowns||[]}catch(e){var t;this.pmError="无法获取持仓监控状态："+((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||e.message||"服务不可达"),this.pmStatus={enabled:!1},this.pmStats={},this.pmConfig={},this.pmCooldowns=[]}finally{this.loadingPM=!1}},async fetchMonitoredPositions(){this.loadingPositions=!0;try{const t=await Object(n["d"])();this.monitoredPositions=t.data.data||[],this.monitoredPositions.length>0&&this.fetchPrices()}catch(t){this.monitoredPositions=[]}finally{this.loadingPositions=!1}},async handleTriggerScan(){this.scanning=!0;try{const e=await Object(n["m"])(),s=e.data||{};var t;if(s.success)this.$message.success("扫描完成，监控持仓: "+((null===(t=s.data)||void 0===t?void 0:t.positions_monitored)||0)),this.fetchPMStatus(),this.fetchMonitoredPositions();else this.$message.warning(s.message||s.error||"扫描未成功")}catch(s){var e;this.$message.error("手动扫描失败: "+((null===(e=s.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||s.message))}finally{this.scanning=!1}},async fetchPrices(){if(0!==this.monitoredPositions.length){this.loadingPrices=!0;try{const t=new Set,e=[];this.monitoredPositions.forEach(s=>{const a=(s.exchange||"").toLowerCase(),i=a?`${a}:${s.symbol}`:s.symbol;t.has(i)||(t.add(i),e.push(i))});const s=[...new Set(this.monitoredPositions.map(t=>t.symbol))].join(","),a=e.join(","),i=await Object(n["h"])(s,a),l=(i.data||{}).exchange_prices||{},o=(i.data||{}).prices||{},r={};Object.keys(l).forEach(t=>{l[t]&&l[t].last&&(r[t]=l[t].last)}),Object.keys(o).forEach(t=>{!r[t]&&o[t]&&o[t].last&&(r[t]=o[t].last)}),this.priceMap=r}catch(t){}finally{this.loadingPrices=!1}}},toggleAutoRefresh(t){t?(this.fetchPrices(),this.priceTimer=setInterval(()=>{this.fetchPrices()},1e4),this.positionTimer=setInterval(()=>{this.fetchMonitoredPositions()},3e4)):this.stopAutoRefresh()},stopAutoRefresh(){this.priceTimer&&(clearInterval(this.priceTimer),this.priceTimer=null),this.positionTimer&&(clearInterval(this.positionTimer),this.positionTimer=null),this.autoRefreshPrices=!1},async fetchMarkets(){this.mkLoading=!0,this.mkPage=1;try{const t={};this.mkFilter.exchange&&(t.exchange=this.mkFilter.exchange),this.mkFilter.market_type&&(t.market_type=this.mkFilter.market_type),this.mkFilter.symbol&&(t.symbol=this.mkFilter.symbol);const e=await Object(n["c"])(t);this.mkList=e.data.data||[],this.mkTotal=e.data.total||this.mkList.length}catch(e){var t;this.$message.error("获取市场信息失败: "+((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.detail)||e.message)),this.mkList=[],this.mkTotal=0}finally{this.mkLoading=!1}},resetMkFilter(){this.mkFilter={exchange:"",market_type:"",symbol:""},this.fetchMarkets()},mkExTagType(t){const e={binance:"warning",gate:"",okx:"success"};return e[(t||"").toLowerCase()]||"info"}},computed:{mkFilteredList(){if(!this.mkFilter.symbol)return this.mkList;const t=this.mkFilter.symbol.toUpperCase();return this.mkList.filter(e=>(e.canonical_symbol||"").toUpperCase().includes(t)||(e.base_currency||"").toUpperCase().includes(t))},mkPagedList(){const t=(this.mkPage-1)*this.mkPageSize;return this.mkFilteredList.slice(t,t+this.mkPageSize)},mkExchangeSummary(){const t={};return this.mkList.forEach(e=>{const s=(e.exchange||"unknown").toLowerCase();t[s]=(t[s]||0)+1}),Object.keys(t).sort().map(e=>({name:e,count:t[e]}))}}},o=l,r=(s("0668"),s("2877")),c=Object(r["a"])(o,a,i,!1,null,"4506acc4",null);e["default"]=c.exports},b288:function(t,e,s){}}]);