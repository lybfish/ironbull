(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2fdcfd74"],{"0f66":function(t,e,a){"use strict";a.d(e,"f",(function(){return i})),a.d(e,"a",(function(){return r})),a.d(e,"n",(function(){return l})),a.d(e,"b",(function(){return o})),a.d(e,"e",(function(){return c})),a.d(e,"i",(function(){return u})),a.d(e,"k",(function(){return d})),a.d(e,"l",(function(){return f})),a.d(e,"j",(function(){return m})),a.d(e,"c",(function(){return b})),a.d(e,"g",(function(){return h})),a.d(e,"d",(function(){return p})),a.d(e,"m",(function(){return g})),a.d(e,"h",(function(){return _}));var n=a("bc3a"),s=a.n(n);function i(t={}){return s.a.get("/nodes",{params:t})}function r(t){return s.a.post("/nodes",t)}function l(t,e){return s.a.put("/nodes/"+t,e)}function o(t){return s.a.delete("/nodes/"+t)}function c(t){return s.a.get(`/nodes/${t}/accounts`)}function u(t={}){return s.a.post("/sync/balance",t)}function d(t={}){return s.a.post("/sync/positions",t)}function f(t={}){return s.a.post("/sync/trades",t)}function m(t={}){return s.a.post("/sync/markets",t)}function b(t={}){return s.a.get("/sync/markets",{params:t})}function h(){return s.a.get("/signal-monitor/status")}function p(){return s.a.get("/sync/monitored-positions")}function g(){return s.a.post("/signal-monitor/trigger-scan")}function _(t,e){const a={symbols:t};return e&&(a.exchange_symbols=e),s.a.get("/signal-monitor/realtime-prices",{params:a})}},"1f83":function(t,e,a){"use strict";a("5713")},5713:function(t,e,a){},"5ce7":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ele-body"},[a("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[a("el-col",{attrs:{lg:8,md:12,sm:12}},[a("stat-card",{attrs:{title:"总节点数",value:t.stats.total,icon:"el-icon-s-platform",color:"primary",loading:t.loading}})],1),a("el-col",{attrs:{lg:8,md:12,sm:12}},[a("stat-card",{attrs:{title:"在线节点",value:t.stats.online,icon:"el-icon-success",color:"success",loading:t.loading}})],1),a("el-col",{attrs:{lg:8,md:12,sm:12}},[a("stat-card",{attrs:{title:"离线节点",value:t.stats.offline,icon:"el-icon-error",color:"danger",loading:t.loading}})],1)],1),a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"toolbar"},[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:function(e){return t.showDialog()}}},[t._v("新建节点")]),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:t.fetchData}},[t._v("刷新")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"12px"},attrs:{data:t.list,stripe:"",border:"",size:"small"}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"60"}}),a("el-table-column",{attrs:{prop:"node_code",label:"节点编码",width:"120"}}),a("el-table-column",{attrs:{prop:"name",label:"名称",width:"150"}}),a("el-table-column",{attrs:{prop:"base_url",label:"地址",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",{attrs:{title:n.base_url}},[t._v(t._s(t.truncateUrl(n.base_url)))])]}}])}),a("el-table-column",{attrs:{prop:"is_active",label:"状态",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-tag",{attrs:{type:t.isNodeOnline(n)?"success":"info",size:"mini"}},[t._v(" "+t._s(t.isNodeOnline(n)?"在线":"离线")+" ")])]}}])}),a("el-table-column",{attrs:{prop:"account_count",label:"绑定账户",width:"90",align:"center"}}),a("el-table-column",{attrs:{prop:"last_heartbeat_at",label:"最后心跳",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatDateTime(a.last_heartbeat_at))+" ")]}}])}),a("el-table-column",{attrs:{prop:"created_at",label:"创建时间",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.formatDateTime(a.created_at))+" ")]}}])}),a("el-table-column",{attrs:{label:"操作",width:"240",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.showDialog(n)}}},[t._v("编辑")]),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(e){return t.viewAccounts(n)}}},[t._v("查看账户")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleDelete(n)}}},[t._v("删除")])]}}])})],1)],1),a("el-dialog",{attrs:{title:t.editId?"编辑节点":"新建节点",visible:t.dialogVisible,width:"480px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"节点编码",prop:"node_code"}},[a("el-input",{attrs:{disabled:!!t.editId,placeholder:"唯一标识"},model:{value:t.form.node_code,callback:function(e){t.$set(t.form,"node_code",e)},expression:"form.node_code"}})],1),a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"节点名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"基础地址",prop:"base_url"}},[a("el-input",{attrs:{placeholder:"如 http://192.168.1.10:19101"},model:{value:t.form.base_url,callback:function(e){t.$set(t.form,"base_url",e)},expression:"form.base_url"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary",loading:t.saving},on:{click:t.handleSave}},[t._v("确定")])],1)],1),a("el-dialog",{attrs:{title:"节点关联账户",visible:t.accountsVisible,width:"700px"},on:{"update:visible":function(e){t.accountsVisible=e}}},[a("el-table",{attrs:{data:t.nodeAccounts,stripe:"",border:"",size:"small"}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"60"}}),a("el-table-column",{attrs:{prop:"exchange",label:"交易所",width:"100"}}),a("el-table-column",{attrs:{prop:"account_label",label:"标签",width:"150"}}),a("el-table-column",{attrs:{prop:"tenant_name",label:"租户",width:"120"}}),a("el-table-column",{attrs:{prop:"api_key",label:"API Key","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.maskApiKey(a.api_key))+" ")]}}])})],1),t.loadingAccounts||0!==t.nodeAccounts.length?t._e():a("el-empty",{attrs:{description:"暂无关联账户"}})],1)],1)},s=[],i=(a("0643"),a("2382"),a("0f66")),r={name:"NodeManage",data(){return{loading:!1,saving:!1,loadingAccounts:!1,list:[],stats:{total:0,online:0,offline:0},dialogVisible:!1,editId:null,form:{node_code:"",name:"",base_url:""},rules:{node_code:[{required:!0,message:"请输入节点编码",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入节点名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],base_url:[{required:!0,message:"请输入基础地址",trigger:"blur"},{type:"url",message:"请输入有效的URL地址",trigger:"blur"}]},accountsVisible:!1,nodeAccounts:[]}},mounted(){this.fetchData()},methods:{async fetchData(){this.loading=!0;try{const t=await Object(i["f"])();this.list=t.data.data||[],this.calculateStats()}catch(t){this.$message.error("获取节点列表失败")}finally{this.loading=!1}},calculateStats(){this.stats.total=this.list.length,this.stats.online=this.list.filter(t=>this.isNodeOnline(t)).length,this.stats.offline=this.stats.total-this.stats.online},isNodeOnline(t){if(!t.last_heartbeat_at)return!1;const e=new Date(t.last_heartbeat_at).getTime(),a=Date.now();return a-e<3e5},truncateUrl(t){return t?t.length<=30?t:t.substring(0,27)+"...":"-"},formatDateTime(t){return t?new Date(t).toLocaleString("zh-CN"):"-"},maskApiKey(t){return t?t.length<=8?t:t.substring(0,4)+"****"+t.substring(t.length-4):"-"},showDialog(t){t?(this.editId=t.id,this.form={node_code:t.node_code,name:t.name,base_url:t.base_url||""}):(this.editId=null,this.form={node_code:"",name:"",base_url:""}),this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.form&&this.$refs.form.clearValidate()})},async handleSave(){this.$refs.form.validate(async t=>{if(t){this.saving=!0;try{this.editId?await Object(i["n"])(this.editId,{name:this.form.name,base_url:this.form.base_url}):await Object(i["a"])(this.form),this.$message.success("保存成功"),this.dialogVisible=!1,this.fetchData()}catch(a){var e;const t=(null===(e=a.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||a.message||"保存失败";this.$message.error(t)}finally{this.saving=!1}}})},handleDelete(t){this.$confirm("确定删除节点 "+t.name+"?","提示",{type:"warning"}).then(async()=>{try{await Object(i["b"])(t.id),this.$message.success("已删除"),this.fetchData()}catch(a){var e;const t=(null===(e=a.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||a.message||"删除失败";this.$message.error(t)}}).catch(()=>{})},async viewAccounts(t){this.accountsVisible=!0,this.loadingAccounts=!0;try{const e=await Object(i["e"])(t.id);this.nodeAccounts=e.data.data||[]}catch(e){this.$message.error("获取关联账户失败"),this.nodeAccounts=[]}finally{this.loadingAccounts=!1}}}},l=r,o=(a("1f83"),a("2877")),c=Object(o["a"])(l,n,s,!1,null,"68a6e229",null);e["default"]=c.exports}}]);