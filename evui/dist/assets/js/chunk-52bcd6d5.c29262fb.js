(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-52bcd6d5"],{"1acd":function(t,a,e){"use strict";e("bcd7")},"3f2a":function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"ele-body ele-body-card"},[e("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[e("el-col",{attrs:{lg:6,md:12,sm:12}},[e("el-card",{staticClass:"stat-card",attrs:{shadow:"never"}},[e("div",{staticClass:"stat-title"},[t._v("待结算")]),e("div",{staticClass:"stat-value text-warning"},[t._v(t._s(t.stats.pending?t.stats.pending.count:0))]),e("div",{staticClass:"stat-sub"},[t._v(t._s(t.formatAmount(t.stats.pending?t.stats.pending.total_amount:0))+" USDT")])])],1),e("el-col",{attrs:{lg:6,md:12,sm:12}},[e("el-card",{staticClass:"stat-card",attrs:{shadow:"never"}},[e("div",{staticClass:"stat-title"},[t._v("已结算")]),e("div",{staticClass:"stat-value text-success"},[t._v(t._s(t.stats.settled?t.stats.settled.count:0))]),e("div",{staticClass:"stat-sub"},[t._v(t._s(t.formatAmount(t.stats.settled?t.stats.settled.total_amount:0))+" USDT")])])],1),e("el-col",{attrs:{lg:6,md:12,sm:12}},[e("el-card",{staticClass:"stat-card",attrs:{shadow:"never"}},[e("div",{staticClass:"stat-title"},[e("i",{staticClass:"el-icon-warning",staticStyle:{color:"#F56C6C"}}),t._v(" 分发失败 ")]),e("div",{staticClass:"stat-value text-danger"},[t._v(t._s(t.stats.failed?t.stats.failed.count:0))]),e("div",{staticClass:"stat-sub"},[t._v(t._s(t.formatAmount(t.stats.failed?t.stats.failed.total_amount:0))+" USDT")])])],1),e("el-col",{attrs:{lg:6,md:12,sm:12}},[e("el-card",{staticClass:"stat-card",attrs:{shadow:"never"}},[e("div",{staticClass:"stat-title"},[e("i",{staticClass:"el-icon-circle-close",staticStyle:{color:"#909399"}}),t._v(" 超限无法恢复 ")]),e("div",{staticClass:"stat-value",staticStyle:{color:"#909399"}},[t._v(t._s(t.stats.stuck?t.stats.stuck.count:0))]),e("div",{staticClass:"stat-sub"},[t._v(t._s(t.stats.stuck?t.stats.stuck.description:""))])])],1)],1),e("el-card",{attrs:{shadow:"never"}},[e("div",{staticClass:"ele-toolbar",staticStyle:{"margin-bottom":"15px"}},[e("el-select",{staticStyle:{width:"130px","margin-right":"10px"},attrs:{placeholder:"状态",clearable:"",size:"small"},model:{value:t.where.status,callback:function(a){t.$set(t.where,"status",a)},expression:"where.status"}},[e("el-option",{attrs:{label:"全部",value:null}}),e("el-option",{attrs:{label:"待结算",value:1}}),e("el-option",{attrs:{label:"已结算",value:2}}),e("el-option",{attrs:{label:"分发失败",value:3}})],1),e("el-input",{staticStyle:{width:"120px","margin-right":"10px"},attrs:{placeholder:"用户ID",clearable:"",size:"small"},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.fetchData.apply(null,arguments)}},model:{value:t.where.user_id,callback:function(a){t.$set(t.where,"user_id",a)},expression:"where.user_id"}}),e("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search"},on:{click:t.fetchData}},[t._v("查询")]),e("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:t.resetFilter}},[t._v("重置")]),e("el-button",{staticStyle:{"margin-left":"auto"},attrs:{size:"small",type:"warning",icon:"el-icon-refresh-right",loading:t.batchRetrying,disabled:!t.hasFailedPools},on:{click:t.batchRetry}},[t._v(" 批量重试失败 ")])],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.list,stripe:"",size:"small",border:"","header-cell-style":{background:"#fafafa"},"row-class-name":t.rowClass}},[e("el-table-column",{attrs:{prop:"id",label:"ID",width:"70"}}),e("el-table-column",{attrs:{label:"用户",width:"160"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("div",[e("span",{staticClass:"user-link",on:{click:function(a){return t.filterByUser(s.user_id)}}},[t._v(t._s(s.user_email||"-"))])]),e("div",{staticStyle:{"font-size":"11px",color:"#909399"}},[t._v("ID: "+t._s(s.user_id))])]}}])}),e("el-table-column",{attrs:{label:"利润",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("span",{staticStyle:{color:"#67C23A"}},[t._v("+"+t._s(t.formatAmount(s.profit_amount)))])]}}])}),e("el-table-column",{attrs:{label:"扣费",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("span",{staticStyle:{color:"#F56C6C"}},[t._v("-"+t._s(t.formatAmount(s.deduct_amount)))])]}}])}),e("el-table-column",{attrs:{label:"进池金额",width:"110",align:"right"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("span",{staticStyle:{"font-weight":"600"}},[t._v(t._s(t.formatAmount(s.pool_amount)))])]}}])}),e("el-table-column",{attrs:{label:"分配详情","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[2===s.status?[e("el-tag",{staticStyle:{"margin-right":"4px"},attrs:{size:"mini",type:"info"}},[t._v("技术 "+t._s(t.formatAmount(s.tech_amount)))]),e("el-tag",{staticStyle:{"margin-right":"4px"},attrs:{size:"mini",type:"success"}},[t._v("直推 "+t._s(t.formatAmount(s.direct_distributed)))]),e("el-tag",{staticStyle:{"margin-right":"4px"},attrs:{size:"mini",type:"warning"}},[t._v("级差 "+t._s(t.formatAmount(s.diff_distributed)))]),e("el-tag",{staticStyle:{"margin-right":"4px"},attrs:{size:"mini"}},[t._v("平级 "+t._s(t.formatAmount(s.peer_distributed)))]),e("el-tag",{attrs:{size:"mini",type:"info"}},[t._v("留存 "+t._s(t.formatAmount(s.platform_amount)))])]:3===s.status?[e("div",{staticStyle:{color:"#F56C6C","font-size":"12px"}},[e("i",{staticClass:"el-icon-warning"}),t._v(" 重试 "+t._s(s.retry_count)+" 次 · "+t._s(s.last_error?s.last_error.substring(0,80):"未知错误")+" ")])]:[e("span",{staticStyle:{color:"#909399"}},[t._v("等待结算...")])]]}}])}),e("el-table-column",{attrs:{label:"状态",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("el-tag",{attrs:{type:t.statusTagType(s.status),size:"small"}},[t._v(t._s(s.status_text))])]}}])}),e("el-table-column",{attrs:{label:"创建时间",width:"165"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("span",{staticStyle:{"font-size":"12px"}},[t._v(t._s(s.created_at||"-"))])]}}])}),e("el-table-column",{attrs:{label:"操作",width:"90",align:"center",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[3===s.status||1===s.status?e("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-refresh-right",loading:s._retrying},on:{click:function(a){return t.handleRetry(s)}}},[t._v(" 重试 ")]):e("span",{staticStyle:{color:"#C0C4CC","font-size":"12px"}},[t._v("-")])]}}])})],1),e("el-pagination",{staticStyle:{"margin-top":"15px","text-align":"right"},attrs:{background:"",layout:"total, prev, pager, next, sizes",total:t.total,"current-page":t.page,"page-size":t.pageSize,"page-sizes":[20,50,100]},on:{"update:currentPage":function(a){t.page=a},"update:current-page":function(a){t.page=a},"update:pageSize":function(a){t.pageSize=a},"update:page-size":function(a){t.pageSize=a},"size-change":t.fetchData,"current-change":t.fetchData}})],1)],1)},i=[],r=(e("0643"),e("a573"),e("cd05")),n={name:"ProfitPools",data(){return{loading:!1,batchRetrying:!1,list:[],total:0,page:1,pageSize:20,where:{status:null,user_id:""},stats:{}}},computed:{hasFailedPools(){return this.stats.failed&&this.stats.failed.count>0}},mounted(){this.fetchData(),this.fetchStats()},methods:{formatAmount(t){return t||0===t?parseFloat(t).toFixed(4):"0.00"},statusTagType(t){return{1:"warning",2:"success",3:"danger"}[t]||"info"},rowClass({row:t}){return 3===t.status?"row-failed":""},filterByUser(t){this.where.user_id=String(t),this.page=1,this.fetchData()},resetFilter(){this.where={status:null,user_id:""},this.page=1,this.fetchData()},async fetchStats(){try{const t=await Object(r["e"])();this.stats=t.data&&t.data.data||t.data||{}}catch(t){console.error(t)}},async fetchData(){this.loading=!0;try{const t={page:this.page,page_size:this.pageSize};null!==this.where.status&&""!==this.where.status&&(t.status=this.where.status),this.where.user_id&&(t.user_id=parseInt(this.where.user_id)||void 0);const a=await Object(r["f"])(t),e=a.data;this.list=(e.data||[]).map(t=>({...t,_retrying:!1})),this.total=e.total||0}catch(t){this.$message.error("加载利润池数据失败")}finally{this.loading=!1}},async handleRetry(t){try{await this.$confirm(`确认重试利润池 #${t.id}（用户 ${t.user_email||t.user_id}，金额 ${this.formatAmount(t.pool_amount)} USDT）？`,"重试分发",{type:"warning"})}catch{return}t._retrying=!0;try{await Object(r["k"])(t.id),this.$message.success(`利润池 #${t.id} 分发成功`),this.fetchData(),this.fetchStats()}catch(a){const t=a.response&&a.response.data&&a.response.data.detail||"重试失败";this.$message.error(t),this.fetchData(),this.fetchStats()}finally{t._retrying=!1}},async batchRetry(){const t=this.stats.failed?this.stats.failed.count:0;try{await this.$confirm(`将对 ${t} 条失败记录逐一重试分发，是否继续？`,"批量重试",{type:"warning"})}catch{return}this.batchRetrying=!0;try{const t=await Object(r["f"])({status:3,page:1,page_size:100}),a=t.data&&t.data.data||[];let e=0,s=0;for(const i of a)try{await Object(r["k"])(i.id),e++}catch{s++}this.$message.success(`批量重试完成：成功 ${e}，失败 ${s}`)}catch(a){this.$message.error("批量重试出错")}finally{this.batchRetrying=!1,this.fetchData(),this.fetchStats()}}}},l=n,o=(e("1acd"),e("2877")),c=Object(o["a"])(l,s,i,!1,null,"618235c4",null);a["default"]=c.exports},bcd7:function(t,a,e){},cd05:function(t,a,e){"use strict";e.d(a,"g",(function(){return r})),e.d(a,"c",(function(){return n})),e.d(a,"m",(function(){return l})),e.d(a,"l",(function(){return o})),e.d(a,"i",(function(){return c})),e.d(a,"a",(function(){return u})),e.d(a,"j",(function(){return d})),e.d(a,"b",(function(){return f})),e.d(a,"d",(function(){return h})),e.d(a,"h",(function(){return p})),e.d(a,"f",(function(){return g})),e.d(a,"e",(function(){return m})),e.d(a,"k",(function(){return _}));var s=e("bc3a"),i=e.n(s);function r(t={}){return i.a.get("/quota-plans",{params:t})}function n(t){return i.a.post("/quota-plans",t)}function l(t,a){return i.a.put("/quota-plans/"+t,a)}function o(t){return i.a.patch(`/quota-plans/${t}/toggle`)}function c(t={}){return i.a.get("/withdrawals",{params:t})}function u(t){return i.a.post(`/withdrawals/${t}/approve`)}function d(t,a=""){return i.a.post(`/withdrawals/${t}/reject`,{reason:a})}function f(t,a=""){return i.a.post(`/withdrawals/${t}/complete`,{tx_hash:a})}function h(t={}){return i.a.get("/pointcard-logs",{params:t})}function p(t={}){return i.a.get("/rewards",{params:t})}function g(t={}){return i.a.get("/profit-pools",{params:t})}function m(){return i.a.get("/profit-pools/stats")}function _(t){return i.a.post(`/profit-pools/${t}/retry`)}}}]);