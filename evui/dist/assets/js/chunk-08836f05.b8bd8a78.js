(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-08836f05"],{"4d2b":function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"ele-body ele-body-card"},[e("el-row",{attrs:{gutter:15}},[e("el-col",{attrs:{lg:14,md:24}},[e("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{shadow:"never"}},[e("div",{staticClass:"hdr",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("风控规则配置")]),e("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-check",loading:t.saving},on:{click:t.saveRules}},[t._v("保存")])],1),t._l(t.rules,(function(a){return e("div",{key:a.name,staticClass:"rule-item"},[e("div",{staticClass:"rule-header"},[e("el-switch",{staticStyle:{"margin-right":"12px"},attrs:{"active-text":a.description},model:{value:a.enabled,callback:function(e){t.$set(a,"enabled",e)},expression:"rule.enabled"}}),e("el-tag",{attrs:{type:t.severityType(a.severity),size:"mini"}},[t._v(t._s(a.severity))])],1),a.enabled?e("div",{staticClass:"rule-params"},[t._l(a.params,(function(s,i){return[e("div",{key:i,staticClass:"param-row"},"symbols"!==i?[e("span",{staticClass:"param-label"},[t._v(t._s(t.paramLabel(i)))]),e("el-input-number",{staticStyle:{width:"160px"},attrs:{min:0,size:"small"},model:{value:a.params[i],callback:function(e){t.$set(a.params,i,e)},expression:"rule.params[key]"}})]:[e("span",{staticClass:"param-label"},[t._v(t._s(t.paramLabel(i)))]),e("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"逗号分隔，如 BTC/USDT,ETH/USDT",size:"small"},model:{value:a.symbolsStr,callback:function(e){t.$set(a,"symbolsStr",e)},expression:"rule.symbolsStr"}})],1)]}))],2):t._e()])})),0!==t.rules.length||t.loading?t._e():e("el-empty",{attrs:{description:"无规则数据"}})],2)],1),e("el-col",{attrs:{lg:10,md:24}},[e("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.violationLoading,expression:"violationLoading"}],staticStyle:{"margin-bottom":"15px"},attrs:{shadow:"never"}},[e("div",{staticClass:"hdr",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("风控违规统计")]),e("el-radio-group",{attrs:{size:"mini"},on:{change:t.fetchViolations},model:{value:t.violationDays,callback:function(a){t.violationDays=a},expression:"violationDays"}},[e("el-radio-button",{attrs:{label:7}},[t._v("7天")]),e("el-radio-button",{attrs:{label:14}},[t._v("14天")]),e("el-radio-button",{attrs:{label:30}},[t._v("30天")])],1)],1),e("div",{ref:"chartViolation",staticStyle:{height:"200px"}}),e("div",{staticStyle:{"margin-top":"12px"}},[t._l(t.violationByRule,(function(a){return e("div",{key:a.rule,staticClass:"violation-rule"},[e("span",{staticClass:"violation-name"},[t._v(t._s(a.rule))]),e("el-progress",{staticStyle:{flex:"1",margin:"0 12px"},attrs:{percentage:a.pct,"stroke-width":14,color:a.count>10?"#F56C6C":"#E6A23C"}}),e("span",{staticClass:"violation-count"},[t._v(t._s(a.count))])],1)})),0!==t.violationByRule.length||t.violationLoading?t._e():e("el-empty",{attrs:{description:"近期无违规","image-size":50}})],2)]),t.recentViolations.length>0?e("el-card",{attrs:{shadow:"never"}},[e("div",{attrs:{slot:"header"},slot:"header"},[t._v("最近违规记录")]),e("el-table",{attrs:{data:t.recentViolations,size:"mini",stripe:"","max-height":"300"}},[e("el-table-column",{attrs:{prop:"error_code",label:"规则",width:"160"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("el-tag",{attrs:{type:"danger",size:"mini"}},[t._v(t._s(s.error_code))])]}}],null,!1,4149448491)}),e("el-table-column",{attrs:{prop:"error_message",label:"描述","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"created_at",label:"时间",width:"155"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[e("span",{staticStyle:{"font-size":"11px"}},[t._v(t._s((s.created_at||"").replace("T"," ").slice(0,19)))])]}}],null,!1,3188053423)})],1)],1):t._e()],1)],1)],1)},i=[],l=(e("0643"),e("2382"),e("a573"),e("7cf8")),o=e("22b4"),r=e("1be7"),n=e("4cb5"),c=e("4b2a"),d=e("2da7"),u=e("f95e");o["a"]([n["a"],c["a"],d["a"],u["a"]]);const m={min_balance:"最小余额 (USDT)",max_positions:"最大持仓数",max_value:"最大仓位价值 (USDT)",max_trades:"最大交易次数",max_loss:"最大亏损 (USDT)",max_consecutive:"最大连续亏损次数",cooldown_minutes:"冷却分钟数",cooldown_seconds:"冷却秒数",symbols:"品种列表"};var p={name:"RiskConfig",data(){return{loading:!1,saving:!1,violationLoading:!1,rules:[],violationDays:7,violationByRule:[],recentViolations:[],violationChart:null}},mounted(){this.fetchRules(),this.fetchViolations()},beforeDestroy(){this.violationChart&&this.violationChart.dispose()},methods:{paramLabel(t){return m[t]||t},severityType(t){return{critical:"danger",error:"warning",warning:"info"}[t]||""},async fetchRules(){this.loading=!0;try{const t=await Object(l["h"])(),a=t.data&&t.data.data||[];this.rules=a.map(t=>{const a={...t};return t.params&&t.params.symbols&&(a.symbolsStr=(t.params.symbols||[]).join(",")),a})}catch(t){this.$message.error("加载风控规则失败")}finally{this.loading=!1}},async saveRules(){this.saving=!0;try{const t={};for(const a of this.rules){const e={...a.params};void 0!==a.symbolsStr&&(e.symbols=a.symbolsStr.split(",").map(t=>t.trim()).filter(Boolean)),t[a.name]={enabled:a.enabled,...e}}await Object(l["m"])({rules:t}),this.$message.success("风控规则已保存")}catch(t){this.$message.error("保存失败")}finally{this.saving=!1}},async fetchViolations(){this.violationLoading=!0;try{const t=await Object(l["i"])(this.violationDays),a=t.data&&t.data.data||{},e=a.by_rule||[],s=Math.max(...e.map(t=>t.count),1);this.violationByRule=e.map(t=>({...t,pct:Math.round(t.count/s*100)})),this.recentViolations=a.recent||[],this.$nextTick(()=>{this.renderViolationChart(a.daily||{})})}catch(t){console.error(t)}finally{this.violationLoading=!1}},renderViolationChart(t){const a=this.$refs.chartViolation;a&&(this.violationChart||(this.violationChart=r["b"](a)),this.violationChart.setOption({tooltip:{trigger:"axis"},grid:{left:40,right:10,top:10,bottom:25},xAxis:{type:"category",data:(t.dates||[]).map(t=>t.slice(5)),axisLabel:{fontSize:11}},yAxis:{type:"value",minInterval:1,splitLine:{lineStyle:{color:"#F2F6FC"}}},series:[{type:"bar",data:t.counts||[],itemStyle:{color:"#F56C6C",borderRadius:[3,3,0,0]},barMaxWidth:16}]},!0))}}},v=p,h=(e("7263"),e("2877")),y=Object(h["a"])(v,s,i,!1,null,"089064c0",null);a["default"]=y.exports},7263:function(t,a,e){"use strict";e("d3af")},d3af:function(t,a,e){}}]);