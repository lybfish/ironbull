(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5928b8c0"],{"091c":function(t,e,a){},"14e1":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ele-body"},[a("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[a("el-col",{attrs:{lg:6,md:12}},[a("el-card",{staticClass:"stat-mini",attrs:{shadow:"never"}},[a("div",{staticClass:"stat-mini-label"},[t._v("总操作数")]),a("div",{staticClass:"stat-mini-val"},[t._v(t._s(t.stats.success_count+t.stats.fail_count))])])],1),a("el-col",{attrs:{lg:6,md:12}},[a("el-card",{staticClass:"stat-mini",attrs:{shadow:"never"}},[a("div",{staticClass:"stat-mini-label"},[t._v("成功")]),a("div",{staticClass:"stat-mini-val text-success"},[t._v(t._s(t.stats.success_count))])])],1),a("el-col",{attrs:{lg:6,md:12}},[a("el-card",{staticClass:"stat-mini",attrs:{shadow:"never"}},[a("div",{staticClass:"stat-mini-label"},[t._v("失败")]),a("div",{staticClass:"stat-mini-val text-danger"},[t._v(t._s(t.stats.fail_count))])])],1),a("el-col",{attrs:{lg:6,md:12}},[a("el-card",{staticClass:"stat-mini",attrs:{shadow:"never"}},[a("div",{staticClass:"stat-mini-label"},[t._v("操作趋势")]),a("div",{ref:"chartMini",staticStyle:{height:"50px"}})])],1)],1),a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"toolbar"},[a("el-input",{staticStyle:{width:"130px"},attrs:{placeholder:"操作人",clearable:"",size:"small"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.fetchData.apply(null,arguments)}},model:{value:t.filters.admin_name,callback:function(e){t.$set(t.filters,"admin_name",e)},expression:"filters.admin_name"}}),a("el-input",{staticStyle:{width:"130px","margin-left":"8px"},attrs:{placeholder:"操作类型",clearable:"",size:"small"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.fetchData.apply(null,arguments)}},model:{value:t.filters.action,callback:function(e){t.$set(t.filters,"action",e)},expression:"filters.action"}}),a("el-select",{staticStyle:{width:"100px","margin-left":"8px"},attrs:{placeholder:"结果",clearable:"",size:"small"},model:{value:t.filters.success,callback:function(e){t.$set(t.filters,"success",e)},expression:"filters.success"}},[a("el-option",{attrs:{label:"成功",value:!0}}),a("el-option",{attrs:{label:"失败",value:!1}})],1),a("el-input",{staticStyle:{width:"130px","margin-left":"8px"},attrs:{placeholder:"来源服务",clearable:"",size:"small"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.fetchData.apply(null,arguments)}},model:{value:t.filters.source_service,callback:function(e){t.$set(t.filters,"source_service",e)},expression:"filters.source_service"}}),a("el-date-picker",{staticStyle:{width:"240px","margin-left":"8px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small","value-format":"yyyy-MM-dd"},on:{change:t.handleDateChange},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}}),a("el-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary",size:"small",icon:"el-icon-search"},on:{click:t.fetchData}},[t._v("查询")]),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:t.handleReset}},[t._v("重置")]),a("el-button",{staticStyle:{"margin-left":"auto"},attrs:{size:"small",type:"success",icon:"el-icon-download",loading:t.exporting},on:{click:t.handleExport}},[t._v("导出CSV")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"12px"},attrs:{data:t.list,stripe:"",border:"",size:"small"}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"60"}}),a("el-table-column",{attrs:{prop:"admin_name",label:"操作人",width:"110"}}),a("el-table-column",{attrs:{prop:"action",label:"操作类型",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-tag",{attrs:{size:"mini",type:t.getActionTagType(s.action)}},[t._v(t._s(s.action))])]}}])}),a("el-table-column",{attrs:{label:"结果",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-tag",{attrs:{type:!1!==s.success?"success":"danger",size:"mini"}},[t._v(" "+t._s(!1!==s.success?"成功":"失败")+" ")])]}}])}),a("el-table-column",{attrs:{label:"变更",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[s.status_before||s.status_after?[a("span",{staticClass:"change-before"},[t._v(t._s(s.status_before||"-"))]),a("i",{staticClass:"el-icon-right",staticStyle:{margin:"0 4px",color:"#409EFF"}}),a("span",{staticClass:"change-after"},[t._v(t._s(s.status_after||"-"))])]:a("span",{staticStyle:{color:"#C0C4CC"}},[t._v("-")])]}}])}),a("el-table-column",{attrs:{prop:"source_service",label:"来源",width:"100"}}),a("el-table-column",{attrs:{label:"耗时",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[s.duration_ms?a("span",{style:{color:s.duration_ms>1e3?"#F56C6C":"#909399"}},[t._v(" "+t._s(s.duration_ms)+"ms ")]):a("span",{staticStyle:{color:"#C0C4CC"}},[t._v("-")])]}}])}),a("el-table-column",{attrs:{prop:"detail",label:"详情","min-width":"200","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-tooltip",{attrs:{content:s.detail||"-",placement:"top",effect:"dark"}},[a("span",[t._v(t._s(s.detail||"-"))])])]}}])}),a("el-table-column",{attrs:{prop:"ip",label:"IP",width:"120"}}),a("el-table-column",{attrs:{prop:"created_at",label:"时间",width:"170"}})],1),t.total>0?a("el-pagination",{staticStyle:{"margin-top":"16px","text-align":"right"},attrs:{"current-page":t.pagination.page,"page-sizes":[10,20,50,100],"page-size":t.pagination.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}):t._e(),t.loading||0!==t.list.length?t._e():a("el-empty",{attrs:{description:"暂无审计日志"}})],1)],1)},i=[],n=(a("0643"),a("a573"),a("7cf8")),l=a("22b4"),r=a("1be7"),c=a("3620"),o=a("4b2a"),u=a("f95e");l["a"]([c["a"],o["a"],u["a"]]);var d={name:"AuditLog",data(){return{loading:!1,exporting:!1,list:[],total:0,dateRange:null,filters:{admin_name:"",action:"",success:null,source_service:""},pagination:{page:1,size:20},stats:{success_count:0,fail_count:0},miniChart:null}},mounted(){this.fetchData(),this.fetchStats()},beforeDestroy(){this.miniChart&&this.miniChart.dispose()},methods:{async fetchData(){this.loading=!0;try{const t={page:this.pagination.page,page_size:this.pagination.size};this.filters.admin_name&&(t.admin_name=this.filters.admin_name),this.filters.action&&(t.action=this.filters.action),null!==this.filters.success&&""!==this.filters.success&&(t.success=this.filters.success),this.filters.source_service&&(t.source_service=this.filters.source_service),this.dateRange&&2===this.dateRange.length&&(t.start_date=this.dateRange[0],t.end_date=this.dateRange[1]);const e=await Object(n["e"])(t);this.list=e.data.data||[],this.total=e.data.total||this.list.length}catch(t){this.$message.error("获取审计日志失败")}finally{this.loading=!1}},async fetchStats(){try{const t=await Object(n["d"])(30),e=t.data&&t.data.data||{};this.stats={success_count:e.success_count||0,fail_count:e.fail_count||0},this.$nextTick(()=>{this.renderMiniChart(e.daily||{})})}catch(t){}},renderMiniChart(t){const e=this.$refs.chartMini;e&&(this.miniChart||(this.miniChart=r["b"](e)),this.miniChart.setOption({grid:{left:0,right:0,top:0,bottom:0},xAxis:{show:!1,type:"category",data:(t.dates||[]).map(t=>t.slice(5))},yAxis:{show:!1,type:"value"},series:[{type:"line",data:t.counts||[],smooth:!0,symbol:"none",lineStyle:{color:"#409EFF",width:2},areaStyle:{color:"#409EFF20"}}]},!0))},async handleExport(){this.exporting=!0;try{const t={};this.filters.action&&(t.action=this.filters.action),this.filters.admin_name&&(t.admin_name=this.filters.admin_name),null!==this.filters.success&&""!==this.filters.success&&(t.success=this.filters.success),this.dateRange&&2===this.dateRange.length&&(t.start_date=this.dateRange[0],t.end_date=this.dateRange[1]);const e=await Object(n["c"])(t),a=new Blob([e.data],{type:"text/csv"}),s=window.URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download="audit_logs.csv",i.click(),window.URL.revokeObjectURL(s),this.$message.success("导出成功")}catch(t){this.$message.error("导出失败")}finally{this.exporting=!1}},handleDateChange(t){this.dateRange=t,this.fetchData()},handleReset(){this.filters={admin_name:"",action:"",success:null,source_service:""},this.dateRange=null,this.pagination.page=1,this.fetchData()},handleSizeChange(t){this.pagination.size=t,this.pagination.page=1,this.fetchData()},handleCurrentChange(t){this.pagination.page=t,this.fetchData()},getActionTagType(t){if(!t)return"";const e=t.toLowerCase();return e.includes("create")||e.includes("新增")?"success":e.includes("update")||e.includes("编辑")?"warning":e.includes("delete")||e.includes("删除")?"danger":e.includes("login")||e.includes("登录")?"primary":"info"}}},h=d,p=(a("d77f"),a("2877")),f=Object(p["a"])(h,s,i,!1,null,"d7ec8e22",null);e["default"]=f.exports},"7cf8":function(t,e,a){"use strict";a.d(e,"g",(function(){return n})),a.d(e,"f",(function(){return l})),a.d(e,"e",(function(){return r})),a.d(e,"c",(function(){return c})),a.d(e,"d",(function(){return o})),a.d(e,"j",(function(){return u})),a.d(e,"l",(function(){return d})),a.d(e,"k",(function(){return h})),a.d(e,"b",(function(){return p})),a.d(e,"a",(function(){return f})),a.d(e,"h",(function(){return g})),a.d(e,"m",(function(){return m})),a.d(e,"i",(function(){return _}));var s=a("bc3a"),i=a.n(s);function n(){return i.a.get("/monitor/status")}function l(t=7){return i.a.get("/monitor/metrics",{params:{days:t}})}function r(t={}){return i.a.get("/audit-logs",{params:t})}function c(t={}){return i.a.get("/audit-logs/export",{params:t,responseType:"blob"})}function o(t=30){return i.a.get("/audit-logs/stats",{params:{days:t}})}function u(t=30){return i.a.get("/user-analytics/overview",{params:{days:t}})}function d(t={}){return i.a.get("/user-analytics/ranking",{params:t})}function h(t=30){return i.a.get("/user-analytics/growth",{params:{days:t}})}function p(t){return i.a.post("/batch/toggle-users",t)}function f(t){return i.a.post("/batch/recharge-users",t)}function g(){return i.a.get("/risk/rules")}function m(t){return i.a.put("/risk/rules",t)}function _(t=7){return i.a.get("/risk/violations",{params:{days:t}})}},d77f:function(t,e,a){"use strict";a("091c")}}]);