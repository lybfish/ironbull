(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1fe01038"],{"50fc":function(e,t,a){"use strict";a.d(t,"v",(function(){return s})),a.d(t,"h",(function(){return n})),a.d(t,"K",(function(){return l})),a.d(t,"F",(function(){return o})),a.d(t,"z",(function(){return c})),a.d(t,"b",(function(){return d})),a.d(t,"u",(function(){return u})),a.d(t,"i",(function(){return m})),a.d(t,"L",(function(){return _})),a.d(t,"d",(function(){return p})),a.d(t,"l",(function(){return f})),a.d(t,"y",(function(){return g})),a.d(t,"w",(function(){return h})),a.d(t,"A",(function(){return b})),a.d(t,"x",(function(){return v})),a.d(t,"C",(function(){return y})),a.d(t,"G",(function(){return w})),a.d(t,"m",(function(){return F})),a.d(t,"e",(function(){return k})),a.d(t,"H",(function(){return x})),a.d(t,"D",(function(){return S})),a.d(t,"B",(function(){return $})),a.d(t,"s",(function(){return z})),a.d(t,"t",(function(){return D})),a.d(t,"g",(function(){return R})),a.d(t,"J",(function(){return C})),a.d(t,"k",(function(){return O})),a.d(t,"E",(function(){return I})),a.d(t,"o",(function(){return U})),a.d(t,"n",(function(){return T})),a.d(t,"f",(function(){return N})),a.d(t,"I",(function(){return V})),a.d(t,"j",(function(){return E})),a.d(t,"p",(function(){return B})),a.d(t,"a",(function(){return A})),a.d(t,"c",(function(){return L})),a.d(t,"q",(function(){return j})),a.d(t,"r",(function(){return q}));var r=a("bc3a"),i=a.n(r);function s(e={}){return i.a.get("/tenants",{params:e})}function n(e){return i.a.post("/tenants",e)}function l(e,t){return i.a.put("/tenants/"+e,t)}function o(e){return i.a.patch(`/tenants/${e}/toggle`)}function c(e,t){return i.a.post(`/tenants/${e}/recharge`,t)}function d(e,t){return i.a.post(`/tenants/${e}/assign-plan`,{plan_id:t})}function u(e,t={}){return i.a.get(`/tenants/${e}/tenant-strategies`,{params:t})}function m(e,t){return i.a.post(`/tenants/${e}/tenant-strategies`,t)}function _(e,t,a){return i.a.put(`/tenants/${e}/tenant-strategies/${t}`,a)}function p(e,t){return i.a.post(`/tenants/${e}/tenant-strategies/${t}/copy-from-master`)}function f(e,t){return i.a.delete(`/tenants/${e}/tenant-strategies/${t}`)}function g(e={}){return i.a.get("/users",{params:e})}function h(e){return i.a.get("/users/"+e)}function b(e,t){return i.a.post(`/users/${e}/recharge`,t)}function v(e,t={}){return i.a.get(`/users/${e}/team`,{params:t})}function y(e,t){return i.a.post(`/users/${e}/set-market-node`,t)}function w(e,t){return i.a.post(`/users/${e}/toggle-status`,{status:t})}function F(e={}){return i.a.get("/admins",{params:e})}function k(e){return i.a.post("/admins",e)}function x(e,t){return i.a.put("/admins/"+e,t)}function S(e){return i.a.patch(`/admins/${e}/toggle`)}function $(e,t){return i.a.post(`/admins/${e}/reset-password`,t)}function z(e={}){return i.a.get("/strategies",{params:e})}function D(e){return i.a.get("/strategies/"+e)}function R(e){return i.a.post("/strategies",e)}function C(e,t){return i.a.post("/strategies/"+e,t)}function O(e){return i.a.delete("/strategies/"+e)}function I(e){return i.a.patch(`/strategies/${e}/toggle`)}function U(e={}){return i.a.get("/strategy-bindings-admin",{params:e})}function T(){return i.a.get("/strategy-bindings-admin/form-options")}function N(e){return i.a.post("/strategy-bindings-admin",e)}function V(e,t){return i.a.put("/strategy-bindings-admin/"+e,t)}function E(e){return i.a.delete("/strategy-bindings-admin/"+e)}function B(e={}){return i.a.get("/exchange-accounts",{params:e})}function A(e,t){return i.a.put(`/exchange-accounts/${e}/assign-node`,t)}function L(e){return i.a.post("/exchange-accounts/batch-assign-node",e)}function j(e={}){return i.a.get("/signal-events",{params:e})}function q(){return i.a.get("/signal-events/strategies")}},"7a00":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ele-body"},[a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"toolbar"},[a("span",{staticClass:"toolbar-title"},[e._v("策略绑定")]),a("div",[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.openCreate}},[e._v("新增绑定")]),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh",loading:e.loading},on:{click:e.fetchData}},[e._v("刷新")])],1)]),a("div",{staticClass:"search-bar"},[a("el-form",{attrs:{inline:!0,size:"small"}},[a("el-form-item",{attrs:{label:"租户ID"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"租户ID",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch.apply(null,arguments)}},model:{value:e.where.tenant_id,callback:function(t){e.$set(e.where,"tenant_id",e._n(t))},expression:"where.tenant_id"}})],1),a("el-form-item",{attrs:{label:"用户ID"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"用户ID",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch.apply(null,arguments)}},model:{value:e.where.user_id,callback:function(t){e.$set(e.where,"user_id",e._n(t))},expression:"where.user_id"}})],1),a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"全部",clearable:""},model:{value:e.where.status,callback:function(t){e.$set(e.where,"status",t)},expression:"where.status"}},[a("el-option",{attrs:{label:"运行",value:1}}),a("el-option",{attrs:{label:"停止",value:0}})],1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.onSearch}},[e._v("查询")]),a("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:e.resetSearch}},[e._v("重置")])],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"12px"},attrs:{data:e.list,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa"}}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"55",align:"center"}}),a("el-table-column",{attrs:{prop:"tenant_name",label:"租户",width:"100","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"user_email",label:"用户","min-width":"140","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"strategy_name",label:"策略",width:"140","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"交易所",width:"85",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-tag",{attrs:{size:"mini",effect:"plain"}},[e._v(e._s((r.exchange||"").toUpperCase()))])]}}])}),a("el-table-column",{attrs:{prop:"exchange_account_label",label:"交易所账户",width:"130","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"mode",label:"模式",width:"70",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-tag",{attrs:{type:2===r.mode?"warning":"info",size:"mini"}},[e._v(e._s(2===r.mode?"循环":"单次"))])]}}])}),a("el-table-column",{attrs:{label:"本金",width:"80",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.capital>0?a("span",[e._v(e._s(e.formatNum(r.capital)))]):a("span",{staticStyle:{color:"#909399"}},[e._v("-")])]}}])}),a("el-table-column",{attrs:{label:"杠杆",width:"55",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(a.leverage||20)+"X")]}}])}),a("el-table-column",{attrs:{label:"仓位/风控",width:"140",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.risk_based_sizing?[a("div",{staticStyle:{"line-height":"1.5"}},[a("el-tag",{attrs:{type:"warning",size:"mini"}},[e._v("以损定仓")]),a("br"),a("span",{staticStyle:{"font-size":"11px",color:"#E6A23C"}},[e._v("每笔亏损≤"+e._s(r.max_loss_per_trade)+"U")])],1)]:[a("div",{staticStyle:{"line-height":"1.5"}},[r.amount_usdt>0?a("span",[e._v(e._s(e.formatNum(r.amount_usdt))+"U")]):a("span",{staticStyle:{color:"#909399"}},[e._v("-")]),r.risk_mode_label?a("br"):e._e(),a("span",{staticStyle:{"font-size":"11px",color:"#909399"}},[e._v(e._s(r.risk_mode_label))])])]]}}])}),a("el-table-column",{attrs:{label:"累计盈亏",width:"100",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{class:Number(r.total_profit||0)>=0?"text-success":"text-danger"},[e._v(" "+e._s(Number(r.total_profit||0)>=0?"+":"")+e._s(e.formatNum(r.total_profit))+" ")])]}}])}),a("el-table-column",{attrs:{label:"笔数",width:"55",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(a.total_trades||0))]}}])}),a("el-table-column",{attrs:{label:"状态",width:"65",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-tag",{attrs:{type:1===r.status?"success":"info",size:"mini",effect:"dark"}},[e._v(e._s(1===r.status?"运行":"停止"))])]}}])}),a("el-table-column",{attrs:{prop:"created_at",label:"时间",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(e.formatTime(a.created_at)))]}}])}),a("el-table-column",{attrs:{label:"操作",width:"140",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-view"},on:{click:function(t){return e.showDetail(r)}}},[e._v("详情")]),a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(t){return e.showEdit(r)}}},[e._v("编辑")]),0===r.status?a("el-button",{staticStyle:{color:"#F56C6C"},attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return e.handleDeleteBinding(r)}}},[e._v("删除")]):e._e()]}}])})],1),e.loading||0!==e.list.length?e._e():a("el-empty",{attrs:{description:"暂无策略绑定"}}),e.total>0?a("div",{staticStyle:{"margin-top":"12px",display:"flex","justify-content":"space-between","align-items":"center"}},[a("span",{staticClass:"tip"},[e._v("共 "+e._s(e.total)+" 条")]),a("el-pagination",{attrs:{background:"","current-page":e.page,"page-size":e.pageSize,total:e.total,layout:"prev, pager, next"},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"current-change":e.fetchData}})],1):e._e()],1),a("el-dialog",{attrs:{title:"绑定详情",visible:e.detailVisible,width:"560px","append-to-body":""},on:{"update:visible":function(t){e.detailVisible=t}}},[e.detailRow?a("el-descriptions",{attrs:{column:1,border:"",size:"small"}},[a("el-descriptions-item",{attrs:{label:"绑定ID"}},[e._v(e._s(e.detailRow.id))]),a("el-descriptions-item",{attrs:{label:"租户"}},[e._v(e._s(e.detailRow.tenant_name||"-")+" (ID: "+e._s(e.detailRow.tenant_id||"-")+")")]),a("el-descriptions-item",{attrs:{label:"用户"}},[e._v(e._s(e.detailRow.user_email||"-")+" (ID: "+e._s(e.detailRow.user_id)+")")]),a("el-descriptions-item",{attrs:{label:"策略"}},[e._v(e._s(e.detailRow.strategy_name||e.detailRow.strategy_code))]),a("el-descriptions-item",{attrs:{label:"交易所账户"}},[e._v(e._s(e.detailRow.exchange_account_label||"-")+" (ID: "+e._s(e.detailRow.account_id)+")")]),a("el-descriptions-item",{attrs:{label:"执行模式"}},[e._v(e._s(2===e.detailRow.mode?"循环执行":"单次执行"))]),a("el-descriptions-item",{attrs:{label:"本金"}},[e._v(e._s(e.detailRow.capital>0?e.formatNum(e.detailRow.capital)+" USDT":"未设置"))]),a("el-descriptions-item",{attrs:{label:"杠杆"}},[e._v(e._s(e.detailRow.leverage||20)+"X")]),a("el-descriptions-item",{attrs:{label:"仓位模式"}},[e.detailRow.risk_based_sizing?[a("el-tag",{attrs:{type:"warning",size:"small"}},[e._v("以损定仓")]),a("span",{staticStyle:{color:"#909399","font-size":"12px","margin-left":"4px"}},[e._v("每笔最大亏损 "+e._s(e.detailRow.max_loss_per_trade)+" USDT，仓位按止损距离自动调整")])]:[e._v(" "+e._s(e.detailRow.amount_usdt>0?e.formatNum(e.detailRow.amount_usdt)+" USDT":"-")+" "),e.detailRow.risk_mode_label?a("span",{staticStyle:{color:"#909399","font-size":"12px","margin-left":"4px"}},[e._v("("+e._s(e.detailRow.risk_mode_label)+")")]):e._e()]],2),a("el-descriptions-item",{attrs:{label:"累计盈亏"}},[e._v(e._s(e.formatNum(e.detailRow.total_profit)))]),a("el-descriptions-item",{attrs:{label:"交易笔数"}},[e._v(e._s(e.detailRow.total_trades||0))]),a("el-descriptions-item",{attrs:{label:"状态"}},[a("el-tag",{attrs:{type:1===e.detailRow.status?"success":"info",size:"small"}},[e._v(e._s(1===e.detailRow.status?"运行":"停止"))])],1),a("el-descriptions-item",{attrs:{label:"绑定时间"}},[e._v(e._s(e.formatTime(e.detailRow.created_at)))])],1):e._e(),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.detailVisible=!1}}},[e._v("关闭")])],1)],1),a("el-dialog",{attrs:{title:"新增策略绑定",visible:e.createVisible,width:"560px","append-to-body":""},on:{"update:visible":function(t){e.createVisible=t},open:e.loadFormOptions}},[a("el-form",{ref:"createForm",attrs:{model:e.createForm,"label-width":"110px",size:"small",rules:e.createRules}},[a("el-form-item",{attrs:{label:"用户",prop:"user_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"选择用户"},on:{change:e.onCreateUserChange},model:{value:e.createForm.user_id,callback:function(t){e.$set(e.createForm,"user_id",t)},expression:"createForm.user_id"}},e._l(e.formOptions.users,(function(e){return a("el-option",{key:e.id,attrs:{label:e.email+" (ID:"+e.id+") "+e.tenant_name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"交易所账户",prop:"account_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"选择账户"},model:{value:e.createForm.account_id,callback:function(t){e.$set(e.createForm,"account_id",t)},expression:"createForm.account_id"}},e._l(e.createUserAccounts,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label+" (ID:"+e.id+")",value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"策略",prop:"strategy_code"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"选择策略"},on:{change:e.onCreateStrategyChange},model:{value:e.createForm.strategy_code,callback:function(t){e.$set(e.createForm,"strategy_code",t)},expression:"createForm.strategy_code"}},e._l(e.formOptions.strategies,(function(e){return a("el-option",{key:e.code,attrs:{label:e.name+" ("+e.code+")",value:e.code}})})),1)],1),a("el-form-item",{attrs:{label:"执行模式"}},[a("el-radio-group",{model:{value:e.createForm.mode,callback:function(t){e.$set(e.createForm,"mode",t)},expression:"createForm.mode"}},[a("el-radio-button",{attrs:{label:2}},[e._v("循环执行")]),a("el-radio-button",{attrs:{label:1}},[e._v("单次执行")])],1)],1),a("el-form-item",{attrs:{label:"本金 (USDT)"}},[a("el-input-number",{staticStyle:{width:"200px"},attrs:{min:0,step:100,precision:2},model:{value:e.createForm.capital,callback:function(t){e.$set(e.createForm,"capital",t)},expression:"createForm.capital"}})],1),a("el-form-item",{attrs:{label:"杠杆"}},[a("el-select",{staticStyle:{width:"200px"},model:{value:e.createForm.leverage,callback:function(t){e.$set(e.createForm,"leverage",t)},expression:"createForm.leverage"}},e._l(e.leverageOptions,(function(e){return a("el-option",{key:e,attrs:{label:e+"X",value:e}})})),1)],1),e.createSelectedIsRiskBased?a("el-form-item",{attrs:{label:"每单最大亏损"}},[a("el-input-number",{staticStyle:{width:"200px"},attrs:{min:1,step:5,precision:2},model:{value:e.createForm.max_loss_per_trade,callback:function(t){e.$set(e.createForm,"max_loss_per_trade",t)},expression:"createForm.max_loss_per_trade"}}),a("span",{staticStyle:{color:"#909399","font-size":"12px","margin-left":"8px"}},[e._v("USDT")])],1):a("el-form-item",{attrs:{label:"风险档位"}},[a("el-radio-group",{model:{value:e.createForm.risk_mode,callback:function(t){e.$set(e.createForm,"risk_mode",t)},expression:"createForm.risk_mode"}},[a("el-radio-button",{attrs:{label:1}},[e._v("稳健 (1%)")]),a("el-radio-button",{attrs:{label:2}},[e._v("均衡 (1.5%)")]),a("el-radio-button",{attrs:{label:3}},[e._v("激进 (2%)")])],1)],1),a("el-form-item",{attrs:{label:"状态"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-text":"运行","inactive-text":"停止"},model:{value:e.createForm.status,callback:function(t){e.$set(e.createForm,"status",t)},expression:"createForm.status"}})],1),a("el-form-item",{attrs:{label:"预估"}},[a("div",{staticClass:"preview-box"},[e.createSelectedIsRiskBased?[a("div",[e._v("每笔最大亏损: "),a("b",{staticStyle:{color:"#E6A23C"}},[e._v(e._s(e.createForm.max_loss_per_trade||0)+" USDT")]),a("el-tag",{staticStyle:{"margin-left":"4px"},attrs:{type:"warning",size:"mini"}},[e._v("以损定仓")])],1),a("div",{staticStyle:{color:"#909399","font-size":"12px"}},[e._v("实际仓位按止损距离自动调整")])]:[a("div",[e._v("单笔保证金: "),a("b",[e._v(e._s(e.calcCreateMargin)+" USDT")])]),a("div",[e._v("单笔仓位: "),a("b",[e._v(e._s(e.calcCreateAmount)+" USDT")])]),a("div",{staticStyle:{color:"#909399","font-size":"12px"}},[e._v("= 本金 × "+e._s(e.createRiskPctLabel)+" × "+e._s(e.createForm.leverage)+"倍杠杆")])]],2)])],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.createVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.createLoading},on:{click:e.submitCreate}},[e._v("创建")])],1)],1),a("el-dialog",{attrs:{title:"编辑绑定参数",visible:e.editVisible,width:"520px","append-to-body":""},on:{"update:visible":function(t){e.editVisible=t}}},[e.editForm?a("el-form",{attrs:{"label-width":"110px",size:"small"}},[a("el-form-item",{attrs:{label:"用户"}},[a("span",[e._v(e._s(e.editForm._user_email)+" (ID: "+e._s(e.editForm._user_id)+")")])]),a("el-form-item",{attrs:{label:"策略"}},[a("span",[e._v(e._s(e.editForm._strategy_name))])]),a("el-form-item",{attrs:{label:"执行模式"}},[a("el-radio-group",{model:{value:e.editForm.mode,callback:function(t){e.$set(e.editForm,"mode",t)},expression:"editForm.mode"}},[a("el-radio-button",{attrs:{label:2}},[e._v("循环执行")]),a("el-radio-button",{attrs:{label:1}},[e._v("单次执行")])],1)],1),a("el-form-item",{attrs:{label:"本金 (USDT)"}},[a("el-input-number",{staticStyle:{width:"200px"},attrs:{min:0,step:100,precision:2},model:{value:e.editForm.capital,callback:function(t){e.$set(e.editForm,"capital",t)},expression:"editForm.capital"}})],1),a("el-form-item",{attrs:{label:"杠杆"}},[a("el-select",{staticStyle:{width:"200px"},model:{value:e.editForm.leverage,callback:function(t){e.$set(e.editForm,"leverage",t)},expression:"editForm.leverage"}},e._l(e.leverageOptions,(function(e){return a("el-option",{key:e,attrs:{label:e+"X",value:e}})})),1)],1),e.editForm._risk_based_sizing?a("el-form-item",{attrs:{label:"每单最大亏损"}},[a("el-input-number",{staticStyle:{width:"200px"},attrs:{min:1,step:5,precision:2},model:{value:e.editForm.max_loss_per_trade,callback:function(t){e.$set(e.editForm,"max_loss_per_trade",t)},expression:"editForm.max_loss_per_trade"}}),a("span",{staticStyle:{color:"#909399","font-size":"12px","margin-left":"8px"}},[e._v("USDT")])],1):a("el-form-item",{attrs:{label:"风险档位"}},[a("el-radio-group",{model:{value:e.editForm.risk_mode,callback:function(t){e.$set(e.editForm,"risk_mode",t)},expression:"editForm.risk_mode"}},[a("el-radio-button",{attrs:{label:1}},[e._v("稳健 (1%)")]),a("el-radio-button",{attrs:{label:2}},[e._v("均衡 (1.5%)")]),a("el-radio-button",{attrs:{label:3}},[e._v("激进 (2%)")])],1)],1),a("el-form-item",{attrs:{label:"状态"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-text":"运行","inactive-text":"停止"},model:{value:e.editForm.status,callback:function(t){e.$set(e.editForm,"status",t)},expression:"editForm.status"}})],1),a("el-form-item",{attrs:{label:"预估"}},[a("div",{staticClass:"preview-box"},[e.editForm._risk_based_sizing?[a("div",[e._v("每笔最大亏损: "),a("b",{staticStyle:{color:"#E6A23C"}},[e._v(e._s(e.editForm.max_loss_per_trade||0)+" USDT")]),a("el-tag",{staticStyle:{"margin-left":"4px"},attrs:{type:"warning",size:"mini"}},[e._v("以损定仓")])],1),a("div",{staticStyle:{color:"#909399","font-size":"12px"}},[e._v("实际仓位按止损距离自动调整")])]:[a("div",[e._v("单笔保证金: "),a("b",[e._v(e._s(e.calcEditMargin)+" USDT")])]),a("div",[e._v("单笔仓位: "),a("b",[e._v(e._s(e.calcEditAmount)+" USDT")])])]],2)])],1):e._e(),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.editLoading},on:{click:e.submitEdit}},[e._v("保存")])],1)],1)],1)},i=[],s=(a("0643"),a("2382"),a("fffc"),a("50fc"));const n={1:.01,2:.015,3:.02},l={1:"1%",2:"1.5%",3:"2%"};var o={name:"StrategyBindings",data(){return{loading:!1,list:[],total:0,page:1,pageSize:20,where:{tenant_id:null,user_id:null,status:null},leverageOptions:[3,5,10,15,20,25,50,75,100],detailVisible:!1,detailRow:null,createVisible:!1,createLoading:!1,formOptions:{strategies:[],users:[],accounts:[]},createForm:{user_id:null,account_id:null,strategy_code:"",mode:2,capital:200,leverage:20,risk_mode:1,max_loss_per_trade:20,status:1},createRules:{user_id:[{required:!0,message:"请选择用户",trigger:"change"}],account_id:[{required:!0,message:"请选择交易所账户",trigger:"change"}],strategy_code:[{required:!0,message:"请选择策略",trigger:"change"}]},editVisible:!1,editLoading:!1,editForm:null,editBindingId:null}},computed:{createSelectedStrategy(){return this.formOptions.strategies.find(e=>e.code===this.createForm.strategy_code)||null},createSelectedIsRiskBased(){return this.createSelectedStrategy&&this.createSelectedStrategy.risk_based_sizing},createUserAccounts(){return this.createForm.user_id?this.formOptions.accounts.filter(e=>e.user_id===this.createForm.user_id):this.formOptions.accounts},createRiskPctLabel(){return l[this.createForm.risk_mode]||"1%"},calcCreateMargin(){const e=Number(this.createForm.capital)||0,t=n[this.createForm.risk_mode]||.01;return(e*t).toFixed(2)},calcCreateAmount(){const e=Number(this.createForm.capital)||0,t=Number(this.createForm.leverage)||20,a=n[this.createForm.risk_mode]||.01;return(e*a*t).toFixed(2)},calcEditMargin(){if(!this.editForm)return"0.00";const e=n[this.editForm.risk_mode]||.01;return(Number(this.editForm.capital||0)*e).toFixed(2)},calcEditAmount(){if(!this.editForm)return"0.00";const e=n[this.editForm.risk_mode]||.01;return(Number(this.editForm.capital||0)*e*(this.editForm.leverage||20)).toFixed(2)}},mounted(){this.fetchData()},methods:{formatNum(e){return null!==e&&void 0!==e?parseFloat(e).toFixed(2):"0.00"},formatTime(e){return e?e.replace("T"," ").substring(0,19):"-"},onSearch(){this.page=1,this.fetchData()},resetSearch(){this.where={tenant_id:null,user_id:null,status:null},this.page=1,this.fetchData()},async fetchData(){this.loading=!0;try{const e={page:this.page,page_size:this.pageSize};null!=this.where.tenant_id&&""!==this.where.tenant_id&&(e.tenant_id=Number(this.where.tenant_id)),null!=this.where.user_id&&""!==this.where.user_id&&(e.user_id=Number(this.where.user_id)),null!==this.where.status&&""!==this.where.status&&(e.status=Number(this.where.status));const t=await Object(s["o"])(e),a=t.data;this.list=a.data||a||[],this.total=null!=a.total?a.total:this.list.length}catch(t){var e;this.$message.error((null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.detail)||"获取策略绑定失败")}finally{this.loading=!1}},showDetail(e){this.detailRow=e,this.detailVisible=!0},async loadFormOptions(){if(!(this.formOptions.strategies.length>0))try{const e=await Object(s["n"])();e.data.success&&(this.formOptions=e.data.data)}catch(e){this.$message.error("加载表单选项失败")}},openCreate(){this.createForm={user_id:null,account_id:null,strategy_code:"",mode:2,capital:200,leverage:20,risk_mode:1,max_loss_per_trade:20,status:1},this.createVisible=!0},onCreateUserChange(){this.createForm.account_id=null;const e=this.createUserAccounts;1===e.length&&(this.createForm.account_id=e[0].id)},onCreateStrategyChange(){const e=this.createSelectedStrategy;e&&(e.leverage&&(this.createForm.leverage=e.leverage),e.capital>0&&(this.createForm.capital=e.capital),e.max_loss_per_trade>0&&(this.createForm.max_loss_per_trade=e.max_loss_per_trade),e.risk_mode&&(this.createForm.risk_mode=e.risk_mode))},async submitCreate(){this.$refs.createForm.validate(async e=>{if(e){this.createLoading=!0;try{const e={user_id:this.createForm.user_id,account_id:this.createForm.account_id,strategy_code:this.createForm.strategy_code,mode:this.createForm.mode,capital:this.createForm.capital,leverage:this.createForm.leverage,status:this.createForm.status};this.createSelectedIsRiskBased?e.max_loss_per_trade=this.createForm.max_loss_per_trade:e.risk_mode=this.createForm.risk_mode;const t=await Object(s["f"])(e);t.data.success?(this.$message.success(t.data.message||"创建成功"),this.createVisible=!1,this.fetchData()):this.$message.error(t.data.message||"创建失败")}catch(r){var t,a;this.$message.error((null===(t=r.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||(null===(a=r.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||"创建失败")}finally{this.createLoading=!1}}})},showEdit(e){this.editBindingId=e.id,this.editForm={_user_email:e.user_email,_user_id:e.user_id,_strategy_name:e.strategy_name||e.strategy_code,_risk_based_sizing:!!e.risk_based_sizing,mode:e.mode||2,capital:e.capital||0,leverage:e.leverage||20,risk_mode:e.risk_mode||1,max_loss_per_trade:e.max_loss_per_trade||0,status:e.status},this.editVisible=!0},async submitEdit(){if(this.editBindingId){this.editLoading=!0;try{const e={mode:this.editForm.mode,status:this.editForm.status};this.editForm.capital>0&&(e.capital=this.editForm.capital),this.editForm.leverage>0&&(e.leverage=this.editForm.leverage),this.editForm._risk_based_sizing?e.max_loss_per_trade=this.editForm.max_loss_per_trade:this.editForm.risk_mode&&(e.risk_mode=this.editForm.risk_mode);const t=await Object(s["I"])(this.editBindingId,e),a=t.data;a.success?(this.$message.success(a.message||"修改成功"),this.editVisible=!1,this.fetchData()):this.$message.error(a.message||"修改失败")}catch(t){var e;this.$message.error((null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.message)||"修改失败")}finally{this.editLoading=!1}}},async handleDeleteBinding(e){try{await this.$confirm(`确定要删除绑定 #${e.id}（用户: ${e.user_email}，策略: ${e.strategy_name}）吗？`,"删除确认",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"error"})}catch{return}try{const t=await Object(s["j"])(e.id);t.data.success?(this.$message.success("删除成功"),this.fetchData()):this.$message.error(t.data.message||"删除失败")}catch(r){var t,a;this.$message.error((null===(t=r.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||(null===(a=r.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.detail)||"删除失败")}}}},c=o,d=(a("a8b0"),a("2877")),u=Object(d["a"])(c,r,i,!1,null,"f94bb6a2",null);t["default"]=u.exports},a8b0:function(e,t,a){"use strict";a("e10e")},e10e:function(e,t,a){}}]);