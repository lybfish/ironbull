(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5b2852a4"],{3116:function(t,e,a){},"50fc":function(t,e,a){"use strict";a.d(e,"v",(function(){return i})),a.d(e,"h",(function(){return n})),a.d(e,"K",(function(){return l})),a.d(e,"F",(function(){return o})),a.d(e,"z",(function(){return d})),a.d(e,"b",(function(){return c})),a.d(e,"u",(function(){return m})),a.d(e,"i",(function(){return u})),a.d(e,"L",(function(){return p})),a.d(e,"d",(function(){return _})),a.d(e,"l",(function(){return g})),a.d(e,"y",(function(){return f})),a.d(e,"w",(function(){return h})),a.d(e,"A",(function(){return b})),a.d(e,"x",(function(){return y})),a.d(e,"C",(function(){return v})),a.d(e,"G",(function(){return F})),a.d(e,"m",(function(){return x})),a.d(e,"e",(function(){return k})),a.d(e,"H",(function(){return w})),a.d(e,"D",(function(){return S})),a.d(e,"B",(function(){return $})),a.d(e,"s",(function(){return z})),a.d(e,"t",(function(){return N})),a.d(e,"g",(function(){return I})),a.d(e,"J",(function(){return A})),a.d(e,"k",(function(){return C})),a.d(e,"E",(function(){return L})),a.d(e,"o",(function(){return U})),a.d(e,"n",(function(){return O})),a.d(e,"f",(function(){return D})),a.d(e,"I",(function(){return E})),a.d(e,"j",(function(){return T})),a.d(e,"p",(function(){return V})),a.d(e,"a",(function(){return R})),a.d(e,"c",(function(){return j})),a.d(e,"q",(function(){return M})),a.d(e,"r",(function(){return B}));var r=a("bc3a"),s=a.n(r);function i(t={}){return s.a.get("/tenants",{params:t})}function n(t){return s.a.post("/tenants",t)}function l(t,e){return s.a.put("/tenants/"+t,e)}function o(t){return s.a.patch(`/tenants/${t}/toggle`)}function d(t,e){return s.a.post(`/tenants/${t}/recharge`,e)}function c(t,e){return s.a.post(`/tenants/${t}/assign-plan`,{plan_id:e})}function m(t,e={}){return s.a.get(`/tenants/${t}/tenant-strategies`,{params:e})}function u(t,e){return s.a.post(`/tenants/${t}/tenant-strategies`,e)}function p(t,e,a){return s.a.put(`/tenants/${t}/tenant-strategies/${e}`,a)}function _(t,e){return s.a.post(`/tenants/${t}/tenant-strategies/${e}/copy-from-master`)}function g(t,e){return s.a.delete(`/tenants/${t}/tenant-strategies/${e}`)}function f(t={}){return s.a.get("/users",{params:t})}function h(t){return s.a.get("/users/"+t)}function b(t,e){return s.a.post(`/users/${t}/recharge`,e)}function y(t,e={}){return s.a.get(`/users/${t}/team`,{params:e})}function v(t,e){return s.a.post(`/users/${t}/set-market-node`,e)}function F(t,e){return s.a.post(`/users/${t}/toggle-status`,{status:e})}function x(t={}){return s.a.get("/admins",{params:t})}function k(t){return s.a.post("/admins",t)}function w(t,e){return s.a.put("/admins/"+t,e)}function S(t){return s.a.patch(`/admins/${t}/toggle`)}function $(t,e){return s.a.post(`/admins/${t}/reset-password`,e)}function z(t={}){return s.a.get("/strategies",{params:t})}function N(t){return s.a.get("/strategies/"+t)}function I(t){return s.a.post("/strategies",t)}function A(t,e){return s.a.post("/strategies/"+t,e)}function C(t){return s.a.delete("/strategies/"+t)}function L(t){return s.a.patch(`/strategies/${t}/toggle`)}function U(t={}){return s.a.get("/strategy-bindings-admin",{params:t})}function O(){return s.a.get("/strategy-bindings-admin/form-options")}function D(t){return s.a.post("/strategy-bindings-admin",t)}function E(t,e){return s.a.put("/strategy-bindings-admin/"+t,e)}function T(t){return s.a.delete("/strategy-bindings-admin/"+t)}function V(t={}){return s.a.get("/exchange-accounts",{params:t})}function R(t,e){return s.a.put(`/exchange-accounts/${t}/assign-node`,e)}function j(t){return s.a.post("/exchange-accounts/batch-assign-node",t)}function M(t={}){return s.a.get("/signal-events",{params:t})}function B(){return s.a.get("/signal-events/strategies")}},7317:function(t,e,a){"use strict";a("3116")},aee0:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ele-body"},[a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"toolbar"},[a("span",{staticClass:"toolbar-label"},[t._v("选择租户：")]),a("el-select",{staticStyle:{width:"280px"},attrs:{placeholder:"请选择租户",clearable:"",filterable:"",size:"small"},on:{change:t.onTenantChange},model:{value:t.tenantId,callback:function(e){t.tenantId=e},expression:"tenantId"}},t._l(t.tenantList,(function(t){return a("el-option",{key:t.id,attrs:{label:(t.name||"租户#"+t.id)+" (ID: "+t.id+")",value:t.id}})})),1),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh",loading:t.tenantLoading},on:{click:t.fetchTenants}},[t._v("刷新租户")]),t.tenantId?[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus",loading:t.loading},on:{click:t.openAdd}},[t._v("新增实例")]),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh",loading:t.loading},on:{click:t.fetchList}},[t._v("刷新列表")])]:t._e(),a("div",{staticStyle:{flex:"1"}})],2),t.tenantId?[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"12px"},attrs:{data:t.list,stripe:"",border:"",size:"small"}},[a("el-table-column",{attrs:{prop:"id",label:"实例ID",width:"80",align:"center"}}),a("el-table-column",{attrs:{prop:"strategy_code",label:"主策略编码",width:"100","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"strategy_name",label:"主策略名称",width:"120","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"display_name",label:"展示名称",width:"120","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"display_description",label:"展示描述","min-width":"140","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"本金(U)",width:"90",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(a.capital>0?a.capital:"继承"))]}}],null,!1,3906170792)}),a("el-table-column",{attrs:{label:"杠杆",width:"75",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[null!=r.leverage?a("el-tag",{attrs:{size:"mini",type:"warning"}},[t._v(t._s(r.leverage)+"x")]):a("span",{staticClass:"text-placeholder"},[t._v("继承")])]}}],null,!1,1370675450)}),a("el-table-column",{attrs:{label:"风险档位",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[null!=r.risk_mode?[a("el-tag",{attrs:{size:"mini",type:3===r.risk_mode?"danger":2===r.risk_mode?"warning":"success"}},[t._v(" "+t._s({1:"稳健",2:"均衡",3:"激进"}[r.risk_mode]||"继承")+" ")])]:a("span",{staticClass:"text-placeholder"},[t._v("继承")])]}}],null,!1,3997613199)}),a("el-table-column",{attrs:{label:"单笔仓位/风控",width:"140",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[r.risk_based_sizing?[a("div",{staticStyle:{"line-height":"1.5"}},[a("span",{staticStyle:{color:"#E6A23C","font-weight":"500"}},[t._v("以损定仓")]),a("br"),a("span",{staticStyle:{"font-size":"11px",color:"#909399"}},[t._v("每笔最大亏损: "+t._s(r.max_loss_per_trade)+"U")])])]:[a("span",[t._v(t._s(r.amount_usdt>0?r.amount_usdt+"U":"继承"))])]]}}],null,!1,2299141776)}),a("el-table-column",{attrs:{prop:"min_capital",label:"最低资金",width:"90",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(null!=a.min_capital?a.min_capital:"继承"))]}}],null,!1,1634876801)}),a("el-table-column",{attrs:{prop:"status",label:"状态",width:"75",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("el-tag",{attrs:{type:1===r.status?"success":"info",size:"mini"}},[t._v(t._s(1===r.status?"启用":"禁用"))])]}}],null,!1,462494141)}),a("el-table-column",{attrs:{prop:"sort_order",label:"排序",width:"70",align:"center"}}),a("el-table-column",{attrs:{label:"操作",width:"240",align:"center",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(e){return t.openEdit(r)}}},[t._v("编辑")]),a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-document-copy"},on:{click:function(e){return t.copyFromMaster(r)}}},[t._v("复制主策略")]),a("el-button",{staticClass:"ele-text-danger",attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(e){return t.remove(r)}}},[t._v("删除")])]}}],null,!1,1317942053)})],1),t.loading||0!==t.list.length?t._e():a("el-empty",{attrs:{description:"该租户下暂无策略实例"}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.openAdd}},[t._v("新增实例")])],1)]:a("el-empty",{attrs:{description:"请先选择租户"}})],2),a("el-dialog",{attrs:{title:"新增策略实例",visible:t.addVisible,width:"560px","close-on-click-modal":!1},on:{"update:visible":function(e){t.addVisible=e},close:function(e){t.addForm={}}}},[a("el-form",{ref:"addFormRef",staticClass:"tenant-strategy-form",attrs:{model:t.addForm,rules:t.addRules,"label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"主策略",prop:"strategy_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择主策略",filterable:""},on:{change:t.onAddFormStrategyChange},model:{value:t.addForm.strategy_id,callback:function(e){t.$set(t.addForm,"strategy_id",e)},expression:"addForm.strategy_id"}},t._l(t.masterStrategies,(function(t){return a("el-option",{key:t.id,attrs:{label:t.code+" - "+t.name,value:t.id}})})),1)],1),a("el-form-item",{staticClass:"copy-option-item",attrs:{label:" "}},[a("el-checkbox",{on:{change:t.onCopyFromMasterChange},model:{value:t.addForm.copy_from_master,callback:function(e){t.$set(t.addForm,"copy_from_master",e)},expression:"addForm.copy_from_master"}},[t._v("一键复制主策略参数")]),a("div",{staticClass:"form-item-hint"},[t._v("勾选后将自动带入：本金、杠杆、风险档位、最低资金、展示名与描述")])],1),a("el-form-item",{attrs:{label:"展示名称"}},[a("el-input",{attrs:{placeholder:"留空则用主策略名称"},model:{value:t.addForm.display_name,callback:function(e){t.$set(t.addForm,"display_name",e)},expression:"addForm.display_name"}})],1),a("el-form-item",{attrs:{label:"展示描述"}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"留空则用主策略描述"},model:{value:t.addForm.display_description,callback:function(e){t.$set(t.addForm,"display_description",e)},expression:"addForm.display_description"}})],1),a("el-form-item",{attrs:{label:"本金(USDT)"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,precision:2,placeholder:"留空继承主策略"},model:{value:t.addForm.capital,callback:function(e){t.$set(t.addForm,"capital",e)},expression:"addForm.capital"}})],1),a("el-form-item",{attrs:{label:"杠杆"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"留空继承主策略",clearable:""},model:{value:t.addForm.leverage,callback:function(e){t.$set(t.addForm,"leverage",e)},expression:"addForm.leverage"}},[a("el-option",{attrs:{label:"5x",value:5}}),a("el-option",{attrs:{label:"10x",value:10}}),a("el-option",{attrs:{label:"20x",value:20}}),a("el-option",{attrs:{label:"50x",value:50}}),a("el-option",{attrs:{label:"75x",value:75}}),a("el-option",{attrs:{label:"100x",value:100}})],1)],1),t.addStrategyIsRiskBased?a("el-form-item",{attrs:{label:"每单最大亏损(U)"}},[a("el-input-number",{staticStyle:{width:"200px"},attrs:{min:1,step:5,precision:2},model:{value:t.addForm.max_loss_per_trade,callback:function(e){t.$set(t.addForm,"max_loss_per_trade",e)},expression:"addForm.max_loss_per_trade"}}),a("div",{staticStyle:{"font-size":"12px",color:"#909399","margin-top":"2px"}},[a("el-tag",{attrs:{type:"warning",size:"mini"}},[t._v("以损定仓")]),t._v(" 实际仓位按止损距离自动调整 ")],1)],1):[a("el-form-item",{attrs:{label:"风险档位"}},[a("el-radio-group",{model:{value:t.addForm.risk_mode,callback:function(e){t.$set(t.addForm,"risk_mode",e)},expression:"addForm.risk_mode"}},[a("el-radio-button",{attrs:{label:1}},[t._v("稳健(1%)")]),a("el-radio-button",{attrs:{label:2}},[t._v("均衡(1.5%)")]),a("el-radio-button",{attrs:{label:3}},[t._v("激进(2%)")])],1)],1),t.addForm.capital>0?a("el-form-item",{attrs:{label:"下单金额(U)"}},[a("div",{staticStyle:{"line-height":"32px"}},[a("span",{staticStyle:{"font-size":"16px","font-weight":"600",color:"#409EFF"}},[t._v(t._s(t.calcAddAmountUsdt))]),a("span",{staticStyle:{color:"#909399","font-size":"12px","margin-left":"4px"}},[t._v("USDT (自动计算)")])])]):t._e()],a("el-form-item",{attrs:{label:"最低资金(USDT)"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,precision:2,placeholder:"留空继承"},model:{value:t.addForm.min_capital,callback:function(e){t.$set(t.addForm,"min_capital",e)},expression:"addForm.min_capital"}})],1),a("el-form-item",{attrs:{label:"状态"}},[a("el-radio-group",{model:{value:t.addForm.status,callback:function(e){t.$set(t.addForm,"status",e)},expression:"addForm.status"}},[a("el-radio",{attrs:{label:1}},[t._v("启用")]),a("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1),a("el-form-item",{attrs:{label:"排序"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:t.addForm.sort_order,callback:function(e){t.$set(t.addForm,"sort_order",e)},expression:"addForm.sort_order"}})],1)],2),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.addVisible=!1}}},[t._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary",loading:t.addSaving},on:{click:t.submitAdd}},[t._v("确定")])],1)],1),a("el-dialog",{attrs:{title:"编辑策略实例",visible:t.editVisible,width:"520px","close-on-click-modal":!1},on:{"update:visible":function(e){t.editVisible=e},close:function(e){t.editForm={}}}},[a("el-form",{ref:"editFormRef",attrs:{model:t.editForm,"label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"主策略"}},[a("span",[t._v(t._s(t.editForm.strategy_code)+" - "+t._s(t.editForm.strategy_name))])]),a("el-form-item",{attrs:{label:"展示名称"}},[a("el-input",{attrs:{placeholder:"留空则用主策略名称"},model:{value:t.editForm.display_name,callback:function(e){t.$set(t.editForm,"display_name",e)},expression:"editForm.display_name"}})],1),a("el-form-item",{attrs:{label:"展示描述"}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"留空则用主策略描述"},model:{value:t.editForm.display_description,callback:function(e){t.$set(t.editForm,"display_description",e)},expression:"editForm.display_description"}})],1),a("el-form-item",{attrs:{label:"本金(USDT)"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,precision:2},model:{value:t.editForm.capital,callback:function(e){t.$set(t.editForm,"capital",e)},expression:"editForm.capital"}})],1),a("el-form-item",{attrs:{label:"杠杆"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"留空继承",clearable:""},model:{value:t.editForm.leverage,callback:function(e){t.$set(t.editForm,"leverage",e)},expression:"editForm.leverage"}},[a("el-option",{attrs:{label:"5x",value:5}}),a("el-option",{attrs:{label:"10x",value:10}}),a("el-option",{attrs:{label:"20x",value:20}}),a("el-option",{attrs:{label:"50x",value:50}}),a("el-option",{attrs:{label:"75x",value:75}}),a("el-option",{attrs:{label:"100x",value:100}})],1)],1),t.editStrategyIsRiskBased?a("el-form-item",{attrs:{label:"每单最大亏损(U)"}},[a("el-input-number",{staticStyle:{width:"200px"},attrs:{min:1,step:5,precision:2},model:{value:t.editForm.max_loss_per_trade,callback:function(e){t.$set(t.editForm,"max_loss_per_trade",e)},expression:"editForm.max_loss_per_trade"}}),a("div",{staticStyle:{"font-size":"12px",color:"#909399","margin-top":"2px"}},[a("el-tag",{attrs:{type:"warning",size:"mini"}},[t._v("以损定仓")]),t._v(" 实际仓位按止损距离自动调整 ")],1)],1):[a("el-form-item",{attrs:{label:"风险档位"}},[a("el-radio-group",{model:{value:t.editForm.risk_mode,callback:function(e){t.$set(t.editForm,"risk_mode",e)},expression:"editForm.risk_mode"}},[a("el-radio-button",{attrs:{label:1}},[t._v("稳健(1%)")]),a("el-radio-button",{attrs:{label:2}},[t._v("均衡(1.5%)")]),a("el-radio-button",{attrs:{label:3}},[t._v("激进(2%)")])],1)],1),t.editForm.capital>0?a("el-form-item",{attrs:{label:"下单金额(U)"}},[a("div",{staticStyle:{"line-height":"32px"}},[a("span",{staticStyle:{"font-size":"16px","font-weight":"600",color:"#409EFF"}},[t._v(t._s(t.calcEditAmountUsdt))]),a("span",{staticStyle:{color:"#909399","font-size":"12px","margin-left":"4px"}},[t._v("USDT (自动计算)")])])]):t._e()],a("el-form-item",{attrs:{label:"最低资金(USDT)"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,precision:2},model:{value:t.editForm.min_capital,callback:function(e){t.$set(t.editForm,"min_capital",e)},expression:"editForm.min_capital"}})],1),a("el-form-item",{attrs:{label:"状态"}},[a("el-radio-group",{model:{value:t.editForm.status,callback:function(e){t.$set(t.editForm,"status",e)},expression:"editForm.status"}},[a("el-radio",{attrs:{label:1}},[t._v("启用")]),a("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1),a("el-form-item",{attrs:{label:"排序"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:t.editForm.sort_order,callback:function(e){t.$set(t.editForm,"sort_order",e)},expression:"editForm.sort_order"}})],1)],2),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.editVisible=!1}}},[t._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary",loading:t.editSaving},on:{click:t.submitEdit}},[t._v("保存")])],1)],1)],1)},s=[],i=(a("e9c4"),a("0643"),a("fffc"),a("50fc")),n={name:"TenantStrategies",data(){return{tenantId:null,tenantList:[],tenantLoading:!1,list:[],loading:!1,masterStrategies:[],addVisible:!1,addForm:{strategy_id:null,copy_from_master:!0,display_name:"",display_description:"",capital:null,leverage:null,risk_mode:1,max_loss_per_trade:20,min_capital:null,status:1,sort_order:0},addRules:{strategy_id:[{required:!0,message:"请选择主策略",trigger:"change"}]},addSaving:!1,editVisible:!1,editForm:{},editSaving:!1}},computed:{addStrategyIsRiskBased(){if(!this.addForm.strategy_id)return!1;const t=this.masterStrategies.find(t=>t.id===this.addForm.strategy_id);if(!t)return!1;const e=t.config||{};return!!e.risk_based_sizing},editStrategyIsRiskBased(){return!!this.editForm.risk_based_sizing},calcAddAmountUsdt(){const t=Number(this.addForm.capital)||0,e=Number(this.addForm.leverage)||20,a=Number(this.addForm.risk_mode)||1,r={1:.01,2:.015,3:.02}[a]||.01;return t>0?(t*r*e).toFixed(2):"0.00"},calcEditAmountUsdt(){const t=Number(this.editForm.capital)||0,e=Number(this.editForm.leverage)||20,a=Number(this.editForm.risk_mode)||1,r={1:.01,2:.015,3:.02}[a]||.01;return t>0?(t*r*e).toFixed(2):"0.00"}},mounted(){this.fetchTenants()},methods:{async fetchTenants(){this.tenantLoading=!0;try{const t=await Object(i["v"])({page_size:500}),e=t.data||{};this.tenantList=e.data||[],Array.isArray(this.tenantList)||(this.tenantList=[])}catch(t){this.$message.error(t.response&&t.response.data&&(t.response.data.detail||t.response.data.message)||t.message||"获取租户列表失败")}finally{this.tenantLoading=!1}},onTenantChange(){this.list=[],this.tenantId&&this.fetchList()},async fetchList(){if(this.tenantId){this.loading=!0;try{const t=await Object(i["u"])(this.tenantId,{}),e=t.data||{};this.list=e.data||[],Array.isArray(this.list)||(this.list=[])}catch(t){this.$message.error(t.response&&t.response.data&&(t.response.data.detail||t.response.data.message)||t.message||"获取列表失败")}finally{this.loading=!1}}},async loadMasterStrategies(){try{const t=await Object(i["s"])({}),e=t.data||{};this.masterStrategies=e.data||[],Array.isArray(this.masterStrategies)||(this.masterStrategies=[])}catch{this.masterStrategies=[]}},openAdd(){this.loadMasterStrategies(),this.addForm={strategy_id:null,copy_from_master:!0,display_name:"",display_description:"",capital:null,leverage:null,risk_mode:1,min_capital:null,status:1,sort_order:0},this.addVisible=!0},async fillFormFromMasterStrategy(){if(this.addForm.strategy_id&&this.addForm.copy_from_master)try{const t=await Object(i["t"])(this.addForm.strategy_id),e=t.data||{},a=e.data||e;if(!a)return;this.addForm.display_name=(a.user_display_name||a.name||"").toString().trim()||"",this.addForm.display_description=(a.user_description||a.description||"").toString().trim()||"",this.addForm.capital=null!=a.capital?Number(a.capital):null,this.addForm.leverage=null!=a.leverage?Number(a.leverage):null,this.addForm.risk_mode=null!=a.risk_mode?Number(a.risk_mode):1,this.addForm.max_loss_per_trade=null!=a.max_loss_per_trade?Number(a.max_loss_per_trade):20,this.addForm.min_capital=null!=a.min_capital?Number(a.min_capital):null}catch(t){this.$message.warning("获取主策略参数失败，可手动填写或提交时由后端复制")}},onAddFormStrategyChange(){this.addForm.copy_from_master&&this.addForm.strategy_id&&this.fillFormFromMasterStrategy()},onCopyFromMasterChange(t){t&&this.addForm.strategy_id&&this.fillFormFromMasterStrategy()},async submitAdd(){await this.$refs.addFormRef.validate().catch(()=>{throw new Error("请填写必填项")});const t={strategy_id:this.addForm.strategy_id,copy_from_master:!!this.addForm.copy_from_master,status:this.addForm.status,sort_order:this.addForm.sort_order};void 0!==this.addForm.display_name&&""!==this.addForm.display_name&&(t.display_name=this.addForm.display_name),void 0!==this.addForm.display_description&&""!==this.addForm.display_description&&(t.display_description=this.addForm.display_description),null!=this.addForm.capital&&""!==this.addForm.capital&&(t.capital=Number(this.addForm.capital)),null!=this.addForm.leverage&&""!==this.addForm.leverage&&(t.leverage=Number(this.addForm.leverage)),this.addStrategyIsRiskBased?this.addForm.max_loss_per_trade>0&&(t.max_loss_per_trade=Number(this.addForm.max_loss_per_trade)):null!=this.addForm.risk_mode&&(t.risk_mode=Number(this.addForm.risk_mode)),null!=this.addForm.min_capital&&""!==this.addForm.min_capital&&(t.min_capital=Number(this.addForm.min_capital)),this.addSaving=!0;try{await Object(i["i"])(this.tenantId,t),this.$message.success("新增成功"),this.addVisible=!1,this.fetchList()}catch(e){const t=e.response&&e.response.data&&(e.response.data.detail||e.response.data.message)||e.message||"新增失败";this.$message.error("string"===typeof t?t:JSON.stringify(t))}finally{this.addSaving=!1}},openEdit(t){this.editForm={id:t.id,strategy_code:t.strategy_code,strategy_name:t.strategy_name,risk_based_sizing:!!t.risk_based_sizing,display_name:t.display_name||"",display_description:t.display_description||"",capital:null!=t.capital?Number(t.capital):null,leverage:null!=t.leverage?Number(t.leverage):null,risk_mode:null!=t.risk_mode?Number(t.risk_mode):1,max_loss_per_trade:null!=t.max_loss_per_trade?Number(t.max_loss_per_trade):20,min_capital:null!=t.min_capital?Number(t.min_capital):null,status:null!=t.status?Number(t.status):1,sort_order:null!=t.sort_order?Number(t.sort_order):0},this.editVisible=!0},async submitEdit(){if(!this.editForm.id)return void this.$message.error("策略实例ID无效，请重新打开编辑");const t={display_name:this.editForm.display_name||null,display_description:this.editForm.display_description||null,capital:this.editForm.capital,leverage:this.editForm.leverage,min_capital:this.editForm.min_capital,status:this.editForm.status,sort_order:this.editForm.sort_order};this.editStrategyIsRiskBased?t.max_loss_per_trade=this.editForm.max_loss_per_trade>0?this.editForm.max_loss_per_trade:null:t.risk_mode=this.editForm.risk_mode,this.editSaving=!0;try{await Object(i["L"])(this.tenantId,this.editForm.id,t),this.$message.success("保存成功"),this.editVisible=!1,this.fetchList()}catch(e){const t=e.response&&e.response.data&&(e.response.data.detail||e.response.data.message)||e.message||"保存失败";this.$message.error("string"===typeof t?t:JSON.stringify(t))}finally{this.editSaving=!1}},async copyFromMaster(t){if(t.id){try{await this.$confirm("确定用主策略参数覆盖当前实例的杠杆、单笔金额、最低资金及展示名/描述？","一键复制主策略",{type:"warning"})}catch{return}try{await Object(i["d"])(this.tenantId,t.id),this.$message.success("已从主策略复制参数"),this.fetchList()}catch(e){const t=e.response&&e.response.data&&(e.response.data.detail||e.response.data.message)||e.message||"复制失败";this.$message.error("string"===typeof t?t:JSON.stringify(t))}}else this.$message.error("策略实例ID无效")},async remove(t){if(t.id){try{await this.$confirm(`确定删除该租户下的策略实例「${t.display_name||t.strategy_name}」？`,"删除",{type:"warning"})}catch{return}try{await Object(i["l"])(this.tenantId,t.id),this.$message.success("已删除"),this.fetchList()}catch(e){const t=e.response&&e.response.data&&(e.response.data.detail||e.response.data.message)||e.message||"删除失败";this.$message.error("string"===typeof t?t:JSON.stringify(t))}}else this.$message.error("策略实例ID无效")}}},l=n,o=(a("7317"),a("2877")),d=Object(o["a"])(l,r,s,!1,null,"6b3297ec",null);e["default"]=d.exports}}]);