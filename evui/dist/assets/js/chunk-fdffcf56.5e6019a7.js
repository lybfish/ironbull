(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fdffcf56"],{"2b56":function(t,e,s){"use strict";s("a454")},a454:function(t,e,s){},b2af:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ele-body"},[t.connectionError?s("el-alert",{staticStyle:{"margin-bottom":"16px"},attrs:{title:"无法连接 signal-monitor 服务",type:"error",closable:!1,"show-icon":""}},[s("div",{attrs:{slot:"description"},slot:"description"},[t._v(t._s(t.connectionError))])]):t._e(),s("el-row",{staticStyle:{"margin-bottom":"16px"},attrs:{gutter:15}},[s("el-col",{attrs:{span:6}},[s("stat-card",{attrs:{title:"运行状态",value:t.statusRunning?"运行中":"已停止",icon:"el-icon-video-play",color:t.statusRunning?"success":"info",loading:t.statusLoading,"help-text":"信号监控主循环"}})],1),s("el-col",{attrs:{span:6}},[s("stat-card",{attrs:{title:"活跃策略",value:t.statusConfig.strategies_count||0,icon:"el-icon-s-opportunity",color:"primary",loading:t.statusLoading,"help-text":"当前加载的策略数"}})],1),s("el-col",{attrs:{span:6}},[s("stat-card",{attrs:{title:"已处理信号",value:t.state.total_signals||0,icon:"el-icon-s-data",color:"warning",loading:t.statusLoading,"help-text":"累计检测到的信号数"}})],1),s("el-col",{attrs:{span:6}},[s("stat-card",{attrs:{title:"检测轮次",value:t.state.total_checks||0,icon:"el-icon-refresh",color:"info",loading:t.statusLoading,"help-text":"已执行检测次数"}})],1)],1),s("el-card",{staticStyle:{"margin-bottom":"16px"},attrs:{shadow:"never"}},[s("div",{staticClass:"toolbar"},[s("span",{staticClass:"toolbar-title"},[t._v("控制")]),s("div",[t.statusRunning?s("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-video-pause",loading:t.actionLoading},on:{click:t.handleStop}},[t._v("停止监控")]):s("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-video-play",loading:t.actionLoading},on:{click:t.handleStart}},[t._v("启动监控")]),s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-refresh",loading:t.statusLoading},on:{click:t.fetchAll}},[t._v("刷新")]),s("el-switch",{staticStyle:{"margin-left":"12px"},attrs:{"active-text":"自动刷新","inactive-text":""},on:{change:t.handleAutoRefreshChange},model:{value:t.autoRefresh,callback:function(e){t.autoRefresh=e},expression:"autoRefresh"}}),s("el-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"warning",size:"small",icon:"el-icon-message",loading:t.testNotifyLoading},on:{click:t.handleTestNotify}},[t._v("测试通知")])],1)])]),s("el-row",{attrs:{gutter:16}},[s("el-col",{attrs:{span:12}},[s("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.statusLoading,expression:"statusLoading"}],attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[t._v("状态详情")]),s("el-descriptions",{attrs:{column:1,border:"",size:"small"}},[s("el-descriptions-item",{attrs:{label:"运行状态"}},[s("el-tag",{attrs:{type:t.statusRunning?"success":"info",size:"small"}},[t._v(t._s(t.statusRunning?"运行中":"已停止"))])],1),s("el-descriptions-item",{attrs:{label:"最后检测时间"}},[t._v(t._s(t.formatTime(t.state.last_check)))]),s("el-descriptions-item",{attrs:{label:"信号检测间隔"}},[t._v(t._s(t.statusConfig.interval_seconds||"-")+" 秒")]),s("el-descriptions-item",{attrs:{label:"数据同步间隔"}},[t._v(t._s(t.statusConfig.sync_interval_seconds||"-")+" 秒")]),s("el-descriptions-item",{attrs:{label:"错误次数"}},[t._v(t._s(t.state.errors||0))])],1)],1)],1),s("el-col",{attrs:{span:12}},[s("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.configLoading,expression:"configLoading"}],attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[t._v("全局配置")]),s("el-form",{attrs:{model:t.config,"label-width":"140px",size:"small"}},[s("el-form-item",{attrs:{label:"信号检测间隔(秒)"}},[s("el-input-number",{staticStyle:{width:"140px"},attrs:{min:10,max:600,step:10},model:{value:t.config.interval_seconds,callback:function(e){t.$set(t.config,"interval_seconds",e)},expression:"config.interval_seconds"}}),s("span",{staticClass:"form-tip"},[t._v("建议 60–300 秒")])],1),s("el-form-item",{attrs:{label:"数据同步间隔(秒)"}},[s("el-input-number",{staticStyle:{width:"140px"},attrs:{min:10,max:600,step:10},model:{value:t.config.sync_interval_seconds,callback:function(e){t.$set(t.config,"sync_interval_seconds",e)},expression:"config.sync_interval_seconds"}}),s("span",{staticClass:"form-tip"},[t._v("余额/持仓/成交同步频率")])],1),s("el-form-item",{attrs:{label:"有信号时通知"}},[s("el-switch",{model:{value:t.config.notify_on_signal,callback:function(e){t.$set(t.config,"notify_on_signal",e)},expression:"config.notify_on_signal"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",loading:t.configSaving},on:{click:t.saveConfig}},[t._v("保存配置")])],1)],1)],1)],1)],1),t.state.last_signal?s("el-card",{staticStyle:{"margin-top":"16px"},attrs:{shadow:"never"}},[s("div",{attrs:{slot:"header"},slot:"header"},[t._v("最近一次信号")]),s("el-descriptions",{attrs:{column:2,border:"",size:"small"}},[s("el-descriptions-item",{attrs:{label:"交易对"}},[t._v(t._s(t.state.last_signal.symbol))]),s("el-descriptions-item",{attrs:{label:"方向"}},[s("el-tag",{attrs:{type:"BUY"===t.state.last_signal.side?"success":"danger",size:"mini"}},[t._v(t._s(t.state.last_signal.side))])],1),s("el-descriptions-item",{attrs:{label:"入场价"}},[t._v(t._s(t.state.last_signal.entry_price))]),s("el-descriptions-item",{attrs:{label:"置信度"}},[t._v(t._s(t.state.last_signal.confidence)+"%")]),s("el-descriptions-item",{attrs:{label:"策略"}},[t._v(t._s(t.state.last_signal.strategy||"-"))]),s("el-descriptions-item",{attrs:{label:"时间"}},[t._v(t._s(t.formatTime(t.state.last_signal.timestamp)))])],1)],1):t._e(),s("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.strategiesLoading,expression:"strategiesLoading"}],staticStyle:{"margin-top":"16px"},attrs:{shadow:"never"}},[s("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[s("span",[t._v("策略列表（信号监控加载）")]),s("el-button",{attrs:{size:"mini",icon:"el-icon-refresh",loading:t.strategiesLoading},on:{click:t.fetchStrategies}},[t._v("刷新")])],1),s("el-table",{attrs:{data:t.strategies,stripe:"",border:"",size:"small","header-cell-style":{background:"#fafafa"}}},[s("el-table-column",{attrs:{prop:"code",label:"策略编码",width:"120"}}),s("el-table-column",{attrs:{prop:"name",label:"策略名称","min-width":"140","show-overflow-tooltip":""}}),s("el-table-column",{attrs:{prop:"exchange",label:"交易所",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(s.exchange||"-"))]}}])}),s("el-table-column",{attrs:{prop:"timeframe",label:"周期",width:"80",align:"center"}}),s("el-table-column",{attrs:{label:"交易对","min-width":"180","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(t.formatSymbols(s.symbols)))]}}])}),s("el-table-column",{attrs:{prop:"min_confidence",label:"最低置信度",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t._v(t._s(null!=s.min_confidence?s.min_confidence+"%":"-"))]}}])})],1),t.strategiesLoading||0!==t.strategies.length?t._e():s("el-empty",{attrs:{description:"暂无策略或服务未就绪"}})],1)],1)},i=[],n=s("bc3a"),o=s.n(n),r=s("d2b8");function l(t){const e="/ib/signal-api",s="undefined"!==typeof window?window.location.origin+e:e;return s+t}const c=o.a.create({timeout:15e3});function d(){return c.get(l("/status"))}function g(){return c.get(l("/config"))}function f(t){return c.post(l("/config"),t)}function u(){return c.get(l("/strategies"))}function h(){return c.post(l("/start"))}function m(){return c.post(l("/stop"))}function p(){return c.post(l("/test-notify"))}c.interceptors.request.use(t=>{const e=r["a"].takeToken();return e&&(t.headers[r["a"].tokenHeaderName]="Bearer "+e),t},t=>Promise.reject(t));var v={name:"SignalControl",data(){return{statusLoading:!1,configLoading:!1,configSaving:!1,strategiesLoading:!1,actionLoading:!1,testNotifyLoading:!1,connectionError:"",autoRefresh:!1,refreshTimer:null,state:{},statusConfig:{},config:{interval_seconds:300,sync_interval_seconds:300,notify_on_signal:!0},strategies:[]}},computed:{statusRunning(){return!!this.state.running}},mounted(){this.fetchAll()},beforeDestroy(){this.clearRefreshTimer()},methods:{formatTime(t){if(!t)return"-";const e="string"===typeof t?t:t.toISOString&&t.toISOString();return e?e.replace("T"," ").substring(0,19):"-"},formatSymbols(t){return t?Array.isArray(t)?t.join(", "):String(t):"-"},handleAutoRefreshChange(t){t?this.startAutoRefresh():this.clearRefreshTimer()},startAutoRefresh(){this.clearRefreshTimer(),this.refreshTimer=setInterval(()=>{this.fetchStatus()},1e4)},clearRefreshTimer(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)},fetchAll(){this.fetchStatus(),this.fetchConfig(),this.fetchStrategies()},async fetchStatus(){this.statusLoading=!0,this.connectionError="";try{const t=await d(),e=t.data;this.state=e.state||e||{},this.statusConfig=e.config||{}}catch(t){this.connectionError=t.message||t.response&&t.response.data&&(t.response.data.error||t.response.data.detail)||"请确认 signal-monitor 已启动（端口 8020）",this.state={},this.statusConfig={}}finally{this.statusLoading=!1}},async fetchConfig(){this.configLoading=!0;try{const t=await g(),e=t.data,s=e.config||e||{};null!=s.interval_seconds&&(this.config.interval_seconds=s.interval_seconds),null!=s.sync_interval_seconds&&(this.config.sync_interval_seconds=s.sync_interval_seconds),void 0!==s.notify_on_signal&&(this.config.notify_on_signal=!!s.notify_on_signal)}catch(t){this.$message.error("获取配置失败")}finally{this.configLoading=!1}},async saveConfig(){this.configSaving=!0;try{await f({interval_seconds:this.config.interval_seconds,sync_interval_seconds:this.config.sync_interval_seconds,notify_on_signal:this.config.notify_on_signal}),this.$message.success("配置已保存"),this.fetchStatus()}catch(e){var t;this.$message.error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.error)||"保存失败")}finally{this.configSaving=!1}},async fetchStrategies(){this.strategiesLoading=!0;try{const t=await u(),e=t.data;this.strategies=e.strategies||e.data||e||[]}catch(t){this.strategies=[]}finally{this.strategiesLoading=!1}},async handleStart(){this.actionLoading=!0;try{const t=await h(),e=t.data;e.success?(this.$message.success(e.message||"监控已启动"),this.fetchStatus()):this.$message.warning(e.error||"启动失败")}catch(e){var t;this.$message.error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.error)||"启动失败")}finally{this.actionLoading=!1}},async handleStop(){this.actionLoading=!0;try{const t=await m(),e=t.data;e.success?(this.$message.success(e.message||"监控已停止"),this.fetchStatus()):this.$message.warning(e.error||"停止失败")}catch(e){var t;this.$message.error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.error)||"停止失败")}finally{this.actionLoading=!1}},async handleTestNotify(){this.testNotifyLoading=!0;try{const t=await p(),e=t.data;e.success?this.$message.success("测试通知已发送"):this.$message.warning(e.error||"发送失败")}catch(e){var t;this.$message.error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.error)||"测试通知失败")}finally{this.testNotifyLoading=!1}}}},_=v,y=(s("2b56"),s("2877")),b=Object(y["a"])(_,a,i,!1,null,"4576a4b8",null);e["default"]=b.exports}}]);