# IronBull v0 — Next Task Plan

## ✅ 最近完成

### Phase 9 - Analytics 分析模块（2026-02-06）
- ✅ **Analytics 模块**：绩效分析与风险指标
  - fact_performance_snapshot / fact_trade_statistics / fact_risk_metrics 表
  - 绩效指标：收益率、净值、累计收益
  - 风险指标：夏普比率、索提诺比率、最大回撤、VaR/CVaR
  - 交易统计：胜率、盈亏比、获利因子、连胜/连亏
  - 净值曲线生成
- ✅ **signal-monitor / local_monitor 集成**
  - 真实交易数据自动持久化
  - `--no-persist` 参数支持

### Phase 8 - SaaS 核心模块重建（2026-02-05）
- ✅ **OrderTrade 模块**：订单/成交事实记录
- ✅ **Position 模块**：持仓管理
- ✅ **Ledger 模块**：资金/账务管理
- ✅ **TradeSettlementService**：交易结算服务
- ✅ **LiveTrader 集成**：支持 settlement_service

### Phase 7 - 真实合约交易（2026-02-05）
- ✅ Binance USDT 永续合约交易
- ✅ 双向持仓模式支持（LONG/SHORT）
- ✅ 自动止盈止损订单
- ✅ Telegram 通知集成
- ✅ signal-monitor 服务 + 本地监控脚本

---

## 🎯 SaaS 蓝图进度

### 模块层（Modules）- 100% ✅
```
┌─────────────────────────────────────────────────────────────────┐
│ 能力域       │ 状态  │ 实现位置                                 │
├─────────────────────────────────────────────────────────────────┤
│ 1. Strategy  │  ✅   │ libs/strategies (21个策略)              │
│ 2. MarketData│  ✅   │ libs/exchange, data-provider            │
│ 3. Signal    │  ✅   │ 策略产出信号                             │
│ 4. Backtest  │  ✅   │ services/backtest                       │
│ 5. Execution │  ✅   │ libs/trading/live_trader                │
│ 6. OrderTrade│  ✅   │ libs/order_trade                        │
│ 7. Position  │  ✅   │ libs/position                           │
│ 8. Ledger    │  ✅   │ libs/ledger                             │
│ 9. Analytics │  ✅   │ libs/analytics                          │
└─────────────────────────────────────────────────────────────────┘
```

### 平台层（Platform）- 0%
```
┌─────────────────────────────────────────────────────────────────┐
│ 能力           │ 状态  │ 说明                                   │
├─────────────────────────────────────────────────────────────────┤
│ 租户管理        │  ❌   │ 无 Tenant 表/服务                      │
│ 用户管理        │  ❌   │ 无 User 表/服务                        │
│ 角色权限        │  ❌   │ 无 Role/Permission                     │
│ 认证鉴权        │  ❌   │ API 无认证                             │
│ 配额计费        │  ❌   │ 未实现                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🎯 下一步建议

### 选项 1：REST API 接口（推荐优先级：⭐⭐⭐⭐⭐）
**目标**：为所有模块创建统一的查询 API

**任务清单**：
- [ ] /api/orders - 订单查询
- [ ] /api/fills - 成交查询
- [ ] /api/positions - 持仓查询
- [ ] /api/accounts - 资金账户查询
- [ ] /api/transactions - 流水查询
- [ ] /api/analytics/performance - 绩效查询
- [ ] /api/analytics/risk - 风险指标查询
- [ ] /api/analytics/statistics - 交易统计查询

**产出**：
- 完整的数据查询能力
- 前端开发基础

---

### 选项 2：多租户与身份（推荐优先级：⭐⭐⭐⭐）
**目标**：开始平台层建设

**任务清单**：
- [ ] Tenant 表设计与实现
- [ ] User 表设计与实现
- [ ] 基础认证（JWT）
- [ ] API 权限校验中间件

**产出**：
- 多租户数据隔离
- 基础身份认证

---

### 选项 3：前端管理界面（推荐优先级：⭐⭐⭐）
**目标**：Web 界面管理和监控

**任务清单**：
- [ ] Dashboard（概览页）
- [ ] 订单/持仓/资金页面
- [ ] 绩效分析页面（净值曲线、风险指标）
- [ ] 策略管理页面
- [ ] 信号监控页面

**产出**：
- 用户友好的 Web 管理后台

---

### 选项 4：实盘验证（推荐优先级：⭐⭐⭐⭐⭐）
**目标**：小资金实盘测试，验证完整闭环

**启动命令**：
```bash
cd /Users/pro/Documents/www/server/nginx/html/ironbull
python3 scripts/local_monitor.py -m auto -i 60
```

**验证项**：
- [ ] 订单数据正确写入 fact_order
- [ ] 成交数据正确写入 fact_fill
- [ ] 持仓实时更新 fact_position
- [ ] 资金正确结算 fact_account
- [ ] 分析指标可计算

---

## 🎯 推荐路径

### 路径 A：API + 前端（推荐）
```
1. REST API 接口 - 数据查询能力
   ↓
2. 前端管理界面 - 可视化展示
   ↓
3. 多租户与身份 - 平台层
```

### 路径 B：平台层优先
```
1. 多租户与身份 - 基础架构
   ↓
2. REST API 接口 - 带权限控制
   ↓
3. 前端管理界面
```

---

## 💡 建议

基于当前进度，推荐**路径 A（API + 前端）**：

1. **模块层 100% 完成**：9 大能力域全部实现
2. **数据已持久化**：交易数据可入库
3. **缺少查询能力**：目前只能直接查数据库
4. **缺少可视化**：没有前端界面

---

## 📝 注意事项

### ✅ 已解决的技术债
- ~~OrderTrade/Position/Ledger 需要重建~~ → 已完成！
- ~~v0 没有持久化~~ → 已有完整事实表
- ~~signal-monitor 未集成新模块~~ → 已集成！
- ~~Analytics 模块缺失~~ → 已实现！

### 当前技术债
- v0 使用内存存储（signal-hub/follow-service）
- v0 没有认证（所有 API 开放）
- 缺少 REST API 查询接口
- 没有前端界面

---

## 🎓 当前架构总览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              应用层 (Apps)                                   │
│   signal-monitor │ local_monitor │ (前端待建)                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                              模块层 (Modules) ✅                             │
│ ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────────┐│
│ │Strategy │MarketDat│ Signal  │Backtest │Execution│OrderTrd │  Position   ││
│ │   ✅    │   ✅    │   ✅    │   ✅    │   ✅    │   ✅    │     ✅      ││
│ └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────────┘│
│ ┌─────────┬─────────┬─────────────────────────────────────────────────────┐│
│ │ Ledger  │Analytics│                  Settlement                         ││
│ │   ✅    │   ✅    │                     ✅                              ││
│ └─────────┴─────────┴─────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────────────────────────┤
│                              平台层 (Platform) ❌                            │
│   Tenant │ User │ Role │ Permission │ Auth │ Audit │ Quota                 │
│    ❌    │  ❌  │  ❌  │     ❌     │  ❌  │  ⚠️   │  ❌                   │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

**请告知您希望优先推进哪个方向。**

---

**最后更新**: 2026-02-06  
**当前版本**: v0 (Phase 9 - Analytics 分析模块)
