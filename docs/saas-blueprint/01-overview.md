# SaaS 量化平台总体规划（Blueprint）

本文档为规划阶段产出，遵循 `docs/PLANNING_ONLY.md` 的全局约束：仅输出架构蓝图、模型与清单，不涉及任何实现细节。

---

## 1. 平台定位、目标与非目标

### 平台定位

面向机构与专业交易者的**多租户量化 SaaS 平台**，提供策略研发、回测、实盘执行、资金与持仓账本、分析报表的一体化能力，以租户隔离、可扩展的模块与应用形态交付。

### 目标

- **多租户**：租户级数据与资源隔离，租户可独立配置可用模块与应用。
- **量化闭环**：从策略编写 → 回测验证 → 实盘执行 → 账本与清算 → 分析报表，形成可追溯的完整链路。
- **可扩展**：通过 Platform / Modules / Apps 分层，支持后续新增策略引擎、交易所适配、报表应用等而不破坏核心平台。
- **可运维**：权限、审计、配额、计费在平台层统一，便于运营与合规。

### 非目标（明确现在不做什么）

- **不做**：公开 C 端散户产品、社交/跟单/社区功能。
- **不做**：自营资金交易或代客操盘；平台仅提供工具与执行通道，资金与交易决策归属租户。
- **不做**：通用低代码/无代码平台；量化能力（策略、回测、执行、账本）是领域核心，不做泛化业务编排。
- **不做**：在规划阶段做任何代码、建表、接口或实现细节；当前阶段仅产出蓝图、模型与清单。

---

## 2. SaaS 分层架构

### Platform（平台层）

- 提供租户、用户、角色、权限、审计、配额与计费的基础能力。
- 负责多租户隔离（数据、配置、资源）、认证与鉴权、日志与审计、系统配置与运维入口。
- 不承载具体量化业务逻辑，仅提供「谁在什么租户下能使用哪些应用与模块」的支撑。

### Modules（模块层）

- 承载量化领域核心能力，以**模块**为单位：策略、回测、执行、账本、分析等。
- 每个模块有清晰的职责边界与对外能力描述，可被上层应用组合调用。
- 模块间通过平台约定的契约交互（概念层），不直接依赖具体实现；数据与调用均在租户上下文中执行。

### Apps（应用层）

- 面向最终用户的产品形态，如「策略工作台」「回测报告」「交易终端」「资金报表」等。
- 每个应用由平台层授权（租户可见性、用户权限），并组合一个或多个模块的能力。
- 应用层负责交互与展示逻辑的边界定义，具体实现不在规划范围内。

**关系简述**：Platform 支撑 Modules 与 Apps 的隔离与授权；Modules 提供量化能力；Apps 基于 Modules 组装成用户可用的产品。

---

## 3. 多租户模型：tenant、user、role、app、module 的关系

- **Tenant（租户）**：隔离边界。所有业务数据、配置、资源归属某租户；租户下可启用若干 **Module** 与 **App**。
- **User（用户）**：归属某一租户，在租户内拥有唯一身份；同一自然人可在不同租户下拥有不同 User 身份（若产品支持多租户切换）。
- **Role（角色）**：租户内定义，用于对 User 进行权限分组；权限可细粒度到「能访问哪些 App」「能使用哪些 Module 能力」。
- **App（应用）**：租户级可见性配置；某租户启用某 App 后，该租户下被授权的 User 可通过对应角色访问该 App。
- **Module（模块）**：租户级启用/禁用；某租户启用某 Module 后，该租户下已启用的、依赖该 Module 的 App 才可使用其能力。

**关系小结**：Tenant 是根；User 属于 Tenant，通过 Role 获得权限；App 与 Module 均在 Tenant 维度配置启用；App 依赖一个或多个 Module；权限控制「某 User 在某 Tenant 下能访问哪些 App、间接使用哪些 Module」。

---

## 4. 量化平台核心能力清单

以下为概念级能力清单，不涉及实现与表结构。

| 能力域 | 英文名 | 职责简述 |
|--------|--------|----------|
| 策略 | Strategy | 策略的创建、版本、参数配置、依赖资源（如因子、标的池）的管理与生命周期；不包含执行与回测的具体引擎实现细节。 |
| 回测 | Backtest | 基于历史数据与策略配置进行回测任务编排、执行与结果产出；回测结果可被分析与报表使用。 |
| 执行 | Execution | 将策略或人工指令转化为交易所/经纪商订单，管理订单生命周期、成交流水与执行质量。 |
| 账本 | Ledger | 资金与持仓的记账、对账、清算视角；与执行流水一致，支持多账户、多币种、多标的的权益与持仓快照。 |
| 分析 | Analytics | 基于回测结果、执行流水、账本数据做绩效、风险、归因等分析，并支撑报表与可视化（仅能力边界，不含具体图表实现）。 |

以上五类能力对应模块层的核心模块，由 Platform 做租户隔离与授权，由 Apps 组合呈现给用户。

---

## 5. 高风险模块（必须重建、禁止复用旧项目）

以下模块因安全、一致性或架构约束，**不得直接复用旧项目实现**，必须在本次规划中视为「从零设计、后续重建」。

- **多租户与身份**：旧项目若为单租户或租户模型不清晰，所有与 Tenant/User/Role/权限相关的逻辑必须重建，否则无法保证隔离与审计合规。
- **账本（Ledger）**：资金与持仓是合规与对账基础；若旧账本存在口径不统一、与执行流水不一致或难以支持多租户的情况，必须重建，避免「错账难以追溯」。
- **执行（Execution）**：订单与成交流水若与账本、风控强耦合且无清晰边界，或存在硬编码通道/协议，必须重建执行层，明确与 Ledger、Strategy 的边界与契约。
- **权限与审计**：若旧系统无统一审计日志、操作不可追溯，则权限与审计模块必须新建，不能沿用旧逻辑。

**原因归纳**：多租户与身份错误会导致数据串租与合规风险；账本错误会导致资金与持仓不可信；执行边界混乱会导致与账本、策略难以对接；缺少审计会导致无法满足运营与监管要求。上述任一模块复用旧实现都会放大技术债与业务风险，故规划中明确列为「必须重建」。

---

## 6. 规划阶段的验收标准（什么算「规划完成」）

满足以下条件时，可视为**规划阶段完成**，可进入后续设计或迭代：

1. **蓝图完整**：平台定位、目标、非目标已定稿；Platform / Modules / Apps 分层及职责边界已描述清晰，无重大遗漏。
2. **多租户模型定稿**：Tenant、User、Role、App、Module 的关系已文档化，且与「谁能用什么」的权限逻辑一致。
3. **量化能力清单已锁定**：Strategy / Backtest / Execution / Ledger / Analytics 五类能力的职责与边界已列出，并与模块层、应用层对应关系明确。
4. **风险与重建范围已标定**：高风险模块（多租户与身份、账本、执行、权限与审计）已明确为「必须重建」，原因已记录，无争议。
5. **现有项目盘点与差异分析已完成**：旧项目/现有资产已盘点，与目标架构的差异、可复用与不可复用部分已列出（可在独立文档中）。
6. **无违反 PLANNING_ONLY 约束**：所有产出物均为架构、模型、清单、风险与验收标准，无代码、建表、接口实现或伪代码。

达到上述六项即视为「规划完成」，可作为后续详细设计或里程碑排期的输入。

---

*文档归属：SaaS 量化平台 Blueprint · 01 总览*
