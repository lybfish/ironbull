service_name: ironbull
log_level: INFO
log_structured: false

# Service Ports
signal_hub_port: 8001
risk_control_port: 8002
execution_dispatcher_port: 8003
crypto_node_port: 9101
mt5_node_port: 9102
backtest_port: 8030

# MySQL Database (v1 Facts Layer)
# 生产请用环境变量 IRONBULL_DB_* 覆盖，勿提交真实密码
db_host: 127.0.0.1
db_port: 3306
db_user: root
db_password: ""                     # 生产必填，用 IRONBULL_DB_PASSWORD
db_name: ironbull
db_charset: utf8mb4
db_pool_size: 5
db_max_overflow: 10
db_pool_timeout: 30
db_pool_recycle: 3600

# Redis (v1 Phase 3 - Queue)
redis_host: 127.0.0.1
redis_port: 6379
redis_db: 0
redis_password: ""
redis_pool_size: 10

# Data Provider (v1 Phase 5)
data_source: mock                 # 数据源: mock / live
default_exchange: binance         # 默认交易所: binance / okx
data_cache_enabled: true          # 是否启用数据缓存
data_provider_url: http://127.0.0.1:8005  # data-provider 服务地址（勿用 8010，该端口为 merchant-api）
signal_monitor_url: http://127.0.0.1:8020  # signal-monitor 状态代理（管理后台用）

# Trading (v1 Phase 6)
trading_mode: paper               # 交易模式: paper(模拟) / live(真实)

# Risk Control (v1 Phase 4)
risk_min_balance: 100.0           # 最小可用余额
risk_max_positions: 10            # 最大持仓数量
risk_max_position_value: 50000.0  # 单仓最大价值
risk_daily_trade_limit: 100       # 每日交易次数上限
risk_daily_loss_limit: 1000.0     # 每日亏损上限
risk_max_consecutive_losses: 5    # 连续亏损次数上限
risk_loss_cooldown_minutes: 30    # 连续亏损后冷却时间（分钟）
risk_trade_cooldown_seconds: 0    # 两次交易间隔（秒，0=不限制）

# Telegram Notification（生产用 IRONBULL_TELEGRAM_BOT_TOKEN / IRONBULL_TELEGRAM_CHAT_ID）
telegram_bot_token: ""
telegram_chat_id: ""

# Exchange API (用于真实交易，生产必须用环境变量 IRONBULL_EXCHANGE_*，勿写在此)
exchange_name: binance              # 交易所: binance / okx
exchange_api_key: ""                # 生产用 IRONBULL_EXCHANGE_API_KEY
exchange_api_secret: ""             # 生产用 IRONBULL_EXCHANGE_API_SECRET
exchange_passphrase: ""             # API Passphrase (OKX 需要)
exchange_sandbox: false             # 真实交易（注意！）
exchange_market_type: future        # 市场类型: spot(现货) / future(合约)

# Execution Node Authentication（生产用 IRONBULL_NODE_AUTH_SECRET，勿用默认值）
node_auth_secret: ""                # 中心⇄节点共享密钥，用于 X-Center-Token

# Auto Trading
auto_trade_enabled: false           # 是否启用自动交易
auto_trade_mode: notify_only        # 模式: notify_only / confirm_each / auto_execute
auto_trade_max_amount: 200.0        # 单笔最大金额 (USDT) - 合约最小100
auto_trade_max_daily: 10            # 每日最大交易次数
auto_trade_max_positions: 3         # 最大同时持仓数
auto_trade_min_confidence: 70       # 最低置信度要求

# Risk Limits (AutoTrader 风控)
risk_max_trade_amount: 200.0        # 单笔最大金额 (USDT)
risk_max_daily_trades: 30           # 每日最大交易次数（3策略 x 3币种 x ~3笔/天）
risk_max_open_positions: 12         # 最大持仓数量（3策略 x 3币种 + buffer）
risk_max_daily_loss: 500.0          # 每日最大亏损 (USDT)
risk_min_confidence: 70             # 最低置信度要求

# Signal Monitor（全局运行参数，策略级配置已下沉到 dim_strategy 表）
monitor_interval_seconds: 300       # 信号检测间隔（秒）
notify_on_signal: true               # 有信号时通知
http_timeout: 30.0                   # HTTP 请求超时（秒）
dispatch_by_strategy: false          # 是否按策略多账户分发
strategy_dispatch_amount: 100.0      # 策略分发 fallback 下单金额 (USDT)

# 以下为 fallback（数据库无策略时使用，正常应在 dim_strategy 表中配置）
default_strategy_code: market_regime
default_atr_mult_sl: 1.5
default_atr_mult_tp: 3.0
monitor_symbols:
  - BTCUSDT
  - ETHUSDT
  - SOLUSDT
monitor_timeframe: 1h
min_confidence: 50
signal_cooldown_minutes: 60

# Execution Node
heartbeat_timeout: 10.0              # 心跳 HTTP 超时（秒）

# Monitor Daemon 监控告警
monitor_enabled: true                # 是否启用监控守护
monitor_interval: 60                 # 巡检间隔（秒）
monitor_services:                    # 要巡检的服务列表
  - name: data-api
    url: http://127.0.0.1:8026/health
  - name: merchant-api
    url: http://127.0.0.1:8010/health
  - name: signal-monitor
    url: http://127.0.0.1:8020/health
monitor_node_timeout: 180            # 节点心跳超时（秒）
monitor_alert_cooldown: 300          # 同一告警去重间隔（秒）
